"use strict";(self.webpackChunkfcsapi_chart=self.webpackChunkfcsapi_chart||[]).push([["indicator.signals.order-block-signal"],{712:(e,t,r)=>{function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,l=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw l}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=Array(t);r<t;r++)o[r]=e[r];return o}function l(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,a(o.key),o)}}function a(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}function s(e,t,r){return t=h(t),function(e,t){if(t&&("object"==o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,u()?Reflect.construct(t,r||[],h(e).constructor):t.apply(e,r))}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(u=function(){return!!e})()}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}r.r(t),r.d(t,{default:()=>f});const f=function(e){function t(e,r,o){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=s(this,t,[e,r,o])).title="Order Block",n.shorttitle="OB",n.precision=2,n.minImpulseMove=void 0!==r.minImpulseMove?r.minImpulseMove:2,n.minVolumeSurge=void 0!==r.minVolumeSurge?r.minVolumeSurge:50,n.retestThreshold=void 0!==r.retestThreshold?r.retestThreshold:.5,n.showLabels=void 0===r.showLabels||r.showLabels,n.bullishColor=r.bullishColor||"#00E676",n.bearishColor=r.bearishColor||"#FF1744",n.panelType="main",n.plots=[{dataKey:"signals",colorKey:"bullishColor",title:"Order Block"}],n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(t,e),r=t,i=[{key:"getSettingsConfig",value:function(){return{inputs:[{key:"minImpulseMove",label:"Min Impulse Move %",type:"number",default:2,min:1,max:5,step:.5},{key:"minVolumeSurge",label:"Min Volume Surge %",type:"number",default:50,min:20,max:150,step:10},{key:"retestThreshold",label:"Retest Threshold %",type:"number",default:.5,min:.2,max:1.5,step:.1},{key:"showLabels",label:"Show Labels",type:"checkbox",default:!0}],style:[{key:"bullishColor",label:"Bullish Order Block",type:"color",default:"#00E676"},{key:"bearishColor",label:"Bearish Order Block",type:"color",default:"#FF1744"}]}}}],(o=[{key:"calculate",value:function(){for(var e=this.engine.data,t=[],r=e.map(function(){return null}),o=5;o<e.length-5;o++){var i=e[o],l=this.calculateAverageVolume(e,o-1,10),a=(i.volume-l)/l*100;a<this.minVolumeSurge||(this.checkImpulseMove(e,o,!0)&&t.push({type:"bullish",index:o,high:i.high,low:i.low,strength:a}),this.checkImpulseMove(e,o,!1)&&t.push({type:"bearish",index:o,high:i.high,low:i.low,strength:a}))}for(var s=0;s<e.length;s++){var u,h=e[s],c=n(t);try{for(c.s();!(u=c.n()).done;){var f=u.value;if(!(f.index>=s-5||s-f.index>100)){var b=h.close*this.retestThreshold/100;if("bullish"===f.type){if(h.low<=f.high+b&&h.low>=f.low-b&&!r[s]&&s<e.length-1&&e[s+1].close>h.close){r[s]={type:"bullish",price:h.low,blockStrength:f.strength};break}}else if(h.high>=f.low-b&&h.high<=f.high+b&&!r[s]&&s<e.length-1&&e[s+1].close<h.close){r[s]={type:"bearish",price:h.high,blockStrength:f.strength};break}}}}catch(y){c.e(y)}finally{c.f()}}this.data={signals:r,orderBlocks:t}}},{key:"checkImpulseMove",value:function(e,t,r){for(var o=0,n=0,i=t+1;i<Math.min(t+6,e.length);i++){var l=e[i-1].close,a=(e[i].close-l)/l*100;if(r){if(!(a>0))break;o+=a,n++}else{if(!(a<0))break;o+=Math.abs(a),n++}}return o>=this.minImpulseMove&&n>=2}},{key:"calculateAverageVolume",value:function(e,t,r){for(var o=0,n=0,i=Math.max(0,t-r+1);i<=t;i++)o+=e[i].volume||1,n++;return n>0?o/n:1}},{key:"render",value:function(e,t){if(this.visible&&this.data){var r=e.ctx,o=e.getDpr(),n=this.engine,i=n.data;if(this.data.signals&&this.data.signals.length===i.length||(this.calculate(),this.data&&this.data.signals)){r.save(),r.scale(o,o);for(var l=n.visibleRange,a=l.start;a<l.end;a++)if(!(a<0||a>=this.data.signals.length)){var s=this.data.signals[a];if(s){var u=n.indexToX(a)+n.candleWidth/2,h=n.priceToY(s.price);"bullish"===s.type?(this.drawBullishOrderBlock(r,u,h),this.showLabels&&this.drawLabel(r,u,h,"OB↑",this.bullishColor)):"bearish"===s.type&&(this.drawBearishOrderBlock(r,u,h),this.showLabels&&this.drawLabel(r,u,h,"OB↓",this.bearishColor))}}r.restore()}}}},{key:"drawBullishOrderBlock",value:function(e,t,r){var o=20;e.strokeStyle=this.bullishColor,e.fillStyle=this.bullishColor,e.lineWidth=2.5,e.beginPath(),e.moveTo(t-10,r+o),e.lineTo(t+10,r+o),e.stroke(),e.lineWidth=1,e.beginPath(),e.moveTo(t-10,r+o-3),e.lineTo(t+10,r+o-3),e.stroke(),e.fillRect(t-4,r+o-10,8,5),e.lineWidth=2,e.beginPath(),e.moveTo(t,r+o-15),e.lineTo(t-4,r+o-11),e.lineTo(t+4,r+o-11),e.closePath(),e.fill()}},{key:"drawBearishOrderBlock",value:function(e,t,r){var o=20;e.strokeStyle=this.bearishColor,e.fillStyle=this.bearishColor,e.lineWidth=2.5,e.beginPath(),e.moveTo(t-10,r-o),e.lineTo(t+10,r-o),e.stroke(),e.lineWidth=1,e.beginPath(),e.moveTo(t-10,r-o+3),e.lineTo(t+10,r-o+3),e.stroke(),e.fillRect(t-4,r-o+5,8,5),e.lineWidth=2,e.beginPath(),e.moveTo(t,r-o+15),e.lineTo(t-4,r-o+11),e.lineTo(t+4,r-o+11),e.closePath(),e.fill()}},{key:"drawLabel",value:function(e,t,r,o,n){e.font="bold 9px sans-serif",e.fillStyle=n,e.textAlign="center";var i=o.includes("↑")?40:-35;e.fillText(o,t,r+i)}}])&&l(r.prototype,o),i&&l(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,o,i}(r(8018).A)}}]);