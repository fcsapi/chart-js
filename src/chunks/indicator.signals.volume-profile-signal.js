"use strict";(self.webpackChunkfcsapi_chart=self.webpackChunkfcsapi_chart||[]).push([["indicator.signals.volume-profile-signal"],{1626:(e,t,o)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function l(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(e){if("string"==typeof e)return n(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var r=0,l=function(){};return{s:l,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==o.return||o.return()}finally{if(c)throw a}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=Array(t);o<t;o++)r[o]=e[o];return r}function a(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var l=o.call(e,t||"default");if("object"!=r(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function c(e,t,o){return t=u(t),function(e,t){if(t&&("object"==r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,s()?Reflect.construct(t,o||[],u(e).constructor):t.apply(e,o))}function s(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(s=function(){return!!e})()}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}o.r(t),o.d(t,{default:()=>f});const f=function(e){function t(e,o,r){var l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(l=c(this,t,[e,o,r])).title="Volume Profile",l.shorttitle="Vol Prof",l.precision=2,l.lookbackPeriod=void 0!==o.lookbackPeriod?o.lookbackPeriod:50,l.priceRows=void 0!==o.priceRows?o.priceRows:24,l.valueAreaPercent=void 0!==o.valueAreaPercent?o.valueAreaPercent:70,l.touchThreshold=void 0!==o.touchThreshold?o.touchThreshold:.5,l.showLabels=void 0===o.showLabels||o.showLabels,l.pocColor=o.pocColor||"#FFC107",l.vahColor=o.vahColor||"#FF5722",l.valColor=o.valColor||"#03A9F4",l.panelType="main",l.plots=[{dataKey:"signals",colorKey:"pocColor",title:"Volume Profile"}],l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(t,e),o=t,n=[{key:"getSettingsConfig",value:function(){return{inputs:[{key:"lookbackPeriod",label:"Lookback Period",type:"number",default:50,min:20,max:200,step:10},{key:"priceRows",label:"Price Rows",type:"number",default:24,min:12,max:48,step:6},{key:"valueAreaPercent",label:"Value Area %",type:"number",default:70,min:60,max:80,step:5},{key:"touchThreshold",label:"Touch Threshold %",type:"number",default:.5,min:.2,max:1.5,step:.1},{key:"showLabels",label:"Show Labels",type:"checkbox",default:!0}],style:[{key:"pocColor",label:"POC (Point of Control)",type:"color",default:"#FFC107"},{key:"vahColor",label:"VAH (Value Area High)",type:"color",default:"#FF5722"},{key:"valColor",label:"VAL (Value Area Low)",type:"color",default:"#03A9F4"}]}}}],(r=[{key:"calculate",value:function(){for(var e=this.engine.data,t=[],o=this.lookbackPeriod;o<e.length;o++){var r=e.slice(o-this.lookbackPeriod,o),l=this.calculateVolumeProfile(r),n=e[o],a=this.touchThreshold/100*n.close;t[o]=null,Math.abs(n.close-l.poc)<=a?t[o]={type:"poc",price:n.close,level:l.poc,levelName:"POC"}:Math.abs(n.close-l.vah)<=a?t[o]={type:"vah",price:n.close,level:l.vah,levelName:"VAH"}:Math.abs(n.close-l.val)<=a&&(t[o]={type:"val",price:n.close,level:l.val,levelName:"VAL"})}this.data={signals:t}}},{key:"calculateVolumeProfile",value:function(e){var t,o=-1/0,r=1/0,n=l(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;o=Math.max(o,a.high),r=Math.min(r,a.low)}}catch(S){n.e(S)}finally{n.f()}var i,c=(o-r)/this.priceRows,s=new Array(this.priceRows).fill(0),u=l(e);try{for(u.s();!(i=u.n()).done;){var h=i.value,f=h.volume||1;if(0===h.high-h.low){var p=Math.floor((h.close-r)/c);s[Math.max(0,Math.min(this.priceRows-1,p))]+=f}else for(var v=h.low;v<=h.high;v+=c){var y=Math.floor((v-r)/c);s[Math.max(0,Math.min(this.priceRows-1,y))]+=f/this.priceRows}}}catch(S){u.e(S)}finally{u.f()}for(var b=0,d=s[0],m=1;m<s.length;m++)s[m]>d&&(d=s[m],b=m);for(var w=r+(b+.5)*c,g=s.reduce(function(e,t){return e+t},0)*(this.valueAreaPercent/100),k=s[b],P=b,C=b;k<g&&(P>0||C<this.priceRows-1);){var T=P>0?s[P-1]:0,A=C<this.priceRows-1?s[C+1]:0;T>A&&P>0?(P--,k+=T):C<this.priceRows-1?(C++,k+=A):P>0&&(P--,k+=T)}return{poc:w,val:r+(P+.5)*c,vah:r+(C+.5)*c}}},{key:"render",value:function(e,t){if(this.visible&&this.data){var o=e.ctx,r=e.getDpr(),l=this.engine,n=l.data;if(this.data.signals&&this.data.signals.length===n.length||(this.calculate(),this.data&&this.data.signals)){o.save(),o.scale(r,r);for(var a=l.visibleRange,i=a.start;i<a.end;i++)if(!(i<0||i>=this.data.signals.length)){var c=this.data.signals[i];if(c){var s=l.indexToX(i)+l.candleWidth/2,u=l.priceToY(c.price);"poc"===c.type?(this.drawPOCTouch(o,s,u),this.showLabels&&this.drawLabel(o,s,u,"POC",this.pocColor)):"vah"===c.type?(this.drawVAHTouch(o,s,u),this.showLabels&&this.drawLabel(o,s,u,"VAH",this.vahColor)):"val"===c.type&&(this.drawVALTouch(o,s,u),this.showLabels&&this.drawLabel(o,s,u,"VAL",this.valColor))}}o.restore()}}}},{key:"drawPOCTouch",value:function(e,t,o){e.strokeStyle=this.pocColor,e.fillStyle=this.pocColor,e.lineWidth=2,e.beginPath(),e.moveTo(t-10,o),e.lineTo(t+10,o),e.stroke(),e.beginPath(),e.arc(t,o,4,0,2*Math.PI),e.fill()}},{key:"drawVAHTouch",value:function(e,t,o){e.strokeStyle=this.vahColor,e.fillStyle=this.vahColor,e.lineWidth=2,e.beginPath(),e.moveTo(t,o-6),e.lineTo(t+6,o),e.lineTo(t,o+6),e.lineTo(t-6,o),e.closePath(),e.stroke()}},{key:"drawVALTouch",value:function(e,t,o){e.strokeStyle=this.valColor,e.fillStyle=this.valColor,e.lineWidth=2,e.beginPath(),e.moveTo(t,o-6),e.lineTo(t+6,o),e.lineTo(t,o+6),e.lineTo(t-6,o),e.closePath(),e.stroke()}},{key:"drawLabel",value:function(e,t,o,r,l){e.font="bold 9px sans-serif",e.fillStyle=l,e.textAlign="center",e.fillText(r,t,o-15)}}])&&a(o.prototype,r),n&&a(o,n),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,r,n}(o(8018).A)}}]);