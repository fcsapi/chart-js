"use strict";(self.webpackChunkfcsapi_chart=self.webpackChunkfcsapi_chart||[]).push([["src_core_UIManager_js"],{6917:(e,t,a)=>{a.r(t),a.d(t,{default:()=>E});var n=a(6942),i=a(548),o=a(7741),r=a(9692),s=a(3606),l=a(6626),c=a(1068),d=a(7001),u=a(8098);function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function g(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach(function(t){L(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,i,o,r,s=[],l=!0,c=!1;try{if(o=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;l=!1}else for(;!(l=(n=o.call(a)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=a.return&&(r=a.return(),Object(r)!==r))return}finally{if(c)throw i}}return s}}(e,t)||b(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=b(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return r=e.done,e},e:function(e){s=!0,o=e},f:function(){try{r||null==a.return||a.return()}finally{if(s)throw o}}}}function f(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||b(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){if(e){if("string"==typeof e)return y(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?y(e,t):void 0}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=Array(t);a<t;a++)n[a]=e[a];return n}function w(){var e,t,a="function"==typeof Symbol?Symbol:{},n=a.iterator||"@@iterator",i=a.toStringTag||"@@toStringTag";function o(a,n,i,o){var l=n&&n.prototype instanceof s?n:s,c=Object.create(l.prototype);return C(c,"_invoke",function(a,n,i){var o,s,l,c=0,d=i||[],u=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,a){return o=t,s=0,l=e,h.n=a,r}};function p(a,n){for(s=a,l=n,t=0;!u&&c&&!i&&t<d.length;t++){var i,o=d[t],p=h.p,g=o[2];a>3?(i=g===n)&&(l=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=e):o[0]<=p&&((i=a<2&&p<o[1])?(s=0,h.v=n,h.n=o[1]):p<g&&(i=a<3||o[0]>n||n>g)&&(o[4]=a,o[5]=n,h.n=g,s=0))}if(i||a>1)return r;throw u=!0,n}return function(i,d,g){if(c>1)throw TypeError("Generator is already running");for(u&&1===d&&p(d,g),s=d,l=g;(t=s<2?e:l)||!u;){o||(s?s<3?(s>1&&(h.n=-1),p(s,l)):h.n=l:h.v=l);try{if(c=2,o){if(s||(i="next"),t=o[i]){if(!(t=t.call(o,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=o.return)&&t.call(o),s<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),s=1);o=e}else if((t=(u=h.n<0)?l:a.call(n,h))!==r)break}catch(t){o=e,s=1,l=t}finally{c=1}}return{value:t,done:u}}}(a,i,o),!0),c}var r={};function s(){}function l(){}function c(){}t=Object.getPrototypeOf;var d=[][n]?t(t([][n]())):(C(t={},n,function(){return this}),t),u=c.prototype=s.prototype=Object.create(d);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,C(e,i,"GeneratorFunction")),e.prototype=Object.create(u),e}return l.prototype=c,C(u,"constructor",c),C(c,"constructor",l),l.displayName="GeneratorFunction",C(c,i,"GeneratorFunction"),C(u),C(u,i,"Generator"),C(u,n,function(){return this}),C(u,"toString",function(){return"[object Generator]"}),(w=function(){return{w:o,m:h}})()}function C(e,t,a,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}C=function(e,t,a,n){function o(t,a){C(e,t,function(e){return this._invoke(t,a,e)})}t?i?i(e,t,{value:a,enumerable:!n,configurable:!n,writable:!n}):e[t]=a:(o("next",0),o("throw",1),o("return",2))},C(e,t,a,n)}function S(e,t,a,n,i,o,r){try{var s=e[o](r),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(n,i)}function k(e){return function(){var t=this,a=arguments;return new Promise(function(n,i){var o=e.apply(t,a);function r(e){S(o,n,i,r,s,"next",e)}function s(e){S(o,n,i,r,s,"throw",e)}r(void 0)})}}function T(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,M(n.key),n)}}function L(e,t,a){return(t=M(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function M(e){var t=function(e,t){if("object"!=h(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==h(t)?t:t+""}const E=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),L(this,"selectedMarkerType","arrow-up"),L(this,"selectedMarkerColor","#26a69a"),this.engine=t,this.chartId=this.engine.container.id,this.chartIndex=this.engine.container.dataset.chartIndex||"1",this.isMainChart="1"===this.chartIndex||1===this.chartIndex,this.timeframeLabels={CUSTOM:"Add custom interval","1m":"1 Minute","2m":"2 Minutes","3m":"3 Minutes","5m":"5 Minutes","10m":"10 Minutes","15m":"15 Minutes","30m":"30 Minutes","1H":"1 Hour","2H":"2 Hours","4H":"4 Hours","6H":"6 Hours","8H":"8 Hours","12H":"12 Hours","1D":"1 Day","1W":"1 Week","1M":"1 Month"},this.unitLabels={m:{singular:"Minute",plural:"Minutes"},H:{singular:"Hour",plural:"Hours"},D:{singular:"Day",plural:"Days"},W:{singular:"Week",plural:"Weeks"},M:{singular:"Month",plural:"Months"}},this.loadFavoriteIndicators(),this.keepDrawingMode=!1,this.hasUnsavedChanges=!1,this.isLoadingTemplate=!1,this._indicatorUpdateDebounceTimer=null,this._indicatorUpdateDebounceDelay=35,this._indicatorValueCache=new Map,this.createUI(),this.initializeTooltipSystem()},t=[{key:"getToolShortcut",value:function(e){return{trendline:"Alt+T",horizontal:"Alt+H",vertical:"Alt+V",cross:"Alt+C",ray:"Alt+J",extended:"Alt+E",infoline:"Alt+M",parallelchannel:"Alt+Shift+P",fibonacci:"Alt+F",rectangle:"Alt+Shift+R",ellipse:"Alt+Shift+E",arrow:"Alt+Shift+A",brush:"Alt+B",note:"Alt+N",deleteAll:"Alt+Shift+Del"}[e]||null}},{key:"getTimeframeFullLabel",value:function(e){if(this.timeframeLabels[e])return this.timeframeLabels[e];var t=e.match(/^(\d+)([mHDWM])$/);if(t){var a=parseInt(t[1]),n=t[2],i=this.unitLabels[n];if(i)return"".concat(a," ").concat(1===a?i.singular:i.plural)}return e}},{key:"hasAnyFavoriteTimeframes",value:function(){return this.loadFavoriteTimeframes().length>0}},{key:"getTimeframeTriggerLabel",value:function(e){return this.hasAnyFavoriteTimeframes()?e:this.getTimeframeFullLabel(e)}},{key:"isKeyboardDevice",value:function(){return window.matchMedia("(pointer: fine)").matches}},{key:"createUI",value:(I=k(w().m(function e(){var t,a;return w().w(function(e){for(;;)switch(e.n){case 0:if(this.engine.container.dataset.chartIndex,this.chartId=this.engine.container.id,t=this.engine.options,(a=t.parentContainer||this.engine.container.parentElement)&&(!1===t.enableSidebar&&a.classList.add("fcs-no-sidebar"),!1===t.enableToolbar&&a.classList.add("fcs-no-toolbar"),!1===t.enableRangeSelector&&a.classList.add("fcs-no-rangebar")),"chartonly"!==t.displayMode){e.n=1;break}return this.allIndicators=!1!==t.enableIndicators?this.getAllIndicatorDefinitions():[],e.a(2);case 1:this.allIndicators=!1!==t.enableIndicators?this.getAllIndicatorDefinitions():[],!1!==t.enableToolbar&&this.createTopToolbar(),!1!==t.enableSidebar&&(this.createLeftSidebar(),this.engine.chartArea.classList.add("fcsapi-chart-area-with-sidebar")),this.loadChartSettings(),!1!==t.enableIndicators&&this.createIndicatorLegend(),!1!==t.enableReplay&&this.createReplayControlBar(),!1!==t.enableSearch&&this.createSearchModal(),!1!==t.enableIndicators&&this.createIndicatorModal(),!1!==t.enableSettings&&this.createChartSettingsModal(),o.s.init(this.engine),!1!==t.enableContextMenu&&!1!==t.enableDrawingTools&&this.createDrawingContextMenu(),!1!==t.enableDrawingTools&&this.createFloatingToolbar(),!1!==t.enableSettings&&this.createSettingsDialog(),this.createChartSettingsMenu();case 2:return e.a(2)}},e,this)})),function(){return I.apply(this,arguments)})},{key:"getAllIndicatorDefinitions",value:function(){var e=[];return r&&Array.isArray(r)&&r.forEach(function(t,a){var n=t.folder||t.category||"editorchoice",i=t.timeLabel?"[".concat(t.timeLabel,"] "):"",o="".concat(i).concat(t.title);e.push({type:t.class,label:o,params:{},category:n,source:"pinescript",originalFile:t.originalPine,overlay:t.overlay})}),e}},{key:"createTopToolbar",value:function(){var e=this.engine.options;this.toolbar=document.createElement("div"),this.toolbar.className="fcsapi-toolbar-top",this.toolbar.setAttribute("data-chart-id",this.chartId),this.toolbar.setAttribute("data-chart-index",this.chartIndex),this.engine.parentContainer&&this.engine.parentContainer!==this.engine.container?this.engine.parentContainer.insertBefore(this.toolbar,this.engine.container):this.engine.container.insertBefore(this.toolbar,this.engine.chartArea);var t=document.createElement("div");if(t.className="toolbar-top-left",!1!==e.enableSearch&&this.createSymbolSearchButton(t),!1!==e.enableSymbolInfo&&this.createStockInfoButton(t),!1!==e.enableTimeframeSelector&&this.createFavoriteTimeframes(t),!1!==e.enableTimeframeSelector&&this.createTimeframeDropdown(t),!1!==e.enableChartTypeSelector&&this.createChartTypeDropdown(t),!1!==e.enableIndicators&&this.createIndicatorsButton(t),!1!==e.enableIndicators){var a=document.createElement("div");a.className="toolbar-separator",t.appendChild(a)}if(!1!==e.enableReplay&&this.createReplayButton(t),!1!==e.enableReplay){var n=document.createElement("div");n.className="toolbar-separator",t.appendChild(n)}!1!==e.enableUndoRedo&&this.createUndoButtonTop(t),!1!==e.enableUndoRedo&&this.createRedoButtonTop(t);var i=document.createElement("div");if(i.className="toolbar-top-right",!1!==e.enableTemplates&&this.createTemplateDropdown(i),!1!==e.enableTemplates&&!1!==e.enableMultiChart){var o=document.createElement("div");o.className="toolbar-separator",i.appendChild(o)}if(!1!==e.enableMultiChart&&this.createMultiChartButton(i),!1!==e.enableMultiChart&&!1!==e.enableSettings){var r=document.createElement("div");r.className="toolbar-separator",i.appendChild(r)}!1!==e.enableSettings&&this.createSettingsButton(i),!1!==e.enableFullscreen&&this.createFullscreenButton(i),!1!==e.enableCapture&&this.createScreenshotButton(i),this.createShortcutsButton(i);var s=document.createElement("button");s.className="toolbar-scroll-btn toolbar-scroll-left",s.innerHTML=l.cI.scrollLeft,s.setAttribute("data-tooltip-title","Scroll toolbar left");var c=document.createElement("button");c.className="toolbar-scroll-btn toolbar-scroll-right",c.innerHTML=l.cI.scrollRight,c.setAttribute("data-tooltip-title","Scroll toolbar right");var d=document.createElement("div");d.className="toolbar-scroll-content",d.appendChild(t),d.appendChild(i),s.addEventListener("click",function(){d.scrollBy({left:-150,behavior:"smooth"})}),c.addEventListener("click",function(){d.scrollBy({left:150,behavior:"smooth"})});var u=function(){var e=d.scrollLeft,t=e>0,a=e<d.scrollWidth-d.clientWidth-1;s.classList.toggle("visible",t),c.classList.toggle("visible",a)};d.addEventListener("scroll",u),window.addEventListener("resize",function(){requestAnimationFrame(u)}),requestAnimationFrame(u),this.toolbar.appendChild(s),this.toolbar.appendChild(d),this.toolbar.appendChild(c),this.toolbarScrollContent=d,this.updateToolbarScrollButtons=u}},{key:"createSymbolSearchButton",value:function(e){var t=this,a=document.createElement("button");a.className="toolbar-search-btn",a.innerHTML='\n      <svg width="18" height="18" fill="none" stroke="currentColor">\n        <use href="#search"></use>\n    </svg>\n    <span class="search-symbol-text"></span>\n    ',a.setAttribute("data-tooltip-title",(0,u.Eg)("search",!1)),a.setAttribute("data-cm-toggle","custom-modal"),a.setAttribute("data-cm-target","#chartSearchModal"),a.addEventListener("click",function(){var e=a.closest(".fcsapi-toolbar-top"),n=e?e.getAttribute("data-chart-id"):t.engine.container.id;window._fcsapiSearchManager&&(window._fcsapiSearchManager.targetChartId=n)}),e.appendChild(a),this.searchBtn=a}},{key:"updateSearchSymbolText",value:function(e){var t;if(e){var a=null===(t=this.searchBtn)||void 0===t?void 0:t.querySelector(".search-symbol-text");a&&(a.textContent=e)}}},{key:"createTimeframeDropdown",value:function(e){var t=this,a=this.engine.options.period||"1D",n=this.getCustomTimeframes(),i=n.filter(function(e){return e.endsWith("m")}),o=n.filter(function(e){return e.endsWith("H")}),r=n.filter(function(e){return e.endsWith("D")&&"1D"!==e}),s=n.filter(function(e){return e.endsWith("W")&&"1W"!==e}),d=n.filter(function(e){return e.endsWith("M")&&"1M"!==e}),u=this.sortTimeframes([].concat(["1m","2m","3m","5m","10m","15m","30m"],f(i))),h=this.sortTimeframes([].concat(["1H","2H","4H","6H","8H","12H"],f(o))),p=this.sortTimeframes([].concat(["1D","1W","1M"],f(r),f(s),f(d))),g=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.isFavoriteTimeframe(e),o='<span class="favorite-star '.concat(i?"favorited":"",'" data-timeframe="').concat(e,'">\n            <svg width="16" height="16" fill="none" stroke="currentColor"><use href="#star"></use></svg>\n          </span>'),r=n?'<span class="custom-tf-delete" data-timeframe="'.concat(e,'">\n            ').concat(l.cI.trash,"\n          </span>"):"";return'<li class="select-option '.concat(e===a?"selected":"").concat(n?" custom-timeframe-item":"",'" data-value="').concat(e,'">\n        <span>').concat(t.getTimeframeFullLabel(e),'</span>\n        <span class="tf-actions">').concat(o).concat(r,"</span>\n      </li>")},m="";m+='<li class="tf-group-header">Minutes</li>',u.forEach(function(e){m+=g(e,i.includes(e))}),m+='<li class="tf-group-header">Hours</li>',h.forEach(function(e){m+=g(e,o.includes(e))}),m+='<li class="tf-group-header">Days</li>',p.forEach(function(e){m+=g(e,function(e){return r.includes(e)||s.includes(e)||d.includes(e)}(e))});var v="timeframeDropdownList-".concat(this.chartId),b=document.createElement("div");b.className="dropdown-select",b.id="timeframeSelect",b.setAttribute("data-dropdown-id",v),b.innerHTML='\n      <div class="select-trigger" tabindex="0" data-tooltip-title="Choose the chart timeframe">\n        <span class="select-trigger-text-nochange tf-label">'.concat(this.getTimeframeTriggerLabel(a),'</span>\n        <svg width="18" height="18" class="select-arrow" fill="none" stroke="currentColor">\n          <use href="#chevron-down"></use>\n        </svg>\n      </div>\n    ');var y=document.createElement("div");y.id=v,y.className="select-dropdown",y.innerHTML='\n      <div class="select-option tf-custom-option" data-value="CUSTOM" data-cm-toggle="custom-modal" data-cm-target="#timeframeModal">\n        '.concat(l.cI.plus,"\n        <span>").concat(this.timeframeLabels.CUSTOM,'</span>\n      </div>\n      <ul class="select-options" data-max-height-offset="60">\n        ').concat(m,"\n      </ul>\n    "),document.body.appendChild(y),this.timeframeSelect=b,this.timeframeButton=b.querySelector(".select-trigger"),this.timeframeDropdown=y,e.appendChild(b),new c.A(b),y.addEventListener("click",function(e){var a=e.target.closest(".favorite-star");if(a){e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation();var n=a.dataset.timeframe,i=t.toggleFavoriteTimeframe(n);a.classList.toggle("favorited",i),n===(t.engine.options.period||"1D")&&(b.querySelector(".tf-label").textContent=t.getTimeframeTriggerLabel(n))}else{var o=e.target.closest(".custom-tf-delete");if(o){e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation();var r=o.dataset.timeframe;t.removeCustomTimeframe(r);var s=o.closest(".select-option");s&&s.remove()}}},!0);var w=y.querySelector(".tf-custom-option");w&&w.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),b.customSelectAPI&&b.customSelectAPI.close(),t.engine.shortcutManager&&t.engine.shortcutManager.createTimeframeModal();var a=document.getElementById("timeframeModal");a&&window.CustomModal&&window.CustomModal.getOrCreateInstance(a).show()}),b.addEventListener("customSelectChange",function(e){var a=e.detail.value;b.querySelector(".tf-label").textContent=t.getTimeframeTriggerLabel(a),t.engine.isParentChart()&&t.engine.saveToCache("fcsapi_timeframe",a),t.engine.chartInstance&&t.engine.chartInstance.setPeriod(a)})}},{key:"refreshTimeframeDropdown",value:function(){var e=this;if(this.timeframeDropdown){var t=this.engine.options.period||"1D",a=this.getCustomTimeframes(),n=a.filter(function(e){return e.endsWith("m")}),i=a.filter(function(e){return e.endsWith("H")}),o=a.filter(function(e){return e.endsWith("D")&&"1D"!==e}),r=a.filter(function(e){return e.endsWith("W")&&"1W"!==e}),s=a.filter(function(e){return e.endsWith("M")&&"1M"!==e}),c=this.sortTimeframes([].concat(["1m","2m","3m","5m","10m","15m","30m"],f(n))),d=this.sortTimeframes([].concat(["1H","2H","4H","6H","8H","12H"],f(i))),u=this.sortTimeframes([].concat(["1D","1W","1M"],f(o),f(r),f(s))),h=function(a){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.isFavoriteTimeframe(a),o='<span class="favorite-star '.concat(i?"favorited":"",'" data-timeframe="').concat(a,'">\n            <svg width="16" height="16" fill="none" stroke="currentColor"><use href="#star"></use></svg>\n          </span>'),r=n?'<span class="custom-tf-delete" data-timeframe="'.concat(a,'">\n            ').concat(l.cI.trash,"\n          </span>"):"";return'<li class="select-option '.concat(a===t?"selected":"").concat(n?" custom-timeframe-item":"",'" data-value="').concat(a,'">\n        <span>').concat(e.getTimeframeFullLabel(a),'</span>\n        <span class="tf-actions">').concat(o).concat(r,"</span>\n      </li>")},p="";p+='<li class="tf-group-header">Minutes</li>',c.forEach(function(e){p+=h(e,n.includes(e))}),p+='<li class="tf-group-header">Hours</li>',d.forEach(function(e){p+=h(e,i.includes(e))}),p+='<li class="tf-group-header">Days</li>',u.forEach(function(e){p+=h(e,function(e){return o.includes(e)||r.includes(e)||s.includes(e)}(e))});var g=this.timeframeDropdown.querySelector(".select-options");g&&(g.innerHTML=p)}}},{key:"createFavoriteTimeframes",value:function(e){var t=document.createElement("div");t.className="favorite-timeframes";var a=document.createElement("div");a.className="toolbar-separator",t.appendChild(a),this.favoriteTimeframesContainer=t,this.updateFavoriteTimeframes(),e.appendChild(t)}},{key:"updateFavoriteTimeframes",value:function(){var e=this;if(this.favoriteTimeframesContainer){var t=this.loadFavoriteTimeframes(),a=this.sortTimeframes(t),n=this.favoriteTimeframesContainer.querySelector(".toolbar-separator");this.favoriteTimeframesContainer.innerHTML="",n&&this.favoriteTimeframesContainer.appendChild(n),0===a.length?this.favoriteTimeframesContainer.style.display="none":(this.favoriteTimeframesContainer.style.display="flex",a.forEach(function(t){var a=document.createElement("button");a.className="toolbar-timeframe-btn",a.textContent=t,a.setAttribute("data-tooltip-title","Switch to ".concat(e.getTimeframeFullLabel(t)));var n=e.engine.options.period||"1D";t===n&&a.classList.add("active"),a.addEventListener("click",function(){e.engine.chartInstance&&e.engine.chartInstance.setPeriod(t),e.favoriteTimeframesContainer.querySelectorAll(".toolbar-timeframe-btn").forEach(function(e){e.classList.remove("active")}),a.classList.add("active"),e.updateTimeframeDropdown(t),e.engine.isParentChart()&&e.engine.saveToCache("fcsapi_timeframe",t)}),e.favoriteTimeframesContainer.appendChild(a)}))}this.updateTimeframeDropdownStars()}},{key:"updateTimeframeDropdownStars",value:function(){if(this.timeframeDropdown){var e=this.loadFavoriteTimeframes();this.timeframeDropdown.querySelectorAll(".favorite-star[data-timeframe]").forEach(function(t){var a=t.dataset.timeframe;e.includes(a)?t.classList.add("favorited"):t.classList.remove("favorited")})}}},{key:"updateTimeframeDropdown",value:function(e){if(this.timeframeSelect){this.timeframeSelect.querySelector(".tf-label").textContent=this.getTimeframeTriggerLabel(e),(this.timeframeDropdown||this.timeframeSelect).querySelectorAll(".select-option").forEach(function(t){var a=t.dataset.value;t.classList.remove("selected"),a===e&&t.classList.add("selected")});var t=!1;this.favoriteTimeframesContainer&&this.favoriteTimeframesContainer.querySelectorAll(".toolbar-timeframe-btn").forEach(function(a){a.textContent===e?(a.classList.add("active"),t=!0):a.classList.remove("active")});var a=this.timeframeSelect.querySelector(".select-trigger");a&&(t?a.classList.remove("list-selected"):a.classList.add("list-selected"))}}},{key:"createChartTypeDropdown",value:function(e){var t=this,a=[[{id:"candles",icon:l.AM.candles,label:"Candlestick"},{id:"hollow-candles",icon:l.AM["hollow-candles"],label:"Hollow Candles"},{id:"volume-candles",icon:l.AM["volume-candles"],label:"Volume Candles"},{id:"heikin-ashi",icon:l.AM["heikin-ashi"],label:"Heikin Ashi"}],[{id:"bars",icon:l.AM.bars,label:"Bars"},{id:"hlc",icon:l.AM.hlc,label:"HLC Area"},{id:"high-low",icon:l.AM["high-low"],label:"High-Low"}],[{id:"line",icon:l.AM.line,label:"Line"},{id:"line-with-markers",icon:l.AM["line-with-markers"],label:"Line with Markers"},{id:"step-line",icon:l.AM["step-line"],label:"Step Line"},{id:"colored-line",icon:l.AM["colored-line"],label:"Colored Line"}],[{id:"area",icon:l.AM.area,label:"Area"},{id:"baseline",icon:l.AM.baseline,label:"Baseline"},{id:"columns",icon:l.AM.columns,label:"Columns"},{id:"dots",icon:l.AM.dots,label:"Dots"}],[{id:"renko",icon:l.AM.renko,label:"Renko",hasSettings:!0}]],n=a.flat();this.chartTypes=n;var i=n.find(function(e){return e.id===t.engine.chartType})||n[0],o="";a.forEach(function(e,t){e.forEach(function(e){var t=e.id===i.id,a=e.hasSettings?'<span class="chart-type-settings" data-type="'.concat(e.id,'" data-tooltip-title="Settings">\n               ').concat(l.cI.settings,"\n             </span>"):"",n='<span class="select-option-img"><div class="flag-icon-container">'.concat(e.icon,"</div></span>");o+='\n          <li class="select-option'.concat(t?" selected":"",'" data-value="').concat(e.id,'" data-html="').concat(n.replace(/"/g,"&quot;"),'">\n            <span class="select-option-img">\n              <div class="flag-icon-container">').concat(e.icon,"</div>\n              <span>").concat(e.label,"</span>\n            </span>\n            ").concat(a,"\n          </li>\n        ")}),t<a.length-1&&(o+='<li class="chart-type-separator"></li>')});var r=this.engine.container.id||"main",s="chartTypeDropdownList_".concat(r),d=document.createElement("div");d.className="dropdown-select chart-type-select",d.setAttribute("data-dropdown-id",s),d.innerHTML='\n      <div class="select-trigger" tabindex="0" data-tooltip-title="'.concat(i.label,'">\n        <span class="select-trigger-text">\n          <span class="select-option-img"><div class="flag-icon-container">').concat(i.icon,"</div>").concat(i.label,"</span>\n        </span>\n      </div>\n    ");var u=document.createElement("div");u.id=s,u.className="select-dropdown",u.innerHTML='<ul class="select-options">'.concat(o,"</ul>"),document.body.appendChild(u),this.chartTypeSelect=d,this.chartTypeDropdown=u;var h=document.createElement("div");h.className="toolbar-separator",e.appendChild(h),e.appendChild(d);var p=document.createElement("div");p.className="toolbar-separator",e.appendChild(p),new c.A(d),u.addEventListener("click",function(e){var a,n=e.target.closest(".chart-type-settings");n&&(e.stopPropagation(),e.preventDefault(),"renko"===n.dataset.type&&(d.customSelectAPI&&d.customSelectAPI.close(),((null===(a=t.engine.multiChartManager)||void 0===a||null===(a=a.getActiveChart())||void 0===a?void 0:a.engine)||t.engine).setChartType("renko"),t.updateChartTypeDropdown("renko"),t.showRenkoSettings()))},!0),d.addEventListener("customSelectChange",function(e){var a,n=e.detail.value;n&&((null===(a=t.engine.multiChartManager)||void 0===a||null===(a=a.getActiveChart())||void 0===a?void 0:a.engine)||t.engine).setChartType(n)})}},{key:"updateChartTypeDropdown",value:function(e){if(this.chartTypeSelect&&this.chartTypeDropdown&&this.chartTypes){var t=this.chartTypes.find(function(t){return t.id===e});if(t){var a=this.chartTypeSelect.querySelector(".select-trigger");if(a&&a.setAttribute("data-tooltip-title",t.label),this.chartTypeSelect.customSelectAPI)this.chartTypeSelect.customSelectAPI.setValue(e);else{var n=this.chartTypeSelect.querySelector(".select-trigger-text");n&&(n.innerHTML='<span class="select-option-img"><div class="flag-icon-container">'.concat(t.icon,"</div>").concat(t.label,"</span>")),this.chartTypeDropdown.querySelectorAll(".select-option").forEach(function(t){t.classList.toggle("selected",t.dataset.value===e)})}}}}},{key:"createIndicatorsButton",value:function(e){var t=this,a=document.createElement("div");a.className="indicator-wrapper",a.id="indicatorSelect";var n=document.createElement("button");n.className="toolbar-dropdown-btn indicator-main-btn",n.innerHTML="".concat(l.cI.indicator," <span>Indicators</span>"),n.setAttribute("data-tooltip-title",(0,u.Eg)("indicators")),n.setAttribute("data-cm-toggle","custom-modal"),n.setAttribute("data-cm-target","#chartIndicatorModal"),n.addEventListener("click",function(){var e;null===(e=t.indicatorModalManager)||void 0===e||e.updateIndicators(t.allIndicators,t.favoriteIndicators)});var i="favIndicatorDropdownList-".concat(this.chartId),o=document.createElement("div");o.className="dropdown-select fav-indicator-select",o.setAttribute("data-dropdown-id",i),o.innerHTML='\n      <div class="select-trigger" tabindex="0" data-tooltip-title="Favorite Indicators">\n        <svg width="18" height="18" class="select-arrow" fill="none" stroke="currentColor">\n          <use href="#chevron-down"></use>\n        </svg>\n      </div>\n    ';var r=document.createElement("div");r.id=i,r.className="select-dropdown fav-indicator-dropdown",r.innerHTML='<ul class="select-options fav-indicator-list"></ul>',document.body.appendChild(r),this.favIndicatorSelect=o,this.favIndicatorDropdown=r,a.appendChild(n),a.appendChild(o),e.appendChild(a),new c.A(o),r.addEventListener("click",function(e){var a=e.target.closest(".select-option");if(a&&a.dataset.indicator){e.stopPropagation();var n=a.dataset.indicator;t.engine.indicatorManager.addIndicator(n),o.customSelectAPI&&o.customSelectAPI.close()}}),this.updateFavoriteIndicatorsDropdown()}},{key:"updateFavoriteIndicatorsDropdown",value:function(){var e,t=this;if(this.favIndicatorDropdown){var a=this.favIndicatorDropdown.querySelector(".fav-indicator-list");if(a){var n=this.favoriteIndicators||[];if(0===n.length)return this.favIndicatorSelect&&this.favIndicatorSelect.classList.add("hidden"),void(a.innerHTML='<li class="select-option no-favorites">No favorites yet</li>');this.favIndicatorSelect&&this.favIndicatorSelect.classList.remove("hidden");var i='<li class="tf-group-header">Favorite indicators</li>';n.forEach(function(e){var a,n=null===(a=t.allIndicators)||void 0===a?void 0:a.find(function(t){return t.type===e}),o=(null==n?void 0:n.name)||e;i+='\n        <li class="select-option" data-indicator="'.concat(e,'">\n          <span class="select-option-text">').concat(o,"</span>\n        </li>\n      ")}),a.innerHTML=i,null!==(e=this.favIndicatorSelect)&&void 0!==e&&e.customSelectAPI&&this.favIndicatorSelect.customSelectAPI.refresh()}}}},{key:"createStockInfoButton",value:function(e){var t=document.createElement("button");t.className="toolbar-dropdown-btn stock-info-btn",t.innerHTML="".concat(l.cI.info," <span>Info</span>"),t.setAttribute("data-tooltip-title",(0,u.Eg)("stockInfo",!1)),t.setAttribute("data-cm-toggle","custom-modal"),t.setAttribute("data-cm-target","#profilePanelModal"),e.appendChild(t),this.stockInfoBtn=t}},{key:"updateStockInfoButton",value:function(e){}},{key:"createTemplateDropdown",value:function(e){var t=this;this.loadTemplates(),this.currentTemplate||(this.currentTemplate="Default"),this.templateAutoSave=this.loadTemplateSetting("autoSave",!1),this.templateSharing=this.loadTemplateSetting("sharing",!1);var a=this.engine.container.id||"main",n="templateDropdownList_".concat(a),i=document.createElement("div");i.className="template-wrapper",i.id="templateSelect";var o=document.createElement("div");o.className="dropdown-select template-select",o.setAttribute("data-dropdown-id",n),o.setAttribute("data-placement","bottom-right"),o.innerHTML='\n      <div class="select-trigger" tabindex="0" data-tooltip-title="Chart Layouts">\n        <svg width="18" height="18" class="select-arrow" fill="none" stroke="currentColor">\n          <use href="#chevron-down"></use>\n        </svg>\n      </div>\n    ';var r=document.createElement("button");r.className="template-name-btn toolbar-dropdown-btn",r.innerHTML='<span class="template-label">'.concat(this.currentTemplate,"</span>"),i.appendChild(r),i.appendChild(o);var s=document.createElement("div");s.id=n,s.className="select-dropdown template-dropdown",s.innerHTML='\n      <div class="template-toggles">\n        <div class="select-option checkbox-field template-toggle-item" data-setting="autoSave">\n          <label>\n            <span>Auto save</span>\n            <input type="checkbox" '.concat(this.templateAutoSave?"checked":"",'>\n          </label>\n        </div>\n        <div class="select-option checkbox-field template-toggle-item" data-setting="sharing">\n          <label>\n            <span>Sharing <span class="sharing-info-icon" data-tooltip-trigger="click" data-tooltip-title="When enabled, anyone with the link can view your last saved layout">').concat(l.cI.info,'</span></span>\n            <input type="checkbox" ').concat(this.templateSharing?"checked":"",'>\n          </label>\n        </div>\n        <button class="select-option template-share-link-btn" style="display: ').concat(this.templateSharing?"flex":"none",'">\n          ').concat(l.cI.link||"ðŸ”—",'\n          <span>Copy Share Link</span>\n        </button>\n      </div>\n      <ul class="select-options list-template-all" data-max-height-offset="190"></ul>\n      <div class="select-option template-create-new tf-custom-option">\n        ').concat(l.cI.plus,'\n        <span>Create new layout</span>\n      </div>\n      <div class="template-actions-row">\n        <button class="select-option template-action-btn" data-action="download" data-tooltip-title="Download Layout">').concat(l.cI.downloadTemplate,'</button>\n        <button class="select-option template-action-btn" data-action="upload" data-tooltip-title="Upload Layout">').concat(l.cI.uploadTemplate,"</button>\n      </div>\n    "),document.body.appendChild(s),this.updateTemplateDropdownMenu(s),this.templateSelect=o,this.templateNameBtn=r,this.templateDropdownBtn=o.querySelector(".select-trigger"),this.templateDropdown=s,e.appendChild(i),r.addEventListener("click",function(){t.hasUnsavedChanges&&t.handleTemplateSave()}),new c.A(o),s.addEventListener("click",function(e){var a=e.target.closest(".template-toggle-item");if(a){e.stopPropagation();var n=a.dataset.setting,i=a.querySelector('input[type="checkbox"]');if("autoSave"===n)t.templateAutoSave=i.checked,t.saveTemplateSetting("autoSave",t.templateAutoSave);else if("sharing"===n){t.templateSharing=i.checked,t.saveTemplateSetting("sharing",t.templateSharing);var r=s.querySelector(".template-share-link-btn");r&&(r.style.display=t.templateSharing?"flex":"none")}}else{if(e.target.closest(".template-share-link-btn"))return e.stopPropagation(),void t.copyShareLink();var l=function(){o.customSelectAPI&&o.customSelectAPI.close()};if(e.target.closest(".template-create-new"))return l(),void t.showSaveTemplateDialog();var c=e.target.closest(".template-delete-btn");if(c){e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation();var d=c.dataset.template;return t.deleteTemplate(d),void l()}var u=e.target.closest(".select-option:not(.template-toggle-item):not(.template-create-new):not(.template-action-btn)");if(u&&!e.target.closest(".template-delete-btn")){var h=u.dataset.value;if(h){e.stopPropagation(),s.querySelectorAll(".select-option").forEach(function(e){return e.classList.remove("selected")}),u.classList.add("selected"),t.loadTemplate(h);var p=o.querySelector(".template-label");p&&(p.textContent=h),l()}}var g=e.target.closest(".template-action-btn");if(g){e.stopPropagation(),e.preventDefault();var m=g.dataset.action;switch(l(),m){case"save":t.handleTemplateSave();break;case"download":t.downloadCurrentTemplate();break;case"upload":t.uploadTemplate()}}}},!0)}},{key:"loadTemplateSetting",value:function(t,a){try{var n=localStorage.getItem("fcsapi_template_".concat(t));return null!==n?JSON.parse(n):a}catch(e){return a}}},{key:"saveTemplateSetting",value:function(t,a){try{localStorage.setItem("fcsapi_template_".concat(t),JSON.stringify(a))}catch(e){}}},{key:"updateTemplateDropdownMenu",value:function(e){var t=this,a=this.builtInTemplateNames||["Default","Classic Dark","Clean White","Night Vision","Pro Trader","Monochrome"],n=[],i=[];this.templates&&Object.keys(this.templates).forEach(function(e){a.includes(e)?i.push(e):n.push(e)}),i.includes("Default")||i.unshift("Default");var o="";n.length>0&&(o='<li class="tf-group-header">My layouts</li>',n.forEach(function(e){var a=t.currentTemplate===e?" selected":"";o+='\n          <li class="select-option template-item'.concat(a,'" data-value="').concat(e,'">\n            <span class="select-option-text">').concat(e,'</span>\n            <button class="template-delete-btn" data-template="').concat(e,'" data-tooltip-title="Delete layout: ').concat(e,'">\n              ').concat(l.cI.trash,"\n            </button>\n          </li>\n        ")}));var r='<li class="tf-group-header">Default</li>';i.forEach(function(e){var a=t.currentTemplate===e?" selected":"";r+='\n        <li class="select-option'.concat(a,'" data-value="').concat(e,'">\n          <span class="select-option-text">').concat(e,"</span>\n        </li>\n      ")});var s=e.querySelector(".select-options");s&&(s.innerHTML=o+r),this.templateSelect&&this.templateSelect.customSelectAPI&&this.templateSelect.customSelectAPI.refresh()}},{key:"createThemeButton",value:function(e){var t=this,a=document.createElement("button");a.className="toolbar-icon-btn";var n=this.engine.themeManager.currentTheme;a.textContent="dark"===n?"ðŸŒ™":"â˜€",a.title="Toggle Theme",a.addEventListener("click",function(){var e="dark"===t.engine.themeManager.currentTheme?"light":"dark";a.textContent="dark"===e?"ðŸŒ™":"â˜€",t.engine.setTheme(e)}),e.appendChild(a)}},{key:"createScreenshotButton",value:function(e){var t=this,a=document.createElement("button");a.className="toolbar-icon-btn",a.innerHTML=l.cI.camera,a.setAttribute("data-tooltip-title",(0,u.Eg)("screenshot")),a.addEventListener("click",function(){var e=t.engine.exportImage(),a=document.createElement("a");a.download="chart-".concat(Date.now(),".png"),a.href=e,a.click()}),e.appendChild(a)}},{key:"createShortcutsButton",value:function(e){var t=this,a=document.createElement("button");a.className="toolbar-icon-btn keyboard-shortcuts-btn",a.innerHTML=l.cI.keyboard,a.setAttribute("data-tooltip-title","Keyboard Shortcuts"),a.addEventListener("click",function(){t.engine.shortcutManager&&t.engine.shortcutManager.showHelp()}),e.appendChild(a)}},{key:"createReplayButton",value:function(e){var t=this,a=document.createElement("button");a.className="toolbar-icon-btn replay-toggle-btn has-text",a.innerHTML="".concat(l.cI.play,"<span>Replay</span>"),a.setAttribute("data-tooltip-title",(0,u.Eg)("replay")),a.addEventListener("click",function(){t.engine.interactionManager.replaySelectionMode?t.engine.interactionManager.exitReplaySelectionMode():t.engine.replayManager.isActive?t.engine.replayManager.stop():t.showReplayStartDialog()}),e.appendChild(a),this.replayToggleBtn=a}},{key:"showReplayStartDialog",value:function(){this.replayControlBar&&window.CustomModal&&window.CustomModal.getOrCreateInstance(this.replayControlBar).show(),this.replayTimeDisplay&&(this.replayTimeDisplay.textContent="Select range...",this.replayTimeDisplay.style.color=""),this.replayProgressFill&&(this.replayProgressFill.style.width="0%"),this.replayToggleBtn&&(this.replayToggleBtn.classList.add("active"),this.replayToggleBtn.innerHTML="".concat(l.cI.play,"<span>Exit</span>"),this.replayToggleBtn.setAttribute("data-tooltip-title",(0,u.Eg)("replayExit",!1))),this.engine.interactionManager.enterReplaySelectionMode()}},{key:"createReplayControlBar",value:function(){var e=this,t="replayControlBarModal",a="replaySpeedDropdown",n=this.engine.wrapperDiv.querySelector("#".concat(t));if(n)this.replayControlBar=n;else{(n=document.createElement("div")).className="modal replay-control-modal",n.id=t,n.setAttribute("data-custom-modal","true"),n.setAttribute("data-cm-draggable","true"),n.setAttribute("data-cm-persistent","true"),n.setAttribute("data-cm-compact",!0),n.setAttribute("data-cm-placement","bottom"),n.setAttribute("data-cm-margin","80"),n.setAttribute("data-cm-keyboard","false"),n.setAttribute("data-cm-save-position","true"),n.setAttribute("data-cm-constrain","true");var i=document.createElement("div");i.className="modal-dialog";var o=document.createElement("div");o.className="modal-content";var r=document.createElement("div");r.className="modal-body replay-control-bar";var s=document.createElement("div");s.className="replay-drag-handle",s.setAttribute("data-cm-drag-handle",""),s.innerHTML=l.cI.dragHandle;var c=document.createElement("div");c.className="replay-controls-wrapper";var d=document.createElement("button");d.className="replay-control-btn replay-play-pause",d.innerHTML=l.cI.play,d.setAttribute("data-tooltip-title",(0,u.Eg)("replayPlay")),d.addEventListener("click",function(t){t.stopPropagation(),e.engine.replayManager.togglePlayPause()}),this.replayPlayPauseBtn=d;var h=document.createElement("button");h.className="replay-control-btn replay-stop",h.innerHTML=l.cI.stop,h.setAttribute("data-tooltip-title",(0,u.Eg)("replayExit",!1)),h.addEventListener("mousedown",function(t){t.stopPropagation(),t.preventDefault(),e.engine.interactionManager.replaySelectionMode?e.engine.interactionManager.exitReplaySelectionMode():e.engine.replayManager.stop()});var p=document.createElement("button");p.className="replay-control-btn replay-reselect",p.innerHTML=l.cI.reselect,p.setAttribute("data-tooltip-title","Reselect Replay Start Point"),p.addEventListener("click",function(t){t.stopPropagation(),e.engine.replayManager.stop(),e.showReplayStartDialog()});var g=document.createElement("button");g.className="replay-control-btn replay-skip",g.innerHTML=l.cI.skipBack,g.setAttribute("data-tooltip-title",(0,u.Eg)("replayStepBackward")),g.addEventListener("click",function(t){t.stopPropagation(),e.engine.replayManager.skipBackward(1)}),this.replaySkipBackBtn=g;var m=document.createElement("button");m.className="replay-control-btn replay-skip",m.innerHTML=l.cI.skipForward,m.setAttribute("data-tooltip-title",(0,u.Eg)("replayStepForward")),m.addEventListener("click",function(t){t.stopPropagation(),e.engine.replayManager.skipForward(1)});var v=document.createElement("div");v.className="replay-speed-wrapper dropdown-select",v.setAttribute("data-dropdown-id",a),v.setAttribute("data-modal-escape","true"),v.setAttribute("data-tooltip-title",(0,u.Eg)("replaySpeed",!1)),v.addEventListener("click",function(e){return e.stopPropagation()});var f=document.createElement("div");f.className="select-trigger",f.innerHTML='\n      <span class="select-trigger-text">1x</span>',v.appendChild(f);var b=document.createElement("div");b.className="select-dropdown",b.id=a;var y=document.createElement("ul");y.className="select-options",[{value:"0.25",label:"0.25x (Slowest)"},{value:"0.5",label:"0.5x"},{value:"1",label:"1x (Normal)",selected:!0},{value:"2",label:"2x"},{value:"4",label:"4x"},{value:"10",label:"10x"},{value:"20",label:"20x (Fastest)"}].forEach(function(e){var t=document.createElement("li");t.className="select-option"+(e.selected?" selected":""),t.setAttribute("data-html",e.value+"x"),t.setAttribute("data-value",e.value),t.textContent=e.label,y.appendChild(t)}),b.appendChild(y);var w=document.createElement("button");w.className="replay-control-btn replay-autofit",w.innerHTML=l.cI.autoScale,w.setAttribute("data-tooltip-title",(0,u.Eg)("autoScale",!1)),w.addEventListener("click",function(t){t.stopPropagation(),e.engine.replayManager.toggleAutoFit()}),this.replayAutoFitBtn=w;var C=document.createElement("div");C.className="replay-time-display",C.textContent="Select range...",this.replayTimeDisplay=C;var S=document.createElement("div");S.className="replay-progress-container";var k=document.createElement("div");k.className="replay-progress-bar";var T=document.createElement("div");T.className="replay-progress-fill",T.style.width="0%",this.replayProgressFill=T,k.appendChild(T),S.appendChild(k),this.makeProgressBarDraggable(k);var L=document.createElement("div");L.className="replay-row-1",L.appendChild(d),L.appendChild(h),L.appendChild(p),L.appendChild(g),L.appendChild(m),L.appendChild(v),L.appendChild(w);var M=document.createElement("div");M.className="replay-row-2",M.appendChild(C),M.appendChild(S),c.appendChild(L),c.appendChild(M),r.appendChild(s),r.appendChild(c),o.appendChild(r),i.appendChild(o),n.appendChild(i),this.engine.wrapperDiv.appendChild(n),this.engine.wrapperDiv.appendChild(b),this.replayControlBar=n,setTimeout(function(){window.initCustomSelects&&window.initCustomSelects(e.engine.wrapperDiv),v.addEventListener("customSelectChange",function(t){var a,n=parseFloat((null===(a=t.detail)||void 0===a?void 0:a.value)||1);e.engine.replayManager.setSpeed(n)})},0)}}},{key:"updateReplayControls",value:function(e){if(this.replayControlBar)if(e.isActive){window.CustomModal&&window.CustomModal.getOrCreateInstance(this.replayControlBar).show(),this.replayToggleBtn.classList.add("active"),this.replayToggleBtn.innerHTML="".concat(l.cI.play,"<span>Exit</span>"),this.replayToggleBtn.setAttribute("data-tooltip-title",(0,u.Eg)("replayExit",!1)),e.isPlaying?(this.replayPlayPauseBtn.innerHTML=l.cI.pause,this.replayPlayPauseBtn.setAttribute("data-tooltip-title",(0,u.Eg)("replayPlay"))):(this.replayPlayPauseBtn.innerHTML=l.cI.play,this.replayPlayPauseBtn.setAttribute("data-tooltip-title",(0,u.Eg)("replayPlay"))),this.replaySkipBackBtn&&(e.currentIndex<=e.replayStartIndex?(this.replaySkipBackBtn.disabled=!0,this.replaySkipBackBtn.style.opacity="0.3",this.replaySkipBackBtn.style.cursor="not-allowed"):(this.replaySkipBackBtn.disabled=!1,this.replaySkipBackBtn.style.opacity="1",this.replaySkipBackBtn.style.cursor="pointer")),this.replayAutoFitBtn&&(e.autoFitPriceRange?this.replayAutoFitBtn.classList.add("active"):this.replayAutoFitBtn.classList.remove("active")),e.currentIndex>e.replayEndIndex?(this.replayTimeDisplay.textContent="âœ“ Completed",this.replayTimeDisplay.style.color="var(--color-green)"):(this.replayTimeDisplay.textContent=e.getCurrentTime(),this.replayTimeDisplay.style.color="");var t=e.getProgress();this.replayProgressFill.style.width=t+"%"}else{if(window.CustomModal){var a=window.CustomModal.getInstance(this.replayControlBar);a&&a.hide()}this.resetReplayButton()}}},{key:"resetReplayButton",value:function(){this.replayToggleBtn&&(this.replayToggleBtn.classList.remove("active"),this.replayToggleBtn.innerHTML="".concat(l.cI.play,"<span>Replay</span>"),this.replayToggleBtn.setAttribute("data-tooltip-title",(0,u.Eg)("replay")))}},{key:"createMultiChartButton",value:function(e){var t=this,a="multiChartDropdown-".concat(this.chartId),n=l.gL,i=document.createElement("div");i.className="dropdown-select multi-chart-select",i.dataset.type="multichart",i.setAttribute("data-dropdown-id",a);var o=document.createElement("button");o.className="select-trigger toolbar-multi-chart-btn toolbar-icon-btn",o.setAttribute("type","button"),o.innerHTML='<span class="select-trigger-text">'.concat(l.cI.multichart,"</span>"),o.classList.add("has-svg-icon"),o.setAttribute("data-tooltip-title",(0,u.Eg)("multiChart",!1)),i.appendChild(o);var r=document.createElement("div");r.id=a,r.className="select-dropdown multi-chart-dropdown";var s=function(e){return e.replace(/"/g,"&quot;")};r.innerHTML='\n      <ul class="select-options" data-max-height-offset="20">\n        \x3c!-- Group: Single Chart --\x3e\n        <li class="tf-group-header">Single Chart</li>\n        <li class="multi-chart-group">\n          <div class="multi-chart-group-icons">\n            <div class="multi-chart-dropdown-item select-option" data-layout="1" data-orientation="single" data-html="'.concat(s(n.single),'">').concat(n.single,'</div>\n          </div>\n        </li>\n        <li class="tf-group-header">2 Charts</li>\n        <li class="multi-chart-group">\n          <div class="multi-chart-group-icons">\n            <div class="multi-chart-dropdown-item select-option" data-layout="2" data-orientation="vertical" data-html="').concat(s(n["2_vertical"]),'">').concat(n["2_vertical"],'</div>\n            <div class="multi-chart-dropdown-item select-option" data-layout="2" data-orientation="horizontal" data-html="').concat(s(n["2_horizontal"]),'">').concat(n["2_horizontal"],'</div>\n          </div>\n        </li>\n        <li class="tf-group-header">3 Charts</li>\n        <li class="multi-chart-group">\n          <div class="multi-chart-group-icons">\n            <div class="multi-chart-dropdown-item select-option" data-layout="3" data-orientation="left-right" data-html="').concat(s(n["3_left_right"]),'">').concat(n["3_left_right"],'</div>\n            <div class="multi-chart-dropdown-item select-option" data-layout="3" data-orientation="top-bottom" data-html="').concat(s(n["3_top_bottom"]),'">').concat(n["3_top_bottom"],'</div>\n            <div class="multi-chart-dropdown-item select-option" data-layout="3" data-orientation="bottom-top" data-html="').concat(s(n["3_bottom_top"]),'">').concat(n["3_bottom_top"],'</div>\n            <div class="multi-chart-dropdown-item select-option" data-layout="3" data-orientation="vertical" data-html="').concat(s(n["3_vertical"]),'">').concat(n["3_vertical"],'</div>\n            <div class="multi-chart-dropdown-item select-option" data-layout="3" data-orientation="horizontal" data-html="').concat(s(n["3_horizontal"]),'">').concat(n["3_horizontal"],'</div>\n          </div>\n        </li>\n        <li class="tf-group-header">4 Charts</li>\n        <li class="multi-chart-group">\n          <div class="multi-chart-group-icons">\n            <div class="multi-chart-dropdown-item select-option" data-layout="4" data-orientation="grid" data-html="').concat(s(n["4_grid"]),'">').concat(n["4_grid"],'</div>\n            <div class="multi-chart-dropdown-item select-option" data-layout="4" data-orientation="left-3right" data-html="').concat(s(n["4_left_3right"]),'">').concat(n["4_left_3right"],'</div>\n            <div class="multi-chart-dropdown-item select-option" data-layout="4" data-orientation="top-3bottom" data-html="').concat(s(n["4_top_3bottom"]),'">').concat(n["4_top_3bottom"],'</div>\n            <div class="multi-chart-dropdown-item select-option" data-layout="4" data-orientation="3top-bottom" data-html="').concat(s(n["4_3top_bottom"]),'">').concat(n["4_3top_bottom"],'</div>\n            <div class="multi-chart-dropdown-item select-option" data-layout="4" data-orientation="2top-2bottom-split" data-html="').concat(s(n["4_2top_2bottom_split"]),'">').concat(n["4_2top_2bottom_split"],'</div>\n            <div class="multi-chart-dropdown-item select-option" data-layout="4" data-orientation="2top-split-2bottom" data-html="').concat(s(n["4_2top_split_2bottom"]),'">').concat(n["4_2top_split_2bottom"],'</div>\n            <div class="multi-chart-dropdown-item select-option" data-layout="4" data-orientation="vertical" data-html="').concat(s(n["4_vertical"]),'">').concat(n["4_vertical"],'</div>\n            <div class="multi-chart-dropdown-item select-option" data-layout="4" data-orientation="horizontal" data-html="').concat(s(n["4_horizontal"]),'">').concat(n["4_horizontal"],'</div>\n          </div>\n        </li>\n        <li class="tf-group-header">Sync in layout</li>\n        <li class="multi-chart-group multi-chart-sync-group">\n          <div class="template-toggles multi-chart-sync-options">\n            <div class="select-option checkbox-field template-toggle-item" data-sync="symbol">\n              <label>\n                <span>Symbol <span class="sync-info-icon" data-tooltip-trigger="click" data-tooltip-title="Sync symbol changes across all charts">').concat(l.cI.info,'</span></span>\n                <input type="checkbox" id="sync-symbol-').concat(this.chartId,'">\n              </label>\n            </div>\n            <div class="select-option checkbox-field template-toggle-item" data-sync="timeperiod">\n              <label>\n                <span>Time Period <span class="sync-info-icon" data-tooltip-trigger="click" data-tooltip-title="Sync time period changes across all charts">').concat(l.cI.info,'</span></span>\n                <input type="checkbox" id="sync-timeperiod-').concat(this.chartId,'">\n              </label>\n            </div>\n            <div class="select-option checkbox-field template-toggle-item" data-sync="crosshair">\n              <label>\n                <span>Crosshair by Time <span class="sync-info-icon" data-tooltip-trigger="click" data-tooltip-title="Sync crosshair by time - shows same candle time across all charts">').concat(l.cI.info,'</span></span>\n                <input type="checkbox" id="sync-crosshair-').concat(this.chartId,'">\n              </label>\n            </div>\n            <div class="select-option checkbox-field template-toggle-item" data-sync="crosshairIndex">\n              <label>\n                <span>Crosshair by Index <span class="sync-info-icon" data-tooltip-trigger="click" data-tooltip-title="Sync crosshair by candle index - shows same candle number across all charts">').concat(l.cI.info,'</span></span>\n                <input type="checkbox" id="sync-crosshair-index-').concat(this.chartId,'" checked>\n              </label>\n            </div>\n            <div class="select-option checkbox-field template-toggle-item" data-sync="zoom">\n              <label>\n                <span>Zoom <span class="sync-info-icon" data-tooltip-trigger="click" data-tooltip-title="Sync zoom level and reset across all charts">').concat(l.cI.info,'</span></span>\n                <input type="checkbox" id="sync-zoom-').concat(this.chartId,'">\n              </label>\n            </div>\n            <div class="select-option checkbox-field template-toggle-item" data-sync="drawing">\n              <label>\n                <span>Drawing <span class="sync-info-icon" data-tooltip-trigger="click" data-tooltip-title="Sync drawings across charts with same symbol only">').concat(l.cI.info,'</span></span>\n                <input type="checkbox" id="sync-drawing-').concat(this.chartId,'">\n              </label>\n            </div>\n          </div>\n        </li>\n      </ul>\n    '),r.addEventListener("click",function(e){var a=e.target.closest(".multi-chart-dropdown-item");if(a){var n=parseInt(a.dataset.layout),i=a.dataset.orientation;t.setMultiChartLayout(n,i),c.A.closeAllDropdowns()}}),r.addEventListener("change",function(e){var a=e.target.closest("[data-sync]");if("checkbox"===e.target.type&&a){var n=a.dataset.sync,i=e.target.checked;if(i&&("crosshair"===n||"crosshairIndex"===n)){var o="crosshair"===n?"crosshairIndex":"crosshair",s=r.querySelector('[data-sync="'.concat(o,'"] input[type="checkbox"]'));s&&s.checked&&(s.checked=!1,t.engine.multiChartManager&&t.engine.multiChartManager.setSyncSetting(o,!1))}t.engine.multiChartManager&&(t.engine.multiChartManager.setSyncSetting(n,i),t.engine.multiChartManager.chartInstances.forEach(function(e){var a,o=null===(a=e.engine)||void 0===a?void 0:a.uiManager;if(o&&o!==t&&o.multiChartDropdown){var r=o.multiChartDropdown.querySelector('[data-sync="'.concat(n,'"] input[type="checkbox"]'));if(r&&(r.checked=i),"crosshair"===n||"crosshairIndex"===n){var s="crosshair"===n?"crosshairIndex":"crosshair",l=o.multiChartDropdown.querySelector('[data-sync="'.concat(s,'"] input[type="checkbox"]'));l&&i&&(l.checked=!1)}}})),e.stopPropagation()}});var d=r.querySelector(".multi-chart-sync-options");d&&d.addEventListener("click",function(e){e.stopPropagation()}),document.body.appendChild(r),e.appendChild(i),new c.A(i),this.multiChartButton=o,this.multiChartWrapper=i,this.multiChartDropdown=r,o.addEventListener("click",function(){setTimeout(function(){r.classList.contains("show")&&(t.initializeSyncSettings(),t.updateMultiChartButton(t.engine.multiChartManager))},10)}),this.initializeSyncSettings(),this.updateMultiChartButton()}},{key:"initializeSyncSettings",value:function(){var e=this;if(this.multiChartDropdown){var t=this.getSyncSettings();Object.keys(t).forEach(function(a){var n=e.multiChartDropdown.querySelector('[data-sync="'.concat(a,'"] input[type="checkbox"]'));n&&(n.checked=t[a])})}}},{key:"getSyncSettings",value:function(){return this.engine.multiChartManager?this.engine.multiChartManager.getSyncSettings():{timeperiod:!1,crosshair:!1,crosshairIndex:!0,symbol:!1,zoom:!1}}},{key:"setMultiChartLayout",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"grid";this.engine.multiChartManager&&(this.engine.multiChartManager.setLayout(e,a),this.updateMultiChartButton(),requestAnimationFrame(function(){t.syncMultiChartLayoutToAllCharts()}))}},{key:"syncMultiChartLayoutToAllCharts",value:function(){if(this.engine.multiChartManager){var e=this.engine.multiChartManager;e.chartInstances.forEach(function(t){var a,n=null===(a=t.engine)||void 0===a?void 0:a.uiManager;n&&n.updateMultiChartButton(e)})}}},{key:"updateMultiChartButton",value:function(e){if(this.multiChartButton&&this.multiChartDropdown){var t=e||this.engine.multiChartManager;if(t){t.isActive()?(this.multiChartButton.classList.add("active"),this.multiChartWrapper&&this.multiChartWrapper.classList.add("active")):(this.multiChartButton.classList.remove("active"),this.multiChartWrapper&&this.multiChartWrapper.classList.remove("active"));var a=t.getLayoutCount(),n=t.currentOrientation,i=this.multiChartDropdown.querySelectorAll(".multi-chart-dropdown-item"),o=null;if(i.forEach(function(e){var t=parseInt(e.dataset.layout),i=e.dataset.orientation;t===a&&i===n?(e.classList.add("selected"),o=e.getAttribute("data-html")||e.innerHTML):e.classList.remove("selected")}),o&&this.multiChartButton){var r=this.multiChartButton.querySelector(".select-trigger-text");r&&(r.innerHTML=o)}}}}},{key:"createSettingsButton",value:function(e){var t,a=this,n="chartSettingsDropdownList",i=document.createElement("div");i.className="dropdown-select chart-settings-select no-auto-highlight",i.id="chartSettingsSelect",i.setAttribute("data-dropdown-id",n),i.setAttribute("data-placement","bottom-right"),i.innerHTML='\n      <div class="select-trigger toolbar-icon-btn" tabindex="0" data-tooltip-title="'.concat((0,u.Eg)("settings",!1),'">\n        ').concat(l.cI.settings,"\n      </div>\n    ");var o=document.createElement("div");o.id=n,o.className="select-dropdown chart-settings-dropdown";var r=(null===(t=this.engine.themeManager)||void 0===t?void 0:t.currentTheme)||"light",s="dark"===r?l.cI.sun:l.cI.moon,d="dark"===r?"Light Mode":"Dark Mode";o.innerHTML='\n      <ul class="select-options no-auto-highlight">\n        <li class="select-option theme-toggle-option" data-action="theme">\n          <span class="select-option-img">\n            <div class="flag-icon-container">'.concat(s,"</div>\n            <span>").concat(d,'</span>\n          </span>\n        </li>\n        <li class="select-option" data-action="resetZoom">\n          <span class="select-option-img">\n            <div class="flag-icon-container">').concat(l.cI.resetZoom,'</div>\n            <span>Reset Zoom</span>\n          </span>\n        </li>\n        <li class="select-option" data-action="settings" data-cm-toggle="custom-modal" data-cm-target="#chartSettingsModal">\n          <span class="select-option-img">\n            <div class="flag-icon-container">').concat(l.cI.settings,'</div>\n            <span>Settings</span>\n          </span>\n        </li>\n        <li class="select-option danger" data-action="factoryReset">\n          <span class="select-option-img">\n            <div class="flag-icon-container">').concat(l.cI.warning,"</div>\n            <span>Factory Reset</span>\n          </span>\n        </li>\n      </ul>\n    "),document.body.appendChild(o),e.appendChild(i),this.settingsSelect=i,this.settingsDropdown=o,new c.A(i),o.addEventListener("click",function(e){var t,n,o,r=e.target.closest(".select-option");if(r){var s=r.dataset.action;switch(s){case"theme":var c="dark"===a.engine.themeManager.currentTheme?"light":"dark";a.engine.setTheme(c);var d=r.querySelector(".flag-icon-container"),u=r.querySelector(".select-option-img > span");d&&(d.innerHTML="dark"===c?l.cI.sun:l.cI.moon),u&&(u.textContent="dark"===c?"Light Mode":"Dark Mode");break;case"resetZoom":a.resetChartZoom();break;case"settings":null===(t=a.chartSettingsModalManager)||void 0===t||t.storeOriginalSettings(),null===(n=a.chartSettingsModalManager)||void 0===n||n.populateChartColors(),null===(o=a.chartSettingsModalManager)||void 0===o||o.populateSettings();break;case"factoryReset":a.confirmFactoryReset()}"settings"!==s&&i.customSelectAPI&&i.customSelectAPI.close()}})}},{key:"createFullscreenButton",value:function(e){var t=this,a=document.createElement("button");a.className="toolbar-icon-btn fullscreen-btn",a.innerHTML=l.cI.fullscreen,a.setAttribute("data-tooltip-title",(0,u.Eg)("fullscreen",!1)),a.addEventListener("click",function(e){e.stopPropagation(),t.toggleFullscreen()}),e.appendChild(a),this.fullscreenBtn=a,document.addEventListener("fullscreenchange",function(){return t.updateFullscreenIcon()}),document.addEventListener("webkitfullscreenchange",function(){return t.updateFullscreenIcon()})}},{key:"toggleFullscreen",value:function(){var e=document.body;document.fullscreenElement||document.webkitFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}},{key:"updateFullscreenIcon",value:function(){var e=this;if(this.fullscreenBtn){var t=document.fullscreenElement||document.webkitFullscreenElement;this.fullscreenBtn.innerHTML=l.cI.fullscreen,t?this.fullscreenBtn.setAttribute("data-tooltip-title",(0,u.Eg)("fullscreenExit",!1)):this.fullscreenBtn.setAttribute("data-tooltip-title",(0,u.Eg)("fullscreen",!1)),setTimeout(function(){e.engine.handleResize&&e.engine.handleResize()},100)}}},{key:"createUndoButtonTop",value:function(e){var t=this,a=document.createElement("button");a.className="toolbar-icon-btn undo-btn",a.innerHTML=l.cI.undo,a.setAttribute("data-tooltip-title",(0,u.Eg)("undo")),a.addEventListener("click",function(){t.engine.undo()}),e.appendChild(a),this.undoButton=a,this.updateUndoButtonState()}},{key:"createRedoButtonTop",value:function(e){var t=this,a=document.createElement("button");a.className="toolbar-icon-btn redo-btn",a.innerHTML=l.cI.redo,a.setAttribute("data-tooltip-title",(0,u.Eg)("redo")),a.addEventListener("click",function(){t.engine.redo()}),e.appendChild(a),this.redoButton=a,this.updateRedoButtonState()}},{key:"createLeftSidebar",value:function(){var e=this.engine.options;this.sidebar=document.createElement("div"),this.sidebar.className="fcsapi-left-sidebar",this.sidebar.setAttribute("data-chart-id",this.engine.container.id);var t=this.engine.container.dataset.chartIndex||"1";if(this.sidebar.setAttribute("data-chart-index",t),"1"!==t&&(this.sidebar.style.display="none"),this.engine.parentContainer&&this.engine.parentContainer!==this.engine.container?this.engine.parentContainer.appendChild(this.sidebar):this.engine.container.appendChild(this.sidebar),"1"===(this.engine.container.dataset.chartIndex||"1")){var a=document.createElement("div");a.className="sidebar-chart-badge select-trigger sidebar-tool-icon-btn",a.textContent="1",a.setAttribute("data-tooltip-title","Chart Selected tab"),a.style.cssText="display: none;",this.sidebar.appendChild(a),this.chartBadge=a}this.lastSelectedTools={markers:null,lines:null,fibonacci:null,patterns:null,text:null},this.createSidebarTool(l.s0.cursor,(0,u.Eg)("cursor"),null),!1!==e.enableDrawingTools&&(this.createSidebarToolWithDropdown(l.id.trendline,(0,u.Eg)("lines",!1),"lines"),this.createSidebarToolWithDropdown(l.zC.fibonacci,(0,u.Eg)("fibTools",!1),"fibonacci"),this.createSidebarToolWithDropdown(l.K8.abcd,(0,u.Eg)("patterns",!1),"patterns"),this.createSidebarToolWithDropdown(l.s0.longposition,(0,u.Eg)("projection",!1),"projection"),this.createSidebarToolWithDropdown(l.s0.brush,(0,u.Eg)("shapes",!1),"shapes"),this.createSidebarToolWithDropdown(l.ns.textT,(0,u.Eg)("text",!1),"text"),this.createSidebarToolWithDropdown(l.ns.alphabets,(0,u.Eg)("markers",!1),"markers"),this.createSidebarToolWithDropdown(l.cI.emoji,(0,u.Eg)("emojis",!1),"emojis"),this.createMagnetToggle(),this.createKeepDrawingToggle(),this.createMeasureButton(),this.createDeleteMenu(),this.createFavoritesMenu())}},{key:"createSidebarTool",value:function(e,t,a){var n=this,i=document.createElement("div");i.className="dropdown-select sidebar-tool-btn-wrapper",i.dataset.type="cursor";var o=document.createElement("button");o.className="select-trigger sidebar-tool-icon-btn",e&&e.includes("<svg")?(o.innerHTML=e,o.classList.add("has-svg-icon")):o.textContent=e,o.setAttribute("data-tooltip-title",t),o.addEventListener("click",function(){if(n.engine.drawingManager.setTool(null),n.sidebar.querySelectorAll(".sidebar-tool-btn-wrapper").forEach(function(e){e.classList.contains("magnet-toggle")||e.classList.remove("active")}),i.classList.add("active"),n.hideAllSidebarDropdowns(),n.engine.multiChartManager){var e,t=null===(e=n.engine.container)||void 0===e?void 0:e.id;n.engine.multiChartManager.syncCursorSelection(t)}}),i.classList.add("active"),i.appendChild(o),this.sidebar.appendChild(i),this.cursorWrapper=i}},{key:"createMagnetToggle",value:function(){var e=this,t=document.createElement("div");t.className="dropdown-select sidebar-tool-btn-wrapper",t.dataset.type="magnet";var a=document.createElement("button");a.className="select-trigger sidebar-tool-icon-btn magnet-toggle",a.setAttribute("type","button"),this.engine.drawingManager.magnetEnabled?(a.innerHTML=l.cI.magnetOn,a.setAttribute("data-tooltip-title",(0,u.Eg)("magnetStrong")),a.classList.add("magneton"),t.classList.add("active")):(a.innerHTML=l.cI.magnet,a.setAttribute("data-tooltip-title",(0,u.Eg)("magnet"))),a.classList.add("has-svg-icon"),a.addEventListener("click",function(){e.engine.drawingManager.magnetEnabled=!e.engine.drawingManager.magnetEnabled;var n=e.engine.drawingManager.magnetEnabled;if(e.updateMagnetButtonVisual(a,n),t.classList.toggle("active",n),e.engine.multiChartManager){var i,o=null===(i=e.engine.container)||void 0===i?void 0:i.id;e.engine.multiChartManager.syncMagnetToggle(o,n)}}),t.appendChild(a),this.sidebar.appendChild(t),this.magnetButton=a}},{key:"createKeepDrawingToggle",value:function(){var e=this,t=document.createElement("div");t.className="dropdown-select sidebar-tool-btn-wrapper",t.dataset.type="keepdrawing";var a=document.createElement("button");a.className="select-trigger sidebar-tool-icon-btn keep-drawing-toggle",a.setAttribute("type","button"),a.innerHTML=l.cI.unlock,a.setAttribute("data-tooltip-title",(0,u.Eg)("keepDrawing")),a.classList.add("has-svg-icon"),a.addEventListener("click",function(){e.keepDrawingMode=!e.keepDrawingMode;var n=e.keepDrawingMode;if(e.updateKeepDrawingButtonVisual(a,n),t.classList.toggle("active",n),e.engine.multiChartManager){var i,o=null===(i=e.engine.container)||void 0===i?void 0:i.id;e.engine.multiChartManager.syncKeepDrawingToggle(o,n)}}),this.keepDrawingButton=a,t.appendChild(a),this.sidebar.appendChild(t)}},{key:"createMeasureButton",value:function(){var e=this,t=document.createElement("div");t.className="dropdown-select sidebar-tool-btn-wrapper",t.dataset.type="measure";var a=document.createElement("button");a.className="select-trigger sidebar-tool-icon-btn measure-btn",a.setAttribute("type","button"),a.innerHTML=l.cI.measure,a.classList.add("has-svg-icon"),a.setAttribute("data-tooltip-title",(0,u.Eg)("measure")),a.addEventListener("click",function(){if(e.sidebar.querySelectorAll(".sidebar-tool-btn-wrapper").forEach(function(e){e.classList.contains("magnet-toggle")||e.classList.contains("keep-drawing-toggle")||e.classList.remove("active")}),t.classList.add("active"),e.engine.drawingManager.setTool("infoline"),e.engine.multiChartManager){var a,n=null===(a=e.engine.container)||void 0===a?void 0:a.id;e.engine.multiChartManager.syncToolSelection(n,"infoline",{id:"infoline"})}}),this.measureButton=a,this.measureWrapper=t,t.appendChild(a),this.sidebar.appendChild(t)}},{key:"createUndoButton",value:function(){var e=this,t=document.createElement("div");t.className="dropdown-select sidebar-tool-btn-wrapper",t.dataset.type="undo";var a=document.createElement("button");a.className="select-trigger sidebar-tool-icon-btn undo-btn",a.setAttribute("type","button"),a.innerHTML=l.cI.undo,a.classList.add("has-svg-icon"),a.setAttribute("data-tooltip-title",(0,u.Eg)("undo")),a.addEventListener("click",function(){e.engine.undo()}),t.appendChild(a),this.sidebar.appendChild(t),this.undoButton=a,this.undoWrapper=t,this.updateUndoButtonState()}},{key:"updateUndoButtonState",value:function(){this.undoButton&&(this.engine.undoHistory&&this.engine.undoHistory.length>0?(this.undoButton.style.opacity="1",this.undoButton.style.filter="none",this.undoButton.style.cursor="pointer",this.undoButton.disabled=!1):(this.undoButton.style.opacity="0.3",this.undoButton.style.filter="grayscale(100%)",this.undoButton.style.cursor="not-allowed",this.undoButton.disabled=!0))}},{key:"updateRedoButtonState",value:function(){this.redoButton&&(this.engine.redoHistory&&this.engine.redoHistory.length>0?(this.redoButton.style.opacity="1",this.redoButton.style.filter="none",this.redoButton.style.cursor="pointer",this.redoButton.disabled=!1):(this.redoButton.style.opacity="0.3",this.redoButton.style.filter="grayscale(100%)",this.redoButton.style.cursor="not-allowed",this.redoButton.disabled=!0))}},{key:"createDeleteMenu",value:function(){var e=this,t="deleteMenuDropdown-".concat(this.chartId),a=document.createElement("div");a.className="dropdown-select sidebar-tool-btn-wrapper delete-menu-wrapper",a.dataset.type="delete",a.setAttribute("data-dropdown-id",t),a.setAttribute("data-placement","right");var n=document.createElement("button");n.className="select-trigger sidebar-tool-icon-btn",n.setAttribute("type","button"),n.innerHTML=l.cI.trash,n.classList.add("has-svg-icon"),n.setAttribute("data-tooltip-title",(0,u.Eg)("deleteSelected")),a.appendChild(n);var i=document.createElement("div");i.id=t,i.className="select-dropdown sidebar-dropdown delete-dropdown",i.innerHTML='<ul class="select-options">\n      <li class="select-option delete-dropdown-item" data-action="drawings">\n        <span>Delete all drawings</span>\n        <span class="count-badge" id="drawings-count">0</span>\n      </li>\n      <li class="select-option delete-dropdown-item" data-action="markers">\n        <span>Delete all markers/emojis</span>\n        <span class="count-badge" id="markers-count">0</span>\n      </li>\n      <li class="select-option delete-dropdown-item" data-action="indicators">\n        <span>Delete indicators</span>\n        <span class="count-badge" id="indicators-count">0</span>\n      </li>\n      <li class="select-option delete-dropdown-item hide-indicators-option" data-action="hideIndicators">\n        <span>Hide All Indicators</span>\n      </li>\n      <li class="delete-dropdown-separator"></li>\n      <li class="select-option  delete-dropdown-item delete-all-option" data-action="deleteAll">\n        <span>Delete All</span>\n        <span class="tool-shortcut">Alt+Shift+Del</span>\n        <span class="count-badge" id="total-count">0</span>\n      </li>\n    </ul>',document.body.appendChild(i),this.sidebar.appendChild(a),new c.A(a),i.addEventListener("click",function(t){var n=t.target.closest(".select-option");if(n){var i=n.dataset.action,o=e.getActiveEngine();switch(i){case"drawings":o.drawingManager.drawings.length>0&&(o.drawingManager.clearAll(),e.updateDeleteCounts());break;case"markers":o.markers.length>0&&(o.clearMarkers(),e.updateDeleteCounts());break;case"indicators":if(o.indicatorManager.indicators.length>0){var r=f(o.indicatorManager.indicators);o.indicatorManager.indicators.forEach(function(e){"separate"===e.panelType&&o.panelManager&&o.panelManager.removePanel(e.id)}),o.indicatorManager.indicators=[],o.indicatorManager.saveIndicators(),r.length>0&&o.trackAction("batchDelete",{items:r.map(function(e){return{type:"indicator",item:e}})}),o.render(),e.updateDeleteCounts(),e.updateIndicatorLegend()}break;case"hideIndicators":e.toggleAllIndicatorsVisibility();break;case"deleteAll":o.drawingManager.drawings.length+o.markers.length+o.indicatorManager.indicators.length>0&&(o.drawingManager.clearAll(),o.clearMarkers(),o.indicatorManager.indicators.map(function(e){return e.id}).forEach(function(e){return o.removeIndicator(e)}),e.updateDeleteCounts())}a.customSelectAPI&&a.customSelectAPI.close()}}),a.addEventListener("click",function(){e.updateDeleteCounts()}),this.deleteMenuDropdown=i,this.deleteMenuWrapper=a,this.updateDeleteCounts()}},{key:"createFavoritesMenu",value:function(){var e=this;if(!1!==this.isMainChart){var t=document.createElement("div");t.className="dropdown-select sidebar-tool-btn-wrapper",t.dataset.type="favorites";var a=document.createElement("button");a.className="select-trigger sidebar-tool-icon-btn favorites-btn",a.setAttribute("type","button"),a.innerHTML=l.cI.starOutline,a.classList.add("has-svg-icon"),a.setAttribute("data-tooltip-title",(0,u.Eg)("favorites",!1)),t.appendChild(a);var n=localStorage.getItem("fcsapi_favorites_layout")||"horizontal",i=document.createElement("div");i.className="modal favorites-toolbar-modal",i.id="favoritesToolbarModal",i.setAttribute("data-custom-modal","true"),i.setAttribute("data-cm-draggable","true"),i.setAttribute("data-cm-persistent","true"),i.setAttribute("data-cm-compact","true"),i.setAttribute("data-cm-placement","left-bottom"),i.setAttribute("data-cm-margin","80"),i.setAttribute("data-cm-keyboard","false"),i.setAttribute("data-cm-save-position","true"),i.setAttribute("data-cm-constrain","true");var o=document.createElement("div");o.className="modal-dialog";var r=document.createElement("div");r.className="modal-content";var s=document.createElement("div");s.className="modal-body favorites-toolbar","vertical"===n&&s.classList.add("vertical");var c=document.createElement("div");c.className="favorites-fixed-section";var d=document.createElement("div");d.className="favorites-drag-handle",d.setAttribute("data-cm-drag-handle",""),d.innerHTML=l.cI.dragHandle;var h=document.createElement("button");h.className="favorites-layout-toggle",h.classList.add("has-svg-icon"),h.innerHTML="vertical"===n?l.cI.layoutVertical:l.cI.layoutHorizontal,h.setAttribute("data-tooltip-title","Toggle Layout"),h.addEventListener("click",function(t){t.stopPropagation(),e.toggleFavoritesLayout(s,h)}),c.appendChild(d),c.appendChild(h);var p=document.createElement("div");p.className="favorites-scroll-section",s.appendChild(c),s.appendChild(p),r.appendChild(s),o.appendChild(r),i.appendChild(o),a.addEventListener("click",function(t){var a;if(t.stopPropagation(),e.currentSidebarDropdown){var n=e.currentSidebarDropdown;n.classList.remove("visible"),e.currentSidebarDropdown=null,setTimeout(function(){n&&n.parentNode&&n.parentNode.removeChild(n)},200)}var o=null===(a=window.CustomModal)||void 0===a?void 0:a.getOrCreateInstance(i);o&&o.toggle()}),i.addEventListener("shown.cm.modal",function(){e.updateFavoritesToolbar(s),a.classList.add("activefav"),a.innerHTML=l.cI.starFilled,t.classList.add("active"),localStorage.setItem("fcsapi_favorites_toolbar_open","true")}),i.addEventListener("hidden.cm.modal",function(){a.classList.remove("activefav"),a.innerHTML=l.cI.starOutline,t.classList.remove("active"),localStorage.setItem("fcsapi_favorites_toolbar_open","false")}),this.sidebar.appendChild(t),document.body.appendChild(i),this.favoritesBtn=a,this.favoritesWrapper=t,this.favoritesToolbar=s,this.favoritesToolbarModal=i,"true"===localStorage.getItem("fcsapi_favorites_toolbar_open")&&setTimeout(function(){var t,a=null===(t=window.CustomModal)||void 0===t?void 0:t.getOrCreateInstance(i);a&&(e.updateFavoritesToolbar(s),a.show())},100)}}},{key:"toggleFavoritesLayout",value:function(e,t){var a=e.classList.contains("vertical"),n=e.closest(".modal-dialog");a?(e.classList.remove("vertical"),t.innerHTML=l.cI.layoutHorizontal,localStorage.setItem("fcsapi_favorites_layout","horizontal")):(e.classList.add("vertical"),t.innerHTML=l.cI.layoutVertical,localStorage.setItem("fcsapi_favorites_layout","vertical")),n&&(n.style.width="",requestAnimationFrame(function(){var t=n.getBoundingClientRect();e.classList.contains("vertical")?(t.top<50&&(n.style.top="".concat(50,"px")),t.bottom>window.innerHeight-20&&(n.style.top="".concat(window.innerHeight-t.height-20,"px"))):(t.left<50&&(n.style.left="".concat(50,"px")),t.right>window.innerWidth-20&&(n.style.left="".concat(window.innerWidth-t.width-20,"px")))}))}},{key:"updateFavoritesToolbar",value:function(e){var t=this,a=e.querySelector(".favorites-fixed-section"),n=e.querySelector(".favorites-scroll-section");if(!a||!n){var i=e.querySelector(".favorites-drag-handle"),o=e.querySelector(".favorites-layout-toggle");e.innerHTML="",(a=document.createElement("div")).className="favorites-fixed-section",(n=document.createElement("div")).className="favorites-scroll-section",i&&a.appendChild(i),o&&a.appendChild(o),e.appendChild(a),e.appendChild(n)}n.innerHTML="";var r=a.querySelector(".cursor-btn");r||((r=document.createElement("button")).className="favorite-tool-btn cursor-btn",r.setAttribute("data-tooltip-title","Cursor"),r.innerHTML=l.cI.cursorSmall,r.classList.add("has-svg-icon"),r.addEventListener("click",function(){if(t.engine.drawingManager.setTool(null),e.querySelectorAll(".favorite-tool-btn").forEach(function(e){return e.classList.remove("active")}),r.classList.add("active"),t.sidebar.querySelectorAll(".sidebar-tool-btn-wrapper").forEach(function(e){e.classList.contains("magnet-toggle")||e.classList.contains("keep-drawing-toggle")||e.classList.remove("active")}),t.cursorWrapper&&t.cursorWrapper.classList.add("active"),t.engine.multiChartManager){var a,n=null===(a=t.engine.container)||void 0===a?void 0:a.id;t.engine.multiChartManager.syncCursorSelection(n)}}),a.appendChild(r)),this.engine.drawingManager.currentTool?r.classList.remove("active"):r.classList.add("active"),this.favoritesCursorBtn=r;var s=this.loadFavorites();if(0===s.length){var c=document.createElement("div");return c.className="favorites-empty",c.innerHTML='No favorites yet. Click <svg width="16" height="16" fill="currentColor" stroke="currentColor" style="color: var(--warning-orange)"><use href="#star"></use></svg> in tool menus to add.',void n.appendChild(c)}s.forEach(function(a){var i=document.createElement("button");i.className="favorite-tool-btn",i.setAttribute("data-tooltip-title",a.label),i.dataset.toolType=a.type,i.dataset.toolId=a.id,a.icon&&a.icon.includes("<svg")?(i.innerHTML=a.icon,i.classList.add("has-svg-icon")):i.textContent=a.icon||a.label.charAt(0),i.addEventListener("click",function(){t.selectTool(a.type,a),e.querySelectorAll(".favorite-tool-btn").forEach(function(e){return e.classList.remove("active")}),i.classList.add("active");var n=t.sidebar.querySelector('.sidebar-tool-btn-wrapper[data-type="'.concat(a.type,'"]'));t.sidebar.querySelectorAll(".sidebar-tool-btn-wrapper").forEach(function(e){return e.classList.remove("active")}),n&&n.classList.add("active")}),n.appendChild(i),t.engine.drawingManager.currentTool===a.id&&(i.classList.add("active"),r.classList.remove("active"))})}},{key:"loadFavorites",value:function(){try{var t=localStorage.getItem("fcsapi_favorite_tools");return t?JSON.parse(t):[]}catch(e){return[]}}},{key:"saveFavorites",value:function(t){try{localStorage.setItem("fcsapi_favorite_tools",JSON.stringify(t))}catch(e){}}},{key:"toggleFavorite",value:function(e,t){var a=this.loadFavorites(),n="".concat(e,":").concat(t.id),i=a.findIndex(function(e){return"".concat(e.type,":").concat(e.id)===n});if(i>=0)a.splice(i,1);else{var o={type:e,id:t.id,label:t.label,icon:t.icon||""};a.push(o)}return this.saveFavorites(a),i<0}},{key:"isFavorite",value:function(e,t){var a=this.loadFavorites(),n="".concat(e,":").concat(t);return a.some(function(e){return"".concat(e.type,":").concat(e.id)===n})}},{key:"loadFavoriteTimeframes",value:function(){try{var t=localStorage.getItem("fcsapi_favorite_timeframes");return t?JSON.parse(t):[]}catch(e){return[]}}},{key:"saveFavoriteTimeframes",value:function(t){try{localStorage.setItem("fcsapi_favorite_timeframes",JSON.stringify(t))}catch(e){}}},{key:"isFavoriteTimeframe",value:function(e){return this.loadFavoriteTimeframes().includes(e)}},{key:"toggleFavoriteTimeframe",value:function(e){var t=this.loadFavoriteTimeframes(),a=t.indexOf(e);return a>=0?t.splice(a,1):t.push(e),this.saveFavoriteTimeframes(t),this.engine.multiChartManager?(this.engine.multiChartManager.markAllChartsUnsaved(),this.engine.multiChartManager.syncTimeframeFavorites()):(this.markTemplateUnsaved(),this.favoriteTimeframesContainer&&this.updateFavoriteTimeframes()),a<0}},{key:"sortTimeframes",value:function(e){var t={"1m":1,"2m":2,"3m":3,"5m":5,"10m":10,"15m":15,"30m":30,"1H":60,"2H":120,"4H":240,"6H":360,"8H":480,"12H":720,"1D":1440,"1W":10080,"1M":43200},a=function(e){if(t[e])return t[e];var a=e.match(/^(\d+)([mHDWM])$/);if(a){var n=parseInt(a[1]);switch(a[2]){case"m":return n;case"H":return 60*n;case"D":return 1440*n;case"W":return 10080*n;case"M":return 43200*n;default:return 0}}return 0};return f(e).sort(function(e,t){return a(e)-a(t)})}},{key:"getCustomTimeframes",value:function(){try{var e=localStorage.getItem("fcsapi_custom_timeframes");return e?JSON.parse(e):[]}catch(t){return[]}}},{key:"saveCustomTimeframes",value:function(t){try{localStorage.setItem("fcsapi_custom_timeframes",JSON.stringify(t))}catch(e){}}},{key:"addCustomTimeframe",value:function(e){var t=this.getCustomTimeframes();t.includes(e)||(t.push(e),this.saveCustomTimeframes(t))}},{key:"removeCustomTimeframe",value:function(e){var t=this.getCustomTimeframes(),a=t.indexOf(e);a>=0&&(t.splice(a,1),this.saveCustomTimeframes(t));var n=this.loadFavoriteTimeframes(),i=n.indexOf(e);i>=0&&(n.splice(i,1),this.saveFavoriteTimeframes(n),this.engine.multiChartManager?this.engine.multiChartManager.syncTimeframeFavorites():this.favoriteTimeframesContainer&&this.updateFavoriteTimeframes())}},{key:"getActiveEngine",value:function(){if(this.engine.multiChartManager&&this.engine.multiChartManager.isActive()){var e=this.engine.multiChartManager.getActiveChart();return e?e.engine:this.engine}return this.engine}},{key:"updateDeleteCounts",value:function(){if(this.deleteMenuDropdown){var e=this.getActiveEngine(),t=e.drawingManager.drawings.length,a=e.markers.length,n=e.indicatorManager.indicators.length,i=t+a+n,o=this.deleteMenuDropdown.querySelector("#drawings-count"),r=this.deleteMenuDropdown.querySelector("#markers-count"),s=this.deleteMenuDropdown.querySelector("#indicators-count"),l=this.deleteMenuDropdown.querySelector("#total-count");o&&(o.textContent=t),r&&(r.textContent=a),s&&(s.textContent=n),l&&(l.textContent=i)}}},{key:"createSidebarToolWithDropdown",value:function(e,t,a){var n=this,i="sidebarDropdown-".concat(a,"-").concat(this.chartId),o="markers"===a||"emojis"===a,r=document.createElement("div");r.className="dropdown-select sidebar-tool-btn-wrapper",r.dataset.type=a,r.setAttribute("data-dropdown-id",i),r.setAttribute("data-placement","right");var s=document.createElement("button");s.className="select-trigger sidebar-tool-icon-btn",s.setAttribute("type","button"),s.setAttribute("tabindex","0"),e&&e.includes("<svg")?(s.innerHTML=e,s.classList.add("has-svg-icon")):s.textContent=e,s.setAttribute("data-tooltip-title",t),s.dataset.defaultIcon=e,r.appendChild(s);var l=document.createElement("div");if(l.id=i,l.className="select-dropdown sidebar-dropdown",l.dataset.type=a,o){l.classList.add("grid-dropdown");var d=document.createElement("div");d.className="select-options",l.appendChild(d),this.populateGridDropdownItems(a,d)}else l.innerHTML='<ul class="select-options"></ul>',this.populateSidebarDropdownItems(a,l.querySelector(".select-options"));document.body.appendChild(l),this.sidebar.appendChild(r),new c.A(r),l.addEventListener("click",function(e){var t=e.target.closest(".favorite-star");if(t){e.stopPropagation(),e.preventDefault();var i=t.dataset.toolType,s=t.dataset.toolId,l=n.findSidebarTool(i,s);if(l){var c=n.toggleFavorite(i,l);t.classList.toggle("favorited",c);var d=document.getElementById("favoritesToolbarModal");if(null!=d&&d.classList.contains("show")){var u=d.querySelector(".favorites-toolbar");u&&n.updateFavoritesToolbar(u)}}}else if(o){var h=e.target.closest(".marker-grid-item, .emoji-grid-item");if(h){var p=h.dataset.type,g=n.findMarkerOrEmoji(a,p);g&&(n.selectTool(a,g),n.sidebar.querySelectorAll(".sidebar-tool-btn-wrapper").forEach(function(e){return e.classList.remove("active")}),r.classList.add("active"),r.customSelectAPI&&r.customSelectAPI.close())}}else{var m=e.target.closest(".select-option");if(m&&!m.classList.contains("disabled")){var v=m.dataset.value,f=n.findSidebarTool(a,v);f&&(n.selectTool(a,f),n.sidebar.querySelectorAll(".sidebar-tool-btn-wrapper").forEach(function(e){return e.classList.remove("active")}),r.classList.add("active"),r.customSelectAPI&&r.customSelectAPI.close())}}},!0),this.sidebarDropdowns||(this.sidebarDropdowns={}),this.sidebarDropdowns[a]={wrapper:r,dropdown:l}}},{key:"populateGridDropdownItems",value:function(e,t){"markers"===e?n.I3.forEach(function(e,a){var n=document.createElement("div");n.className="tf-group-header",n.textContent=e.category,t.appendChild(n);var i=document.createElement("div");i.className="marker-grid",e.markers.forEach(function(e){var t=document.createElement("div");t.className="marker-grid-item",t.dataset.type=e.type,t.innerHTML='<span class="marker-icon" style="color: '.concat(e.color,'">').concat(e.icon,"</span>"),i.appendChild(t)}),t.appendChild(i)}):"emojis"===e&&this.populateEmojiGrid(t)}},{key:"populateEmojiGrid",value:function(e){i.A.forEach(function(t,a){var n=document.createElement("div");n.className="tf-group-header",n.textContent=t.category,e.appendChild(n);var i=document.createElement("div");i.className="emoji-grid",t.emojis.forEach(function(e){var t=document.createElement("div");t.className="emoji-grid-item",t.dataset.type=e.type,t.innerHTML=e.emoji,i.appendChild(t)}),e.appendChild(i)})}},{key:"findMarkerOrEmoji",value:function(e,t){if("markers"===e){var a,o=v(n.I3);try{for(o.s();!(a=o.n()).done;){var r=a.value.markers.find(function(e){return e.type===t});if(r)return r}}catch(d){o.e(d)}finally{o.f()}}else if("emojis"===e){var s,l=v(i.A);try{for(l.s();!(s=l.n()).done;){var c=s.value.emojis.find(function(e){return e.type===t});if(c)return c}}catch(d){l.e(d)}finally{l.f()}}return null}},{key:"populateSidebarDropdownItems",value:function(e,t){var a=this,n=this.getSidebarToolConfig(e);if(n){var i="";n.forEach(function(t,o){t.category&&(i+='<li class="tf-group-header'.concat(o>0?" with-separator":"",'">').concat(t.category,"</li>")),t.tools.forEach(function(t){var o,r=(null===(o=n.iconSet)||void 0===o?void 0:o[t.id])||"";t.icon=r;var s=a.getToolShortcut(t.id),l=s&&a.isKeyboardDevice()?'<span class="tool-shortcut">'.concat(s,"</span>"):"",c=a.isFavorite(e,t.id),d='<span class="favorite-star '.concat(c?"favorited":"",'" data-tool-type="').concat(e,'" data-tool-id="').concat(t.id,'"><svg width="16" height="16" fill="none" stroke="currentColor"><use href="#star"></use></svg></span>'),u=t.disabled?"disabled":"",h='<span class="select-option-img"><div class="flag-icon-container">'.concat(r,"</div><span>").concat(t.label,"</span></span>").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;");i+='<li class="select-option sidebar-dropdown-item '.concat(u,'" data-value="').concat(t.id,'" data-html="').concat(h,'"').concat(t.disabled?' style="opacity:0.5;cursor:not-allowed"':"",'>\n          <span class="select-option-img">\n            <div class="flag-icon-container">').concat(r,"</div>\n            <span>").concat(t.label,"</span>\n          </span>\n          ").concat(l).concat(d,"\n        </li>")})}),t.innerHTML=i}}},{key:"getSidebarToolConfig",value:function(e){switch(e){case"lines":return Object.assign([{category:"Trend Lines",tools:[{id:"trendline",label:"Trend Line"},{id:"trendangle",label:"Trend Angle"},{id:"infoline",label:"Info Line"}]},{category:"Horizontal & Vertical",tools:[{id:"horizontal",label:"Horizontal Line"},{id:"vertical",label:"Vertical Line"},{id:"cross",label:"Cross Line"}]},{category:"Rays",tools:[{id:"ray",label:"Ray"},{id:"horizontalRay",label:"Horizontal Ray"},{id:"extended",label:"Extended Line"}]},{category:"Channels",tools:[{id:"parallelchannel",label:"Parallel Channel"},{id:"equidistantchannel",label:"Equidistant Channel"},{id:"flattopchannel",label:"Flat Top/Bottom"},{id:"regressiontrend",label:"Regression Trend"}]},{category:"Pitchforks",tools:[{id:"pitchfork",label:"Pitchfork"},{id:"pitchforkschiff",label:"Schiff Pitchfork"},{id:"pitchforkmodified",label:"Modified Schiff"}]}],{iconSet:l.id});case"fibonacci":return Object.assign([{category:"Fibonacci & Extension",tools:[{id:"fibonacci",label:"Fib Retracement"},{id:"fibExtension",label:"Fib Extension"}]},{category:"Channels & Fans",tools:[{id:"fibchannel",label:"Fib Channel"},{id:"fibfan",label:"Fib Fan"},{id:"fibwedge",label:"Fib Wedge"}]},{category:"Time & Circles",tools:[{id:"fibtimezones",label:"Fib Time Zones"},{id:"fibcircles",label:"Fib Circles"},{id:"fibarcs",label:"Fib Speed Arcs"}]},{category:"Gann",tools:[{id:"gannbox",label:"Gann Box"},{id:"gannfan",label:"Gann Fan"}]}],{iconSet:l.zC});case"patterns":return Object.assign([{category:"Elliott Wave",tools:[{id:"abc",label:"Correction (ABC)"},{id:"elliotwave",label:"Impulse (12345)"},{id:"xyz",label:"Double Combo (WXY)"},{id:"wxyxz",label:"Triple Combo (WXYXZ)"}]},{category:"Harmonic Patterns",tools:[{id:"abcd",label:"ABCD Pattern"},{id:"abcde",label:"ABCDE Pattern"},{id:"gartley",label:"XABCD (Cipher)"},{id:"butterfly",label:"Butterfly"},{id:"threedrives",label:"Three Drives"}]},{category:"Chart Patterns",tools:[{id:"headandshoulders",label:"Head & Shoulders"}]}],{iconSet:l.K8});case"projection":return Object.assign([{category:"Projection",tools:[{id:"longposition",label:"Long Position"},{id:"shortposition",label:"Short Position"},{id:"barspattern",label:"Bars Pattern"}]},{category:"Measurement",tools:[{id:"pricezone",label:"Price Zone"},{id:"pricerange",label:"Price Range"},{id:"daterange",label:"Date Range"},{id:"datepricerange",label:"Date and Price Range"}]}],{iconSet:l.s0});case"shapes":return Object.assign([{category:"Freehand",tools:[{id:"brush",label:"Brush"},{id:"highlighter",label:"Highlighter"},{id:"highlighterrectangle",label:"Highlighter Rect"}]},{category:"Shapes",tools:[{id:"rectangle",label:"Rectangle"},{id:"circle",label:"Circle"},{id:"ellipse",label:"Ellipse"},{id:"triangle",label:"Triangle"},{id:"arrow",label:"Arrow"},{id:"pathcreator",label:"Polyline"}]}],{iconSet:l.s0});case"text":return Object.assign([{category:"Text Tools",tools:[{id:"plaintext",label:"Text"},{id:"anchoredtext",label:"Anchored Text"}]},{category:"Labels & Notes",tools:[{id:"pricelabel",label:"Price Label"},{id:"callout",label:"Callout"},{id:"note",label:"Note"}]},{category:"Advanced",tools:[{id:"textcomment",label:"Comment"},{id:"texttable",label:"Table"}]}],{iconSet:l.ns});default:return null}}},{key:"findSidebarTool",value:function(e,t){var a=this.getSidebarToolConfig(e);if(!a)return null;var n,i=v(a);try{for(i.s();!(n=i.n()).done;){var o,r=n.value.tools.find(function(e){return e.id===t});if(r)return r.icon=(null===(o=a.iconSet)||void 0===o?void 0:o[t])||"",r}}catch(s){i.e(s)}finally{i.f()}return null}},{key:"activateLastSelectedTool",value:function(e,t){var a=this.lastSelectedTools[e];a?(this.selectTool(e,a),this.sidebar.querySelectorAll(".sidebar-tool-btn-wrapper").forEach(function(e){e.classList.contains("magnet-toggle")||e.classList.remove("active")}),t.classList.add("active")):t.customSelectAPI&&t.customSelectAPI.toggle()}},{key:"selectTool",value:(A=k(w().m(function e(t,a){var n,i,o,r,s,c,d=arguments;return w().w(function(e){for(;;)switch(e.n){case 0:if(n=d.length>2&&void 0!==d[2]&&d[2],a.icon||(a.icon=(0,l.S8)(a.id)),this.lastSelectedTools[t]=a,i=this.sidebar.querySelector('.sidebar-tool-btn-wrapper[data-type="'.concat(t,'"]')),"markers"!==t){e.n=2;break}return this.selectedMarkerType=a.type,this.selectedMarkerColor=a.color,e.n=1,this.engine.drawingManager.setTool("marker");case 1:e.n=5;break;case 2:if("emojis"!==t){e.n=4;break}return this.selectedEmoji=a.emoji,this.selectedMarkerType=a.type,this.selectedMarkerColor=a.color,e.n=3,this.engine.drawingManager.setTool("marker");case 3:e.n=5;break;case 4:return i&&(o=i.querySelector(".sidebar-tool-icon-btn"))&&(o.innerHTML=a.icon||"",o.classList.add("has-svg-icon"),r=this.getToolShortcut(a.id),o.title=r&&this.isKeyboardDevice()?"".concat(a.label," (").concat(r,")"):a.label),e.n=5,this.engine.drawingManager.setTool(a.id);case 5:this.updateFavoritesToolbarActiveState(t,a.id),!n&&this.engine.multiChartManager&&(c=null===(s=this.engine.container)||void 0===s?void 0:s.id,this.engine.multiChartManager.syncToolSelection(c,t,a));case 6:return e.a(2)}},e,this)})),function(e,t){return A.apply(this,arguments)})},{key:"updateFavoritesToolbarActiveState",value:function(e,t){if(this.favoritesToolbar){this.favoritesToolbar.querySelectorAll(".favorite-tool-btn").forEach(function(e){e.classList.remove("active")});var a=this.favoritesToolbar.querySelector('.favorite-tool-btn[data-tool-type="'.concat(e,'"][data-tool-id="').concat(t,'"]'));a&&a.classList.add("active")}}},{key:"updateSidebarToolState",value:(E=k(w().m(function e(t,a){var n,i,o;return w().w(function(e){for(;;)switch(e.n){case 0:if(this.sidebar){e.n=1;break}return e.a(2);case 1:if(a.icon||(a.icon=(0,l.S8)(a.id)),this.lastSelectedTools[t]=a,(n=this.sidebar.querySelector('.sidebar-tool-btn-wrapper[data-type="'.concat(t,'"]')))&&((i=n.querySelector(".sidebar-tool-icon-btn"))&&(i.innerHTML=a.icon||"",i.classList.add("has-svg-icon"),o=this.getToolShortcut(a.id),i.title=o&&this.isKeyboardDevice()?"".concat(a.label," (").concat(o,")"):a.label),this.sidebar.querySelectorAll(".sidebar-tool-btn-wrapper").forEach(function(e){return e.classList.remove("active")}),n.classList.add("active")),"markers"!==t){e.n=3;break}return this.selectedMarkerType=a.type,this.selectedMarkerColor=a.color,e.n=2,this.engine.drawingManager.setTool("marker");case 2:e.n=4;break;case 3:if(!a.id){e.n=4;break}return e.n=4,this.engine.drawingManager.setTool(a.id);case 4:this.updateFavoritesToolbarActiveState(t,a.id);case 5:return e.a(2)}},e,this)})),function(e,t){return E.apply(this,arguments)})},{key:"switchToCursorSynced",value:function(){if(this.sidebar&&(this.engine.drawingManager.setTool(null),this.sidebar.querySelectorAll(".sidebar-tool-btn-wrapper").forEach(function(e){e.classList.contains("keep-drawing-toggle")||e.classList.contains("magnet-toggle")||e.classList.remove("active")}),this.cursorWrapper&&this.cursorWrapper.classList.add("active"),this.hideAllSidebarDropdowns(),this.favoritesToolbar)){this.favoritesToolbar.querySelectorAll(".favorite-tool-btn").forEach(function(e){e.classList.remove("active")});var e=this.favoritesToolbar.querySelector(".cursor-btn");e&&e.classList.add("active")}}},{key:"updateMagnetButtonVisual",value:function(e,t){t?(e.innerHTML=l.cI.magnetOn,e.setAttribute("data-tooltip-title",(0,u.Eg)("magnetStrong")),e.classList.add("magneton")):(e.innerHTML=l.cI.magnet,e.setAttribute("data-tooltip-title",(0,u.Eg)("magnet")),e.classList.remove("magneton"))}},{key:"setMagnetStateSynced",value:function(e){this.engine.drawingManager.magnetEnabled=e,this.magnetButton&&this.updateMagnetButtonVisual(this.magnetButton,e)}},{key:"updateKeepDrawingButtonVisual",value:function(e,t){t?(e.innerHTML=l.cI.lock,e.setAttribute("data-tooltip-title",(0,u.Eg)("keepDrawing")),e.classList.add("locked")):(e.innerHTML=l.cI.unlock,e.setAttribute("data-tooltip-title",(0,u.Eg)("keepDrawing")),e.classList.remove("locked"))}},{key:"setKeepDrawingStateSynced",value:function(e){this.keepDrawingMode=e,this.keepDrawingButton&&this.updateKeepDrawingButtonVisual(this.keepDrawingButton,e)}},{key:"setEmojiStateSynced",value:function(e){if(this.sidebar){this.selectedEmoji=e.emoji,this.selectedMarkerType=e.type,this.selectedMarkerColor=e.color;var t=this.sidebar.querySelector('.sidebar-tool-btn-wrapper[data-type="emojis"]');if(t){this.sidebar.querySelectorAll(".sidebar-tool-btn-wrapper").forEach(function(e){return e.classList.remove("active")}),t.classList.add("active");var a=t.querySelector(".sidebar-tool-icon-btn");a&&(a.textContent=e.emoji)}this.engine.drawingManager.setTool("marker")}}},{key:"closeAllDropdowns",value:function(){if(document.querySelectorAll(".toolbar-dropdown-menu").forEach(function(e){e.classList.remove("visible")}),document.querySelectorAll(".toolbar-dropdown-btn").forEach(function(e){e.classList.remove("active")}),document.querySelectorAll(".dropdown-select .select-dropdown.active").forEach(function(e){e.classList.remove("active")}),document.querySelectorAll(".dropdown-select .select-trigger.active").forEach(function(e){e.classList.remove("active")}),document.querySelectorAll(".select-dropdown.sidebar-dropdown.active").forEach(function(e){e.classList.remove("active")}),this.sidebarDropdowns&&Object.values(this.sidebarDropdowns).forEach(function(e){var t=e.wrapper;null!=t&&t.customSelectAPI&&t.customSelectAPI.close()}),document.querySelectorAll(".multi-chart-dropdown").forEach(function(e){e.classList.remove("show")}),this.chartSettingsMenu&&this.chartSettingsMenu.classList.remove("visible"),this.currentSidebarDropdown){var e=this.currentSidebarDropdown;e.classList.remove("visible"),this.currentSidebarDropdown=null,setTimeout(function(){e&&e.parentNode&&e.parentNode.removeChild(e)},200)}this.sidebar&&this.sidebar.querySelectorAll(".sidebar-tool-btn-wrapper.drclicked").forEach(function(e){e.classList.remove("drclicked")}),this._sidebarDropdownClickTimeout&&(clearTimeout(this._sidebarDropdownClickTimeout),this._sidebarDropdownClickTimeout=null),this.clickOutsideHandler&&(document.removeEventListener("click",this.clickOutsideHandler),this.clickOutsideHandler=null),this._deleteMenuClickTimeout&&(clearTimeout(this._deleteMenuClickTimeout),this._deleteMenuClickTimeout=null),this.deleteMenuClickHandler&&(document.removeEventListener("click",this.deleteMenuClickHandler),this.deleteMenuClickHandler=null),this.deleteMenuDropdown&&(this.deleteMenuDropdown.classList.remove("active"),this.deleteMenuWrapper&&this.deleteMenuWrapper.classList.remove("active")),this._toggleDropdownClickTimeout&&(clearTimeout(this._toggleDropdownClickTimeout),this._toggleDropdownClickTimeout=null)}},{key:"hideAllSidebarDropdowns",value:function(){this.closeAllDropdowns()}},{key:"switchToCursor",value:function(){var e=this.keepDrawingMode;if(!this.favoritesToolbar&&this.engine.multiChartManager){var t,a,n=null===(t=this.engine.multiChartManager.chartInstances)||void 0===t?void 0:t[0],i=null==n||null===(a=n.engine)||void 0===a?void 0:a.uiManager;i&&(e=i.keepDrawingMode)}if(!e){if(this.sidebar.querySelectorAll(".sidebar-tool-btn-wrapper").forEach(function(e){e.classList.contains("keep-drawing-toggle")||e.classList.remove("active")}),this.cursorWrapper&&this.cursorWrapper.classList.add("active"),this.sidebarDropdowns&&Object.values(this.sidebarDropdowns).forEach(function(e){var t=e.dropdown;t&&t.querySelectorAll(".select-option.selected").forEach(function(e){e.classList.remove("selected")})}),this.favoritesToolbar){var o=this.favoritesToolbar.querySelector(".cursor-btn");o&&(this.favoritesToolbar.querySelectorAll(".favorite-tool-btn").forEach(function(e){e.classList.contains("lock-btn")||e.classList.remove("active")}),o.classList.add("active"))}if(!this.favoritesToolbar&&this.engine.multiChartManager){var r,s,l=null===(r=this.engine.multiChartManager.chartInstances)||void 0===r?void 0:r[0],c=null==l||null===(s=l.engine)||void 0===s?void 0:s.uiManager;if(null!=c&&c.favoritesToolbar){var d=c.favoritesToolbar.querySelector(".cursor-btn");d&&(c.favoritesToolbar.querySelectorAll(".favorite-tool-btn").forEach(function(e){e.classList.contains("lock-btn")||e.classList.remove("active")}),d.classList.add("active"))}}if(this.hideAllSidebarDropdowns(),this.engine.multiChartManager){var u,h=null===(u=this.engine.container)||void 0===u?void 0:u.id;this.engine.multiChartManager.syncCursorSelection(h)}}}},{key:"createSearchModal",value:function(){if(window._fcsapiSearchManager)this.searchManager=window._fcsapiSearchManager;else{this.searchManager=new s.g(this.engine);var e=document.getElementById("chartSearchModal");this.searchManager.init(e),window._fcsapiSearchManager=this.searchManager}}},{key:"createAddedTab",value:function(e){this.addedContainer=e,this.updateAddedTab()}},{key:"updateAddedTab",value:function(){var e=this;if(this.addedContainer){this.addedContainer.innerHTML="";var t=document.createElement("div");t.className="indicator-list";var a=this.engine.indicatorManager.getAllIndicators();if(0===a.length){var n=document.createElement("p");return n.style.color="#758696",n.style.textAlign="center",n.style.padding="40px 20px",n.textContent="No indicators added yet",void this.addedContainer.appendChild(n)}a.forEach(function(a){var n=document.createElement("div");n.className="indicator-list-item";var i=document.createElement("span");i.className="indicator-name",i.textContent=a.config.name||a.config.type||"Custom";var o=document.createElement("div");o.className="indicator-actions";var r=document.createElement("div");r.className="action-icon",r.innerHTML=l.cI.settings,r.setAttribute("data-tooltip-title",(0,u.Eg)("indicatorSettings",!1)),r.addEventListener("click",function(t){t.stopPropagation(),e.showIndicatorSettings(a)});var s=document.createElement("div");s.className="action-icon",s.textContent="Ã—",s.setAttribute("data-tooltip-title",(0,u.Eg)("indicatorRemove",!1)),s.addEventListener("click",function(t){t.stopPropagation(),e.engine.removeIndicator(a.id),e.updateAddedTab(),e.updateIndicatorLegend()}),o.appendChild(r),o.appendChild(s),n.appendChild(i),n.appendChild(o),t.appendChild(n)}),this.addedContainer.appendChild(t)}}},{key:"toggleFavoriteIndicator",value:function(e){var t=this.favoriteIndicators.indexOf(e);t>-1?this.favoriteIndicators.splice(t,1):this.favoriteIndicators.push(e),this.saveFavoriteIndicators(),this.engine.multiChartManager?(this.engine.multiChartManager.markAllChartsUnsaved(),this.engine.multiChartManager.syncIndicatorFavorites()):(this.markTemplateUnsaved(),this.updateFavoriteIndicatorsDropdown())}},{key:"toggleDropdown",value:function(e,t){var a=this,n=e.classList.contains("visible");if(this.closeAllDropdowns(),!n){var i=t.getBoundingClientRect();e.style.top=i.bottom+5+"px",e.style.left=i.left+"px",e.classList.add("visible"),t.classList.add("active"),this._toggleDropdownClickTimeout&&(clearTimeout(this._toggleDropdownClickTimeout),this._toggleDropdownClickTimeout=null),this._toggleDropdownClickTimeout=setTimeout(function(){a._toggleDropdownClickTimeout=null,document.addEventListener("click",function(){a.closeAllDropdowns()},{once:!0})},0)}}},{key:"hideAllDropdowns",value:function(){this.closeAllDropdowns()}},{key:"createIndicatorLegend",value:function(){var e;this.indicatorLegend=document.createElement("div"),this.indicatorLegend.className="fcsapi-indicator-legend",this.indicatorLegendCollapsed=!1;var t=null===(e=this.engine.chartArea)||void 0===e?void 0:e.querySelector(".fcsapi-overlay-wrapper");t?t.appendChild(this.indicatorLegend):this.engine.chartArea.appendChild(this.indicatorLegend)}},{key:"updateIndicatorLegend",value:(M=k(w().m(function e(){var t,a,n=this;return w().w(function(e){for(;;)switch(e.n){case 0:if(this.indicatorLegend){e.n=1;break}return e.a(2);case 1:t=this.engine.indicatorManager.getAllIndicators(),this.indicatorLegend.innerHTML="",t.forEach(function(e){if("separate"!==e.panelType){var t=document.createElement("div");t.className="indicator-legend-item";var a="#2962ff";a=e.outColor?e.outColor:e.kColor?e.kColor:e.macdColor?e.macdColor:e.upColor?e.upColor:e.rsiColor?e.rsiColor:e.color||e.config.color||"#2962ff";var i=document.createElement("span");i.className="name",i.textContent=e.config.name||e.config.type||"Indicator";var o=document.createElement("span");o.className="params";var r=n.getIndicatorParamsText(e);r&&(o.textContent="(".concat(r,")"));var s=document.createElement("div");s.className="actions";var c=document.createElement("div");c.className="action-btn hide";var d=!1===e.visible;c.innerHTML='<svg width="18" height="18" fill="none" stroke="currentColor" '.concat(d?'style="opacity:0.4"':"",'><use href="#eye"></use></svg>'),c.setAttribute("data-tooltip-title",(0,u.Eg)("indicatorHide",!1)),d&&t.classList.add("hidden-indicator"),c.addEventListener("click",function(t){t.stopPropagation(),e.visible=!1===e.visible,n.engine.render(),n.updateIndicatorLegend(),n.engine.indicatorManager.saveIndicators(),n.autoSaveTemplate()});var h=document.createElement("div");h.className="action-btn edit",h.innerHTML=l.cI.settings,h.setAttribute("data-tooltip-title",(0,u.Eg)("indicatorSettings",!1)),h.addEventListener("click",function(t){t.stopPropagation(),n.showIndicatorSettings(e)});var p=document.createElement("div");p.className="action-btn remove",p.innerHTML=l.cI.trash,p.setAttribute("data-tooltip-title",(0,u.Eg)("indicatorRemove",!1)),p.addEventListener("click",function(t){t.stopPropagation(),n.engine.removeIndicator(e.id),n.updateIndicatorLegend(),n.updateAddedTab()}),s.appendChild(c),s.appendChild(h),s.appendChild(p);var g=document.createElement("span");g.className="value-display",g.dataset.indicatorId=e.id,g.dataset.color=a,g.style.color=a;for(var m=[],v=0;v<6;v++){var f=document.createElement("span");f.style.display="none",f.style.marginRight="4px",g.appendChild(f),m.push(f)}g._valueSpans=m,g._lastValues="",t.appendChild(i),r&&t.appendChild(o),t.appendChild(g),t.appendChild(s),n.indicatorLegend.appendChild(t)}}),t.filter(function(e){return"separate"!==e.panelType}).length>0&&((a=document.createElement("div")).className="indicator-legend-toggle",a.innerHTML='<svg width="18" height="18" class="toggle-arrow" fill="none" stroke="currentColor"><use href="#chevron-down"></use></svg>',a.setAttribute("data-tooltip-title",this.indicatorLegendCollapsed?"Expand indicators":"Collapse indicators"),this.indicatorLegendCollapsed&&a.classList.add("collapsed"),a.addEventListener("click",function(){n.indicatorLegendCollapsed=!n.indicatorLegendCollapsed,n.indicatorLegend.classList.toggle("collapsed",n.indicatorLegendCollapsed),a.classList.toggle("collapsed",n.indicatorLegendCollapsed),a.setAttribute("data-tooltip-title",n.indicatorLegendCollapsed?"Expand indicators":"Collapse indicators")}),this.indicatorLegend.appendChild(a),this.indicatorLegendCollapsed&&this.indicatorLegend.classList.add("collapsed")),this.updateOverlayIndicatorValues();case 2:return e.a(2)}},e,this)})),function(){return M.apply(this,arguments)})},{key:"getIndicatorParamsText",value:function(t){var a=[],n=t.config||{},i=function(e){var a;return null!==(a=t[e])&&void 0!==a?a:n[e]};if(t.constructor&&"function"==typeof t.constructor.getSettingsConfig)try{var o=t.constructor.getSettingsConfig();if(o&&o.inputs&&o.inputs.length>0){var r=["linewidth","lineWidth","opacity","transparency"];if(o.inputs.filter(function(e){return("number"===e.type||"source"===e.type||"select"===e.type)&&!r.includes(e.key)}).slice(0,3).forEach(function(e){var t=i(e.key);null!=t&&("source"===e.type?a.push(t):"select"===e.type?t!==e.default&&a.push(t):a.push(t))}),a.length>0)return a.join(", ")}}catch(e){}if(void 0!==i("k_period"))a.push("".concat(i("k_period"),",").concat(i("k_smoothing"),",").concat(i("d_smoothing")));else if(void 0!==i("kPeriod"))a.push("".concat(i("kPeriod"),",").concat(i("dPeriod"),",").concat(i("smoothK")));else if(void 0!==i("fastPeriod"))a.push("".concat(i("fastPeriod"),",").concat(i("slowPeriod"),",").concat(i("signalPeriod")));else if(void 0!==i("medLength"))a.push("".concat(i("fastLength"),",").concat(i("medLength"),",").concat(i("slowLength")));else if(void 0!==i("signalLength"))a.push("".concat(i("fastLength"),",").concat(i("slowLength"),",").concat(i("signalLength")));else if(void 0!==i("fastLength"))a.push("".concat(i("fastLength"),",").concat(i("slowLength")));else if(void 0!==i("shortLength"))a.push("".concat(i("shortLength"),",").concat(i("longLength")));else if(void 0!==i("stdDev")&&"BollingerBands"===n.type){var s;a.push("".concat(null!==(s=i("period"))&&void 0!==s?s:i("length"),",").concat(i("stdDev")))}else void 0!==i("mfiPeriod")?a.push(i("mfiPeriod")):void 0!==i("rsiLength")?a.push(i("rsiLength")):void 0!==i("atrLength")?a.push(i("atrLength")):void 0!==i("rangePeriod")?a.push(i("rangePeriod")):void 0!==i("lookback")?a.push(i("lookback")):void 0!==i("lookbackPeriod")?a.push(i("lookbackPeriod")):void 0!==i("leftBars")?a.push("".concat(i("leftBars"),",").concat(i("rightBars"))):void 0!==i("len")?a.push(i("len")):void 0!==i("length")?a.push(i("length")):void 0!==i("period")?a.push(i("period")):void 0!==i("sensitivity")?a.push(i("sensitivity")):void 0!==i("minBodyRatio")?a.push(i("minBodyRatio")):void 0!==i("tolerance")?a.push(i("tolerance")):void 0!==i("threshold")?a.push(i("threshold")):void 0!==i("minGapSize")?a.push(i("minGapSize")):void 0!==i("mult")?a.push(i("mult")):void 0!==i("overbought")?a.push("".concat(i("overbought"),",").concat(i("oversold"))):void 0!==i("consecutiveCandles")?a.push(i("consecutiveCandles")):void 0!==i("swingLookback")?a.push(i("swingLookback")):void 0!==i("pivotLookback")?a.push(i("pivotLookback")):void 0!==i("wickRatio")?a.push(i("wickRatio")):void 0!==i("minWickRatio")?a.push(i("minWickRatio")):void 0!==i("bodyThreshold")?a.push(i("bodyThreshold")):void 0!==i("maxBodyRatio")?a.push(i("maxBodyRatio")):void 0!==i("minBodySize")?a.push(i("minBodySize")):void 0!==i("trendStrength")?a.push(i("trendStrength")):void 0!==i("minCandleSize")?a.push(i("minCandleSize")):void 0!==i("squeezeThreshold")?a.push(i("squeezeThreshold")):void 0!==i("minPenetration")?a.push(i("minPenetration")):void 0!==i("maxMiddleBody")?a.push(i("maxMiddleBody")):void 0!==i("multiplier")?a.push(i("multiplier")):void 0!==i("minDistance")?a.push(i("minDistance")):void 0!==i("minCupDepth")?a.push(i("minCupDepth")):void 0!==i("fibTolerance")&&a.push(i("fibTolerance"));return a.join(", ")}},{key:"updateOverlayIndicatorValues",value:function(e){var t=this;this.indicatorLegend&&(arguments.length>0&&(null!=e?this.lastHoveredIndex=e:null===e&&(this.lastHoveredIndex=null)),this._indicatorUpdateDebounceTimer&&clearTimeout(this._indicatorUpdateDebounceTimer),this._indicatorUpdateDebounceTimer=setTimeout(function(){t._doUpdateOverlayIndicatorValues(),t._indicatorUpdateDebounceTimer=null},this._indicatorUpdateDebounceDelay))}},{key:"_doUpdateOverlayIndicatorValues",value:function(){var e=this;if(this.indicatorLegend){var t=this.engine.indicatorManager.getAllIndicators();this.indicatorLegend.querySelectorAll(".value-display").forEach(function(a){var n=a.dataset.indicatorId,i=t.find(function(e){return String(e.id)===String(n)});if(i&&i.data){var o=null!==e.lastHoveredIndex&&void 0!==e.lastHoveredIndex?e.lastHoveredIndex:0,r=[];if(i.plots&&i.plots.length>0)i.plots.forEach(function(t){if(!1!==t.showInHover&&(!t.condition||i[t.condition])){var a=i.data[t.dataKey];if(a){var n=0;void 0!==t.offset?n=t.offset:t.offsetKey&&void 0!==i[t.offsetKey]?n=i[t.offsetKey]*(t.offsetSign||1):void 0!==i.offset&&(n=i.offset);var s=o-n;if(!(s<0||s>=a.length)){var l=a[s];if(null!=l&&!isNaN(l)){var c=i[t.colorKey]||"#2962FF";r.push({value:e.engine.formatPrice(l),color:c})}}}}});else if(void 0!==i.data.out){var s=void 0!==i.offset?i.offset:0,l=o-s;if(l<0||l>=i.data.out.length)return void(a._valueSpans&&a._valueSpans.forEach(function(e){"none"!==e.style.display&&(e.style.display="none")}));var c=i.data.out[l];if(null!=c&&!isNaN(c)){var d=i.outColor||i.color||"#2962FF";r.push({value:e.engine.formatPrice(c),color:d})}if(i.data.smoothingMA&&"None"!==i.maTypeInput){var u=i.data.smoothingMA[l];if(null!=u&&!isNaN(u)){var h=i.smoothingMAColor||"#FFFF00";r.push({value:e.engine.formatPrice(u),color:h})}}if(i.data.bbUpper&&i.data.bbLower&&"SMA + Bollinger Bands"===i.maTypeInput){var p=i.data.bbUpper[l],g=i.data.bbLower[l],m="#26A69A";null==p||isNaN(p)||r.push({value:e.engine.formatPrice(p),color:m}),null==g||isNaN(g)||r.push({value:e.engine.formatPrice(g),color:m})}}else if(void 0!==i.data.upper&&void 0!==i.data.lower){var v=void 0!==i.offset?i.offset:0,f=o-v;if(f<0||f>=i.data.upper.length)return void(a._valueSpans&&a._valueSpans.forEach(function(e){"none"!==e.style.display&&(e.style.display="none")}));var b=i.data.upper[f],y=i.data.middle?i.data.middle[f]:null,w=i.data.lower[f],C=i.color||i.upperColor||"#2962FF";null==b||isNaN(b)||r.push({value:e.engine.formatPrice(b),color:C}),null==y||isNaN(y)||r.push({value:e.engine.formatPrice(y),color:C}),null==w||isNaN(w)||r.push({value:e.engine.formatPrice(w),color:C})}else if(void 0!==i.data.fast&&void 0!==i.data.slow){var S=void 0!==i.offset?i.offset:0,k=o-S;if(k<0||k>=i.data.fast.length)return void(a._valueSpans&&a._valueSpans.forEach(function(e){"none"!==e.style.display&&(e.style.display="none")}));var T=i.data.fast[k],L=i.data.slow[k],M=i.fastColor||"#2962FF",E=i.slowColor||"#FF6D00";null==T||isNaN(T)||r.push({value:e.engine.formatPrice(T),color:M}),null==L||isNaN(L)||r.push({value:e.engine.formatPrice(L),color:E})}var A=r.map(function(e){return"".concat(e.value,":").concat(e.color)}).join("|");if(a._lastValues!==A){a._lastValues=A;var I=a._valueSpans;if(!I){I=[];for(var x=0;x<6;x++){var D=document.createElement("span");D.style.display="none",D.style.marginRight="4px",a.appendChild(D),I.push(D)}a._valueSpans=I}for(var B=0;B<I.length;B++){var P=I[B];if(B<r.length){var H=r[B],N=H.value,_=H.color;P.textContent!==N&&(P.textContent=N),P.style.color!==_&&(P.style.color=_),"none"===P.style.display&&(P.style.display="")}else"none"!==P.style.display&&(P.style.display="none")}}}else a._valueSpans&&a._valueSpans.forEach(function(e){"none"!==e.style.display&&(e.style.display="none")})})}}},{key:"createSettingsDialog",value:function(){var e=this,t="indicatorSettingsModal";if(document.getElementById(t))return this.settingsDialog=document.getElementById(t),this.settingsTabHeader=this.settingsDialog.querySelector(".settings-tab-header"),void(this.settingsBody=this.settingsDialog.querySelector(".settings-dialog-body"));var a='\n      <div class="modal" id="'.concat(t,'" tabindex="-1" data-custom-modal="true" data-cm-draggable="true">\n        <div class="modal-dialog modal-md modal-dialog-centered">\n          <div class="modal-content">\n            <div class="modal-header cm-modal-header" data-cm-drag-handle>\n              <h5 class="modal-title">Indicator Settings</h5>\n              <span class="custom-modal-close" data-cm-dismiss="custom-modal">\n                <svg width="22" height="22" fill="none" stroke="currentColor"><use href="#x"></use></svg>\n              </span>\n            </div>\n            <div class="settings-tab-header">\n              <div class="settings-tab active" data-tab="settings">Settings</div>\n              <div class="settings-tab" data-tab="style">Style</div>\n            </div>\n            <div class="modal-body settings-dialog-body"></div>\n            <div class="modal-footer settings-dialog-footer">\n              <button class="btn-cancel" data-cm-dismiss="custom-modal">Cancel</button>\n              <button class="btn-apply-changes">Ok</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    ');document.body.insertAdjacentHTML("beforeend",a),this.settingsDialog=document.getElementById(t),this.settingsTabHeader=this.settingsDialog.querySelector(".settings-tab-header"),this.settingsBody=this.settingsDialog.querySelector(".settings-dialog-body");var n=this.settingsTabHeader.querySelector('[data-tab="settings"]'),i=this.settingsTabHeader.querySelector('[data-tab="style"]');n.addEventListener("click",function(){return e.switchSettingsTab("settings")}),i.addEventListener("click",function(){return e.switchSettingsTab("style")})}},{key:"switchSettingsTab",value:function(e){this.settingsTabHeader.querySelectorAll(".settings-tab").forEach(function(t){t.classList.toggle("active",t.dataset.tab===e)}),this.settingsBody.querySelectorAll(".settings-tab-content").forEach(function(t){t.classList.toggle("active",t.dataset.tab===e)})}},{key:"createDynamicField",value:function(e){var t=this,a=document.createElement("div");a.className="settings-field";var n,i=document.createElement("label");if(i.textContent=e.label,"select"===e.type){var r="settingsSelect-".concat(e.key,"-").concat(Date.now());(n=document.createElement("div")).className="dropdown-select settings-select",n.dataset.setting=e.key,n.setAttribute("data-dropdown-id",r),n.setAttribute("data-modal-escape","true");var s=e.default||(e.options?e.options[0]:"");n.innerHTML='\n        <div class="select-trigger">\n          <span class="select-trigger-text">'.concat(s,'</span>\n          <svg width="18" height="18" class="select-arrow" fill="none" stroke="currentColor">\n            <use href="#chevron-down"></use>\n          </svg>\n        </div>\n      ');var l=document.createElement("div");l.id=r,l.className="select-dropdown settings-dropdown";var c="";e.options&&Array.isArray(e.options)&&e.options.forEach(function(t){var a=t===e.default?"selected":"";c+='<li class="select-option '.concat(a,'" data-value="').concat(t,'">').concat(t,"</li>")}),l.innerHTML='<ul class="select-options">'.concat(c,"</ul>"),document.body.appendChild(l),n.addEventListener("customSelectChange",function(a){t.applySettingImmediately(e.key,a.detail.value)})}else if("source"===e.type){var d="settingsSource-".concat(e.key,"-").concat(Date.now());(n=document.createElement("div")).className="dropdown-select settings-select",n.dataset.setting=e.key,n.setAttribute("data-dropdown-id",d),n.setAttribute("data-modal-escape","true");var u=["close","open","high","low","hl2","hlc3","ohlc4"],h=["Close","Open","High","Low","HL2","HLC3","OHLC4"],p=u.indexOf(e.default),g=p>=0?h[p]:h[0];n.innerHTML='\n        <div class="select-trigger">\n          <span class="select-trigger-text">'.concat(g,'</span>\n          <svg width="18" height="18" class="select-arrow" fill="none" stroke="currentColor">\n            <use href="#chevron-down"></use>\n          </svg>\n        </div>\n      ');var m=document.createElement("div");m.id=d,m.className="select-dropdown settings-dropdown";var v="";u.forEach(function(t,a){var n=t===e.default?"selected":"";v+='<li class="select-option '.concat(n,'" data-value="').concat(t,'">').concat(h[a],"</li>")}),m.innerHTML='<ul class="select-options">'.concat(v,"</ul>"),document.body.appendChild(m),n.addEventListener("customSelectChange",function(a){t.applySettingImmediately(e.key,a.detail.value)})}else{if("checkbox"===e.type){a.className="settings-field checkbox-field";var f=document.createElement("label");(n=document.createElement("input")).type="checkbox",n.checked=e.default,n.dataset.setting=e.key;var b=document.createElement("span");return b.textContent=e.label,f.appendChild(n),f.appendChild(b),a.appendChild(f),n.addEventListener("change",function(){t.applySettingImmediately(e.key,n.checked)}),a}if("color"===e.type){(n=document.createElement("div")).className="dropdown-select color-trigger-select no-auto-highlight",n.dataset.setting=e.key,n.setAttribute("data-dropdown-id","colorPickerDropdown"),n.setAttribute("data-modal-escape","true");var y=document.createElement("div");y.className="select-trigger";var w=document.createElement("span");w.className="color-preview";var C=o.s.rgbaToHex(e.default),S=o.s.extractOpacity(e.default);w.style.backgroundColor=o.s.hexToRgba(C,S),w.dataset.color=e.default,y.appendChild(w),n.appendChild(y),n._colorPickerCallback=function(a,n){var i=o.s.hexToRgba(a,n);w.style.backgroundColor=i,w.dataset.color=i,t.applySettingImmediately(e.key,i)}}else(n=document.createElement("input")).type=e.type,n.value=e.default,n.dataset.setting=e.key,"number"===e.type?(void 0!==e.min&&(n.min=e.min),void 0!==e.max&&(n.max=e.max),void 0!==e.step&&(n.step=e.step),n.addEventListener("input",function(){var a=parseFloat(n.value);isNaN(a)||t.applySettingImmediately(e.key,a)})):n.addEventListener("input",function(){t.applySettingImmediately(e.key,n.value)})}return a.appendChild(i),a.appendChild(n),a}},{key:"setupDependentFields",value:function(e,t){t.forEach(function(t){if(t.dependsOn){var a,n=t.dependsOn,i=n.key,o=n.condition,r=null===(a=e.querySelector('.settings-field [data-setting="'.concat(t.key,'"]')))||void 0===a?void 0:a.closest(".settings-field"),s=e.querySelector('[data-setting="'.concat(i,'"]'));if(r&&s){var l=function(){var e=s.value,t=o(e);r.style.display=t?"flex":"none"};l(),s.addEventListener("change",l),s.addEventListener("input",l)}}})}},{key:"addSettingsField",value:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=document.createElement("div");i.className="settings-field";var o=document.createElement("label");o.textContent=e;var r=document.createElement("input");r.type=t,r.value=a,r.dataset.setting=e.toLowerCase().replace(/\s+/g,"_"),Object.keys(n).forEach(function(e){r.setAttribute(e,n[e])}),i.appendChild(o),i.appendChild(r),this.settingsBody.appendChild(i)}},{key:"hideSettingsDialog",value:function(){if(this.settingsDialog&&window.CustomModal){var e=window.CustomModal.getOrCreateInstance(this.settingsDialog);null==e||e.hide()}this.currentIndicator=null}},{key:"showSettingsDialog",value:function(){if(this.settingsDialog&&window.CustomModal){var e=window.CustomModal.getOrCreateInstance(this.settingsDialog);null==e||e.show()}}},{key:"showContextMenu",value:function(e,t,a){this.hideBlankAreaContextMenu(),this.selectedItem=e;var n=this.contextMenu.querySelector("#context-color-btn");if(n&&e.color){var i=o.s.rgbaToHex(e.color);n.style.background=i}var r=this.contextMenu.querySelector('[data-action="lock"]'),s=r.querySelector(".icon"),c=r.querySelector(".lock-text");e.locked?(s.innerHTML=l.cI.lock,c.textContent="Unlock"):(s.innerHTML=l.cI.unlock,c.textContent="Lock"),this.contextMenu.classList.add("visible");var d=this.contextMenu.getBoundingClientRect(),u=window.innerWidth,h=window.innerHeight,p=t,g=a;t+d.width>u&&(p=t-d.width),a+d.height>h&&(g=a-d.height),p<0&&(p=5),g<0&&(g=5),this.contextMenu.style.left=p+"px",this.contextMenu.style.top=g+"px"}},{key:"hideContextMenu",value:function(){this.contextMenu&&(this.contextMenu.classList.remove("visible"),this.selectedItem=null)}},{key:"createBlankAreaContextMenu",value:function(){var e,t,a,n=this;this.blankAreaContextMenu=document.createElement("div"),this.blankAreaContextMenu.className="drawing-context-menu blank-area-context-menu";var i=document.createElement("div");i.className="context-menu-item",i.innerHTML='<span class="icon">'.concat(l.cI.resetZoom,"</span><span>Reset Zoom</span>"),i.addEventListener("click",function(e){e.stopPropagation(),n.hideBlankAreaContextMenu(),n.resetChartZoom()}),this.blankAreaContextMenu.appendChild(i);var o=document.createElement("div");o.className="select-option-divider",this.blankAreaContextMenu.appendChild(o);var r=document.createElement("div");r.className="context-menu-item context-menu-submenu",r.innerHTML='\n      <span class="icon">'.concat(l.cI.label,'</span>\n      <span>Labels</span>\n      <span class="submenu-arrow">\n        <svg width="18" height="18" class="select-arrow" fill="none" stroke="currentColor" route="right">\n          <use href="#chevron-down"></use>\n        </svg>\n      </span>\n    ');var s=document.createElement("div");s.className="context-menu-submenu-content";var c=document.createElement("div");c.className="context-menu-item context-menu-toggle label-ask-item";var d=!0===this.engine.showAskPriceLabel;c.innerHTML='\n      <span class="toggle-checkbox '.concat(d?"checked":"",'"></span>\n      <span>Ask Price Label</span>\n    '),c.addEventListener("click",function(e){e.stopPropagation(),n.toggleAskPriceLabel();var t=c.querySelector(".toggle-checkbox");t&&(n.engine.showAskPriceLabel?t.classList.add("checked"):t.classList.remove("checked"))});var u=document.createElement("div");u.className="context-menu-item context-menu-toggle label-bid-item";var h=!0===this.engine.showBidPriceLabel;u.innerHTML='\n      <span class="toggle-checkbox '.concat(h?"checked":"",'"></span>\n      <span>Bid Price Label</span>\n    '),u.addEventListener("click",function(e){e.stopPropagation(),n.toggleBidPriceLabel();var t=u.querySelector(".toggle-checkbox");t&&(n.engine.showBidPriceLabel?t.classList.add("checked"):t.classList.remove("checked"))});var p=document.createElement("div");p.className="context-menu-item context-menu-toggle label-askbidlines-item";var g=!0===this.engine.showAskBidLines;p.innerHTML='\n      <span class="toggle-checkbox '.concat(g?"checked":"",'"></span>\n      <span>Ask Bid Lines</span>\n    '),p.addEventListener("click",function(e){e.stopPropagation(),n.toggleAskBidLines();var t=p.querySelector(".toggle-checkbox");t&&(n.engine.showAskBidLines?t.classList.add("checked"):t.classList.remove("checked"))});var m=document.createElement("div");m.className="context-menu-item context-menu-toggle label-close-item";var v=!1!==this.engine.showPriceLine;m.innerHTML='\n      <span class="toggle-checkbox '.concat(v?"checked":"",'"></span>\n      <span>Close Price</span>\n    '),m.addEventListener("click",function(e){e.stopPropagation(),n.togglePriceLine();var t=m.querySelector(".toggle-checkbox");t&&(n.engine.showPriceLine?t.classList.add("checked"):t.classList.remove("checked"))});var b=document.createElement("div");b.className="context-menu-item context-menu-toggle label-indicator-item";var y=!1!==this.engine.showIndicatorLabels;b.innerHTML='\n      <span class="toggle-checkbox '.concat(y?"checked":"",'"></span>\n      <span>Indicator Labels</span>\n    '),b.addEventListener("click",function(e){e.stopPropagation(),n.toggleIndicatorLabels();var t=b.querySelector(".toggle-checkbox");t&&(n.engine.showIndicatorLabels?t.classList.add("checked"):t.classList.remove("checked"))});var w=document.createElement("div");w.className="context-menu-item context-menu-toggle label-highlow-item";var C=!1!==this.engine.showHighLow;w.innerHTML='\n      <span class="toggle-checkbox '.concat(C?"checked":"",'"></span>\n      <span>High/Low Price</span>\n    '),w.addEventListener("click",function(e){e.stopPropagation(),n.toggleHighLow();var t=w.querySelector(".toggle-checkbox");t&&(n.engine.showHighLow?t.classList.add("checked"):t.classList.remove("checked"))});var S=document.createElement("div");S.className="context-menu-item context-menu-toggle label-ohlc-item";var k=!1!==this.engine.showOHLCBar;S.innerHTML='\n      <span class="toggle-checkbox '.concat(k?"checked":"",'"></span>\n      <span>OHLC Bar</span>\n    '),S.addEventListener("click",function(e){e.stopPropagation(),n.toggleOHLCBar();var t=S.querySelector(".toggle-checkbox");t&&(!1!==n.engine.showOHLCBar?t.classList.add("checked"):t.classList.remove("checked"))}),s.appendChild(S),s.appendChild(c),s.appendChild(u),s.appendChild(p),s.appendChild(m),s.appendChild(w),s.appendChild(b),r.appendChild(s),this.blankAreaContextMenu.appendChild(r);var T=document.createElement("div");T.className="select-option-divider",this.blankAreaContextMenu.appendChild(T);var L=document.createElement("div");L.className="context-menu-item context-menu-submenu",L.innerHTML='\n      <span class="icon">'.concat(l.cI.trash,'</span>\n      <span>Remove</span>\n      <span class="submenu-arrow">\n        <svg width="18" height="18" class="select-arrow" fill="none" stroke="currentColor">\n          <use href="#chevron-down"></use>\n        </svg>\n      </span>\n    ');var M=document.createElement("div");M.className="context-menu-submenu-content";var E=this.getActiveEngine(),A=(null===(e=E.drawingManager)||void 0===e||null===(e=e.drawings)||void 0===e?void 0:e.length)||0,I=(null===(t=E.markers)||void 0===t?void 0:t.length)||0,x=(null===(a=E.indicatorManager)||void 0===a||null===(a=a.indicators)||void 0===a?void 0:a.length)||0,D=document.createElement("div");D.className="context-menu-item remove-drawings-item",D.innerHTML='\n      <span class="icon">'.concat(l.cI.pencil,"</span>\n      <span>Delete Drawings (").concat(A,")</span>\n    "),D.addEventListener("click",function(e){var t;e.stopPropagation(),n.hideBlankAreaContextMenu();var a=n.getActiveEngine();((null===(t=a.drawingManager)||void 0===t||null===(t=t.drawings)||void 0===t?void 0:t.length)||0)>0&&(a.drawingManager.clearAll(),n.updateDeleteCounts())});var B=document.createElement("div");B.className="context-menu-item remove-markers-item",B.innerHTML='\n      <span class="icon">'.concat(l.cI.pin,"</span>\n      <span>Delete Markers (").concat(I,")</span>\n    "),B.addEventListener("click",function(e){var t;e.stopPropagation(),n.hideBlankAreaContextMenu();var a=n.getActiveEngine();((null===(t=a.markers)||void 0===t?void 0:t.length)||0)>0&&(a.clearMarkers(),n.updateDeleteCounts())});var P=document.createElement("div");P.className="context-menu-item remove-indicators-item",P.innerHTML='\n      <span class="icon">'.concat(l.cI.indicator,"</span>\n      <span>Delete Indicators (").concat(x,")</span>\n    "),P.addEventListener("click",function(e){var t;e.stopPropagation(),n.hideBlankAreaContextMenu();var a=n.getActiveEngine();if(((null===(t=a.indicatorManager)||void 0===t||null===(t=t.indicators)||void 0===t?void 0:t.length)||0)>0){var i=f(a.indicatorManager.indicators);a.indicatorManager.indicators.forEach(function(e){"separate"===e.panelType&&a.panelManager&&a.panelManager.removePanel(e.id)}),a.indicatorManager.indicators=[],a.indicatorManager.saveIndicators(),i.length>0&&a.trackAction("batchDelete",{items:i.map(function(e){return{type:"indicator",item:e}})}),a.render(),n.updateDeleteCounts(),n.updateIndicatorLegend()}});var H=document.createElement("div");H.className="context-menu-item hide-indicators-item";var N=this.areAllIndicatorsHidden();H.innerHTML='\n      <span class="icon">\n        <svg width="18" height="18" fill="none" stroke="currentColor">\n          <use href="#eye"></use>\n        </svg>\n      </span>\n      <span>'.concat(N?"Show":"Hide"," All Indicators</span>\n    "),H.addEventListener("click",function(e){e.stopPropagation(),n.hideBlankAreaContextMenu(),n.toggleAllIndicatorsVisibility()});var _=document.createElement("div");_.className="context-menu-item remove-all-item";var F=A+I+x;_.innerHTML='\n      <span class="icon">'.concat(l.cI.trash,"</span>\n      <span>Delete All (").concat(F,")</span>\n    "),_.addEventListener("click",function(e){var t,a,i;e.stopPropagation(),n.hideBlankAreaContextMenu();var o=n.getActiveEngine();((null===(t=o.drawingManager)||void 0===t||null===(t=t.drawings)||void 0===t?void 0:t.length)||0)+((null===(a=o.markers)||void 0===a?void 0:a.length)||0)+((null===(i=o.indicatorManager)||void 0===i||null===(i=i.indicators)||void 0===i?void 0:i.length)||0)>0&&(o.drawingManager.clearAll(),o.clearMarkers(),o.indicatorManager.indicators.map(function(e){return e.id}).forEach(function(e){return o.removeIndicator(e)}),n.updateDeleteCounts())}),M.appendChild(D),M.appendChild(B),M.appendChild(P),M.appendChild(H);var q=document.createElement("div");q.className="select-option-divider",M.appendChild(q),M.appendChild(_),L.appendChild(M),this.blankAreaContextMenu.appendChild(L);var O=document.createElement("div");O.className="select-option-divider",this.blankAreaContextMenu.appendChild(O);var R=document.createElement("div");R.className="context-menu-item",R.innerHTML='<span class="icon">'.concat(l.cI.factoryReset,"</span><span>Factory Reset</span>"),R.addEventListener("click",function(e){e.stopPropagation(),n.hideBlankAreaContextMenu(),n.confirmFactoryReset()});var W=document.createElement("div");W.className="context-menu-item",W.innerHTML='<span class="icon">'.concat(l.cI.camera,"</span><span>Screenshot</span>"),W.addEventListener("click",function(e){e.stopPropagation(),n.hideBlankAreaContextMenu();var t=n.engine.exportImage();if(t){var a=document.createElement("a"),i=(new Date).toISOString().replace(/[:.]/g,"-").slice(0,-5);a.download="chart-screenshot-".concat(i,".png"),a.href=t,a.click()}}),this.blankAreaContextMenu.appendChild(R),this.blankAreaContextMenu.appendChild(W);var U=document.createElement("div");U.className="select-option-divider",this.blankAreaContextMenu.appendChild(U);var j=document.createElement("div");j.className="context-menu-item",j.innerHTML='<span class="icon">'.concat(l.cI.settings,"</span><span>All Settings</span>"),j.addEventListener("click",function(e){var t;e.stopPropagation(),n.hideBlankAreaContextMenu(),null===(t=n.chartSettingsModalManager)||void 0===t||t.show()}),this.blankAreaContextMenu.appendChild(j),document.addEventListener("click",function(e){n.blankAreaContextMenu&&n.blankAreaContextMenu.classList.contains("visible")&&!n.blankAreaContextMenu.contains(e.target)&&n.hideBlankAreaContextMenu()}),this.engine.wrapperDiv.appendChild(this.blankAreaContextMenu)}},{key:"showBlankAreaContextMenu",value:function(e,t){this.hideContextMenu(),this.blankAreaContextMenu||this.createBlankAreaContextMenu(),this.updateContextMenuCounts(),this.blankAreaContextMenu.classList.add("visible");var a=this.blankAreaContextMenu.getBoundingClientRect(),n=window.innerWidth,i=window.innerHeight,o=e,r=t;e+a.width>n&&(o=e-a.width),t+a.height>i&&(r=t-a.height),o<0&&(o=5),r<0&&(r=5),this.blankAreaContextMenu.style.left=o+"px",this.blankAreaContextMenu.style.top=r+"px"}},{key:"updateContextMenuCounts",value:function(){var e,t,a;if(this.blankAreaContextMenu){var n=(null===(e=this.engine.drawingManager)||void 0===e||null===(e=e.drawings)||void 0===e?void 0:e.length)||0,i=(null===(t=this.engine.markers)||void 0===t?void 0:t.length)||0,o=(null===(a=this.engine.indicatorManager)||void 0===a||null===(a=a.indicators)||void 0===a?void 0:a.length)||0,r=n+i+o,s=this.blankAreaContextMenu.querySelector(".remove-drawings-item");s&&(s.innerHTML='\n        <span class="icon">'.concat(l.cI.pencil,"</span>\n        <span>Delete Drawings (").concat(n,")</span>\n      "));var c=this.blankAreaContextMenu.querySelector(".remove-markers-item");c&&(c.innerHTML='\n        <span class="icon">'.concat(l.cI.pin,"</span>\n        <span>Delete Markers (").concat(i,")</span>\n      "));var d=this.blankAreaContextMenu.querySelector(".remove-indicators-item");d&&(d.innerHTML='\n        <span class="icon">'.concat(l.cI.indicator,"</span>\n        <span>Delete Indicators (").concat(o,")</span>\n      "));var u=this.blankAreaContextMenu.querySelector(".hide-indicators-item");if(u){var h=this.areAllIndicatorsHidden();u.innerHTML='\n        <span class="icon">\n          <svg width="18" height="18" fill="none" stroke="currentColor">\n          <use href="#eye"></use>\n        </svg>\n        </span>\n        <span>'.concat(h?"Show":"Hide"," All Indicators</span>\n      ")}var p=this.blankAreaContextMenu.querySelector(".remove-all-item");p&&(p.innerHTML='\n        <span class="icon">'.concat(l.cI.trash,"</span>\n        <span>Delete All (").concat(r,")</span>\n      "));var g=this.blankAreaContextMenu.querySelector(".label-ask-item");if(g){var m=!0===this.engine.showAskPriceLabel;g.innerHTML='\n        <span class="toggle-checkbox '.concat(m?"checked":"",'"></span>\n        <span>Ask Price Label</span>\n      ')}var v=this.blankAreaContextMenu.querySelector(".label-bid-item");if(v){var f=!0===this.engine.showBidPriceLabel;v.innerHTML='\n        <span class="toggle-checkbox '.concat(f?"checked":"",'"></span>\n        <span>Bid Price Label</span>\n      ')}var b=this.blankAreaContextMenu.querySelector(".label-askbidlines-item");if(b){var y=!0===this.engine.showAskBidLines;b.innerHTML='\n        <span class="toggle-checkbox '.concat(y?"checked":"",'"></span>\n        <span>Ask Bid Lines</span>\n      ')}var w=this.blankAreaContextMenu.querySelector(".label-close-item");if(w){var C=!1!==this.engine.showPriceLine;w.innerHTML='\n        <span class="toggle-checkbox '.concat(C?"checked":"",'"></span>\n        <span>Close Price</span>\n      ')}var S=this.blankAreaContextMenu.querySelector(".label-indicator-item");if(S){var k=!1!==this.engine.showIndicatorLabels;S.innerHTML='\n        <span class="toggle-checkbox '.concat(k?"checked":"",'"></span>\n        <span>Indicator Labels</span>\n      ')}var T=this.blankAreaContextMenu.querySelector(".label-highlow-item");if(T){var L=!1!==this.engine.showHighLow;T.innerHTML='\n        <span class="toggle-checkbox '.concat(L?"checked":"",'"></span>\n        <span>High/Low Price</span>\n      ')}var M=this.blankAreaContextMenu.querySelector(".label-ohlc-item");if(M){var E=!1!==this.engine.showOHLCBar;M.innerHTML='\n        <span class="toggle-checkbox '.concat(E?"checked":"",'"></span>\n        <span>OHLC Bar</span>\n      ')}}}},{key:"hideBlankAreaContextMenu",value:function(){this.blankAreaContextMenu&&this.blankAreaContextMenu.classList.remove("visible")}},{key:"showFloatingToolbar",value:function(e,t,a){var n;if((this.floatingToolbar&&this.floatingToolbarModal||("function"==typeof this.createFloatingToolbar&&this.createFloatingToolbar(),this.floatingToolbar&&this.floatingToolbarModal))&&!(this._floatingToolbarHideTime&&Date.now()-this._floatingToolbarHideTime<50)){var i=this.drawingQuickToolbarModal||document.getElementById("drawingQuickToolbarModal");if(void 0!==t&&void 0!==a&&i)return this.drawingQuickToolbarModal||(this.drawingQuickToolbarModal=i),void this.showDrawingQuickToolbar(e);this.floatingToolbarItem=e,this.floatingToolbarVisible=!0,this.floatingToolbarModal._activeUIManager=this;var r=void 0!==e.index,s="fibonacci"===e.type||"fibExtension"===e.type||"fibchannel"===e.type||"fibtimezones"===e.type||"fibfan"===e.type||"fibwedge"===e.type||"fibcircles"===e.type||"fibarcs"===e.type||"gannbox"===e.type,c="longposition"===e.type||"shortposition"===e.type;e.text||(e.text=""),e.textColor||(e.textColor="plaintext"===e.type?"#999999":"#ffffff"),e.textSize||(e.textSize=12),e.textPosition||(e.textPosition="above-center");var d,u=this.floatingToolbar.querySelector("#floating-color-btn"),h=null==u?void 0:u.querySelector(".color-preview");h&&("plaintext"===e.type?e.backgroundColor&&"transparent"!==e.backgroundColor?(d=e.backgroundColor,h.style.background=d):(d="#000000",h.style.background="#000000"):"textcomment"===e.type||"pricelabel"===e.type||"callout"===e.type||"note"===e.type||"anchoredtext"===e.type?e.borderColor?(h.style.background=e.borderColor,d=e.backgroundColor):e.backgroundColor&&(d=e.backgroundColor,h.style.background=d):"texttable"===e.type&&e.backgroundColor?(d=e.backgroundColor,h.style.background=d):e.color&&(d=e.color,h.style.background=d));var p=this.floatingToolbar.querySelector("#floating-text-input");p&&(p.value=e.text||"");var g=this.floatingToolbar.querySelector("#floating-text-color-trigger"),v=null==g?void 0:g.querySelector(".color-preview");v&&(v.style.background=e.textColor||"#d0d0d0");var f=function(e,t){if(e)if(e.customSelectAPI&&e.customSelectAPI.optionsContainer)e.customSelectAPI.setValue(String(t));else{var a=e.querySelector(".select-trigger-text")||e.querySelector(".selected-text"),n=e.getAttribute("data-dropdown-id"),i=n?document.getElementById(n):e;(i?i.querySelectorAll(".select-option"):[]).forEach(function(e){e.classList.toggle("selected",e.dataset.value===String(t)),e.dataset.value===String(t)&&a&&(a.innerHTML=e.innerHTML)})}};f(this.floatingToolbar.querySelector("#floating-text-size-select"),e.textSize||12);var b=m((e.textPosition||"above-center").split("-"),2),y=b[0],w=b[1],C=this.floatingToolbar.querySelector("#floating-text-vpos"),S=this.floatingToolbar.querySelector("#floating-text-hpos");f(C,y||"above"),f(S,w||"center"),this.updateCoordinatesTab(e);var k=this.floatingToolbar.querySelector(".settings-field:has(#floating-width-select)"),T=this.floatingToolbar.querySelector(".settings-field.style-field"),L=this.floatingToolbar.querySelector("#floating-width-select"),M=this.floatingToolbar.querySelector("#floating-style-select"),E=null==k?void 0:k.querySelector("label");if(r)k&&(k.style.display=""),E&&(E.textContent="Size"),T&&(T.style.display="none"),f(L,e.size||1);else if(s){k&&(k.style.display=""),E&&(E.textContent="Line"),T&&(T.style.display="");var A=e.lineWidth||1,I=e.lineStyle||"solid";f(L,A),f(M,I)}else{k&&(k.style.display=""),E&&(E.textContent="Line"),T&&(T.style.display="");var x=e.lineWidth||1,D=e.lineStyle||"solid";f(L,x),f(M,D)}var B=this.floatingToolbar.querySelector(".settings-field.tooltip-mode-row"),P=this.floatingToolbar.querySelector(".settings-field.layer-row");if(B)if(r||["brush","highlighter","highlighterrectangle","daterange","pathcreator","polygon","triangle","pricerange","plaintext","textcomment","pricelabel","callout","note","anchoredtext","texttable","abc","xyz","wxyxz","abcd","abcde","gartley","butterfly","elliotwave","headandshoulders","threedrives"].includes(e.type))B.style.display="none";else{B.style.display="",e.tooltipMode||(e.tooltipMode="auto"),["pitchfork","pitchforkschiff","pitchforkmodified","equidistantchannel","flattopchannel","flatbottomchannel"].includes(e.type)&&(e.showInfoBox="off"!==e.tooltipMode),"always"===e.tooltipMode&&(e.tooltipMode="auto");var H=e.tooltipMode||"auto";this.floatingToolbar.querySelectorAll(".tooltip-mode-btn").forEach(function(e){e.dataset.mode===H?e.classList.add("active"):e.classList.remove("active")})}var N=this.floatingToolbar.querySelector(".settings-field.projection-toggle-row");if(N)if(["abc","xyz","wxyxz","elliotwave","butterfly","threedrives"].includes(e.type)){N.style.cssText="display: flex !important;",void 0===e.showProjections&&(e.showProjections=!0);var _=this.floatingToolbar.querySelector("#show-projections-checkbox");_&&(_.checked=e.showProjections)}else N.style.cssText="display: none !important;";if(P){e.layer||(e.layer="front");var F=this.floatingToolbar.querySelector("#floating-layer-toggle");F&&(F.checked="behind"===e.layer)}var q=this.floatingToolbar.querySelector(".settings-field.bg-opacity-field");if(q)if(["rectangle","ellipse","arc","parallelchannel","flattopchannel","flatbottomchannel","pricerange","daterange","highlighterrectangle","polygon","triangle","fibonacci","fibExtension","fibchannel","fibtimezones","fibfan","fibwedge","fibcircles","fibarcs"].includes(e.type)){if(q.style.display="",!e.fillColor){var O=e.color||"#2962ff";e.fillColor=o.s.hexToRgba(o.s.rgbaToHex(O),20)}var R=this.floatingToolbar.querySelector("#floating-bg-opacity"),W=this.floatingToolbar.querySelector(".bg-opacity-field .opacity-value");if(R){var U=o.s.extractOpacity(e.fillColor);R.value=U,W&&(W.textContent="".concat(U,"%"))}}else q.style.display="none";var j="brush"===e.type||"highlighter"===e.type,G=this.floatingToolbar.querySelector('.settings-tab[data-tab="coordinates"]'),z=this.floatingToolbar.querySelector('.tab-content[data-tab="coordinates"]');if(j){if(G&&(G.style.display="none"),z&&(z.style.display="none"),G&&G.classList.contains("active")){var V=this.floatingToolbar.querySelector('.settings-tab[data-tab="style"]'),J=this.floatingToolbar.querySelector('.tab-content[data-tab="style"]');V&&J&&(G.classList.remove("active"),V.classList.add("active"),z&&z.classList.remove("active"),J.classList.add("active"))}}else G&&(G.style.display=""),z&&(z.style.display="");var K=this.floatingToolbar.querySelector('.settings-tab[data-tab="text"]'),Z=this.floatingToolbar.querySelector('.tab-content[data-tab="text"]'),X=this.floatingToolbar.querySelector('.settings-tab[data-tab="lines"]'),Y=this.floatingToolbar.querySelector('.tab-content[data-tab="lines"]');if(s)K&&(K.style.display="none"),Z&&(Z.style.display="none"),X&&(X.style.display=""),Y&&(Y.style.display=""),this.updateFibLinesTab(e),K&&K.classList.contains("active")&&(K.classList.remove("active"),X&&X.classList.add("active"),Z&&Z.classList.remove("active"),Y&&Y.classList.add("active"));else if(c){if(K&&(K.style.display="none"),Z&&(Z.style.display="none"),X){X.style.display="";var Q=X.querySelector("span");Q&&(Q.textContent="Position")}Y&&(Y.style.display=""),this.updatePositionSettingsTab(e),K&&K.classList.contains("active")&&(K.classList.remove("active"),X&&X.classList.add("active"),Z&&Z.classList.remove("active"),Y&&Y.classList.add("active"))}else K&&(K.style.display=""),Z&&(Z.style.display=""),X&&(X.style.display="none"),Y&&(Y.style.display="none"),X&&X.classList.contains("active")&&(X.classList.remove("active"),K&&K.classList.add("active"),Y&&Y.classList.remove("active"),Z&&Z.classList.add("active"));var $=this.floatingToolbar.querySelector('[data-action="lock"]'),ee=$.querySelector(".lock-icon"),te=$.querySelectorAll("span")[1];ee.innerHTML=e.locked?l.cI.lock:l.cI.unlock,te&&(te.textContent=e.locked?"Unlock":"Lock");var ae=this.floatingToolbarModal.querySelector(".modal-title");if(ae){var ne=this.getDrawingDisplayName(e.type,r);ae.textContent=ne}this.updateTemplateDropdown();var ie=null===(n=window.CustomModal)||void 0===n?void 0:n.getOrCreateInstance(this.floatingToolbarModal);ie&&!this.floatingToolbarModal.classList.contains("show")&&ie.show()}}},{key:"hideFloatingToolbar",value:function(){if(this.floatingToolbarModal){var e,t=null===(e=window.CustomModal)||void 0===e?void 0:e.getInstance(this.floatingToolbarModal);t&&t.hide(),this.floatingToolbarItem=null,this.floatingToolbarVisible=!1,this._floatingToolbarHideTime=Date.now()}}},{key:"getDrawingDisplayName",value:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?"Marker":{trendline:"Trend Line",horizontalline:"Horizontal Line",verticalline:"Vertical Line",ray:"Ray",arrow:"Arrow",extendedline:"Extended Line",infoline:"Info Line",crossline:"Cross Line",parallelchannel:"Parallel Channel",equidistantchannel:"Equidistant Channel",flattopchannel:"Flat Top Channel",flatbottomchannel:"Flat Bottom Channel",regressiontrend:"Regression Trend",pitchfork:"Pitchfork",pitchforkschiff:"Schiff Pitchfork",pitchforkmodified:"Modified Pitchfork",fibonacci:"Fibonacci Retracement",fibExtension:"Fibonacci Extension",fibchannel:"Fibonacci Channel",fibtimezones:"Fibonacci Time Zones",fibfan:"Fibonacci Fan",fibwedge:"Fibonacci Wedge",fibcircles:"Fibonacci Circles",fibarcs:"Fibonacci Arcs",rectangle:"Rectangle",ellipse:"Ellipse",triangle:"Triangle",polygon:"Polygon",pathcreator:"Path",arc:"Arc",gannbox:"Gann Box",gannfan:"Gann Fan",gannsquare:"Gann Square",pricerange:"Price Range",daterange:"Date Range",datepricerange:"Date & Price Range",plaintext:"Text",textcomment:"Comment",pricelabel:"Price Label",callout:"Callout",note:"Note",anchoredtext:"Anchored Text",texttable:"Table",abc:"ABC Pattern",xyz:"XYZ Pattern",wxyxz:"WXYXZ Pattern",abcd:"ABCD Pattern",abcde:"ABCDE Pattern",gartley:"Gartley Pattern",butterfly:"Butterfly Pattern",elliotwave:"Elliott Wave",headandshoulders:"Head & Shoulders",threedrives:"Three Drives",brush:"Brush",highlighter:"Highlighter",highlighterrectangle:"Highlight Area",cycle:"Cycle",longposition:"Long Position",shortposition:"Short Position"}[e]||e.charAt(0).toUpperCase()+e.slice(1)}},{key:"_setupFibLinesEventDelegation",value:function(e){var t=this,a=e.closest('.tab-content[data-tab="lines"]');a&&!a._dropdownCloseSetup&&(a._dropdownCloseSetup=!0,a.addEventListener("click",function(e){var t;e.target.closest(".dropdown-select")||e.target.closest(".select-dropdown")||null===(t=window.CustomSelect)||void 0===t||t.closeAll()}));var n=function(e){var t="fibtimezones"===e.type;return e.type,{levelsKey:t?"timezones":"levels",visibleKey:t?"visibleZones":"visibleLevels",customKey:t?"customTimezones":"customLevels",colorsKey:t?"zoneColors":"levelColors"}},i=function(e,a){var i=n(e),o=i.visibleKey,r=i.customKey,s=i.colorsKey,l=parseFloat(a);if(e[r].includes(l))return e[o][l]=!0,t.engine.drawingManager.saveToStorage(),t.engine.render(),void t.updateFibLinesTab(e);var c="fibExtension"===e.type;e[r].push(l),e[r].sort(function(e,t){return e-t}),e[o][l]=c;var d="#ffd700";.236===l?d="#ff6b6b":.382===l?d="#ffa500":.5===l?d="#ffd700":.618===l?d="#4caf50":.786===l?d="#2196f3":1===l?d="#9c27b0":1.618===l?d="#ff9800":2.618===l?d="#f44336":4.236===l&&(d="#e91e63"),e[s][l]||(e[s][l]=d),t.engine.drawingManager.saveToStorage(),t.engine.render(),t.updateFibLinesTab(e)};e.addEventListener("change",function(e){if(e.target.classList.contains("fib-line-checkbox")){e.stopPropagation();var a=t.floatingToolbarItem;if(a){var i=n(a).visibleKey,o=parseFloat(e.target.dataset.level);a[i][o]=e.target.checked,t.engine.drawingManager.saveToStorage(),t.engine.render()}}}),e.addEventListener("input",function(e){if(e.target.classList.contains("fib-line-value")){e.stopPropagation();var a=t.floatingToolbarItem;if(a){var i=n(a),o=i.visibleKey,r=i.customKey,s=i.colorsKey,l=parseInt(e.target.dataset.levelIndex),c=a[r][l],d=parseFloat(e.target.value);if(!isNaN(d)&&d>=0){a[r][l]=d;var u=a[o][c];if(delete a[o][c],a[o][d]=u,a[s][c]){var h=a[s][c];delete a[s][c],a[s][d]=h}var p=e.target.parentElement.querySelector(".fib-line-checkbox");p&&(p.dataset.level=d);var g=e.target.parentElement.querySelector(".fib-line-color-btn");g&&(g.dataset.level=d),t.engine.drawingManager.saveToStorage(),t.engine.render()}}}}),e.addEventListener("click",function(e){var a=e.target.closest(".fib-line-color-btn");if(a&&!a._colorPickerCallback){if(!t.floatingToolbarItem)return;var i=parseFloat(a.dataset.level),r=a.querySelector(".color-preview");a._colorPickerCallback=function(e,a){var s=t.floatingToolbarItem;if(s){var l=n(s),c=o.s.hexToRgba(e,a);s[l.colorsKey][i]=c,r&&(r.style.background=c),t.engine.drawingManager.saveToStorage(),t.engine.render()}}}},!0),e.addEventListener("click",function(e){var t;e.stopPropagation(),e.target.closest(".dropdown-select")||e.target.closest(".select-dropdown")||null===(t=window.CustomSelect)||void 0===t||t.closeAll()}),document._fibDropdownEventsSetup||(document._fibDropdownEventsSetup=!0,document.addEventListener("click",function(e){var a=e.target.closest("#fibAddLineDropdown");if(a){var n=e.target.closest(".fib-add-level-option");if(n){var o,r=t.floatingToolbarItem;if(!r)return;return i(r,n.dataset.value),void(null===(o=window.CustomSelect)||void 0===o||o.closeAll())}if(e.target.closest(".fib-add-custom-btn")){var s=t.floatingToolbarItem;if(!s)return;var l,c=a.querySelector(".fib-custom-level-input"),d=parseFloat(null==c?void 0:c.value);!isNaN(d)&&d>=0&&d<=10&&(i(s,d),c.value="",null===(l=window.CustomSelect)||void 0===l||l.closeAll())}else e.target.classList.contains("fib-custom-level-input")&&(e.stopPropagation(),e.target.focus())}}),document.addEventListener("mousedown",function(e){e.target.classList.contains("fib-custom-level-input")&&e.stopPropagation()}),document.addEventListener("keypress",function(e){if(e.target.classList.contains("fib-custom-level-input")&&e.target.closest("#fibAddLineDropdown")&&"Enter"===e.key){e.stopPropagation();var a=t.floatingToolbarItem;if(a){var n,o=parseFloat(e.target.value);!isNaN(o)&&o>=0&&o<=10&&(i(a,o),e.target.value="",null===(n=window.CustomSelect)||void 0===n||n.closeAll())}}})),e.addEventListener("mousedown",function(e){(e.target.classList.contains("fib-line-checkbox")||e.target.classList.contains("fib-line-value")||e.target.closest(".fib-line-color-btn")||e.target.closest(".dropdown-select")||e.target.closest(".select-dropdown"))&&e.stopPropagation()})}},{key:"makeModalDraggable",value:function(e,t){var a,n,i,o,r=!1,s=0,l=0,c=0,d=0,u=0,h=0;function p(s){if("BUTTON"!==s.target.tagName){s.preventDefault();var l=window.innerWidth,p=window.innerHeight,g=l/2,m=p/2;a=-(g-50),n=l-g-50,i=-(m-50),o=p-m-50;var v="touchstart"===s.type?s.touches[0].clientX:s.clientX,f="touchstart"===s.type?s.touches[0].clientY:s.clientY;c=v-u,d=f-h,r=!0,e.style.cursor="move",t.style.cursor="grabbing",document.body.style.cursor="move",document.body.style.userSelect="none",e.classList.add("dragging"),e.style.willChange="transform"}}function g(t){if(r){t.preventDefault();var p="touchmove"===t.type?t.touches[0].clientX:t.clientX,g="touchmove"===t.type?t.touches[0].clientY:t.clientY;s=p-c,l=g-d,s=Math.max(a,Math.min(s,n)),l=Math.max(i,Math.min(l,o)),u=s,h=l,e.style.transform="translate(-50%, -50%) translate(".concat(s,"px, ").concat(l,"px)")}}function m(a){r&&(c=s,d=l,r=!1,e.style.cursor="default",t.style.cursor="move",document.body.style.cursor="default",document.body.style.userSelect="",e.classList.remove("dragging"),e.style.willChange="auto")}t.style.cursor="move",t.style.userSelect="none",t.addEventListener("mousedown",p),document.addEventListener("mousemove",g),document.addEventListener("mouseup",m),t.addEventListener("touchstart",p,{passive:!1}),document.addEventListener("touchmove",g,{passive:!1}),document.addEventListener("touchend",m)}},{key:"updateThemeMenuItem",value:function(e){this.themeMenuItem&&(this.themeMenuItem.innerHTML='<span class="icon">'.concat("dark"===e?"â˜€ï¸":"ðŸŒ™","</span> ").concat("dark"===e?"Light Mode":"Dark Mode"))}},{key:"resetChartZoom",value:function(){var t,a;this.engine.interactionManager&&(this.engine.interactionManager.priceScaleFactor=1,this.engine.interactionManager.priceOffset=0);var n=this.engine.constructor.DEFAULT_SETTINGS.futureOffset;try{var i=localStorage.getItem("fcsapi_chart_settings");if(i){var o=JSON.parse(i);o.comprehensiveSettings&&void 0!==o.comprehensiveSettings.futureOffset&&(n=o.comprehensiveSettings.futureOffset)}}catch(e){}if(this.engine.scrollOffset=-n,this.engine.zoomLevel=1,this.engine.candleWidth=(null===(t=this.engine.options)||void 0===t?void 0:t.candleWidth)||this.engine.constructor.DEFAULT_SETTINGS.candleWidth,this.engine.candleSpacing=(null===(a=this.engine.options)||void 0===a?void 0:a.candleSpacing)||this.engine.constructor.DEFAULT_SETTINGS.candleSpacing,this.engine.isParentChart()&&localStorage.removeItem("chart1_zoom"),this.engine.calculateVisibleRange(),this.engine.calculatePriceRange(),this.engine.render(),this.engine.multiChartManager){var r=this.engine.container.id;this.engine.multiChartManager.syncZoomReset(r)}}},{key:"saveChartSettings",value:function(t){try{var a=JSON.parse(localStorage.getItem("fcsapi_chart_settings"))||{};a=g(g({},a),t),this.engine.saveToCache("fcsapi_chart_settings",JSON.stringify(a))}catch(e){}}},{key:"toggleAskPriceLabel",value:function(){this.engine.showAskPriceLabel=!this.engine.showAskPriceLabel,this.engine.render();var e=JSON.parse(localStorage.getItem("fcsapi_chart_settings"))||{};if(e.comprehensiveSettings||(e.comprehensiveSettings={}),e.comprehensiveSettings.showAskPriceLabel=this.engine.showAskPriceLabel,this.engine.saveToCache("fcsapi_chart_settings",JSON.stringify(e)),this.comprehensiveSettingsDialog){var t=this.comprehensiveSettingsDialog.querySelector("#show-ask-price-label");t&&(t.checked=this.engine.showAskPriceLabel)}}},{key:"toggleBidPriceLabel",value:function(){this.engine.showBidPriceLabel=!this.engine.showBidPriceLabel,this.engine.render();var e=JSON.parse(localStorage.getItem("fcsapi_chart_settings"))||{};if(e.comprehensiveSettings||(e.comprehensiveSettings={}),e.comprehensiveSettings.showBidPriceLabel=this.engine.showBidPriceLabel,this.engine.saveToCache("fcsapi_chart_settings",JSON.stringify(e)),this.comprehensiveSettingsDialog){var t=this.comprehensiveSettingsDialog.querySelector("#show-bid-price-label");t&&(t.checked=this.engine.showBidPriceLabel)}}},{key:"toggleAskBidLines",value:function(){this.engine.showAskBidLines=!this.engine.showAskBidLines,this.engine.render();var e=JSON.parse(localStorage.getItem("fcsapi_chart_settings"))||{};if(e.comprehensiveSettings||(e.comprehensiveSettings={}),e.comprehensiveSettings.showAskBidLines=this.engine.showAskBidLines,this.engine.saveToCache("fcsapi_chart_settings",JSON.stringify(e)),this.comprehensiveSettingsDialog){var t=this.comprehensiveSettingsDialog.querySelector("#show-ask-bid-lines");t&&(t.checked=this.engine.showAskBidLines)}}},{key:"togglePriceLine",value:function(){this.engine.showPriceLine=!this.engine.showPriceLine,this.engine.render();var e=JSON.parse(localStorage.getItem("fcsapi_chart_settings"))||{};if(e.comprehensiveSettings||(e.comprehensiveSettings={}),e.comprehensiveSettings.showPriceLine=this.engine.showPriceLine,this.engine.saveToCache("fcsapi_chart_settings",JSON.stringify(e)),this.comprehensiveSettingsDialog){var t=this.comprehensiveSettingsDialog.querySelector("#show-price-line");t&&(t.checked=this.engine.showPriceLine)}}},{key:"toggleIndicatorLabels",value:function(){this.engine.showIndicatorLabels=!this.engine.showIndicatorLabels,this.engine.render();var e=JSON.parse(localStorage.getItem("fcsapi_chart_settings"))||{};if(e.comprehensiveSettings||(e.comprehensiveSettings={}),e.comprehensiveSettings.showIndicatorLabels=this.engine.showIndicatorLabels,this.engine.saveToCache("fcsapi_chart_settings",JSON.stringify(e)),this.comprehensiveSettingsDialog){var t=this.comprehensiveSettingsDialog.querySelector("#show-indicator-labels");t&&(t.checked=this.engine.showIndicatorLabels)}}},{key:"areAllIndicatorsHidden",value:function(){var e,t=(null===(e=this.getActiveEngine().indicatorManager)||void 0===e?void 0:e.indicators)||[];return 0!==t.length&&t.every(function(e){return!1===e.visible})}},{key:"toggleAllIndicatorsVisibility",value:function(){var e,t=this.getActiveEngine(),a=(null===(e=t.indicatorManager)||void 0===e?void 0:e.indicators)||[];if(0!==a.length){var n=!!this.areAllIndicatorsHidden();a.forEach(function(e){if(e.visible=n,"separate"===e.panelType&&t.panelManager){var a=t.panelManager.panels.find(function(t){return t.indicator.id===e.id});if(a){a.wrapper.classList.toggle("hidden-indicator",!n);var i=a.wrapper.querySelector(".panel-hide-btn");i&&(i.innerHTML=n?"ðŸ‘":'<span style="text-decoration:line-through">ðŸ‘</span>',i.title=n?"Hide":"Show")}}}),t.render(),this.updateIndicatorLegend(),t.indicatorManager.saveIndicators(),this.autoSaveTemplate();var i=document.querySelector(".hide-indicators-option span");i&&(i.textContent=n?"Hide All Indicators":"Show All Indicators")}}},{key:"toggleHighLow",value:function(){this.engine.showHighLow=!this.engine.showHighLow,this.engine.render();var e=JSON.parse(localStorage.getItem("fcsapi_chart_settings"))||{};if(e.comprehensiveSettings||(e.comprehensiveSettings={}),e.comprehensiveSettings.showHighLow=this.engine.showHighLow,this.engine.saveToCache("fcsapi_chart_settings",JSON.stringify(e)),this.comprehensiveSettingsDialog){var t=this.comprehensiveSettingsDialog.querySelector("#show-high-low");t&&(t.checked=this.engine.showHighLow)}}},{key:"toggleOHLCBar",value:function(){this.engine.showOHLCBar=!1===this.engine.showOHLCBar,this.engine.infoOverlay&&this.engine.infoOverlay.update();var e=JSON.parse(localStorage.getItem("fcsapi_chart_settings"))||{};if(e.comprehensiveSettings||(e.comprehensiveSettings={}),e.comprehensiveSettings.showOHLCBar=this.engine.showOHLCBar,this.engine.saveToCache("fcsapi_chart_settings",JSON.stringify(e)),this.comprehensiveSettingsDialog){var t=this.comprehensiveSettingsDialog.querySelector("#show-ohlc-bar");t&&(t.checked=this.engine.showOHLCBar)}}},{key:"loadChartSettings",value:(S=k(w().m(function e(){var t,a,n,i,o,r,s,l,c,d=this;return w().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,this.loadTemplates(),this.engine.isParentChart()||!this.engine.container.classList.contains("multi-chart-instance")){e.n=2;break}if(null==(a=null===(t=window.chartInstance)||void 0===t?void 0:t.uiManager)?void 0:a._isRestoringLayout){e.n=1;break}return e.a(2,null);case 1:case 2:if("Default"!==this.currentTemplate){e.n=3;break}return e.a(2,null);case 3:if(n=null,(i=localStorage.getItem("fcsapi_chart_settings"))&&(n=JSON.parse(i),["candles","bars","hollow-candles","heikin-ashi","high-low","line","area"].forEach(function(e){var t="".concat(e,"_colors");n[t]&&d.engine.themeManager.setChartTypeColors(e,n[t])}),n.comprehensiveSettings&&(o=n.comprehensiveSettings,r=this.engine.themeManager.getCurrentTheme(),o.backgroundColor&&(r.background=o.backgroundColor),o.gridColor&&(r.gridColor=o.gridColor),o.textColor&&(r.textColor=o.textColor),o.crosshairColor&&(r.crosshairColor=o.crosshairColor),o.chartColors&&(s=this.engine.chartType,l=this.engine.themeManager.getChartTypeColors(s),"line"===s||"area"===s?o.chartColors.lineColor&&(l.upColor=o.chartColors.lineColor,l.downColor=o.chartColors.lineColor,r.upColor=o.chartColors.lineColor,r.downColor=o.chartColors.lineColor):"hollow-candles"===s?(o.chartColors.upColor&&(l.upColor=o.chartColors.upColor,r.upColor=o.chartColors.upColor),o.chartColors.downColor&&(l.downColor=o.chartColors.downColor,r.downColor=o.chartColors.downColor),o.chartColors.hollowFill&&(l.hollowFill=o.chartColors.hollowFill)):(o.chartColors.upColor&&(l.upColor=o.chartColors.upColor,r.upColor=o.chartColors.upColor),o.chartColors.downColor&&(l.downColor=o.chartColors.downColor,r.downColor=o.chartColors.downColor)),this.engine.themeManager.setChartTypeColors(s,l)),void 0!==o.candleWidth&&(this.engine.candleWidth=o.candleWidth),void 0!==o.candleSpacing&&(this.engine.candleSpacing=o.candleSpacing),void 0!==o.futureOffset&&(this.engine.scrollOffset=-o.futureOffset),this.engine.showGrid=void 0!==o.showGrid?o.showGrid:this.engine.constructor.DEFAULT_SETTINGS.showGrid,this.engine.showCrosshair=void 0!==o.showCrosshair?o.showCrosshair:this.engine.constructor.DEFAULT_SETTINGS.showCrosshair,this.engine.showCrosshairLabels=void 0!==o.showCrosshairLabels?o.showCrosshairLabels:this.engine.constructor.DEFAULT_SETTINGS.showCrosshairLabels,this.engine.showPriceLine=void 0!==o.showPriceLine?o.showPriceLine:this.engine.constructor.DEFAULT_SETTINGS.showPriceLine,this.engine.showHighLow=void 0!==o.showHighLow?o.showHighLow:this.engine.constructor.DEFAULT_SETTINGS.showHighLow,this.engine.showAskPriceLabel=void 0!==o.showAskPriceLabel?o.showAskPriceLabel:void 0!==o.showAskPrice?o.showAskPrice:this.engine.constructor.DEFAULT_SETTINGS.showAskPriceLabel,this.engine.showBidPriceLabel=void 0!==o.showBidPriceLabel?o.showBidPriceLabel:void 0!==o.showBidPrice?o.showBidPrice:this.engine.constructor.DEFAULT_SETTINGS.showBidPriceLabel,this.engine.showAskBidLines=void 0!==o.showAskBidLines?o.showAskBidLines:this.engine.constructor.DEFAULT_SETTINGS.showAskBidLines,this.engine.showIndicatorLabels=void 0!==o.showIndicatorLabels?o.showIndicatorLabels:this.engine.constructor.DEFAULT_SETTINGS.showIndicatorLabels,this.engine.showOHLCBar=void 0!==o.showOHLCBar?o.showOHLCBar:this.engine.constructor.DEFAULT_SETTINGS.showOHLCBar,this.engine.autoScale=void 0!==o.autoScale?o.autoScale:this.engine.constructor.DEFAULT_SETTINGS.autoScale,this.engine.logScale=void 0!==o.logScale?o.logScale:this.engine.constructor.DEFAULT_SETTINGS.logScale,this.engine.askLabelColor=o.askLabelColor||this.engine.constructor.DEFAULT_SETTINGS.askLabelColor,this.engine.bidLabelColor=o.bidLabelColor||this.engine.constructor.DEFAULT_SETTINGS.bidLabelColor),n.renkoSettings&&this.engine.setRenkoSettings(n.renkoSettings)),!this.currentTemplate||"Custom"===this.currentTemplate||"Default"===this.currentTemplate){e.n=4;break}if(!this.templates[this.currentTemplate]){e.n=4;break}return c=this.templates[this.currentTemplate],e.n=4,this.applyTemplateSettings(c);case 4:return e.a(2,n);case 5:return e.p=5,e.v,e.a(2,null)}},e,this,[[0,5]])})),function(){return S.apply(this,arguments)})},{key:"applyTemplateSettings",value:(C=k(w().m(function e(t){var a,n,i,o,r,s,l,c,d,u,h,p,g=this;return w().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.isLoadingTemplate=!0,a=this.engine.themeManager.getCurrentTheme(),"backgroundColor"in t&&(null!==t.backgroundColor?this.engine.themeManager.setUserBackgroundColor(t.backgroundColor):this.engine.themeManager.clearUserBackgroundColor(),a.background=t.backgroundColor),"gridColor"in t&&(a.gridColor=t.gridColor||this.engine.themeManager.getDefaultTheme().gridColor),"textColor"in t&&(a.textColor=t.textColor||this.engine.themeManager.getDefaultTheme().textColor),"crosshairColor"in t&&(a.crosshairColor=t.crosshairColor||this.engine.themeManager.getDefaultTheme().crosshairColor),n=function(e,t){if(!e)return null;if(e.startsWith("rgba"))return e.replace(/,\s*[\d.]+\)$/,", ".concat(t,")"));if(e.startsWith("rgb"))return e.replace("rgb","rgba").replace(")",", ".concat(t,")"));if(e.startsWith("#")){var a=parseInt(e.substr(1,2),16),n=parseInt(e.substr(3,2),16),i=parseInt(e.substr(5,2),16);return"rgba(".concat(a,", ").concat(n,", ").concat(i,", ").concat(t,")")}return e},i=function(e){if(!e)return!1;var t,a,n;if(e.startsWith("rgba")||e.startsWith("rgb")){var i=e.match(/(\d+),\s*(\d+),\s*(\d+)/);i&&(t=parseInt(i[1]),a=parseInt(i[2]),n=parseInt(i[3]))}else e.startsWith("#")&&(t=parseInt(e.substr(1,2),16),a=parseInt(e.substr(3,2),16),n=parseInt(e.substr(5,2),16));return void 0!==t&&(299*t+587*a+114*n)/1e3>128},t.backgroundColor?(o=n(t.backgroundColor,.5),r=i(t.backgroundColor)?"#0F172A":"#f1f1f1",this.overlayBgColor=o,this.overlayTextColor=r,this.engine.themeManager.setOverlayColors(o,r)):"backgroundColor"in t&&null===t.backgroundColor&&(this.overlayBgColor=null,this.overlayTextColor=null,this.engine.themeManager.clearOverlayColors()),"candlestick"===(s=t.chartType)&&(s="candles"),s&&s!==this.engine.chartType&&(this.engine.setChartType(s),this.updateChartTypeButton(s)),t.chartColors&&(l=s||this.engine.chartType,c=this.engine.themeManager.getChartTypeColors(l),t.chartColors.upColor&&(c.upColor=t.chartColors.upColor,a.upColor=t.chartColors.upColor),t.chartColors.downColor&&(c.downColor=t.chartColors.downColor,a.downColor=t.chartColors.downColor),t.chartColors.hollowFill&&(c.hollowFill=t.chartColors.hollowFill),this.engine.themeManager.setChartTypeColors(l,c)),void 0!==t.candleWidth&&(this.engine.candleWidth=t.candleWidth),void 0!==t.candleSpacing&&(this.engine.candleSpacing=t.candleSpacing),void 0!==t.futureOffset&&(this.engine.scrollOffset=-t.futureOffset),this.engine.showGrid=void 0!==t.showGrid?t.showGrid:this.engine.constructor.DEFAULT_SETTINGS.showGrid,this.engine.showCrosshair=void 0!==t.showCrosshair?t.showCrosshair:this.engine.constructor.DEFAULT_SETTINGS.showCrosshair,this.engine.showPriceLine=void 0!==t.showPriceLine?t.showPriceLine:this.engine.constructor.DEFAULT_SETTINGS.showPriceLine,this.engine.showHighLow=void 0!==t.showHighLow?t.showHighLow:this.engine.constructor.DEFAULT_SETTINGS.showHighLow,this.engine.showOHLCBar=void 0!==t.showOHLCBar?t.showOHLCBar:this.engine.constructor.DEFAULT_SETTINGS.showOHLCBar,this.engine.autoScale=void 0!==t.autoScale?t.autoScale:this.engine.constructor.DEFAULT_SETTINGS.autoScale,this.engine.logScale=void 0!==t.logScale?t.logScale:this.engine.constructor.DEFAULT_SETTINGS.logScale,!t.indicators||!this.engine.indicatorManager){e.n=8;break}this.engine.indicatorManager.getAllIndicators().forEach(function(e){g.engine.indicatorManager.remove(e.id,!0)}),d=v(t.indicators),e.p=1,d.s();case 2:if((u=d.n()).done){e.n=4;break}return h=u.value,e.n=3,this.engine.indicatorManager.add(h,!0);case 3:e.n=2;break;case 4:e.n=6;break;case 5:e.p=5,p=e.v,d.e(p);case 6:return e.p=6,d.f(),e.f(6);case 7:this.engine.indicatorManager.saveIndicators();case 8:this.engine.calculateVisibleRange(),this.engine.render(),this.isLoadingTemplate=!1;case 9:return e.a(2)}},e,this,[[1,5,6,7]])})),function(e){return C.apply(this,arguments)})},{key:"loadFavoriteIndicators",value:function(){try{var t=localStorage.getItem("fcsapi_favorite_indicators");this.favoriteIndicators=t?JSON.parse(t):[]}catch(e){this.favoriteIndicators=[]}}},{key:"saveFavoriteIndicators",value:function(){try{this.engine.saveToCache("fcsapi_favorite_indicators",JSON.stringify(this.favoriteIndicators))}catch(e){}}},{key:"getChartIndex",value:function(){var e,t;if(null!==(e=this.engine.container)&&void 0!==e&&null!==(e=e.dataset)&&void 0!==e&&e.chartIndex)return this.engine.container.dataset.chartIndex;var a=((null===(t=this.engine.container)||void 0===t?void 0:t.id)||"").match(/chart(\d+)/i);return a?a[1]:"1"}},{key:"loadTemplates",value:function(){try{var t=localStorage.getItem("fcsapi_chart_templates");this.templates=t?JSON.parse(t):{},this.addBuiltInTemplates();var a=this.getChartIndex(),n="fcsapi_current_template_chart".concat(a),i=localStorage.getItem(n);this.currentTemplate=i&&"Custom"!==i?i:"Default"}catch(e){this.templates={},this.addBuiltInTemplates(),this.currentTemplate="Default"}}},{key:"addBuiltInTemplates",value:function(){var e=this;this.builtInTemplateNames=["Default","Scalper","Day Trader","Swing Trader","Trend Follower","Technical Analyst"];var t={Scalper:{backgroundColor:null,gridColor:null,textColor:null,crosshairColor:null,chartType:"candles",chartColors:{upColor:"#00e676",downColor:"#ff1744"},candleWidth:6,candleSpacing:2,futureOffset:5,showGrid:!1,showCrosshair:!0,showPriceLine:!0,showHighLow:!0,autoScale:!0,logScale:!1,indicators:[{type:"Ema",period:9,color:"#ffeb3b"},{type:"Ema",period:21,color:"#2196f3"},{type:"Rsi",period:14},{type:"Volume"}]},"Day Trader":{backgroundColor:null,gridColor:null,textColor:null,crosshairColor:null,chartType:"candles",chartColors:{upColor:"#26a69a",downColor:"#ef5350"},candleWidth:8,candleSpacing:2,futureOffset:10,showGrid:!0,showCrosshair:!0,showPriceLine:!0,showHighLow:!0,autoScale:!0,logScale:!1,indicators:[{type:"Ema",period:9,color:"#ffeb3b"},{type:"Ema",period:21,color:"#2196f3"},{type:"Ema",period:55,color:"#9c27b0"},{type:"Vwap",color:"#ff9800"},{type:"Macd"},{type:"Volume"}]},"Swing Trader":{backgroundColor:null,gridColor:null,textColor:null,crosshairColor:null,chartType:"candles",chartColors:{upColor:"#4db6ac",downColor:"#ff8a65"},candleWidth:10,candleSpacing:3,futureOffset:15,showGrid:!0,showCrosshair:!0,showPriceLine:!0,showHighLow:!0,autoScale:!0,logScale:!1,indicators:[{type:"Sma",period:50,color:"#2196f3"},{type:"Sma",period:200,color:"#f44336"},{type:"Bb",period:20,stdDev:2},{type:"Macd"},{type:"Rsi",period:14}]},"Trend Follower":{backgroundColor:null,gridColor:null,textColor:null,crosshairColor:null,chartType:"candles",chartColors:{upColor:"#00e676",downColor:"#ff1744"},candleWidth:9,candleSpacing:2,futureOffset:10,showGrid:!1,showCrosshair:!0,showPriceLine:!0,showHighLow:!0,autoScale:!0,logScale:!1,indicators:[{type:"Ema",period:20,color:"#ffeb3b"},{type:"Supertrend",period:10,multiplier:3},{type:"Adx",period:14},{type:"Volume"}]},"Technical Analyst":{backgroundColor:null,gridColor:null,textColor:null,crosshairColor:null,chartType:"candles",chartColors:{upColor:"#089981",downColor:"#f23645"},candleWidth:8,candleSpacing:2,futureOffset:20,showGrid:!0,showCrosshair:!0,showPriceLine:!0,showHighLow:!0,autoScale:!0,logScale:!1,indicators:[{type:"Sma",period:20,color:"#2196f3"},{type:"Sma",period:50,color:"#ff9800"},{type:"Sma",period:200,color:"#f44336"},{type:"Bb",period:20,stdDev:2},{type:"Rsi",period:14},{type:"Macd"},{type:"Stochastic"},{type:"Volume"}]}};Object.keys(t).forEach(function(a){e.templates[a]||(e.templates[a]=t[a])})}},{key:"saveTemplates",value:function(){try{this.engine.saveToCache("fcsapi_chart_templates",JSON.stringify(this.templates));var t=this.getChartIndex(),a="fcsapi_current_template_chart".concat(t);"Custom"!==this.currentTemplate&&this.engine.saveToCache(a,this.currentTemplate)}catch(e){}}},{key:"getCurrentSettings",value:function(){var e=this,t=this.engine.themeManager.getCurrentTheme(),a=this.engine.chartType,n=this.engine.themeManager.getChartTypeColors(a),i=[];return this.engine.indicatorManager&&this.engine.indicatorManager.getAllIndicators().forEach(function(t){var a={type:t.config.type};!1===t.visible&&(a.visible=!1);var n=e.engine.indicatorManager.loadedIndicators[t.config.type];if(n&&"function"==typeof n.getSettingsConfig){var o=n.getSettingsConfig();o.inputs&&o.inputs.forEach(function(e){void 0!==t[e.key]&&(a[e.key]=t[e.key])}),o.style&&o.style.forEach(function(e){void 0!==t[e.key]&&(a[e.key]=t[e.key])})}i.push(a)}),{backgroundColor:t.background,gridColor:t.gridColor,textColor:t.textColor,crosshairColor:t.crosshairColor,chartType:a,chartColors:{upColor:n.upColor,downColor:n.downColor,hollowFill:n.hollowFill},candleWidth:this.engine.candleWidth,candleSpacing:this.engine.candleSpacing,futureOffset:Math.abs(this.engine.scrollOffset),showGrid:this.engine.showGrid,showCrosshair:this.engine.showCrosshair,showPriceLine:this.engine.showPriceLine,showHighLow:this.engine.showHighLow,showOHLCBar:this.engine.showOHLCBar,autoScale:this.engine.autoScale,logScale:this.engine.logScale,indicators:i}}},{key:"handleTemplateSave",value:function(){"Default"===this.currentTemplate||"Custom"===this.currentTemplate?this.showSaveTemplateDialog():this.saveNewTemplate(this.currentTemplate)}},{key:"showSaveTemplateDialog",value:function(){var e=this;this.showCustomPrompt("Enter template name:","",function(t){t&&(e.templates[t]?e.showCustomConfirm('Template "'.concat(t,'" already exists. Overwrite?'),function(){e.saveNewTemplate(t)}):e.saveNewTemplate(t))})}},{key:"loadTemplate",value:(y=k(w().m(function e(t){var a;return w().w(function(e){for(;;)switch(e.n){case 0:if("Default"!==t){e.n=2;break}return e.n=1,this.loadDefaultTemplate();case 1:e.n=3;break;case 2:if(!this.templates[t]){e.n=3;break}return a=this.templates[t],e.n=3,this.applyTemplateSettings(a);case 3:this.currentTemplate=t,this.hasUnsavedChanges=!1,this.updateTemplateButton(),this.saveTemplates();case 4:return e.a(2)}},e,this)})),function(e){return y.apply(this,arguments)})},{key:"updateTemplateButton",value:function(){this.templateNameBtn&&(this.hasUnsavedChanges?(this.templateNameBtn.innerHTML='\n          <span class="template-label">'.concat(this.currentTemplate,'</span>\n          <span class="template-save-text">Save</span>\n        '),this.templateNameBtn.classList.add("has-changes"),this.templateNameBtn.setAttribute("data-tooltip-title","Layout will be saved with all changes (Ctrl + S)")):(this.templateNameBtn.innerHTML='<span class="template-label">'.concat(this.currentTemplate,"</span>"),this.templateNameBtn.classList.remove("has-changes"),this.templateNameBtn.setAttribute("data-tooltip-title","All changes saved"))),this.templateDropdown&&this.updateTemplateDropdownMenu(this.templateDropdown)}},{key:"syncTemplateButtonToAllCharts",value:function(){}},{key:"loadDefaultTemplate",value:(b=k(w().m(function e(){var t;return w().w(function(e){for(;;)switch(e.n){case 0:return this.engine.themeManager.clearAllUserColors(),t={backgroundColor:null,gridColor:null,textColor:null,crosshairColor:null,chartType:"candles",chartColors:{upColor:"#26a69a",downColor:"#ef5350"},candleWidth:this.engine.constructor.DEFAULT_SETTINGS.candleWidth,candleSpacing:this.engine.constructor.DEFAULT_SETTINGS.candleSpacing,futureOffset:this.engine.constructor.DEFAULT_SETTINGS.futureOffset,showGrid:this.engine.constructor.DEFAULT_SETTINGS.showGrid,showCrosshair:this.engine.constructor.DEFAULT_SETTINGS.showCrosshair,showPriceLine:this.engine.constructor.DEFAULT_SETTINGS.showPriceLine,showHighLow:this.engine.constructor.DEFAULT_SETTINGS.showHighLow,autoScale:this.engine.constructor.DEFAULT_SETTINGS.autoScale,logScale:this.engine.constructor.DEFAULT_SETTINGS.logScale,indicators:[]},e.n=1,this.applyTemplateSettings(t);case 1:return e.a(2)}},e,this)})),function(){return b.apply(this,arguments)})},{key:"updateChartTypeButton",value:function(e){var t={candles:"Candlestick",bars:"Bars",line:"Line",area:"Area","hollow-candles":"Hollow Candles","heikin-ashi":"Heikin Ashi","high-low":"High-Low","volume-candles":"Volume Candles"}[e]||"Candlestick",a=document.querySelector(".chart-type-label");a&&(a.textContent=t)}},{key:"autoSaveTemplate",value:function(){this.isLoadingTemplate||(this.currentTemplate&&"Default"!==this.currentTemplate&&this.templates[this.currentTemplate]?(this.templates[this.currentTemplate]=this.getCurrentSettings(),this.saveTemplates(),this.hasUnsavedChanges=!1,this.updateTemplateButton()):this.markTemplateUnsaved())}},{key:"compressForURL",value:function(t){try{(new TextEncoder).encode(t);var a=t.replace(/\s+/g,"").replace(/"([^"]+)":/g,function(e,t){return'"'.concat({backgroundColor:"bg",gridColor:"gc",textColor:"tc",crosshairColor:"cc",axisBackground:"ab",indicatorPanelBgColor:"ipb",chartType:"ct",chartColors:"cls",upColor:"uc",downColor:"dc",candleWidth:"cw",candleSpacing:"cs",futureOffset:"fo",showGrid:"sg",showCrosshair:"sc",showPriceLine:"sp",showHighLow:"sh",showOHLCBar:"so",autoScale:"as",logScale:"ls",indicators:"ind",settings:"set",version:"v",createdAt:"ca"}[t]||t,'":')});return btoa(encodeURIComponent(a))}catch(e){return null}}},{key:"decompressFromURL",value:function(t){try{return decodeURIComponent(atob(t)).replace(/"([^"]+)":/g,function(e,t){return'"'.concat({bg:"backgroundColor",gc:"gridColor",tc:"textColor",cc:"crosshairColor",ab:"axisBackground",ipb:"indicatorPanelBgColor",ct:"chartType",cls:"chartColors",uc:"upColor",dc:"downColor",cw:"candleWidth",cs:"candleSpacing",fo:"futureOffset",sg:"showGrid",sc:"showCrosshair",sp:"showPriceLine",sh:"showHighLow",so:"showOHLCBar",as:"autoScale",ls:"logScale",ind:"indicators",set:"settings",v:"version",ca:"createdAt"}[t]||t,'":')})}catch(e){return null}}},{key:"copyShareLink",value:(p=k(w().m(function e(){var t,a,n,i,o,r,s,l,c,d,u,h,p;return w().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,i=(null===(t=this.engine.options)||void 0===t?void 0:t.symbol)||this.engine.currentSymbol||"",o=(null===(a=this.engine.options)||void 0===a?void 0:a.period)||this.engine.currentPeriod||"",r=this.getCurrentSettings()){e.n=1;break}return null===(s=this.showCustomAlert)||void 0===s||s.call(this,"No template settings to share"),e.a(2);case 1:if(l={s:i,p:o,t:r},c=this.compressForURL(JSON.stringify(l))){e.n=2;break}return null===(d=this.showCustomAlert)||void 0===d||d.call(this,"Failed to create share link"),e.a(2);case 2:return(u=new URL(window.location.href)).searchParams.delete("symbol"),u.searchParams.delete("period"),u.searchParams.set("share",c),h=u.toString(),e.n=3,navigator.clipboard.writeText(h);case 3:null===(n=this.showCustomAlert)||void 0===n||n.call(this,"Share link copied to clipboard!","success"),e.n=5;break;case 4:e.p=4,e.v,null===(p=this.showCustomAlert)||void 0===p||p.call(this,"Failed to copy share link");case 5:return e.a(2)}},e,this,[[0,4]])})),function(){return p.apply(this,arguments)})},{key:"loadSharedTemplate",value:(h=k(w().m(function e(){var t,a,n,i,o,r,s,l;return w().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t=new URLSearchParams(window.location.search),a=t.get("share")){e.n=1;break}return e.a(2,!1);case 1:if(n=this.decompressFromURL(a)){e.n=2;break}return e.a(2,!1);case 2:if(i=JSON.parse(n),o=i.s,r=i.p,s=i.t,!o||!this.engine.chartInstance){e.n=4;break}return e.n=3,this.engine.chartInstance.setSymbol(o);case 3:if(!r){e.n=4;break}return e.n=4,this.engine.chartInstance.setPeriod(r);case 4:return this.showSaveSharedTemplateDialog(s),(l=new URL(window.location.href)).searchParams.delete("share"),o&&l.searchParams.set("symbol",o),r&&l.searchParams.set("period",r),window.history.replaceState({},"",l.toString()),e.a(2,!0);case 5:return e.p=5,e.v,e.a(2,!1)}},e,this,[[0,5]])})),function(){return h.apply(this,arguments)})},{key:"showSaveSharedTemplateDialog",value:function(e){var t=this,a=document.getElementById("chartSaveTemplateModal");if(a){var n=a.querySelector(".template-name-input"),i=a.querySelector(".template-save-confirm-btn");n&&(n.value="Shared Layout",n.placeholder="Enter name for shared layout"),this._pendingSharedTemplate=e;var o=null==i?void 0:i.onclick;if(i&&(i.onclick=function(){var r,s,l,c=(null==n||null===(r=n.value)||void 0===r?void 0:r.trim())||"Shared Layout";if(t.templates[c]?(t.applyTemplateSettings(e),null===(s=t.showCustomAlert)||void 0===s||s.call(t,'Using existing "'.concat(c,'" template. Shared settings applied to current view.'))):(t.templates[c]=e,t.currentTemplate=c,t.hasUnsavedChanges=!1,t.saveTemplates(),t.applyTemplateSettings(e),t.updateTemplateButton(),null===(l=t.showCustomAlert)||void 0===l||l.call(t,'Shared layout saved as "'.concat(c,'"'))),window.CustomModal){var d=window.CustomModal.getOrCreateInstance(a);null==d||d.hide()}i.onclick=o,t._pendingSharedTemplate=null}),window.CustomModal){var r=window.CustomModal.getOrCreateInstance(a);null==r||r.show(),null==n||n.focus(),null==n||n.select()}}else this.applyTemplateSettings(e)}},{key:"switchToCustomTemplate",value:function(){"Custom"!==this.currentTemplate&&"Default"!==this.currentTemplate?this.markTemplateUnsaved():"Default"===this.currentTemplate?(this.currentTemplate="Custom",this.hasUnsavedChanges=!0,this.updateTemplateButton()):"Custom"===this.currentTemplate&&this.markTemplateUnsaved()}},{key:"confirmFactoryReset",value:function(){var e=this;this.showCustomConfirm("âš ï¸ Factory Reset\n\nThis will:\nâ€¢ Clear all drawings and markers\nâ€¢ Reset all colors to default\nâ€¢ Reset zoom and chart settings\nâ€¢ Clear all saved data\n\nThis action cannot be undone!",function(){e.performFactoryReset()})}},{key:"performFactoryReset",value:function(){try{localStorage.clear();var t=window.location.origin+window.location.pathname;return void(window.location.href=t)}catch(e){this.isLoadingTemplate=!1,this.showCustomAlert("âŒ Factory Reset Failed\n\nPlease refresh the page and try again.")}}},{key:"initializeTooltipSystem",value:function(){(0,d.P)()}},{key:"destroy",value:function(){}}],t&&T(e.prototype,t),a&&T(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,a,h,p,b,y,C,S,M,E,A,I}()}}]);