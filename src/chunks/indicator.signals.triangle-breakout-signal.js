"use strict";(self.webpackChunkfcsapi_chart=self.webpackChunkfcsapi_chart||[]).push([["indicator.signals.triangle-breakout-signal"],{6806:(e,t,r)=>{function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function o(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function a(e,t,r){return t=s(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,l()?Reflect.construct(t,r||[],s(e).constructor):t.apply(e,r))}function l(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(l=function(){return!!e})()}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}r.r(t),r.d(t,{default:()=>c});const c=function(e){function t(e,r,i){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=a(this,t,[e,r,i])).title="Triangle Breakout",n.shorttitle="Triangle",n.precision=2,n.minTriangleBars=void 0!==r.minTriangleBars?r.minTriangleBars:15,n.convergenceTolerance=void 0!==r.convergenceTolerance?r.convergenceTolerance:30,n.breakoutConfirm=void 0!==r.breakoutConfirm?r.breakoutConfirm:.5,n.minVolumeIncrease=void 0!==r.minVolumeIncrease?r.minVolumeIncrease:30,n.showLabels=void 0===r.showLabels||r.showLabels,n.bullishColor=r.bullishColor||"#00E676",n.bearishColor=r.bearishColor||"#FF1744",n.panelType="main",n.plots=[{dataKey:"signals",colorKey:"bullishColor",title:"Triangle Breakout"}],n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(t,e),r=t,o=[{key:"getSettingsConfig",value:function(){return{inputs:[{key:"minTriangleBars",label:"Min Triangle Bars",type:"number",default:15,min:10,max:30,step:5},{key:"convergenceTolerance",label:"Convergence Tolerance %",type:"number",default:30,min:20,max:50,step:5},{key:"breakoutConfirm",label:"Breakout Confirm %",type:"number",default:.5,min:.2,max:1.5,step:.1},{key:"minVolumeIncrease",label:"Min Volume Increase %",type:"number",default:30,min:10,max:100,step:10},{key:"showLabels",label:"Show Labels",type:"checkbox",default:!0}],style:[{key:"bullishColor",label:"Bullish Breakout",type:"color",default:"#00E676"},{key:"bearishColor",label:"Bearish Breakout",type:"color",default:"#FF1744"}]}}}],(i=[{key:"calculate",value:function(){for(var e=this.engine.data,t=e.map(function(){return null}),r=this.minTriangleBars+5;r<e.length;r++){var i=e.slice(r-this.minTriangleBars,r),n=this.findSwingPoints(i,!0,r-this.minTriangleBars),o=this.findSwingPoints(i,!1,r-this.minTriangleBars);if(!(n.length<2||o.length<2)){var a=this.calculateTrendline(n),l=this.calculateTrendline(o);if(this.isConverging(a,l,this.minTriangleBars)){var s=a.slope*(r-a.startIdx)+a.startPrice,u=l.slope*(r-l.startIdx)+l.startPrice,c=e[r],h=this.calculateAverageVolume(e,r-1,10),f=(c.volume-h)/h*100,b=c.close>s*(1+this.breakoutConfirm/100),g=c.close<u*(1-this.breakoutConfirm/100);b&&f>=this.minVolumeIncrease&&!t[r]?t[r]={type:"bullish",price:c.low,triangleLength:this.minTriangleBars,volumeIncrease:f}:g&&f>=this.minVolumeIncrease&&!t[r]&&(t[r]={type:"bearish",price:c.high,triangleLength:this.minTriangleBars,volumeIncrease:f})}}}this.data={signals:t}}},{key:"findSwingPoints",value:function(e,t,r){for(var i=[],n=3;n<e.length-3;n++){for(var o=!0,a=1;a<=3;a++)if(t){if(e[n-a].high>=e[n].high||e[n+a].high>=e[n].high){o=!1;break}}else if(e[n-a].low<=e[n].low||e[n+a].low<=e[n].low){o=!1;break}o&&i.push({index:r+n,price:t?e[n].high:e[n].low})}return i}},{key:"calculateTrendline",value:function(e){if(e.length<2)return null;var t=e[0],r=e[e.length-1];return{slope:(r.price-t.price)/(r.index-t.index),startIdx:t.index,startPrice:t.price}}},{key:"isConverging",value:function(e,t,r){if(!e||!t)return!1;var i=e.slope*r+e.startPrice,n=t.slope*r+t.startPrice,o=Math.abs(e.startPrice-t.startPrice);return Math.abs(i-n)/o*100<this.convergenceTolerance}},{key:"calculateAverageVolume",value:function(e,t,r){for(var i=0,n=0,o=Math.max(0,t-r+1);o<=t;o++)i+=e[o].volume||1,n++;return n>0?i/n:1}},{key:"render",value:function(e,t){if(this.visible&&this.data){var r=e.ctx,i=e.getDpr(),n=this.engine,o=n.data;if(this.data.signals&&this.data.signals.length===o.length||(this.calculate(),this.data&&this.data.signals)){r.save(),r.scale(i,i);for(var a=n.visibleRange,l=a.start;l<a.end;l++)if(!(l<0||l>=this.data.signals.length)){var s=this.data.signals[l];if(s){var u=n.indexToX(l)+n.candleWidth/2,c=n.priceToY(s.price);"bullish"===s.type?(this.drawBullishBreakout(r,u,c),this.showLabels&&this.drawLabel(r,u,c,"TRI↑",this.bullishColor)):"bearish"===s.type&&(this.drawBearishBreakout(r,u,c),this.showLabels&&this.drawLabel(r,u,c,"TRI↓",this.bearishColor))}}r.restore()}}}},{key:"drawBullishBreakout",value:function(e,t,r){var i=20;e.strokeStyle=this.bullishColor,e.fillStyle=this.bullishColor,e.lineWidth=2,e.beginPath(),e.moveTo(t-12,r+i-2),e.lineTo(t+2,r+i+4),e.stroke(),e.beginPath(),e.moveTo(t-12,r+i+10),e.lineTo(t+2,r+i+4),e.stroke(),e.beginPath(),e.moveTo(t+4,r+i+4),e.lineTo(t+12,r+i-4),e.stroke(),e.beginPath(),e.moveTo(t+12,r+i-8),e.lineTo(t+9,r+i-5),e.lineTo(t+15,r+i-5),e.closePath(),e.fill()}},{key:"drawBearishBreakout",value:function(e,t,r){var i=20;e.strokeStyle=this.bearishColor,e.fillStyle=this.bearishColor,e.lineWidth=2,e.beginPath(),e.moveTo(t-12,r-i+2),e.lineTo(t+2,r-i-4),e.stroke(),e.beginPath(),e.moveTo(t-12,r-i-10),e.lineTo(t+2,r-i-4),e.stroke(),e.beginPath(),e.moveTo(t+4,r-i-4),e.lineTo(t+12,r-i+4),e.stroke(),e.beginPath(),e.moveTo(t+12,r-i+8),e.lineTo(t+9,r-i+5),e.lineTo(t+15,r-i+5),e.closePath(),e.fill()}},{key:"drawLabel",value:function(e,t,r,i,n){e.font="bold 9px sans-serif",e.fillStyle=n,e.textAlign="center";var o=i.includes("↑")?40:-35;e.fillText(i,t,r+o)}}])&&n(r.prototype,i),o&&n(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i,o}(r(8018).A)}}]);