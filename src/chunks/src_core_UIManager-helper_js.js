"use strict";(self.webpackChunkfcsapi_chart=self.webpackChunkfcsapi_chart||[]).push([["src_core_UIManager-helper_js"],{1224:(e,t,n)=>{n.r(t),n.d(t,{attachUIManagerHelper:()=>Y,default:()=>H});var a=n(6626),o=n(7741),i=n(8098),l=(n(6942),n(548));n(3606);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function s(){var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,a,o,i){var s=a&&a.prototype instanceof r?a:r,d=Object.create(s.prototype);return c(d,"_invoke",function(n,a,o){var i,r,s,c=0,d=o||[],u=!1,g={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,r=0,s=e,g.n=n,l}};function p(n,a){for(r=n,s=a,t=0;!u&&c&&!o&&t<d.length;t++){var o,i=d[t],p=g.p,h=i[2];n>3?(o=h===a)&&(s=i[(r=i[4])?5:(r=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=n<2&&p<i[1])?(r=0,g.v=a,g.n=i[1]):p<h&&(o=n<3||i[0]>a||a>h)&&(i[4]=n,i[5]=a,g.n=h,r=0))}if(o||n>1)return l;throw u=!0,a}return function(o,d,h){if(c>1)throw TypeError("Generator is already running");for(u&&1===d&&p(d,h),r=d,s=h;(t=r<2?e:s)||!u;){i||(r?r<3?(r>1&&(g.n=-1),p(r,s)):g.n=s:g.v=s);try{if(c=2,i){if(r||(o="next"),t=i[o]){if(!(t=t.call(i,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,r<2&&(r=0)}else 1===r&&(t=i.return)&&t.call(i),r<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),r=1);i=e}else if((t=(u=g.n<0)?s:n.call(a,g))!==l)break}catch(t){i=e,r=1,s=t}finally{c=1}}return{value:t,done:u}}}(n,o,i),!0),d}var l={};function r(){}function d(){}function u(){}t=Object.getPrototypeOf;var g=[][a]?t(t([][a]())):(c(t={},a,function(){return this}),t),p=u.prototype=r.prototype=Object.create(g);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,c(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return d.prototype=u,c(p,"constructor",u),c(u,"constructor",d),d.displayName="GeneratorFunction",c(u,o,"GeneratorFunction"),c(p),c(p,o,"Generator"),c(p,a,function(){return this}),c(p,"toString",function(){return"[object Generator]"}),(s=function(){return{w:i,m:h}})()}function c(e,t,n,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}c=function(e,t,n,a){function i(t,n){c(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},c(e,t,n,a)}function d(e,t,n,a,o,i,l){try{var r=e[i](l),s=r.value}catch(e){return void n(e)}r.done?t(s):Promise.resolve(s).then(a,o)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(a,o){var i=e.apply(t,n);function l(e){d(i,a,o,l,r,"next",e)}function r(e){d(i,a,o,l,r,"throw",e)}l(void 0)})}}function g(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,p(a.key),a)}}function p(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}var h="chartIndicatorModal",v=["Rsi","Macd","Bb","Ema","Sma","Stochastic","Atr","Ichimoku","Vwap","SuperTrend","Adx","Obv","MaCrossSignal","RsiSignal","MacdSignal","EngulfingSignal","PinbarSignal","Engulfing","Doji","ShootingStarHammer","MorningEveningStar"],m=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.engine=t,this.allIndicators=[],this.favoriteIndicators=[],this.activeTab="favorites",this.searchQuery=""},t=[{key:"init",value:function(e,t){this.allIndicators=e||[],this.favoriteIndicators=t||[],this.createModal(),this.bindEvents()}},{key:"updateIndicators",value:function(e,t){this.allIndicators=e||[],this.favoriteIndicators=t||[]}},{key:"getActiveUIManager",value:function(){var e=this.engine.multiChartManager;if(e&&e.chartInstances.length>1){var t,n=e.getActiveChart();return null==n||null===(t=n.engine)||void 0===t?void 0:t.uiManager}return this.engine.uiManager}},{key:"getActiveEngine",value:function(){var e=this.engine.multiChartManager;if(e&&e.chartInstances.length>1){var t=e.getActiveChart();return null==t?void 0:t.engine}return this.engine}},{key:"createModal",value:function(){if(!document.getElementById(h)){var e=[{id:"all",label:"All",icon:"all-indicators"},{id:"favorites",label:"Favorites",icon:"star"},{id:"technical",label:"Technical",icon:"technical"},{id:"signals",label:"Signals",icon:"signals"},{id:"pattern",label:"Pattern",customIcon:a.cI.trendingUp},{id:"editors-choice",label:"Editor's Choice",icon:"editors-choice"}].map(function(e){var t=e.customIcon?e.customIcon:'<svg width="100%" height="100%" fill="none" stroke="currentColor"><use href="#'.concat(e.icon,'"></use></svg>');return'\n            <li class="select-option" data-value="'.concat(e.id,'">\n                <span class="select-option-img">\n                    <span class="flag-icon-container">\n                        ').concat(t,"\n                    </span>\n                    ").concat(e.label,"\n                </span>\n            </li>\n        ")}).join("");document.body.insertAdjacentHTML("beforeend",'\n            <div class="modal" id="'.concat(h,'" tabindex="-1" data-custom-modal="true" data-cm-draggable="true">\n                <div class="modal-dialog modal-lg modal-dialog-centered">\n                    <div class="modal-content search-modal-content">\n                        <div class="modal-header cm-modal-header indicator-modal-header" data-cm-drag-handle>\n                            <h5 class="modal-title">Indicators</h5>\n                            <span class="custom-modal-close" data-cm-dismiss="custom-modal">\n                                <svg width="22" height="22" fill="none" stroke="currentColor">\n                                    <use href="#x"></use>\n                                </svg>\n                            </span>\n                        </div>\n                        <div class="modal-header search-modal-header">\n                            <div class="search-input-container">\n                                <svg width="24" height="24" class="search-icon" fill="none" stroke="currentColor">\n                                    <use href="#search"></use>\n                                </svg>\n                                <input type="text" class="form-control search-modal-input"\n                                       placeholder="Search indicators..."\n                                       id="').concat(h,'-input"\n                                       autocomplete="off">\n                                <button type="button" class="search-clear" id="').concat(h,'-clear" style="display: none;">Clear</button>\n                            </div>\n                        </div>\n                        <div class="modal-body">\n                            <div class="indicator-modal-layout">\n                                <div class="indicator-sidebar dropdown-select">\n                                    <ul class="select-options">').concat(e,'</ul>\n                                </div>\n                                <div class="search-results" id="').concat(h,'-results"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '))}}},{key:"bindEvents",value:function(){var e=this,t=document.getElementById(h);if(t&&!t._eventsBound){t._eventsBound=!0;var n=t.querySelector("#".concat(h,"-input")),a=t.querySelector("#".concat(h,"-clear")),o=t.querySelector("#".concat(h,"-results")),i=t.querySelector(".indicator-sidebar");t.addEventListener("shown.cm.modal",function(){t._focusInputOnShow&&(null==n||n.focus(),t._focusInputOnShow=!1);var a=e.getActiveUIManager();a&&(e.favoriteIndicators=a.favoriteIndicators||[]),e.activeTab=e.favoriteIndicators.length>0?"favorites":"technical",e.updateSidebarSelection(i),e.renderResults(o)}),null==n||n.addEventListener("input",function(t){var n=t.target.value.trim();e.searchQuery=n.toLowerCase(),a.style.display=n?"block":"none",e.renderResults(o)}),null==a||a.addEventListener("click",function(){n.value="",n.focus(),e.searchQuery="",a.style.display="none",e.renderResults(o)}),null==i||i.addEventListener("click",function(t){var n=t.target.closest(".select-option");n&&(e.activeTab=n.dataset.value,e.updateSidebarSelection(i),e.renderResults(o))}),null==o||o.addEventListener("click",function(){var t=u(s().m(function t(n){var a,i,l;return s().w(function(t){for(;;)switch(t.n){case 0:if(a=n.target.closest(".search-result-item")){t.n=1;break}return t.a(2);case 1:if((i=e.allIndicators.find(function(e){return e.type===a.dataset.type}))&&!i.disabled){t.n=2;break}return t.a(2);case 2:if(l=e.getActiveUIManager(),!n.target.closest(".indicator-fav-btn")){t.n=3;break}return n.stopPropagation(),null==l||l.toggleFavoriteIndicator(i.type),e.favoriteIndicators=(null==l?void 0:l.favoriteIndicators)||[],e.renderResults(o),t.a(2);case 3:return t.n=4,e.addIndicatorWithDefaults(i,l);case 4:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}())}}},{key:"addIndicatorWithDefaults",value:(o=u(s().m(function e(t){var n,a,o,i,l=arguments;return s().w(function(e){for(;;)switch(e.n){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:null,a=this.getActiveEngine(),o=n||this.getActiveUIManager(),i={type:t.type},e.n=1,a.addIndicator(i);case 1:null==o||o.updateIndicatorLegend(),null==o||o.updateAddedTab();case 2:return e.a(2)}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"updateSidebarSelection",value:function(e){var t=this;null==e||e.querySelectorAll(".select-option").forEach(function(e){e.classList.toggle("selected",e.dataset.value===t.activeTab)})}},{key:"getIndicatorsForTab",value:function(){var e=this,t=[];switch(this.activeTab){case"all":t=this.allIndicators.filter(function(e){return"editorchoice"!==e.category&&"editors-choice"!==e.category});break;case"favorites":t=this.allIndicators.filter(function(t){return e.favoriteIndicators.includes(t.type)});break;case"technical":t=this.allIndicators.filter(function(e){return"technical"===e.category||"technicals"===e.category});break;case"signals":t=this.allIndicators.filter(function(e){return"signals"===e.category});break;case"pattern":t=this.allIndicators.filter(function(e){return"pattern"===e.category||"patterns"===e.category});break;case"editors-choice":t=v.map(function(t){return e.allIndicators.find(function(e){return e.type===t&&"editorchoice"!==e.category&&"editors-choice"!==e.category})||e.allIndicators.find(function(e){return e.type===t})}).filter(function(e){return void 0!==e})}return this.searchQuery&&(t=t.filter(function(t){return(t.label||"").toLowerCase().includes(e.searchQuery)||(t.type||"").toLowerCase().includes(e.searchQuery)})),t}},{key:"getCategoryLabel",value:function(e){return{technical:"Technical",technicals:"Technical",signals:"Signal",pattern:"Pattern",patterns:"Pattern",editorchoice:"Editor's Choice","editors-choice":"Editor's Choice"}[e]||e||""}},{key:"renderResults",value:function(e){var t=this;if(e){var n=this.getIndicatorsForTab();n.length?(e.innerHTML=n.map(function(e){var n=t.favoriteIndicators.includes(e.type),a=t.getCategoryLabel(e.category);return'\n                <div class="search-result-item'.concat(e.disabled?" disabled":"",'" data-type="').concat(e.type,'" ').concat(e.disabled?'style="opacity:0.5;cursor:not-allowed;"':"",'>\n                    <button class="indicator-fav-btn').concat(n?" active":"",'" title="').concat((0,i.Eg)(n?"removeFromFavorites":"indicatorFavorite",!1),'">\n                        <svg width="16" height="16" fill="').concat(n?"currentColor":"none",'" stroke="currentColor"><use href="#star"></use></svg>\n                    </button>\n                    <span class="indicator-label">').concat(e.label,"</span>\n                    ").concat("all"===t.activeTab?'<span class="indicator-category-badge">'.concat(a,"</span>"):"","\n                </div>\n            ")}).join(""),e.scrollTop=0):e.innerHTML='\n                <div class="menu-search-noresult">\n                    <div class="mb-2"><svg width="200" height="200" fill="none" stroke="none"><use href="#magnifier-char"></use></svg></div>\n                    <div class="fw-medium">'.concat("favorites"===this.activeTab?"No favorites yet":"No indicators found",'</div>\n                    <div class="small mt-1">').concat("favorites"===this.activeTab?"Add indicators to favorites using the star icon":"Try different keywords","</div>\n                </div>\n            ")}}}],t&&g(e.prototype,t),n&&g(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o}(),f=n(7001);function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function w(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,y(a.key),a)}}function y(e){var t=function(e,t){if("object"!=b(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=b(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==b(t)?t:t+""}var k="chartSettingsModal",C=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.engine=t,this.activeTab="appearance",this.originalSettings=null,this.eventsBound=!1},t=[{key:"init",value:function(){this.createModal(),this.bindEvents()}},{key:"createModal",value:function(){if(document.getElementById(k))this.eventsBound||this.bindEvents();else{var e=[{id:"appearance",label:"Appearance",icon:"appearance"},{id:"scales",label:"Scales",icon:"sliders"},{id:"visibility",label:"Visibility",icon:"eye"}].map(function(e){return'\n            <li class="select-option'.concat("appearance"===e.id?" selected":"",'" data-value="').concat(e.id,'">\n                <span class="select-option-img">\n                    <span class="flag-icon-container">\n                        <svg width="100%" height="100%" fill="none" stroke="currentColor"><use href="#').concat(e.icon,'"></use></svg>\n                    </span>\n                    ').concat(e.label,"\n                </span>\n            </li>\n        ")}).join("");document.body.insertAdjacentHTML("beforeend",'\n            <div class="modal" id="'.concat(k,'" tabindex="-1" data-custom-modal="true" data-cm-draggable="true">\n                <div class="modal-dialog modal-md modal-dialog-centered">\n                    <div class="modal-content search-modal-content">\n                        <div class="modal-header cm-modal-header indicator-modal-header" data-cm-drag-handle>\n                            <h5 class="modal-title">Chart Settings</h5>\n                            <span class="custom-modal-close" data-cm-dismiss="custom-modal">\n                                <svg width="22" height="22" fill="none" stroke="currentColor">\n                                    <use href="#x"></use>\n                                </svg>\n                            </span>\n                        </div>\n                        <div class="modal-body">\n                            <div class="indicator-modal-layout">\n                                <div class="indicator-sidebar dropdown-select">\n                                    <ul class="select-options">').concat(e,'</ul>\n                                </div>\n                                <div class="search-results" id="').concat(k,'-content">\n                                    ').concat(this.getAppearanceTabHtml(),"\n                                    ").concat(this.getScalesTabHtml(),"\n                                    ").concat(this.getVisibilityTabHtml(),'\n                                </div>\n                            </div>\n                        </div>\n                        <div class="modal-footer chart-settings-footer">\n                            <button class="btn-reset" id="').concat(k,'-reset">Reset to Default</button>\n                            <div class="footer-right">\n                                <button class="btn-apply-changes" id="').concat(k,'-apply">Ok</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            \x3c!-- External Dropdowns for Chart Settings --\x3e\n            <div id="dateFormatDropdown" class="select-dropdown">\n                <ul class="select-options">\n                    <li class="select-option" data-value="DD/MM/YYYY">DD/MM/YYYY</li>\n                    <li class="select-option" data-value="MM/DD/YYYY">MM/DD/YYYY</li>\n                    <li class="select-option" data-value="YYYY/MM/DD">YYYY/MM/DD</li>\n                    <li class="select-option" data-value="YYYY-MM-DD">YYYY-MM-DD</li>\n                    <li class="select-option" data-value="DD-MM-YYYY">DD-MM-YYYY</li>\n                    <li class="select-option" data-value="MM-DD-YYYY">MM-DD-YYYY</li>\n                    <li class="select-option" data-value="DD.MM.YYYY">DD.MM.YYYY</li>\n                    <li class="select-option" data-value="MM.DD.YYYY">MM.DD.YYYY</li>\n                    <li class="select-option selected" data-value="DD MMM YYYY">DD MMM YYYY</li>\n                    <li class="select-option" data-value="MMM DD, YYYY">MMM DD, YYYY</li>\n                    <li class="select-option" data-value="YYYY MMM DD">YYYY MMM DD</li>\n                    <li class="select-option" data-value="DD MMMM YYYY">DD MMMM YYYY</li>\n                    <li class="select-option" data-value="MMMM DD, YYYY">MMMM DD, YYYY</li>\n                </ul>\n            </div>\n\n            <div id="timeFormatDropdown" class="select-dropdown">\n                <ul class="select-options">\n                    <li class="select-option selected" data-value="24">24-hour</li>\n                    <li class="select-option" data-value="12">12-hour</li>\n                </ul>\n            </div>\n        '))}}},{key:"getAppearanceTabHtml",value:function(){return'\n            <div class="chart-settings-tab-content active" data-tab="appearance">\n                <div class="settings-section appearance-section">\n                    <h4>Chart Colors</h4>\n\n                    <div class="settings-field">\n                        <label>Background</label>\n                        <div class="dropdown-select color-trigger-select no-auto-highlight" id="bg-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="backgroundColor" data-opacity-id="bg-opacity">\n                            <div class="select-trigger">\n                                <span class="color-preview"></span>\n                            </div>\n                        </div>\n                        <input type="hidden" id="bg-opacity" value="100">\n                    </div>\n\n                    <div class="settings-field">\n                        <label>Grid</label>\n                        <div class="dropdown-select color-trigger-select no-auto-highlight" id="grid-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="gridColor" data-opacity-id="grid-opacity">\n                            <div class="select-trigger">\n                                <span class="color-preview"></span>\n                            </div>\n                        </div>\n                        <input type="hidden" id="grid-opacity" value="100">\n                    </div>\n\n                    <div class="settings-field">\n                        <label>Text</label>\n                        <div class="dropdown-select color-trigger-select no-auto-highlight" id="text-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="textColor" data-opacity-id="text-opacity">\n                            <div class="select-trigger">\n                                <span class="color-preview"></span>\n                            </div>\n                        </div>\n                        <input type="hidden" id="text-opacity" value="100">\n                    </div>\n\n                    <div class="settings-field">\n                        <label>Crosshair</label>\n                        <div class="dropdown-select color-trigger-select no-auto-highlight" id="crosshair-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="crosshairColor" data-opacity-id="crosshair-opacity">\n                            <div class="select-trigger">\n                                <span class="color-preview"></span>\n                            </div>\n                        </div>\n                        <input type="hidden" id="crosshair-opacity" value="100">\n                    </div>\n                </div>\n\n                <div class="settings-section appearance-section" id="chart-colors-section">\n                    \x3c!-- Chart type colors will be dynamically populated --\x3e\n                </div>\n            </div>\n        '}},{key:"getScalesTabHtml",value:function(){return'\n            <div class="chart-settings-tab-content" data-tab="scales">\n                <div class="settings-section">\n                    <h4>Candle Size</h4>\n\n                    <div class="settings-field">\n                        <label>Candle Width</label>\n                        <div class="slider-field">\n                            <input type="range" id="candle-width" min="2" max="20" value="8" step="1" data-unit="px">\n                            <span class="slider-thumb-tracker" data-tooltip-trigger="click-only" data-tooltip-title="8px" data-tooltip-placement="top"></span>\n                        </div>\n                    </div>\n\n                    <div class="settings-field">\n                        <label>Candle Spacing</label>\n                        <div class="slider-field">\n                            <input type="range" id="candle-spacing" min="0" max="10" value="2" step="1" data-unit="px">\n                            <span class="slider-thumb-tracker" data-tooltip-trigger="click-only" data-tooltip-title="2px" data-tooltip-placement="top"></span>\n                        </div>\n                    </div>\n\n                    <div class="settings-field">\n                        <label>Future Candles Offset</label>\n                        <div class="slider-field">\n                            <input type="range" id="future-offset" min="0" max="50" value="10" step="1" data-unit="">\n                            <span class="slider-thumb-tracker" data-tooltip-trigger="click-only" data-tooltip-title="10" data-tooltip-placement="top"></span>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="settings-section">\n                    <h4>Scale Options</h4>\n\n                    <div class="settings-field checkbox-field">\n                        <label>\n                            <input type="checkbox" id="auto-scale" checked>\n                            <span>Auto Scale Price Axis</span>\n                        </label>\n                    </div>\n\n                    <div class="settings-field checkbox-field">\n                        <label>\n                            <input type="checkbox" id="log-scale">\n                            <span>Logarithmic Scale</span>\n                        </label>\n                    </div>\n                </div>\n\n                <div class="settings-section">\n                    <h4>Price Labels</h4>\n\n                    <div class="settings-field">\n                        <label>Ask Price</label>\n                        <div class="dropdown-select color-trigger-select no-auto-highlight" id="ask-label-color-btn" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="askLabelColor">\n                            <div class="select-trigger">\n                                <span class="color-preview"></span>\n                            </div>\n                        </div>\n                        <input type="hidden" id="ask-label-color" value="#00bcd4">\n                    </div>\n\n                    <div class="settings-field">\n                        <label>Bid Price</label>\n                        <div class="dropdown-select color-trigger-select no-auto-highlight" id="bid-label-color-btn" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="bidLabelColor">\n                            <div class="select-trigger">\n                                <span class="color-preview"></span>\n                            </div>\n                        </div>\n                        <input type="hidden" id="bid-label-color" value="#ff9800">\n                    </div>\n                </div>\n\n                <div class="settings-section">\n                    <h4>Time Scale</h4>\n\n                    <div class="settings-field checkbox-field">\n                        <label>\n                            <input type="checkbox" id="show-day-in-date" checked>\n                            <span>Show Day Name in Date</span>\n                        </label>\n                    </div>\n\n                    <div class="settings-field">\n                        <label>Date Format</label>\n                        <div class="dropdown-select" id="date-format-select" data-dropdown-id="dateFormatDropdown" data-modal-escape="true">\n                            <div class="select-trigger">\n                                <span class="select-trigger-text">DD MMM YYYY</span>\n                                <svg class="select-arrow" width="12" height="12" fill="none" stroke="currentColor"><use href="#chevron-down"></use></svg>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="settings-field">\n                        <label>Time Format</label>\n                        <div class="dropdown-select" id="time-format-select" data-dropdown-id="timeFormatDropdown" data-modal-escape="true">\n                            <div class="select-trigger">\n                                <span class="select-trigger-text">24-hour</span>\n                                <svg class="select-arrow" width="12" height="12" fill="none" stroke="currentColor"><use href="#chevron-down"></use></svg>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '}},{key:"getVisibilityTabHtml",value:function(){return'\n            <div class="chart-settings-tab-content" data-tab="visibility">\n                <div class="settings-section">\n                    <h4>Chart Elements</h4>\n\n                    <div class="settings-field checkbox-field">\n                        <label>\n                            <input type="checkbox" id="show-grid">\n                            <span>Show Grid Lines</span>\n                        </label>\n                    </div>\n\n                    <div class="settings-field checkbox-field">\n                        <label>\n                            <input type="checkbox" id="show-crosshair" checked>\n                            <span>Show Crosshair</span>\n                        </label>\n                    </div>\n\n                    <div class="settings-field checkbox-field">\n                        <label>\n                            <input type="checkbox" id="show-crosshair-labels" checked>\n                            <span>Show Crosshair Labels</span>\n                        </label>\n                    </div>\n\n                    <div class="settings-field checkbox-field">\n                        <label>\n                            <input type="checkbox" id="show-ohlc-bar" checked>\n                            <span>Show OHLC Bar</span>\n                        </label>\n                    </div>\n                </div>\n\n                <div class="settings-section">\n                    <h4>Price Lines</h4>\n\n                    <div class="settings-field checkbox-field">\n                        <label>\n                            <input type="checkbox" id="show-price-line" checked>\n                            <span>Show Last Close Price Line</span>\n                        </label>\n                    </div>\n\n                    <div class="settings-field checkbox-field">\n                        <label>\n                            <input type="checkbox" id="show-high-low" checked>\n                            <span>Show Highest/Lowest Labels</span>\n                        </label>\n                    </div>\n\n                    <div class="settings-field checkbox-field">\n                        <label>\n                            <input type="checkbox" id="show-ask-price-label" checked>\n                            <span>Show Ask Price Label</span>\n                        </label>\n                    </div>\n\n                    <div class="settings-field checkbox-field">\n                        <label>\n                            <input type="checkbox" id="show-bid-price-label" checked>\n                            <span>Show Bid Price Label</span>\n                        </label>\n                    </div>\n\n                    <div class="settings-field checkbox-field">\n                        <label>\n                            <input type="checkbox" id="show-ask-bid-lines">\n                            <span>Show Ask/Bid Lines</span>\n                        </label>\n                    </div>\n                </div>\n\n                <div class="settings-section">\n                    <h4>Indicators</h4>\n\n                    <div class="settings-field checkbox-field">\n                        <label>\n                            <input type="checkbox" id="show-indicator-labels" checked>\n                            <span>Show Indicator Labels</span>\n                        </label>\n                    </div>\n                </div>\n\n                <div class="settings-section">\n                    <h4>UI Elements</h4>\n\n                    <div class="settings-field checkbox-field">\n                        <label>\n                            <input type="checkbox" id="show-left-sidebar" checked>\n                            <span>Show Left Sidebar</span>\n                        </label>\n                    </div>\n                </div>\n            </div>\n        '}},{key:"bindEvents",value:function(){var e,t,n,a=this;if(!this.eventsBound){var o=document.getElementById(k);if(o){this.eventsBound=!0;var i=o.querySelector(".indicator-sidebar"),l=o.querySelector("#".concat(k,"-content"));null==i||i.addEventListener("click",function(e){var t,n=e.target.closest(".select-option");if(n){var o=n.dataset.value;a.activeTab=o,i.querySelectorAll(".select-option").forEach(function(e){return e.classList.remove("selected")}),n.classList.add("selected"),l.querySelectorAll(".chart-settings-tab-content").forEach(function(e){return e.classList.remove("active")}),null===(t=l.querySelector('[data-tab="'.concat(o,'"]')))||void 0===t||t.classList.add("active")}}),o.addEventListener("shown.cm.modal",function(){a.populateSettings(),window.initCustomSelects&&window.initCustomSelects(o)}),null===(e=o.querySelector("#".concat(k,"-cancel")))||void 0===e||e.addEventListener("click",function(){a.cancel()}),null===(t=o.querySelector("#".concat(k,"-apply")))||void 0===t||t.addEventListener("click",function(){a.apply()}),null===(n=o.querySelector("#".concat(k,"-reset")))||void 0===n||n.addEventListener("click",function(){a.resetToDefault()}),this.setupColorTriggers(o),this.setupRangeSliders(o),this.setupCheckboxes(o)}}}},{key:"setupColorTriggers",value:function(e){var t=this,n=e.querySelector(".modal-body");if(n){var a=n.querySelectorAll(".color-trigger-select");a.forEach(function(e){}),a.forEach(function(n){var a=n.querySelector(".color-preview"),o=n.dataset.opacityId,i=o?e.querySelector("#".concat(o)):null,l=n.id,r=null;"ask-label-color-btn"===l?r=e.querySelector("#ask-label-color"):"bid-label-color-btn"===l&&(r=e.querySelector("#bid-label-color")),n._colorPickerCallback=function(e,n){var o=parseInt(e.substr(1,2),16),l=parseInt(e.substr(3,2),16),s=parseInt(e.substr(5,2),16);a.style.backgroundColor="rgba(".concat(o,", ").concat(l,", ").concat(s,", ").concat(n/100,")"),i&&(i.value=n),r&&(r.value=e),t.previewSettings()}})}}},{key:"setupRangeSliders",value:function(e){var t=this;e.querySelectorAll('input[type="range"]').forEach(function(e){var n=e.parentElement.querySelector(".slider-thumb-tracker");t.updateSliderTrackerPosition(e,n),e.addEventListener("input",function(){t.updateSliderTrackerPosition(e,n),t.previewSettings(),n&&f.g.show(n)}),e.addEventListener("change",function(){f.g.hide()})})}},{key:"updateSliderTrackerPosition",value:function(e,t){var n=e.dataset.unit||"",a=e.value,o=parseFloat(e.min)||0,i=(a-o)/((parseFloat(e.max)||100)-o),l=100*i;if(e.style.background="linear-gradient(to right, var(--color-primary) 0%, var(--color-primary) ".concat(l,"%, var(--bg-tertiary) ").concat(l,"%, var(--bg-tertiary) 100%)"),t){var r=8+i*(e.offsetWidth-16);t.style.left="".concat(r,"px"),t.setAttribute("data-tooltip-title","".concat(a).concat(n))}}},{key:"setupCheckboxes",value:function(e){var t=this;e.querySelectorAll('input[type="checkbox"]').forEach(function(e){e.addEventListener("change",function(){t.previewSettings()})})}},{key:"show",value:function(){this.createModal(),this.bindEvents();var e=document.getElementById(k);e&&(this.storeOriginalSettings(),this.populateChartColors(),this.setupColorTriggers(e),this.populateSettings(),window.CustomModal&&window.CustomModal.getOrCreateInstance(e).show())}},{key:"hide",value:function(){var e=document.getElementById(k);e&&window.CustomModal&&window.CustomModal.getOrCreateInstance(e).hide()}},{key:"storeOriginalSettings",value:function(){var e,t,n,a,o,i,l,r,s,c,d,u,g=this.engine.themeManager.getCurrentTheme(),p=this.engine.constructor.DEFAULT_SETTINGS,h="#131722",v="#363a45",m="#d1d4dc",f="#758696";this.originalSettings={backgroundColor:g.background||h,gridColor:g.gridColor||v,textColor:g.textColor||m,crosshairColor:g.crosshairColor||f,candleWidth:this.engine.candleWidth,candleSpacing:this.engine.candleSpacing,futureOffset:Math.abs(this.engine.scrollOffset),showGrid:this.engine.showGrid,showCrosshair:this.engine.showCrosshair,showCrosshairLabels:null!==(e=this.engine.showCrosshairLabels)&&void 0!==e?e:p.showCrosshairLabels,showPriceLine:null!==(t=this.engine.showPriceLine)&&void 0!==t?t:p.showPriceLine,showHighLow:null!==(n=this.engine.showHighLow)&&void 0!==n?n:p.showHighLow,showAskPriceLabel:null!==(a=this.engine.showAskPriceLabel)&&void 0!==a?a:p.showAskPriceLabel,showBidPriceLabel:null!==(o=this.engine.showBidPriceLabel)&&void 0!==o?o:p.showBidPriceLabel,showAskBidLines:null!==(i=this.engine.showAskBidLines)&&void 0!==i?i:p.showAskBidLines,showIndicatorLabels:null!==(l=this.engine.showIndicatorLabels)&&void 0!==l?l:p.showIndicatorLabels,showOHLCBar:null!==(r=this.engine.showOHLCBar)&&void 0!==r?r:p.showOHLCBar,autoScale:null!==(s=this.engine.autoScale)&&void 0!==s?s:p.autoScale,logScale:null!==(c=this.engine.logScale)&&void 0!==c?c:p.logScale,askLabelColor:this.engine.askLabelColor||p.askLabelColor,bidLabelColor:this.engine.bidLabelColor||p.bidLabelColor,showDayInDate:null===(d=this.engine.showDayInDate)||void 0===d||d,dateFormat:this.engine.dateFormat||"DD MMM YYYY",timeFormat:this.engine.timeFormat||"24",showLeftSidebar:null===(u=this.engine.showLeftSidebar)||void 0===u||u}}},{key:"populateSettings",value:function(){var e=document.getElementById(k);e&&this.originalSettings&&(this.populateColorField(e,"bg-color-trigger","bg-opacity",this.originalSettings.backgroundColor),this.populateColorField(e,"grid-color-trigger","grid-opacity",this.originalSettings.gridColor),this.populateColorField(e,"text-color-trigger","text-opacity",this.originalSettings.textColor),this.populateColorField(e,"crosshair-color-trigger","crosshair-opacity",this.originalSettings.crosshairColor),this.populatePriceLabelColor(e,"ask-label-color-btn","ask-label-color",this.originalSettings.askLabelColor),this.populatePriceLabelColor(e,"bid-label-color-btn","bid-label-color",this.originalSettings.bidLabelColor),this.setSliderValue(e,"candle-width",this.originalSettings.candleWidth),this.setSliderValue(e,"candle-spacing",this.originalSettings.candleSpacing),this.setSliderValue(e,"future-offset",this.originalSettings.futureOffset),this.setCheckbox(e,"show-grid",this.originalSettings.showGrid),this.setCheckbox(e,"show-crosshair",this.originalSettings.showCrosshair),this.setCheckbox(e,"show-crosshair-labels",this.originalSettings.showCrosshairLabels),this.setCheckbox(e,"show-price-line",this.originalSettings.showPriceLine),this.setCheckbox(e,"show-high-low",this.originalSettings.showHighLow),this.setCheckbox(e,"show-ask-price-label",this.originalSettings.showAskPriceLabel),this.setCheckbox(e,"show-bid-price-label",this.originalSettings.showBidPriceLabel),this.setCheckbox(e,"show-ask-bid-lines",this.originalSettings.showAskBidLines),this.setCheckbox(e,"show-indicator-labels",this.originalSettings.showIndicatorLabels),this.setCheckbox(e,"show-ohlc-bar",this.originalSettings.showOHLCBar),this.setCheckbox(e,"auto-scale",this.originalSettings.autoScale),this.setCheckbox(e,"log-scale",this.originalSettings.logScale),this.setCheckbox(e,"show-day-in-date",this.originalSettings.showDayInDate),this.setDropdownValue(e,"date-format-select",this.originalSettings.dateFormat),this.setDropdownValue(e,"time-format-select",this.originalSettings.timeFormat),this.setCheckbox(e,"show-left-sidebar",this.originalSettings.showLeftSidebar))}},{key:"setDropdownValue",value:function(e,t,n){var a=e.querySelector("#".concat(t));a&&a.customSelectAPI&&a.customSelectAPI.setValue(n)}},{key:"populateColorField",value:function(e,t,n,a){var o=e.querySelector("#".concat(t)),i=e.querySelector("#".concat(n));if(o){var l=this.rgbaToHex(a),r=this.extractOpacity(a),s=o.querySelector(".color-preview");if(s){var c=parseInt(l.substr(1,2),16),d=parseInt(l.substr(3,2),16),u=parseInt(l.substr(5,2),16);s.style.backgroundColor="rgba(".concat(c,", ").concat(d,", ").concat(u,", ").concat(r/100,")")}i&&(i.value=r)}}},{key:"populatePriceLabelColor",value:function(e,t,n,a){var o=e.querySelector("#".concat(t)),i=e.querySelector("#".concat(n));if(o){var l=o.querySelector(".color-preview");l&&(l.style.backgroundColor=a)}i&&(i.value=a)}},{key:"setSliderValue",value:function(e,t,n){var a=e.querySelector("#".concat(t));if(a){a.value=Math.round(n);var o=a.parentElement.querySelector(".slider-thumb-tracker");this.updateSliderTrackerPosition(a,o)}}},{key:"setCheckbox",value:function(e,t,n){var a=e.querySelector("#".concat(t));a&&(a.checked=n)}},{key:"populateChartColors",value:function(){var e=document.getElementById(k),t=null==e?void 0:e.querySelector("#chart-colors-section");if(t){var n=this.engine.chartType,a=this.engine.themeManager.getChartTypeColors(n),o=this.engine.themeManager.getCurrentTheme();if(t.innerHTML="","line"===n||"area"===n){t.innerHTML='\n                <h4>Candle Colors</h4>\n                <div class="settings-field">\n                    <label>'.concat({candles:"Candlestick",bars:"Bar",line:"Line",area:"Area","hollow-candles":"Hollow Candlestick","heikin-ashi":"Heikin Ashi","high-low":"High-Low","volume-candles":"Volume Candlestick"}[n]||n,' Color</label>\n                    <div class="dropdown-select color-trigger-select no-auto-highlight" id="chart-line-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="chartLineColor" data-opacity-id="chart-line-opacity">\n                        <div class="select-trigger">\n                            <span class="color-preview"></span>\n                        </div>\n                    </div>\n                    <input type="hidden" id="chart-line-opacity" value="100">\n                </div>\n            ');var i=a.upColor||o.upColor;this.populateColorField(e,"chart-line-color-trigger","chart-line-opacity",i)}else"hollow-candles"===n?(t.innerHTML='\n                <h4>Candle Colors</h4>\n                <div class="settings-field">\n                    <label>Bullish (Up) Color</label>\n                    <div class="dropdown-select color-trigger-select no-auto-highlight" id="chart-up-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="chartUpColor" data-opacity-id="chart-up-opacity">\n                        <div class="select-trigger">\n                            <span class="color-preview"></span>\n                        </div>\n                    </div>\n                    <input type="hidden" id="chart-up-opacity" value="100">\n                </div>\n                <div class="settings-field">\n                    <label>Bearish (Down) Color</label>\n                    <div class="dropdown-select color-trigger-select no-auto-highlight" id="chart-down-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="chartDownColor" data-opacity-id="chart-down-opacity">\n                        <div class="select-trigger">\n                            <span class="color-preview"></span>\n                        </div>\n                    </div>\n                    <input type="hidden" id="chart-down-opacity" value="100">\n                </div>\n                <div class="settings-field">\n                    <label>Hollow Fill Color</label>\n                    <div class="dropdown-select color-trigger-select no-auto-highlight" id="chart-hollow-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="chartHollowColor" data-opacity-id="chart-hollow-opacity">\n                        <div class="select-trigger">\n                            <span class="color-preview"></span>\n                        </div>\n                    </div>\n                    <input type="hidden" id="chart-hollow-opacity" value="100">\n                </div>\n            ',this.populateColorField(e,"chart-up-color-trigger","chart-up-opacity",a.upColor||o.upColor),this.populateColorField(e,"chart-down-color-trigger","chart-down-opacity",a.downColor||o.downColor),this.populateColorField(e,"chart-hollow-color-trigger","chart-hollow-opacity",a.hollowFill||o.background)):(t.innerHTML='\n                <h4>Candle Colors</h4>\n                <div class="settings-field">\n                    <label>Bullish (Up) Color</label>\n                    <div class="dropdown-select color-trigger-select no-auto-highlight" id="chart-up-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="chartUpColor" data-opacity-id="chart-up-opacity">\n                        <div class="select-trigger">\n                            <span class="color-preview"></span>\n                        </div>\n                    </div>\n                    <input type="hidden" id="chart-up-opacity" value="100">\n                </div>\n                <div class="settings-field">\n                    <label>Bearish (Down) Color</label>\n                    <div class="dropdown-select color-trigger-select no-auto-highlight" id="chart-down-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="chartDownColor" data-opacity-id="chart-down-opacity">\n                        <div class="select-trigger">\n                            <span class="color-preview"></span>\n                        </div>\n                    </div>\n                    <input type="hidden" id="chart-down-opacity" value="100">\n                </div>\n            ',this.populateColorField(e,"chart-up-color-trigger","chart-up-opacity",a.upColor||o.upColor),this.populateColorField(e,"chart-down-color-trigger","chart-down-opacity",a.downColor||o.downColor));this.setupChartColorCallbacks(e,t)}}},{key:"setupChartColorCallbacks",value:function(e,t){var n=this;t.querySelectorAll(".color-trigger-select").forEach(function(t){var a=t.querySelector(".color-preview"),o=t.dataset.opacityId,i=o?e.querySelector("#".concat(o)):null;t._colorPickerCallback=function(e,t){var o=parseInt(e.substr(1,2),16),l=parseInt(e.substr(3,2),16),r=parseInt(e.substr(5,2),16);a.style.backgroundColor="rgba(".concat(o,", ").concat(l,", ").concat(r,", ").concat(t/100,")"),i&&(i.value=t),n.previewSettings()}})}},{key:"previewSettings",value:function(){var e,t=this.gatherSettings();null===(e=this.engine.uiManager)||void 0===e||e.applySettingsToEngine(t)}},{key:"gatherSettings",value:function(){var e,t,n,a,o,i,l,r,s,c,d,u,g,p,h,v,m,f,b,w,y,C,S,T,x,M,L,I,E,D,P,q,A,B,O,F=this,Y=document.getElementById(k);if(!Y)return{};var H=function(e,t){var n=Y.querySelector("#".concat(e)),a=Y.querySelector("#".concat(t));if(!n)return null;var o=n.querySelector(".color-preview");if(!o)return null;var i=o.style.backgroundColor;return function(e,t){var n=parseInt(e.substr(1,2),16),a=parseInt(e.substr(3,2),16),o=parseInt(e.substr(5,2),16);return"rgba(".concat(n,", ").concat(a,", ").concat(o,", ").concat(t/100,")")}(F.rgbToHex(i),a?parseInt(a.value):100)},_=this.engine.chartType,j={};return"line"===_||"area"===_?j.lineColor=H("chart-line-color-trigger","chart-line-opacity"):"hollow-candles"===_?(j.upColor=H("chart-up-color-trigger","chart-up-opacity"),j.downColor=H("chart-down-color-trigger","chart-down-opacity"),j.hollowFill=H("chart-hollow-color-trigger","chart-hollow-opacity")):(j.upColor=H("chart-up-color-trigger","chart-up-opacity"),j.downColor=H("chart-down-color-trigger","chart-down-opacity")),{backgroundColor:H("bg-color-trigger","bg-opacity"),gridColor:H("grid-color-trigger","grid-opacity"),textColor:H("text-color-trigger","text-opacity"),crosshairColor:H("crosshair-color-trigger","crosshair-opacity"),chartColors:j,candleWidth:parseInt((null===(e=Y.querySelector("#candle-width"))||void 0===e?void 0:e.value)||8),candleSpacing:parseInt((null===(t=Y.querySelector("#candle-spacing"))||void 0===t?void 0:t.value)||2),futureOffset:parseInt((null===(n=Y.querySelector("#future-offset"))||void 0===n?void 0:n.value)||10),showGrid:null===(a=null===(o=Y.querySelector("#show-grid"))||void 0===o?void 0:o.checked)||void 0===a||a,showCrosshair:null===(i=null===(l=Y.querySelector("#show-crosshair"))||void 0===l?void 0:l.checked)||void 0===i||i,showCrosshairLabels:null===(r=null===(s=Y.querySelector("#show-crosshair-labels"))||void 0===s?void 0:s.checked)||void 0===r||r,showPriceLine:null===(c=null===(d=Y.querySelector("#show-price-line"))||void 0===d?void 0:d.checked)||void 0===c||c,showHighLow:null===(u=null===(g=Y.querySelector("#show-high-low"))||void 0===g?void 0:g.checked)||void 0===u||u,showAskPriceLabel:null===(p=null===(h=Y.querySelector("#show-ask-price-label"))||void 0===h?void 0:h.checked)||void 0===p||p,showBidPriceLabel:null===(v=null===(m=Y.querySelector("#show-bid-price-label"))||void 0===m?void 0:m.checked)||void 0===v||v,showAskBidLines:null!==(f=null===(b=Y.querySelector("#show-ask-bid-lines"))||void 0===b?void 0:b.checked)&&void 0!==f&&f,showIndicatorLabels:null===(w=null===(y=Y.querySelector("#show-indicator-labels"))||void 0===y?void 0:y.checked)||void 0===w||w,showOHLCBar:null===(C=null===(S=Y.querySelector("#show-ohlc-bar"))||void 0===S?void 0:S.checked)||void 0===C||C,autoScale:null===(T=null===(x=Y.querySelector("#auto-scale"))||void 0===x?void 0:x.checked)||void 0===T||T,logScale:null!==(M=null===(L=Y.querySelector("#log-scale"))||void 0===L?void 0:L.checked)&&void 0!==M&&M,askLabelColor:(null===(I=Y.querySelector("#ask-label-color"))||void 0===I?void 0:I.value)||"#00bcd4",bidLabelColor:(null===(E=Y.querySelector("#bid-label-color"))||void 0===E?void 0:E.value)||"#ff9800",showDayInDate:null===(D=null===(P=Y.querySelector("#show-day-in-date"))||void 0===P?void 0:P.checked)||void 0===D||D,dateFormat:(null===(q=Y.querySelector("#date-format-select"))||void 0===q||null===(q=q.customSelectAPI)||void 0===q?void 0:q.getValue())||"DD MMM YYYY",timeFormat:(null===(A=Y.querySelector("#time-format-select"))||void 0===A||null===(A=A.customSelectAPI)||void 0===A?void 0:A.getValue())||"24",showLeftSidebar:null===(B=null===(O=Y.querySelector("#show-left-sidebar"))||void 0===O?void 0:O.checked)||void 0===B||B}}},{key:"cancel",value:function(){var e;this.originalSettings&&(null===(e=this.engine.uiManager)||void 0===e||e.applySettingsToEngine(this.originalSettings)),this.hide()}},{key:"apply",value:function(){var e,t,n,a=this.gatherSettings();null===(e=this.engine.uiManager)||void 0===e||e.applySettingsToEngine(a),null===(t=this.engine.uiManager)||void 0===t||t.saveChartSettings({comprehensiveSettings:a}),null===(n=this.engine.uiManager)||void 0===n||n.switchToCustomTemplate(),this.hide()}},{key:"resetToDefault",value:function(){var e=this.engine.themeManager.getDefaultTheme(),t=this.engine.constructor.DEFAULT_SETTINGS,n="#131722",a="#363a45",o="#d1d4dc",i="#758696",l={backgroundColor:e.background||n,gridColor:e.gridColor||a,textColor:e.textColor||o,crosshairColor:e.crosshairColor||i,candleWidth:t.candleWidth,candleSpacing:t.candleSpacing,futureOffset:t.futureOffset,showGrid:t.showGrid,showCrosshair:t.showCrosshair,showCrosshairLabels:t.showCrosshairLabels,showPriceLine:t.showPriceLine,showHighLow:t.showHighLow,showAskPriceLabel:t.showAskPriceLabel,showBidPriceLabel:t.showBidPriceLabel,showAskBidLines:t.showAskBidLines,showIndicatorLabels:t.showIndicatorLabels,showOHLCBar:t.showOHLCBar,autoScale:t.autoScale,logScale:t.logScale,askLabelColor:t.askLabelColor,bidLabelColor:t.bidLabelColor,showDayInDate:!0,dateFormat:"DD MMM YYYY",timeFormat:"24",showLeftSidebar:!0};this.originalSettings=l,this.populateSettings(),this.populateChartColorsWithDefaults();var r=document.getElementById(k);r&&(this.setupColorTriggers(r),window.initCustomSelects&&window.initCustomSelects(r)),this.previewSettings()}},{key:"populateChartColorsWithDefaults",value:function(){var e=document.getElementById(k),t=null==e?void 0:e.querySelector("#chart-colors-section");if(t){var n=this.engine.chartType,a=this.engine.themeManager.getDefaultTheme(),o={candles:{upColor:"#26a69a",downColor:"#ef5350"},bars:{upColor:"#26a69a",downColor:"#ef5350"},line:{upColor:"#2962ff",downColor:"#2962ff"},area:{upColor:"#2962ff",downColor:"#2962ff"},"hollow-candles":{upColor:"#26a69a",downColor:"#ef5350",hollowFill:"rgba(30, 34, 45, 0)"},"heikin-ashi":{upColor:"#26a69a",downColor:"#ef5350"},"high-low":{upColor:"#26a69a",downColor:"#ef5350"},"volume-candles":{upColor:"#26a69a",downColor:"#ef5350"}}[n]||{upColor:"#26a69a",downColor:"#ef5350"};t.innerHTML="","line"===n||"area"===n?(t.innerHTML='\n                <h4>Candle Colors</h4>\n                <div class="settings-field">\n                    <label>'.concat({candles:"Candlestick",bars:"Bar",line:"Line",area:"Area","hollow-candles":"Hollow Candlestick","heikin-ashi":"Heikin Ashi","high-low":"High-Low","volume-candles":"Volume Candlestick"}[n]||n,' Color</label>\n                    <div class="dropdown-select color-trigger-select no-auto-highlight" id="chart-line-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="chartLineColor" data-opacity-id="chart-line-opacity">\n                        <div class="select-trigger">\n                            <span class="color-preview"></span>\n                        </div>\n                    </div>\n                    <input type="hidden" id="chart-line-opacity" value="100">\n                </div>\n            '),this.populateColorField(e,"chart-line-color-trigger","chart-line-opacity",o.upColor)):"hollow-candles"===n?(t.innerHTML='\n                <h4>Candle Colors</h4>\n                <div class="settings-field">\n                    <label>Bullish (Up) Color</label>\n                    <div class="dropdown-select color-trigger-select no-auto-highlight" id="chart-up-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="chartUpColor" data-opacity-id="chart-up-opacity">\n                        <div class="select-trigger">\n                            <span class="color-preview"></span>\n                        </div>\n                    </div>\n                    <input type="hidden" id="chart-up-opacity" value="100">\n                </div>\n                <div class="settings-field">\n                    <label>Bearish (Down) Color</label>\n                    <div class="dropdown-select color-trigger-select no-auto-highlight" id="chart-down-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="chartDownColor" data-opacity-id="chart-down-opacity">\n                        <div class="select-trigger">\n                            <span class="color-preview"></span>\n                        </div>\n                    </div>\n                    <input type="hidden" id="chart-down-opacity" value="100">\n                </div>\n                <div class="settings-field">\n                    <label>Hollow Fill Color</label>\n                    <div class="dropdown-select color-trigger-select no-auto-highlight" id="chart-hollow-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="chartHollowColor" data-opacity-id="chart-hollow-opacity">\n                        <div class="select-trigger">\n                            <span class="color-preview"></span>\n                        </div>\n                    </div>\n                    <input type="hidden" id="chart-hollow-opacity" value="100">\n                </div>\n            ',this.populateColorField(e,"chart-up-color-trigger","chart-up-opacity",o.upColor),this.populateColorField(e,"chart-down-color-trigger","chart-down-opacity",o.downColor),this.populateColorField(e,"chart-hollow-color-trigger","chart-hollow-opacity",o.hollowFill||a.background)):(t.innerHTML='\n                <h4>Candle Colors</h4>\n                <div class="settings-field">\n                    <label>Bullish (Up) Color</label>\n                    <div class="dropdown-select color-trigger-select no-auto-highlight" id="chart-up-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="chartUpColor" data-opacity-id="chart-up-opacity">\n                        <div class="select-trigger">\n                            <span class="color-preview"></span>\n                        </div>\n                    </div>\n                    <input type="hidden" id="chart-up-opacity" value="100">\n                </div>\n                <div class="settings-field">\n                    <label>Bearish (Down) Color</label>\n                    <div class="dropdown-select color-trigger-select no-auto-highlight" id="chart-down-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-setting="chartDownColor" data-opacity-id="chart-down-opacity">\n                        <div class="select-trigger">\n                            <span class="color-preview"></span>\n                        </div>\n                    </div>\n                    <input type="hidden" id="chart-down-opacity" value="100">\n                </div>\n            ',this.populateColorField(e,"chart-up-color-trigger","chart-up-opacity",o.upColor),this.populateColorField(e,"chart-down-color-trigger","chart-down-opacity",o.downColor)),this.setupChartColorCallbacks(e,t)}}},{key:"rgbToHex",value:function(e){if(!e||e.startsWith("#"))return e||"#000000";var t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(!t)return"#000000";var n=parseInt(t[1]).toString(16).padStart(2,"0"),a=parseInt(t[2]).toString(16).padStart(2,"0"),o=parseInt(t[3]).toString(16).padStart(2,"0");return"#".concat(n).concat(a).concat(o)}},{key:"rgbaToHex",value:function(e){return e?e.startsWith("#")?e:this.rgbToHex(e):"#000000"}},{key:"extractOpacity",value:function(e){if(!e||!e.includes("rgba"))return 100;var t=e.match(/rgba?\([^)]+,\s*([\d.]+)\)/);return t?Math.round(100*parseFloat(t[1])):100}}],t&&w(e.prototype,t),n&&w(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}(),S=n(1068);function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,o,i,l,r=[],s=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(a=i.call(n)).done)&&(r.push(a.value),r.length!==t);s=!0);}catch(e){c=!0,o=e}finally{try{if(!s&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(c)throw o}}return r}}(e,t)||L(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e){return function(e){if(Array.isArray(e))return I(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||L(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){if(e){if("string"==typeof e)return I(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(e,t):void 0}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function E(){var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,a,o,i){var s=a&&a.prototype instanceof r?a:r,c=Object.create(s.prototype);return D(c,"_invoke",function(n,a,o){var i,r,s,c=0,d=o||[],u=!1,g={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,r=0,s=e,g.n=n,l}};function p(n,a){for(r=n,s=a,t=0;!u&&c&&!o&&t<d.length;t++){var o,i=d[t],p=g.p,h=i[2];n>3?(o=h===a)&&(s=i[(r=i[4])?5:(r=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=n<2&&p<i[1])?(r=0,g.v=a,g.n=i[1]):p<h&&(o=n<3||i[0]>a||a>h)&&(i[4]=n,i[5]=a,g.n=h,r=0))}if(o||n>1)return l;throw u=!0,a}return function(o,d,h){if(c>1)throw TypeError("Generator is already running");for(u&&1===d&&p(d,h),r=d,s=h;(t=r<2?e:s)||!u;){i||(r?r<3?(r>1&&(g.n=-1),p(r,s)):g.n=s:g.v=s);try{if(c=2,i){if(r||(o="next"),t=i[o]){if(!(t=t.call(i,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,r<2&&(r=0)}else 1===r&&(t=i.return)&&t.call(i),r<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),r=1);i=e}else if((t=(u=g.n<0)?s:n.call(a,g))!==l)break}catch(t){i=e,r=1,s=t}finally{c=1}}return{value:t,done:u}}}(n,o,i),!0),c}var l={};function r(){}function s(){}function c(){}t=Object.getPrototypeOf;var d=[][a]?t(t([][a]())):(D(t={},a,function(){return this}),t),u=c.prototype=r.prototype=Object.create(d);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,D(e,o,"GeneratorFunction")),e.prototype=Object.create(u),e}return s.prototype=c,D(u,"constructor",c),D(c,"constructor",s),s.displayName="GeneratorFunction",D(c,o,"GeneratorFunction"),D(u),D(u,o,"Generator"),D(u,a,function(){return this}),D(u,"toString",function(){return"[object Generator]"}),(E=function(){return{w:i,m:g}})()}function D(e,t,n,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}D=function(e,t,n,a){function i(t,n){D(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},D(e,t,n,a)}function P(e,t,n,a,o,i,l){try{var r=e[i](l),s=r.value}catch(e){return void n(e)}r.done?t(s):Promise.resolve(s).then(a,o)}function q(e){return function(){var t=this,n=arguments;return new Promise(function(a,o){var i=e.apply(t,n);function l(e){P(i,a,o,l,r,"next",e)}function r(e){P(i,a,o,l,r,"throw",e)}l(void 0)})}}function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach(function(t){O(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function O(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=T(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=T(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==T(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F={handleFloatingToolbarAction:function(e){var t=this;if(this.floatingToolbarItem){var n=this.floatingToolbarItem,o=this.getActiveEngine?this.getActiveEngine():this.engine;if("delete"!==e){if("lock"===e){n.locked=!n.locked;var i=this.floatingToolbar.querySelector('[data-action="lock"]'),l=i.querySelector(".lock-icon"),r=i.querySelectorAll("span")[1];return l.innerHTML=n.locked?a.cI.lock:a.cI.unlock,r&&(r.textContent=n.locked?"Unlock":"Lock"),void 0!==n.index?(o.saveMarkersToStorage(),o.syncMarkerToOtherCharts("reload-storage",{})):(o.drawingManager.saveToStorage(),o.drawingManager.syncDrawingToOtherCharts("reload-storage",{})),void o.render()}this.selectedItem=n,this.handleContextMenuAction(e),"clone"===e&&this.selectedItem&&setTimeout(function(){var e=void 0!==n.index?t.engine.markers[t.engine.markers.length-1]:t.engine.drawingManager.drawings[t.engine.drawingManager.drawings.length-1];if(e){t.floatingToolbarItem=e;var o=t.floatingToolbar.querySelector("#floating-color-input");o&&(o.value=e.color),t.floatingToolbar.querySelector('[data-action="lock"]').querySelector(".lock-icon").innerHTML=e.locked?a.cI.lock:a.cI.unlock}},50)}else{if(this.hideFloatingToolbar(),void 0!==n.index){var s=o.markers.findIndex(function(e){return e===n});-1!==s?o.removeMarker(s):-1!==(s=this.engine.markers.findIndex(function(e){return e===n}))&&this.engine.removeMarker(s)}else if(void 0!==n.id){if(o.drawingManager.drawings.find(function(e){return e.id===n.id}))o.drawingManager.removeDrawing(n.id);else this.engine.drawingManager.drawings.find(function(e){return e.id===n.id})&&this.engine.drawingManager.removeDrawing(n.id)}o.render()}}},handleContextMenuAction:function(e){var t=this;if(this.selectedItem){var n=this.getActiveEngine?this.getActiveEngine():this.engine;switch(e){case"delete":if(void 0!==this.selectedItem.index){var a=n.markers.findIndex(function(e){return e===t.selectedItem});-1!==a?n.removeMarker(a):-1!==(a=this.engine.markers.findIndex(function(e){return e===t.selectedItem}))&&this.engine.removeMarker(a)}else if(void 0!==this.selectedItem.id){if(n.drawingManager.drawings.find(function(e){return e.id===t.selectedItem.id}))n.drawingManager.removeDrawing(this.selectedItem.id);else this.engine.drawingManager.drawings.find(function(e){return e.id===t.selectedItem.id})&&this.engine.drawingManager.removeDrawing(this.selectedItem.id)}break;case"lock":this.selectedItem.locked=!this.selectedItem.locked,void 0!==this.selectedItem.index?(n.saveMarkersToStorage(),n.syncMarkerToOtherCharts("reload-storage",{})):(n.drawingManager.saveToStorage(),n.drawingManager.syncDrawingToOtherCharts("reload-storage",{}));break;case"clone":if(void 0!==this.selectedItem.index){var o=.02*(n.priceRange.max-n.priceRange.min);n.addMarker(B(B({},this.selectedItem),{},{index:this.selectedItem.index+3,price:this.selectedItem.price+o}))}else{var i=Object.assign(Object.create(Object.getPrototypeOf(this.selectedItem)),this.selectedItem);i.id=n.drawingManager.nextId++;var l=.02*(n.priceRange.max-n.priceRange.min);i.points=i.points.map(function(e){return B(B({},e),{},{index:e.index+3,price:e.price+l})}),n.drawingManager.drawings.push(i),n.drawingManager.saveToStorage(),n.drawingManager.syncDrawingToOtherCharts("add",i)}}this.hideContextMenu(),n.render()}},createDrawingContextMenu:function(){var e=this;this.contextMenu=document.createElement("div"),this.contextMenu.className="drawing-context-menu",this.contextMenu.innerHTML='\n      <div class="context-menu-color-picker">\n        <span><span class="icon">'.concat(a.cI.color,'</span>Color</span>\n        <div class="dropdown-select color-trigger-select no-auto-highlight" id="context-color-btn" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" style="width: 24px; height: 24px; margin-left: auto;" data-tooltip-title="Choose Color">\n          <div class="select-trigger">\n            <span class="color-preview" style="background: #2962ff;"></span>\n          </div>\n        </div>\n      </div>\n      <div class="context-menu-item" data-action="lock">\n        <span class="icon">').concat(a.cI.unlock,'</span>\n        <span class="lock-text">Lock</span>\n      </div>\n      <div class="context-menu-item" data-action="clone">\n        <span class="icon">').concat(a.cI.clone,'</span>\n        <span>Clone</span>\n      </div>\n      <div class="context-menu-item" data-action="delete">\n        <span class="icon">').concat(a.cI.trash,"</span>\n        <span>Delete</span>\n      </div>\n    "),this.selectedItem=null;var t=this.contextMenu.querySelector("#context-color-btn");t._colorPickerCallback=function(n,a){if(e.selectedItem){var o=function(e,t){var n=parseInt(e.substr(1,2),16),a=parseInt(e.substr(3,2),16),o=parseInt(e.substr(5,2),16);return"rgba(".concat(n,", ").concat(a,", ").concat(o,", ").concat(t,")")}(n,a/100),i=t.querySelector(".color-preview");i&&(i.style.background=o),e.selectedItem.color=o,void 0===e.selectedItem.index&&(e.engine.drawingManager.lastUsedColor=o),void 0!==e.selectedItem.index?e.engine.saveMarkersToStorage():e.engine.drawingManager.saveToStorage(),e.engine.render(),e.hideContextMenu()}},t.addEventListener("mousedown",function(e){return e.stopPropagation()}),this.contextMenu.querySelectorAll(".context-menu-item").forEach(function(t){t.addEventListener("click",function(n){n.stopPropagation();var a=t.dataset.action;e.handleContextMenuAction(a)})}),document.addEventListener("click",function(t){e.contextMenu&&e.contextMenu.classList.contains("visible")&&!e.contextMenu.contains(t.target)&&e.hideContextMenu()}),this.engine.wrapperDiv.appendChild(this.contextMenu),window.initCustomSelects&&window.initCustomSelects(this.contextMenu)},createFloatingToolbar:function(){var e,t=this,n="floatingToolbarModal",i=document.getElementById(n);if(i)return this.floatingToolbarModal=i,void(this.floatingToolbar=null===(e=i.querySelector(".floating-toolbar-content"))||void 0===e?void 0:e.parentElement);var l='\n      <div class="modal" id="'.concat(n,'" tabindex="-1" data-custom-modal="true" data-cm-draggable="true" data-cm-placement="right" data-cm-margin="80" data-cm-compact="true" data-cm-save-position="true">\n        <div class="modal-dialog modal-md floating-toolbar-dialog">\n          <div class="modal-content">\n            <div class="modal-header cm-modal-header" data-cm-drag-handle>\n              <h5 class="modal-title">Drawing Settings</h5>\n              <span class="custom-modal-close" data-cm-dismiss="custom-modal">\n                <svg width="20" height="20" fill="none" stroke="currentColor"><use href="#x"></use></svg>\n              </span>\n            </div>\n            <div class="settings-tab-header">\n              <div class="settings-tab active" data-tab="style">Style</div>\n              <div class="settings-tab" data-tab="text">Text</div>\n              <div class="settings-tab" data-tab="lines">Lines</div>\n              <div class="settings-tab" data-tab="coordinates">Coordinates</div>\n            </div>\n            <div class="modal-body">\n              <div class="floating-toolbar-content">\n                \x3c!-- Style Tab --\x3e\n                <div class="tab-content active" data-tab="style">\n                  <div class="floating-toolbar-fields">\n                    <div class="settings-field">\n                      <label>Line</label>\n                      <div class="field-controls">\n                        <div class="dropdown-select color-trigger-select no-auto-highlight" id="floating-color-btn" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-tooltip-title="Choose Color">\n                          <div class="select-trigger">\n                            <span class="color-preview"></span>\n                          </div>\n                        </div>\n                        <div class="dropdown-select" id="floating-width-select" data-dropdown-id="floatingWidthDropdown" data-modal-escape="true" data-tooltip-title="Line Thickness">\n                          <div class="select-trigger">\n                            <span class="select-trigger-text">1px</span>\n                            <svg width="18" height="18" class="select-arrow" fill="none" stroke="currentColor">\n                              <use href="#chevron-down"></use>\n                            </svg>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                    <div class="settings-field style-field">\n                      <label>Line Style</label>\n                      <div class="dropdown-select" id="floating-style-select" data-dropdown-id="floatingStyleDropdown" data-modal-escape="true">\n                        <div class="select-trigger">\n                          <span class="select-trigger-text"><span class="select-option-icon">').concat(a.cI.lineSolid,'</span>Solid</span>\n                          <svg width="18" height="18" class="select-arrow" fill="none" stroke="currentColor">\n                              <use href="#chevron-down"></use>\n                            </svg>\n                        </div>\n                      </div>\n                    </div>\n                    <div class="settings-field bg-opacity-field" style="display: none;">\n                      <label>Fill Opacity</label>\n                      <div class="field-controls">\n                        <div class="opacity-slider-wrapper">\n                          <input type="range" id="floating-bg-opacity" class="opacity-slider checkered-slider" min="0" max="100" value="20">\n                          <span class="opacity-value">20%</span>\n                        </div>\n                      </div>\n                    </div>\n                    <div class="settings-field tooltip-mode-row">\n                      <label>Tooltip</label>\n                      <div class="tooltip-mode-buttons">\n                        <button class="tooltip-mode-btn active" data-mode="auto" data-tooltip-title="Show on hover">On</button>\n                        <button class="tooltip-mode-btn" data-mode="off" data-tooltip-title="Hidden">Off</button>\n                      </div>\n                    </div>\n                    <div class="settings-field checkbox-field layer-row">\n                        <label>Back Layer</label>\n                        <input type="checkbox" id="floating-layer-toggle">\n                    </div>\n                    <div class="settings-field checkbox-field projection-toggle-row" style="display: none;">\n                      <label>Projections</label>\n                      <input type="checkbox" id="show-projections-checkbox" checked>\n                    </div>\n                  </div>\n                  <div class="toolbar-actions">\n                    <button class="floating-btn" data-action="lock" id="floating-lock-btn">\n                      <span class="lock-icon">').concat(a.cI.unlock,'</span> <span class="lock-unlock">Lock</span>\n                    </button>\n                    <button class="floating-btn" data-action="clone" id="floating-clone-btn">\n                      ').concat(a.cI.clone,' Clone\n                    </button>\n                    <button class="floating-btn danger" data-action="delete" id="floating-delete-btn">\n                      ').concat(a.cI.trash,' Delete\n                    </button>\n                  </div>\n                </div>\n\n                \x3c!-- Text Tab --\x3e\n                <div class="tab-content" data-tab="text">\n                  <div class="floating-toolbar-fields">\n                    <div class="settings-field text-input-field">\n                      <textarea id="floating-text-input" class="text-input" placeholder="Enter label text..." rows="5"></textarea>\n                    </div>\n                    <div class="settings-field">\n                      <label>Text Style</label>\n                      <div class="field-controls">\n                        <div class="dropdown-select color-trigger-select no-auto-highlight" id="floating-text-color-trigger" data-dropdown-id="colorPickerDropdown" data-modal-escape="true" data-tooltip-title="Choose Text Color">\n                          <div class="select-trigger">\n                            <span class="color-preview"></span>\n                          </div>\n                        </div>\n                        <div class="dropdown-select" id="floating-text-size-select" data-dropdown-id="floatingTextSizeDropdown" data-modal-escape="true" data-tooltip-title="Text Size">\n                          <div class="select-trigger">\n                            <span class="select-trigger-text">12px</span>\n                            <svg width="18" height="18" class="select-arrow" fill="none" stroke="currentColor">\n                              <use href="#chevron-down"></use>\n                            </svg>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                    <div class="settings-field">\n                      <label>Position</label>\n                      <div class="field-controls position-controls">\n                        <div class="dropdown-select" id="floating-text-vpos" data-dropdown-id="floatingTextVPosDropdown" data-modal-escape="true" data-tooltip-title="Vertical Position">\n                          <div class="select-trigger">\n                            <span class="select-trigger-text">Above</span>\n                            <svg width="18" height="18" class="select-arrow" fill="none" stroke="currentColor">\n                              <use href="#chevron-down"></use>\n                            </svg>\n                          </div>\n                        </div>\n                        <div class="dropdown-select" id="floating-text-hpos" data-dropdown-id="floatingTextHPosDropdown" data-modal-escape="true" data-tooltip-title="Horizontal Position">\n                          <div class="select-trigger">\n                            <span class="select-trigger-text">Center</span>\n                            <svg width="18" height="18" class="select-arrow" fill="none" stroke="currentColor">\n                              <use href="#chevron-down"></use>\n                            </svg>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n                \x3c!-- Lines Tab (for Fibonacci tools) --\x3e\n                <div class="tab-content" data-tab="lines">\n                  <div id="fib-lines-container">\n                    \x3c!-- Populated dynamically for Fibonacci tools --\x3e\n                  </div>\n                </div>\n\n                \x3c!-- Coordinates Tab --\x3e\n                <div class="tab-content" data-tab="coordinates">\n                  <div id="coordinates-container">\n                    \x3c!-- Populated dynamically based on drawing type --\x3e\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div class="modal-footer chart-settings-footer floating-toolbar-footer">\n              <div class="template-select-wrapper">\n                <div class="dropdown-select no-auto-highlight" id="floating-template-select" data-dropdown-id="floatingTemplateDropdown" data-modal-escape="true" data-tooltip-title="Save or load templates">\n                  <div class="select-trigger">\n                    <span class="select-trigger-text-nochange">Template</span>\n                    <svg width="18" height="18" class="select-arrow" fill="none" stroke="currentColor">\n                      <use href="#chevron-down"></use>\n                    </svg>\n                  </div>\n                </div>\n              </div>\n              <div class="footer-right">\n                <button class="btn-apply-changes" id="floating-toolbar-ok-btn">Ok</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    ');document.body.insertAdjacentHTML("beforeend",l);var r='\n      \x3c!-- Width Dropdown --\x3e\n      <div id="floatingWidthDropdown" class="select-dropdown">\n        <ul class="select-options">\n          <li class="select-option selected" data-value="1">1px</li>\n          <li class="select-option" data-value="2">2px</li>\n          <li class="select-option" data-value="3">3px</li>\n          <li class="select-option" data-value="4">4px</li>\n          <li class="select-option" data-value="5">5px</li>\n        </ul>\n      </div>\n\n      \x3c!-- Style Dropdown --\x3e\n      <div id="floatingStyleDropdown" class="select-dropdown">\n        <ul class="select-options">\n          <li class="select-option selected" data-value="solid"><span class="select-option-icon">'.concat(a.cI.lineSolid,'</span> Solid</li>\n          <li class="select-option" data-value="dashed"><span class="select-option-icon">').concat(a.cI.lineDashed,'</span> Dashed</li>\n        </ul>\n      </div>\n\n      \x3c!-- Text Size Dropdown --\x3e\n      <div id="floatingTextSizeDropdown" class="select-dropdown">\n        <ul class="select-options">\n          <li class="select-option" data-value="8">8px</li>\n          <li class="select-option" data-value="10">10px</li>\n          <li class="select-option selected" data-value="12">12px</li>\n          <li class="select-option" data-value="14">14px</li>\n          <li class="select-option" data-value="16">16px</li>\n          <li class="select-option" data-value="18">18px</li>\n          <li class="select-option" data-value="20">20px</li>\n          <li class="select-option" data-value="24">24px</li>\n          <li class="select-option" data-value="28">28px</li>\n          <li class="select-option" data-value="36">36px</li>\n          <li class="select-option" data-value="48">48px</li>\n          <li class="select-option" data-value="56">56px</li>\n          <li class="select-option" data-value="64">64px</li>\n          <li class="select-option" data-value="72">72px</li>\n        </ul>\n      </div>\n\n      \x3c!-- Text Vertical Position Dropdown --\x3e\n      <div id="floatingTextVPosDropdown" class="select-dropdown">\n        <ul class="select-options">\n          <li class="select-option selected" data-value="above">Above</li>\n          <li class="select-option" data-value="middle">Middle</li>\n          <li class="select-option" data-value="below">Below</li>\n        </ul>\n      </div>\n\n      \x3c!-- Text Horizontal Position Dropdown --\x3e\n      <div id="floatingTextHPosDropdown" class="select-dropdown">\n        <ul class="select-options">\n          <li class="select-option" data-value="left">Left</li>\n          <li class="select-option selected" data-value="center">Center</li>\n          <li class="select-option" data-value="right">Right</li>\n        </ul>\n      </div>\n\n      \x3c!-- Template Dropdown --\x3e\n      <div id="floatingTemplateDropdown" class="select-dropdown no-auto-highlight template-dropdown">\n        <ul class="select-options">\n          <li class="select-option template-action" data-value="save-as">Save as</li>\n          <li class="select-option template-action" data-value="default">Reset to Default</li>\n          <li class="template-divider"></li>\n          \x3c!-- Saved templates will be added dynamically --\x3e\n        </ul>\n      </div>\n    ');document.body.insertAdjacentHTML("beforeend",r);var s=document.getElementById(n);this.floatingToolbarModal=s,this.floatingToolbar=s.querySelector(".modal-content"),this.floatingToolbarItem=null,this.floatingToolbarVisible=!1;var c=function(){return s._activeUIManager||t};s.addEventListener("click",function(e){var t=e.target.closest(".floating-btn");if(t){e.stopPropagation();var n,a=t.dataset.action;if(a)return null===(n=window.CustomSelect)||void 0===n||n.closeAll(),void c().handleFloatingToolbarAction(a)}e.target.closest(".dropdown-select")||e.target.closest(".select-dropdown")||window.CustomSelect&&window.CustomSelect.closeAll()});var d=this.floatingToolbar.querySelector(".settings-tab-header");null==d||d.addEventListener("click",function(e){var n=e.target.closest(".settings-tab");if(n){var a=n.dataset.tab;d.querySelectorAll(".settings-tab").forEach(function(e){return e.classList.remove("active")}),n.classList.add("active"),t.floatingToolbar.querySelectorAll(".tab-content").forEach(function(e){e.dataset.tab===a?e.classList.add("active"):e.classList.remove("active")})}});var u=this.floatingToolbar.querySelector("#floating-color-btn"),g=null==u?void 0:u.querySelector(".color-preview"),p=function(e,t){var n=parseInt(e.substr(1,2),16),a=parseInt(e.substr(3,2),16),o=parseInt(e.substr(5,2),16);return"rgba(".concat(n,", ").concat(a,", ").concat(o,", ").concat(t,")")};u._colorPickerCallback=function(e,t){var n=c();if(n.floatingToolbarItem){var a=n.floatingToolbarItem,o=p(e,t/100);g&&(g.style.background=o),"plaintext"===a.type?a.backgroundColor=o:"textcomment"===a.type||"pricelabel"===a.type||"callout"===a.type||"note"===a.type?(a.backgroundColor=o,a.borderColor=e):"anchoredtext"===a.type?(a.backgroundColor=o,a.borderColor=e,a.lineColor=o):"texttable"===a.type?a.backgroundColor=o:a.color=o,void 0===a.index&&(n.engine.drawingManager.lastUsedColor=o),void 0!==a.index?n.engine.saveMarkersToStorage():(n.engine.drawingManager.saveToStorage(),n.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{})),n.engine.render()}},u.addEventListener("mousedown",function(e){return e.stopPropagation()}),this.floatingToolbar.querySelector("#floating-width-select").addEventListener("customSelectChange",function(e){e.stopPropagation();var t=c();if(t.floatingToolbarItem){var n=parseInt(e.detail.value);void 0!==t.floatingToolbarItem.index?(t.floatingToolbarItem.size=n,t.engine.saveMarkersToStorage()):(t.floatingToolbarItem.lineWidth=n,t.engine.drawingManager.saveToStorage(),t.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{})),t.engine.render()}}),this.floatingToolbar.querySelector("#floating-style-select").addEventListener("customSelectChange",function(e){e.stopPropagation();var t=c();t.floatingToolbarItem&&(t.floatingToolbarItem.lineStyle=e.detail.value,t.engine.drawingManager.saveToStorage(),t.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{}),t.engine.render())}),this.floatingToolbar.querySelectorAll(".tooltip-mode-btn").forEach(function(e){e.addEventListener("click",function(n){var a;n.stopPropagation(),null===(a=window.CustomSelect)||void 0===a||a.closeAll();var o=c();if(o.floatingToolbarItem){var i=e.dataset.mode;o.floatingToolbarItem.tooltipMode=i,["pitchfork","pitchforkschiff","pitchforkmodified","equidistantchannel","flattopchannel","flatbottomchannel"].includes(o.floatingToolbarItem.type)&&(o.floatingToolbarItem.showInfoBox="off"!==i),o.engine.drawingManager.saveTooltipModeForType(o.floatingToolbarItem.type,i),o.engine.drawingManager.saveToStorage(),o.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{}),o.engine.render(),t.floatingToolbar.querySelectorAll(".tooltip-mode-btn").forEach(function(e){return e.classList.remove("active")}),e.classList.add("active")}}),e.addEventListener("mousedown",function(e){return e.stopPropagation()})});var h=this.floatingToolbar.querySelector("#floating-layer-toggle");h&&(h.addEventListener("change",function(e){var t;e.stopPropagation(),null===(t=window.CustomSelect)||void 0===t||t.closeAll();var n=c();n.floatingToolbarItem&&(n.floatingToolbarItem.layer=e.target.checked?"behind":"front",n.engine.drawingManager.saveToStorage(),n.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{}),n.engine.render())}),h.addEventListener("click",function(e){var t;e.stopPropagation(),null===(t=window.CustomSelect)||void 0===t||t.closeAll()}),h.addEventListener("mousedown",function(e){return e.stopPropagation()}));var v=this.floatingToolbar.querySelector("#show-projections-checkbox");v&&(v.addEventListener("change",function(e){var t;e.stopPropagation(),null===(t=window.CustomSelect)||void 0===t||t.closeAll();var n=c();n.floatingToolbarItem&&(n.floatingToolbarItem.showProjections=e.target.checked,n.engine.drawingManager.saveToStorage(),n.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{}),n.engine.render())}),v.addEventListener("click",function(e){var t;e.stopPropagation(),null===(t=window.CustomSelect)||void 0===t||t.closeAll()}),v.addEventListener("mousedown",function(e){return e.stopPropagation()}));var m=this.floatingToolbar.querySelector("#floating-bg-opacity");m&&(m.addEventListener("input",function(e){e.stopPropagation();var n=c();if(n.floatingToolbarItem){var a=n.floatingToolbarItem,i=parseInt(e.target.value),l=a.color||"#2962ff",r=o.s.rgbaToHex(l),s=o.s.hexToRgba(r,i);a.fillColor=s;var d=t.floatingToolbar.querySelector(".bg-opacity-field .opacity-value");d&&(d.textContent="".concat(i,"%")),n.engine.drawingManager.saveToStorage(),n.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{}),n.engine.render()}}),m.addEventListener("mousedown",function(e){return e.stopPropagation()}));var f=this.floatingToolbar.querySelector("#floating-text-input");f.addEventListener("input",function(e){e.stopPropagation();var t=c();t.floatingToolbarItem&&(t.floatingToolbarItem.text=e.target.value,void 0!==t.floatingToolbarItem.index?t.engine.saveMarkersToStorage():(t.engine.drawingManager.saveToStorage(),t.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{})),t.engine.render())}),f.addEventListener("click",function(e){var t;e.stopPropagation(),null===(t=window.CustomSelect)||void 0===t||t.closeAll()}),f.addEventListener("mousedown",function(e){return e.stopPropagation()});var b=this.floatingToolbar.querySelector("#floating-text-color-trigger"),w=null==b?void 0:b.querySelector(".color-preview");b._colorPickerCallback=function(e,t){var n=c();if(n.floatingToolbarItem){var a=p(e,t/100);n.floatingToolbarItem.textColor=a,w&&(w.style.background=a),void 0!==n.floatingToolbarItem.index?n.engine.saveMarkersToStorage():(n.engine.drawingManager.saveToStorage(),n.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{})),n.engine.render()}},b.addEventListener("mousedown",function(e){return e.stopPropagation()}),this.floatingToolbar.querySelector("#floating-text-size-select").addEventListener("customSelectChange",function(e){e.stopPropagation();var t=c();t.floatingToolbarItem&&(t.floatingToolbarItem.textSize=parseInt(e.detail.value),void 0!==t.floatingToolbarItem.index?t.engine.saveMarkersToStorage():(t.engine.drawingManager.saveToStorage(),t.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{})),t.engine.render())}),this.floatingToolbar.querySelector("#floating-text-vpos").addEventListener("customSelectChange",function(e){e.stopPropagation();var t=c();if(t.floatingToolbarItem){var n,a=(null===(n=t.floatingToolbarItem.textPosition)||void 0===n?void 0:n.split("-")[1])||"center";t.floatingToolbarItem.textPosition="".concat(e.detail.value,"-").concat(a),void 0!==t.floatingToolbarItem.index?t.engine.saveMarkersToStorage():(t.engine.drawingManager.saveToStorage(),t.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{})),t.engine.render()}}),this.floatingToolbar.querySelector("#floating-text-hpos").addEventListener("customSelectChange",function(e){e.stopPropagation();var t=c();if(t.floatingToolbarItem){var n,a=(null===(n=t.floatingToolbarItem.textPosition)||void 0===n?void 0:n.split("-")[0])||"above";t.floatingToolbarItem.textPosition="".concat(a,"-").concat(e.detail.value),void 0!==t.floatingToolbarItem.index?t.engine.saveMarkersToStorage():(t.engine.drawingManager.saveToStorage(),t.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{})),t.engine.render()}}),setTimeout(function(){window.initCustomSelects&&window.initCustomSelects(s)},100);var y=this.floatingToolbar.querySelector("#floating-toolbar-ok-btn");y&&y.addEventListener("click",function(e){e.stopPropagation(),c().hideFloatingToolbar()});var k=this.floatingToolbar.querySelector("#floating-template-select");k&&k.addEventListener("customSelectChange",function(e){e.stopPropagation();var t=e.detail.value,n=c();if("save-as"===t)n.openSaveTemplateModal();else if("default"===t)n.applyDefaultSettings();else if(t.startsWith("template-")){var a=t.replace("template-","");n.applyTemplate(a)}var o=k.querySelector(".select-trigger-text");o&&setTimeout(function(){o.textContent="Template"},100)}),this.createSaveTemplateModal(),this.createDrawingQuickToolbar()},createDrawingQuickToolbar:function(){var e=this,t="drawingQuickToolbarModal",n=document.getElementById(t);if(n)this.drawingQuickToolbarModal=n;else{var i='\n      <div class="modal favorites-toolbar-modal drawing-quick-toolbar-modal" id="'.concat(t,'"\n           data-custom-modal="true"\n           data-cm-draggable="true"\n           data-cm-compact="true"\n           data-cm-placement="bottom"\n           data-cm-keyboard="false"\n           data-cm-constrain="true"\n           data-cm-save-position="true">\n        <div class="modal-dialog">\n          <div class="modal-content">\n            <div class="modal-body favorites-toolbar drawing-quick-toolbar">\n              <div class="favorites-fixed-section">\n                <div class="favorites-drag-handle" data-cm-drag-handle>\n                  ').concat(a.cI.dragHandle,'\n                </div>\n              </div>\n              <div class="drawing-quick-actions">\n                <div class="dropdown-select color-trigger-select no-auto-highlight favorite-tool-btn"\n                     id="quick-color-btn"\n                     data-dropdown-id="colorPickerDropdown"\n                     data-modal-escape="true"\n                     data-tooltip-title="Color">\n                  <div class="select-trigger">\n                    <span class="color-preview"></span>\n                  </div>\n                </div>\n                <div class="dropdown-select favorite-tool-btn has-svg-icon"\n                     id="quick-width-btn"\n                     data-dropdown-id="quickWidthDropdown"\n                     data-modal-escape="true"\n                     data-tooltip-title="Line Width">\n                  <div class="select-trigger">\n                    <span class="width-preview">1</span>\n                  </div>\n                </div>\n                <div class="dropdown-select favorite-tool-btn has-svg-icon"\n                     id="quick-style-btn"\n                     data-dropdown-id="quickStyleDropdown"\n                     data-modal-escape="true"\n                     data-tooltip-title="Line Style">\n                  <div class="select-trigger">\n                    ').concat(a.cI.lineSolid,'\n                  </div>\n                </div>\n                \x3c!-- Text tool quick settings (hidden by default) --\x3e\n                <div class="dropdown-select color-trigger-select no-auto-highlight favorite-tool-btn quick-text-btn"\n                     id="quick-text-color-btn"\n                     data-dropdown-id="colorPickerDropdown"\n                     data-modal-escape="true"\n                     data-tooltip-title="Text Color"\n                     style="display: none;">\n                  <div class="select-trigger">\n                    <span class="color-preview"></span>\n                  </div>\n                </div>\n                <div class="dropdown-select favorite-tool-btn has-svg-icon quick-text-btn"\n                     id="quick-text-size-btn"\n                     data-dropdown-id="quickTextSizeDropdown"\n                     data-modal-escape="true"\n                     data-tooltip-title="Text Size1"\n                     style="display: none;">\n                  <div class="select-trigger">\n                    <span class="text-size-preview">12</span>\n                  </div>\n                </div>\n                <button class="favorite-tool-btn has-svg-icon" data-action="lock" id="quick-lock-btn" data-tooltip-title="Lock">\n                  ').concat(a.cI.unlock,'\n                </button>\n                <button class="favorite-tool-btn has-svg-icon" data-action="clone" data-tooltip-title="Clone">\n                  ').concat(a.cI.clone,'\n                </button>\n                <button class="favorite-tool-btn has-svg-icon danger" data-action="delete" data-tooltip-title="Delete">\n                  ').concat(a.cI.trash,'\n                </button>\n                <div class="dropdown-select favorite-tool-btn has-svg-icon"\n                     id="quick-template-btn"\n                     data-dropdown-id="quickTemplateDropdown"\n                     data-modal-escape="true"\n                     data-tooltip-title="Templates">\n                  <div class="select-trigger">\n                    ').concat(a.cI.template||'<svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="10" height="10" rx="1"/><path d="M7 3v10M3 7h10"/></svg>','\n                  </div>\n                </div>\n                <button class="favorite-tool-btn has-svg-icon" data-action="settings" data-tooltip-title="More Settings">\n                  ').concat(a.cI.settings,"\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    "),l='\n      <div id="quickStyleDropdown" class="select-dropdown">\n        <ul class="select-options">\n          <li class="select-option selected" data-value="solid"><span class="select-option-icon">'.concat(a.cI.lineSolid,'</span> Solid</li>\n          <li class="select-option" data-value="dashed"><span class="select-option-icon">').concat(a.cI.lineDashed,'</span> Dashed</li>\n        </ul>\n      </div>\n      <div id="quickWidthDropdown" class="select-dropdown">\n        <ul class="select-options">\n          <li class="select-option selected" data-value="1">1px</li>\n          <li class="select-option" data-value="2">2px</li>\n          <li class="select-option" data-value="3">3px</li>\n          <li class="select-option" data-value="4">4px</li>\n          <li class="select-option" data-value="5">5px</li>\n        </ul>\n      </div>\n      <div id="quickTextSizeDropdown" class="select-dropdown">\n        <ul class="select-options">\n          <li class="select-option" data-value="8">81px</li>\n          <li class="select-option" data-value="10">10px</li>\n          <li class="select-option selected" data-value="12">12px</li>\n          <li class="select-option" data-value="14">14px</li>\n          <li class="select-option" data-value="16">16px</li>\n          <li class="select-option" data-value="18">18px</li>\n          <li class="select-option" data-value="20">20px</li>\n          <li class="select-option" data-value="24">24px</li>\n          <li class="select-option" data-value="28">28px</li>\n          <li class="select-option" data-value="36">36px</li>\n          <li class="select-option" data-value="48">48px</li>\n        </ul>\n      </div>\n      <div id="quickTemplateDropdown" class="select-dropdown no-auto-highlight template-dropdown">\n        <ul class="select-options">\n          <li class="select-option template-action" data-value="save-as">Save as</li>\n          <li class="select-option template-action" data-value="default">Reset to Default</li>\n          <li class="template-divider"></li>\n        </ul>\n      </div>\n    ');document.body.insertAdjacentHTML("beforeend",i),document.body.insertAdjacentHTML("beforeend",l);var r=document.getElementById(t);this.drawingQuickToolbarModal=r;var s=function(){return r._activeUIManager||e};r.addEventListener("click",function(e){var t=e.target.closest(".favorite-tool-btn[data-action]");if(t){e.stopPropagation();var n=t.dataset.action,o=s();if("settings"===n)o.hideDrawingQuickToolbar(),o.showFloatingToolbar(o.floatingToolbarItem);else if("clone"===n||"delete"===n)o.handleFloatingToolbarAction(n),o.hideDrawingQuickToolbar();else if("lock"===n&&o.floatingToolbarItem){o.floatingToolbarItem.locked=!o.floatingToolbarItem.locked;var i=r.querySelector("#quick-lock-btn");i&&(i.innerHTML=o.floatingToolbarItem.locked?a.cI.lock:a.cI.unlock),void 0!==o.floatingToolbarItem.index?o.engine.saveMarkersToStorage():(o.engine.drawingManager.saveToStorage(),o.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{})),o.engine.render()}}});var c=r.querySelector("#quick-color-btn");c._colorPickerCallback=function(e,t){var n=s();if(n.floatingToolbarItem){var a=n.floatingToolbarItem,i=o.s.hexToRgba(e,t);if("plaintext"===a.type)a.backgroundColor=i;else if(["textcomment","pricelabel","callout","note","anchoredtext"].includes(a.type))a.borderColor=e,a.backgroundColor=o.s.hexToRgba(e,20);else if(a.color=i,a.fillColor){var l=o.s.extractOpacity(a.fillColor);a.fillColor=o.s.hexToRgba(e,Math.round(100*l))}var r=c.querySelector(".color-preview");r&&(r.style.background=i),void 0!==a.index?n.engine.saveMarkersToStorage():(n.engine.drawingManager.saveToStorage(),n.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{})),n.engine.render()}},setTimeout(function(){window.initCustomSelects&&window.initCustomSelects(r);var e=document.getElementById("quick-style-btn");e&&e.addEventListener("customSelectChange",function(t){var n=s();if(n.floatingToolbarItem){n.floatingToolbarItem.lineStyle=t.detail.value;var o=e.querySelector(".select-trigger");o&&(o.innerHTML="dashed"===t.detail.value?a.cI.lineDashed:a.cI.lineSolid),void 0!==n.floatingToolbarItem.index?n.engine.saveMarkersToStorage():(n.engine.drawingManager.saveToStorage(),n.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{})),n.engine.render()}});var t=document.getElementById("quick-width-btn");t&&t.addEventListener("customSelectChange",function(e){var n=s();if(n.floatingToolbarItem){var a=parseInt(e.detail.value),o=void 0!==n.floatingToolbarItem.index;o?n.floatingToolbarItem.size=a:n.floatingToolbarItem.lineWidth=a;var i=t.querySelector(".width-preview");i&&(i.textContent=e.detail.value),o?n.engine.saveMarkersToStorage():(n.engine.drawingManager.saveToStorage(),n.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{})),n.engine.render()}});var n=r.querySelector("#quick-text-color-btn");n&&(n._colorPickerCallback=function(e,t){var a=s();if(a.floatingToolbarItem){var i=o.s.hexToRgba(e,t);a.floatingToolbarItem.textColor=i;var l=n.querySelector(".color-preview");l&&(l.style.background=i),void 0!==a.floatingToolbarItem.index?a.engine.saveMarkersToStorage():(a.engine.drawingManager.saveToStorage(),a.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{})),a.engine.render()}});var i=document.getElementById("quick-text-size-btn");i&&i.addEventListener("customSelectChange",function(e){var t=s();if(t.floatingToolbarItem){t.floatingToolbarItem.textSize=parseInt(e.detail.value);var n=i.querySelector(".text-size-preview");n&&(n.textContent=e.detail.value),void 0!==t.floatingToolbarItem.index?t.engine.saveMarkersToStorage():(t.engine.drawingManager.saveToStorage(),t.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{})),t.engine.render()}});var l=document.getElementById("quick-template-btn");l&&l.addEventListener("customSelectChange",function(e){var t=s(),n=e.detail.value;if("save-as"===n)t.openSaveTemplateModal();else if("default"===n)t.applyDefaultSettings();else if(n.startsWith("template-")){var a=n.replace("template-","");t.applyTemplate(a)}})},100)}},showDrawingQuickToolbar:function(e){var t;if(this.drawingQuickToolbarModal){this.floatingToolbarItem=e,this.drawingQuickToolbarModal._activeUIManager=this;var n=this.drawingQuickToolbarModal.querySelector("#quick-color-btn"),i=null==n?void 0:n.querySelector(".color-preview");if(i){var l=e.color||e.borderColor||e.backgroundColor||"#2962ff";(l.startsWith("rgba")||l.startsWith("rgb"))&&(l=o.s.rgbaToHex(l)||l),i.style.background=l}var r=this.drawingQuickToolbarModal.querySelector("#quick-width-btn"),s=null==r?void 0:r.querySelector(".width-preview"),c=void 0!==e.index;s&&(s.textContent=c?e.size||1:e.lineWidth||1);var d=this.drawingQuickToolbarModal.querySelector("#quick-style-btn .select-trigger");d&&(d.innerHTML="dashed"===e.lineStyle?a.cI.lineDashed:a.cI.lineSolid);var u=["plaintext","textcomment","pricelabel","callout","note","anchoredtext","texttable"].includes(e.type),g=this.drawingQuickToolbarModal.querySelector("#quick-color-btn"),p=this.drawingQuickToolbarModal.querySelector("#quick-width-btn"),h=this.drawingQuickToolbarModal.querySelector("#quick-style-btn"),v=this.drawingQuickToolbarModal.querySelector("#quick-text-color-btn"),m=this.drawingQuickToolbarModal.querySelector("#quick-text-size-btn");if(u){g&&(g.style.display=""),p&&(p.style.display="none"),h&&(h.style.display="none"),v&&(v.style.display=""),m&&(m.style.display="");var f=null==v?void 0:v.querySelector(".color-preview");f&&(f.style.background=e.textColor||"#d0d0d0");var b=null==m?void 0:m.querySelector(".text-size-preview");b&&(b.textContent=e.textSize||12)}else g&&(g.style.display=""),p&&(p.style.display=""),h&&(h.style.display=""),v&&(v.style.cssText="display: none !important"),m&&(m.style.cssText="display: none !important");var w=this.drawingQuickToolbarModal.querySelector("#quick-lock-btn");w&&(w.innerHTML=e.locked?a.cI.lock:a.cI.unlock),this.updateQuickTemplateDropdown();var y=null===(t=window.CustomModal)||void 0===t?void 0:t.getOrCreateInstance(this.drawingQuickToolbarModal);y&&y.show()}},hideDrawingQuickToolbar:function(){if(this.drawingQuickToolbarModal){var e,t=null===(e=window.CustomModal)||void 0===e?void 0:e.getInstance(this.drawingQuickToolbarModal);t&&t.hide()}},updateQuickTemplateDropdown:function(){var e=this,t=document.getElementById("quickTemplateDropdown");if(t){var n=this.getDrawingTypeForTemplates(),o=this.getTemplatesForDrawingType(n),i=t.querySelector(".select-options");if(i){var l=i.querySelectorAll(".template-action, .template-divider");i.innerHTML="",l.forEach(function(e){return i.appendChild(e)}),o.length>0&&o.forEach(function(t){var n=document.createElement("li");n.className="select-option template-item",n.dataset.value="template-".concat(t.name),n.innerHTML='\n          <span class="template-name">'.concat(t.name,'</span>\n          <button type="button" class="template-delete-btn" data-template-name="').concat(t.name,'">\n            ').concat(a.cI.trash,"\n          </button>\n        "),i.appendChild(n);var o=n.querySelector(".template-delete-btn");o&&(o.addEventListener("click",function(n){var a;n.stopPropagation(),n.preventDefault(),null===(a=window.CustomSelect)||void 0===a||a.closeAll(),e.showCustomConfirm("Are you sure you want to delete template '".concat(t.name,"'?"),function(){e.deleteDrawingTemplate(t.name),e.updateQuickTemplateDropdown()})}),o.addEventListener("mousedown",function(e){return e.stopPropagation()}))})}}},createSaveTemplateModal:function(){var e=this,t="saveTemplateModal";if(!document.getElementById(t)){var n='\n      <div class="modal" id="'.concat(t,'" tabindex="-1" data-custom-modal="true">\n        <div class="modal-dialog modal-md modal-dialog-centered">\n          <div class="modal-content">\n            <div class="modal-header cm-modal-header">\n              <h5 class="modal-title">Save Template</h5>\n              <span class="custom-modal-close" data-cm-dismiss="custom-modal">\n                <svg width="20" height="20" fill="none" stroke="currentColor"><use href="#x"></use></svg>\n              </span>\n            </div>\n            <div class="modal-body">\n              <div class="save-template-form">\n                <div class="form-group">\n                  <label>Template Name</label>\n                  <input type="text" id="template-name-input" class="form-control" placeholder="Enter template name...">\n                </div>\n                <div class="form-group template-list-group" style="display: none;">\n                  <label>Or select existing to overwrite</label>\n                  <div class="dropdown-select" id="existing-template-select" data-dropdown-id="existingTemplateDropdown" data-modal-escape="true">\n                    <div class="select-trigger">\n                      <span class="select-trigger-text">Select template...</span>\n                      <span class="select-arrow"></span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div class="modal-footer chart-settings-footer">\n              <button class="btn-reset" data-cm-dismiss="custom-modal">Cancel</button>\n              <div class="footer-right">\n                <button class="btn-apply-changes" id="save-template-btn">Save</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- External dropdown for existing templates --\x3e\n      <div id="existingTemplateDropdown" class="select-dropdown">\n        <ul class="select-options">\n          \x3c!-- Populated dynamically --\x3e\n        </ul>\n      </div>\n    ');document.body.insertAdjacentHTML("beforeend",n);var a=document.getElementById(t),o=function(){return a._activeUIManager||e};a.addEventListener("mousedown",function(e){e.stopPropagation()});var i=document.getElementById("save-template-btn");i&&i.addEventListener("click",function(e){e.stopPropagation(),o().saveCurrentTemplate()});var l=document.getElementById("template-name-input");l&&(l.addEventListener("keydown",function(e){"Enter"===e.key&&(e.stopPropagation(),o().saveCurrentTemplate())}),l.addEventListener("mousedown",function(e){return e.stopPropagation()}),l.addEventListener("click",function(e){return e.stopPropagation()}));var r=document.getElementById("existing-template-select");r&&r.addEventListener("customSelectChange",function(e){e.stopPropagation();var t=e.detail.value;t&&l&&(l.value=t)}),setTimeout(function(){window.initCustomSelects&&window.initCustomSelects(a)},100)}},openSaveTemplateModal:function(){var e=document.getElementById("saveTemplateModal");if(e&&window.CustomModal){e._activeUIManager=this;var t=document.getElementById("template-name-input");t&&(t.value=""),this.populateExistingTemplatesDropdown(),window.CustomModal.getOrCreateInstance(e).show(),setTimeout(function(){return null==t?void 0:t.focus()},150)}},populateExistingTemplatesDropdown:function(){var e=document.getElementById("existingTemplateDropdown"),t=document.querySelector(".template-list-group"),n=document.getElementById("existing-template-select");if(e&&t){var a=this.getDrawingTypeForTemplates(),o=this.getTemplatesForDrawingType(a);if(0!==o.length){t.style.display="";var i=e.querySelector(".select-options");if(i&&(i.innerHTML=o.map(function(e,t){return'\n        <li class="select-option'.concat(0===t?" selected":"",'" data-value="').concat(e.name,'">').concat(e.name,"</li>\n      ")}).join("")),n){var l=n.querySelector(".select-trigger-text");l&&(l.textContent="Select template..."),n.customSelectAPI&&n.customSelectAPI.refresh&&n.customSelectAPI.refresh()}}else t.style.display="none"}},getDrawingTypeForTemplates:function(){return this.floatingToolbarItem&&this.floatingToolbarItem.type||"default"},getTemplatesForDrawingType:function(e){try{return JSON.parse(localStorage.getItem("drawingTemplates")||"{}")[e]||[]}catch(t){return[]}},saveCurrentTemplate:function(){var e,t=document.getElementById("template-name-input"),n=null==t||null===(e=t.value)||void 0===e?void 0:e.trim();if(n){if(this.floatingToolbarItem){var a=this.getDrawingTypeForTemplates(),o=this.extractTemplateData(),i={};try{i=JSON.parse(localStorage.getItem("drawingTemplates")||"{}")}catch(s){i={}}i[a]||(i[a]=[]);var l=i[a].findIndex(function(e){return e.name===n});l>=0?i[a][l]={name:n,data:o}:i[a].push({name:n,data:o}),localStorage.setItem("drawingTemplates",JSON.stringify(i));var r=document.getElementById("saveTemplateModal");r&&window.CustomModal&&window.CustomModal.getOrCreateInstance(r).hide(),this.updateTemplateDropdown()}}else null==t||t.focus()},extractTemplateData:function(){var e=this.floatingToolbarItem;return e?{color:e.color,lineWidth:e.lineWidth,lineStyle:e.lineStyle,tooltipMode:e.tooltipMode,layer:e.layer,text:e.text||"",textColor:e.textColor,textSize:e.textSize,textPosition:e.textPosition,showPriceLabels:e.showPriceLabels,showPercentLabels:e.showPercentLabels,extendLines:e.extendLines,showProjections:e.showProjections}:{}},applyTemplate:function(e){var t=this;if(this.floatingToolbarItem){var n=this.getDrawingTypeForTemplates(),a=this.getTemplatesForDrawingType(n).find(function(t){return t.name===e});if(a){var o=a.data;Object.keys(o).forEach(function(e){void 0!==o[e]&&(t.floatingToolbarItem[e]=o[e])}),this.refreshFloatingToolbarUI(),void 0!==this.floatingToolbarItem.index?this.engine.saveMarkersToStorage():(this.engine.drawingManager.saveToStorage(),this.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{})),this.engine.render()}}},applyDefaultSettings:function(){var e=this;if(this.floatingToolbarItem){var t=this.floatingToolbarItem.type,n=void 0!==this.floatingToolbarItem.index,a={color:"#2962ff",lineWidth:2,lineStyle:"solid",tooltipMode:"auto",layer:"front",text:"",textColor:"plaintext"===t?"#999999":"#ffffff",textSize:12,textPosition:"above-center"};n&&(a.size=1),Object.keys(a).forEach(function(t){e.floatingToolbarItem[t]=a[t]}),this.refreshFloatingToolbarUI(),void 0!==this.floatingToolbarItem.index?this.engine.saveMarkersToStorage():(this.engine.drawingManager.saveToStorage(),this.engine.drawingManager.syncDrawingToOtherCharts("reload-storage",{})),this.engine.render()}},refreshFloatingToolbarUI:function(){var e,t;this.floatingToolbarItem&&(null!==(e=this.drawingQuickToolbarModal)&&void 0!==e&&e.classList.contains("show")&&this.updateQuickToolbarUI(),null!==(t=this.floatingToolbar)&&void 0!==t&&t.classList.contains("show")&&this.engine.uiManager&&this.engine.uiManager.showFloatingToolbar&&this.engine.uiManager.showFloatingToolbar(this.floatingToolbarItem))},updateQuickToolbarUI:function(){if(this.drawingQuickToolbarModal&&this.floatingToolbarItem){var e=this.floatingToolbarItem,t=this.drawingQuickToolbarModal.querySelector("#quick-color-btn"),n=null==t?void 0:t.querySelector(".color-preview");if(n){var i=e.color||e.borderColor||e.backgroundColor||"#2962ff";(i.startsWith("rgba")||i.startsWith("rgb"))&&(i=o.s.rgbaToHex(i)||i),n.style.background=i}var l=this.drawingQuickToolbarModal.querySelector("#quick-width-btn"),r=null==l?void 0:l.querySelector(".width-preview"),s=void 0!==e.index;r&&(r.textContent=s?e.size||1:e.lineWidth||1);var c=this.drawingQuickToolbarModal.querySelector("#quick-style-btn .select-trigger");c&&(c.innerHTML="dashed"===e.lineStyle?a.cI.lineDashed:a.cI.lineSolid);var d=this.drawingQuickToolbarModal.querySelector("#quick-lock-btn");d&&(d.innerHTML=e.locked?a.cI.lock:a.cI.unlock)}},updateTemplateDropdown:function(){var e=this,t=document.getElementById("floatingTemplateDropdown");if(t){var n=this.getDrawingTypeForTemplates(),o=this.getTemplatesForDrawingType(n),i=t.querySelector(".select-options");if(i){var l=i.querySelectorAll(".template-action, .template-divider");i.innerHTML="",l.forEach(function(e){return i.appendChild(e)}),o.length>0&&o.forEach(function(t){var n=document.createElement("li");n.className="select-option template-item",n.dataset.value="template-".concat(t.name),n.innerHTML='\n          <span class="template-name">'.concat(t.name,'</span>\n          <button type="button" class="template-delete-btn" data-template-name="').concat(t.name,'">\n            ').concat(a.cI.trash,"\n          </button>\n        "),i.appendChild(n);var o=n.querySelector(".template-delete-btn");o&&(o.addEventListener("click",function(n){var a;n.stopPropagation(),n.preventDefault(),null===(a=window.CustomSelect)||void 0===a||a.closeAll(),e.showCustomConfirm("Are you sure you want to delete template '".concat(t.name,"'?"),function(){e.deleteDrawingTemplate(t.name)})}),o.addEventListener("mousedown",function(e){return e.stopPropagation()}))}),this.updateQuickTemplateDropdown()}}},deleteDrawingTemplate:function(e){var t;null===(t=window.CustomSelect)||void 0===t||t.closeAll();var n=this.getDrawingTypeForTemplates(),a={};try{a=JSON.parse(localStorage.getItem("drawingTemplates")||"{}")}catch(o){return}a[n]&&(a[n]=a[n].filter(function(t){return t.name!==e}),localStorage.setItem("drawingTemplates",JSON.stringify(a))),this.updateTemplateDropdown(),this.updateQuickTemplateDropdown()},addEmojiItems:function(e){var t=this;l.A.forEach(function(n){var a=document.createElement("div");a.className="emoji-category-header",a.textContent=n.category,e.appendChild(a);var o=document.createElement("div");o.className="emoji-grid",n.emojis.forEach(function(e){var n=document.createElement("button");n.className="emoji-btn",n.textContent=e.emoji,n.title=e.emoji,n.style.color=e.color,n.addEventListener("click",function(){t.selectedMarkerType=e.type,t.selectedMarkerColor=e.color,t.selectedEmoji=e.emoji,t.engine.drawingManager.setTool("marker");var n=t.sidebar.querySelector('.sidebar-tool-btn-wrapper[data-type="emojis"]');if(t.sidebar.querySelectorAll(".sidebar-tool-btn-wrapper, .sidebar-tool-btn").forEach(function(e){return e.classList.remove("active")}),n){n.classList.add("active");var a=n.querySelector(".sidebar-tool-icon-btn");a&&(a.textContent=e.emoji)}if(t.hideAllSidebarDropdowns(),t.engine.multiChartManager){var o,i=null===(o=t.engine.container)||void 0===o?void 0:o.id;t.engine.multiChartManager.syncEmojiSelection(i,{emoji:e.emoji,type:e.type,color:e.color})}}),o.appendChild(n)}),e.appendChild(o)})},makeReplayControlBarDraggable:function(e,t){var n,a,o,i,l=this,r=!1,s=function(e){return e.touches&&e.touches.length>0?{clientX:e.touches[0].clientX,clientY:e.touches[0].clientY}:{clientX:e.clientX,clientY:e.clientY}},c=function(c){if(c.target===t){var d=s(c),u=d.clientX,g=d.clientY,p=l.engine.container.getBoundingClientRect();n=e.offsetLeft,a=e.offsetTop,o=u-p.left-n,i=g-p.top-a,r=!0,e.classList.add("dragging"),e.style.transform="none"}},d=function(t){if(r){t.preventDefault();var c=s(t),d=c.clientX,u=c.clientY,g=l.engine.container.getBoundingClientRect();n=d-g.left-o,a=u-g.top-i;var p=e.offsetWidth,h=e.offsetHeight,v=Math.max(8,g.width-p-8),m=Math.max(8,g.height-h-8);n=Math.max(8,Math.min(n,v)),a=Math.max(8,Math.min(a,m)),e.style.left=n+"px",e.style.top=a+"px"}},u=function(t){r&&(r=!1,e.classList.remove("dragging"))};t.addEventListener("mousedown",c),document.addEventListener("mousemove",d),document.addEventListener("mouseup",u),t.addEventListener("touchstart",c,{passive:!1}),document.addEventListener("touchmove",d,{passive:!1}),document.addEventListener("touchend",u)},validateReplayBarPosition:function(){if(this.replayControlBar){var e=this.engine.container.getBoundingClientRect(),t="none"===this.replayControlBar.style.display;t&&(this.replayControlBar.style.visibility="hidden",this.replayControlBar.style.display="flex");var n=this.replayControlBar.offsetWidth||280,a=this.replayControlBar.offsetHeight||100;t&&(this.replayControlBar.style.display="none",this.replayControlBar.style.visibility="");var o=Math.max(8,(e.width-n)/2),i=Math.max(8,e.height-a-50);this.replayControlBar.style.top=i+"px",this.replayControlBar.style.left=o+"px",this.replayControlBar.style.bottom="auto",this.replayControlBar.style.right="auto",this.replayControlBar.style.transform="none"}},makeProgressBarDraggable:function(e){var t=this,n=!1,a=function(n){var a=e.getBoundingClientRect(),o=(n.type.startsWith("touch")?n.touches[0].clientX:n.clientX)-a.left,i=Math.max(0,Math.min(1,o/a.width)),l=Math.floor(t.engine.replayManager.replayStartIndex+(t.engine.replayManager.replayEndIndex-t.engine.replayManager.replayStartIndex)*i);t.engine.replayManager.seekToIndex(l)},o=function(t){t.preventDefault(),n=!0,e.style.cursor="grabbing",a(t)},i=function(e){n&&(e.preventDefault(),a(e))},l=function(t){n&&(n=!1,e.style.cursor="pointer")};e.addEventListener("mousedown",o),document.addEventListener("mousemove",i),document.addEventListener("mouseup",l),e.addEventListener("touchstart",o,{passive:!1}),document.addEventListener("touchmove",i,{passive:!1}),document.addEventListener("touchend",l)},createChartSettingsMenu:function(){var e=this;this.chartSettingsMenu=document.createElement("div"),this.chartSettingsMenu.className="chart-settings-menu";var t=document.createElement("div");t.className="chart-settings-item";var n=this.engine.themeManager.currentTheme;t.innerHTML='<span class="icon">'.concat("dark"===n?"":"","</span> ").concat("dark"===n?"Light Mode":"Dark Mode"),t.addEventListener("click",function(){var n="dark"===e.engine.themeManager.currentTheme?"light":"dark";e.engine.setTheme(n),t.innerHTML='<span class="icon">'.concat("dark"===n?"":"","</span> ").concat("dark"===n?"Light Mode":"Dark Mode"),e.hideChartSettingsMenu()}),this.themeMenuItem=t;var o=document.createElement("div");o.className="chart-settings-item",o.innerHTML='<span class="icon"></span> Reset Zoom',o.addEventListener("click",function(){e.resetChartZoom(),e.hideChartSettingsMenu()});var i=document.createElement("div");i.className="chart-settings-item",i.setAttribute("data-cm-toggle","custom-modal"),i.setAttribute("data-cm-target","#chartSettingsModal"),i.innerHTML='<span class="icon">'.concat(a.cI.settings,'</span> Settings <span class="arrow"></span>'),i.addEventListener("click",function(){var t,n,a;e.hideChartSettingsMenu(),null===(t=e.chartSettingsModalManager)||void 0===t||t.storeOriginalSettings(),null===(n=e.chartSettingsModalManager)||void 0===n||n.populateChartColors(),null===(a=e.chartSettingsModalManager)||void 0===a||a.populateSettings()});var l=document.createElement("div");l.className="chart-settings-item danger",l.innerHTML='<span class="icon">'.concat(a.cI.warning,"</span> Factory Reset"),l.addEventListener("click",function(){e.confirmFactoryReset()}),this.chartSettingsMenu.appendChild(t),this.chartSettingsMenu.appendChild(o),this.chartSettingsMenu.appendChild(i),this.chartSettingsMenu.appendChild(l),document.addEventListener("click",function(t){e.chartSettingsMenu&&e.chartSettingsMenu.classList.contains("visible")&&!e.chartSettingsMenu.contains(t.target)&&t.target!==e.topToolbarSettingsBtn&&e.hideChartSettingsMenu()}),this.engine.wrapperDiv.appendChild(this.chartSettingsMenu)},toggleChartSettingsMenu:function(){this.chartSettingsMenu.classList.contains("visible")?this.hideChartSettingsMenu():this.showChartSettingsMenu()},showChartSettingsMenu:function(){if(this.floatingToolbarVisible&&this.hideFloatingToolbar(),this.closeAllDropdowns(),this.topToolbarSettingsBtn){var e=this.topToolbarSettingsBtn.getBoundingClientRect();this.chartSettingsMenu.style.position="fixed",this.chartSettingsMenu.style.top=e.bottom+5+"px",this.chartSettingsMenu.style.right="10px",this.chartSettingsMenu.style.bottom="auto"}this.chartSettingsMenu.classList.add("visible")},hideChartSettingsMenu:function(){this.chartSettingsMenu.classList.remove("visible")},createRenkoSettingsModal:function(){var e="renkoSettingsModal";if(!document.getElementById(e)){var t='\n      <div class="modal" id="'.concat(e,'" tabindex="-1" data-custom-modal="true" data-cm-draggable="true">\n        <div class="modal-dialog modal-sm modal-dialog-centered">\n          <div class="modal-content">\n            <div class="modal-header cm-modal-header" data-cm-drag-handle>\n              <h5 class="modal-title">Renko Settings</h5>\n              <span class="custom-modal-close" data-cm-dismiss="custom-modal">\n                <svg width="22" height="22" fill="none" stroke="currentColor"><use href="#x"></use></svg>\n              </span>\n            </div>\n            <div class="modal-body renko-settings-body">\n              <div class="settings-field">\n                <label>Box Size Method</label>\n                <div class="dropdown-select renko-method-select" id="renko-method" data-dropdown-id="renkoMethodDropdown">\n                  <div class="select-trigger" tabindex="0">\n                    <span class="select-trigger-text">ATR (Average True Range)</span>\n                    <svg width="18" height="18" class="select-arrow" fill="none" stroke="currentColor">\n                      <use href="#chevron-down"></use>\n                    </svg>\n                  </div>\n                </div>\n              </div>\n\n              <div class="settings-field" id="renko-atr-group">\n                <label>ATR Period</label>\n                <input type="number" id="renko-atr-period" value="14" min="1" max="100">\n              </div>\n\n              <div class="settings-field" id="renko-boxsize-group" style="display: none;">\n                <label>Box Size</label>\n                <input type="number" id="renko-box-size" value="100" min="0.00001" step="any">\n                <small class="settings-hint">Fixed price movement per brick</small>\n              </div>\n\n              <div class="settings-field" id="renko-percentage-group" style="display: none;">\n                <label>Percentage (%)</label>\n                <input type="number" id="renko-percentage" value="1" min="0.01" max="100" step="0.01">\n                <small class="settings-hint">% of last close price</small>\n              </div>\n\n              <div class="settings-field checkbox-field">\n                <label>\n                  <input type="checkbox" id="renko-show-wicks">\n                  <span>Show Wicks</span>\n                </label>\n                <small class="settings-hint">Display actual high/low on bricks</small>\n              </div>\n\n              <div class="renko-boxsize-info" id="renko-current-boxsize">\n                <label>Current Box Size: <span id="renko-boxsize-display">--</span></label>\n              </div>\n            </div>\n            <div class="modal-footer">\n              <button class="btn-cancel" data-cm-dismiss="custom-modal">Cancel</button>\n              <button class="btn-apply-changes" id="renko-apply-btn">Ok</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    ');document.body.insertAdjacentHTML("beforeend",'\n      <div id="renkoMethodDropdown" class="select-dropdown">\n        <ul class="select-options">\n          <li class="select-option selected" data-value="atr">ATR (Average True Range)</li>\n          <li class="select-option" data-value="traditional">Traditional (Fixed)</li>\n          <li class="select-option" data-value="percentage">Percentage</li>\n        </ul>\n      </div>\n    '),document.body.insertAdjacentHTML("beforeend",t);var n=document.getElementById(e),a=n.querySelector("#renko-method");a&&new S.A(a),this.setupRenkoModalEvents(n)}},setupRenkoModalEvents:function(e){var t=this,n=e.querySelector("#renko-method"),a=e.querySelector("#renko-atr-group"),o=e.querySelector("#renko-boxsize-group"),i=e.querySelector("#renko-percentage-group"),l=e.querySelector("#renko-atr-period"),r=e.querySelector("#renko-box-size"),s=e.querySelector("#renko-percentage"),c=e.querySelector("#renko-show-wicks"),d=e.querySelector("#renko-apply-btn"),u=e.querySelector("#renko-boxsize-display"),g=function(){var e;return(null===(e=n.customSelectAPI)||void 0===e?void 0:e.getValue())||"atr"},p=function(){var e={method:g(),atrPeriod:parseInt(l.value)||14,boxSize:parseFloat(r.value)||100,percentage:parseFloat(s.value)||1,showWicks:c.checked};t.engine.setRenkoSettings(e);var n=t.engine.renkoBoxSize||t.calculateRenkoBoxSize(e);n&&u&&(u.textContent=n.toFixed(t.engine.getDecimalPlaces()))};n.addEventListener("customSelectChange",function(e){var t,n=(null===(t=e.detail)||void 0===t?void 0:t.value)||g();a.style.display="atr"===n?"block":"none",o.style.display="traditional"===n?"block":"none",i.style.display="percentage"===n?"block":"none",p()}),l.addEventListener("input",p),r.addEventListener("input",p),s.addEventListener("input",p),c.addEventListener("change",p),e.addEventListener("show.cm.modal",function(){t.populateRenkoSettings(e)}),e.addEventListener("hide.cm.modal",function(){var e={method:g(),atrPeriod:parseInt(l.value)||14,boxSize:parseFloat(r.value)||100,percentage:parseFloat(s.value)||1,showWicks:c.checked};t.saveChartSettings({renkoSettings:e})}),d.addEventListener("click",function(){t.hideRenkoSettings()})},populateRenkoSettings:function(e){var t=this.engine.renkoSettings,n=e.querySelector("#renko-method"),a=e.querySelector("#renko-atr-period"),o=e.querySelector("#renko-box-size"),i=e.querySelector("#renko-percentage"),l=e.querySelector("#renko-show-wicks"),r=e.querySelector("#renko-boxsize-display"),s=t.method||"atr";n.customSelectAPI&&n.customSelectAPI.setValue(s),a.value=t.atrPeriod||14,o.value=t.boxSize||this.engine.renkoBoxSize||100,i.value=t.percentage||1,l.checked=this.engine.renkoShowWicks||!1;var c=this.engine.renkoBoxSize||this.calculateRenkoBoxSize(t);r.textContent=c?c.toFixed(this.engine.getDecimalPlaces()):"--";var d=e.querySelector("#renko-atr-group"),u=e.querySelector("#renko-boxsize-group"),g=e.querySelector("#renko-percentage-group");d.style.display="atr"===s?"block":"none",u.style.display="traditional"===s?"block":"none",g.style.display="percentage"===s?"block":"none"},calculateRenkoBoxSize:function(e){var t=this.engine.data;if(!t||t.length<2)return null;var n=t.length,a=this.engine.minmove/this.engine.PRICESCALE,o=0;switch(e.method){case"traditional":if((o=e.boxSize||0)<=0)o=t[n-1].close/20;break;case"percentage":o=t[n-1].close*(e.percentage/100);break;default:var i=e.atrPeriod||14,l=0;if(n>i){for(var r=1;r<=i;r++){var s=t[r-1],c=t[r];l+=Math.max(c.high-c.low,Math.abs(c.high-s.close),Math.abs(c.low-s.close))}l/=i;for(var d=i+1;d<n;d++){var u=t[d-1],g=t[d];l=(l*(i-1)+Math.max(g.high-g.low,Math.abs(g.high-u.close),Math.abs(g.low-u.close)))/i}}else{for(var p=1;p<n;p++)l+=t[p].high-t[p].low;l/=n-1}o=l}return o<=0?null:(a>0&&(o=Math.round(o/a)*a)<a&&(o=a),o)},showRenkoSettings:function(){this.createRenkoSettingsModal();var e=document.getElementById("renkoSettingsModal");e&&window.CustomModal&&window.CustomModal.getOrCreateInstance(e).show()},hideRenkoSettings:function(){var e=document.getElementById("renkoSettingsModal");e&&window.CustomModal&&window.CustomModal.getOrCreateInstance(e).hide()},applyRenkoSettings:function(e){if(e||(e=document.getElementById("renkoSettingsModal")),e){var t=e.querySelector("#renko-method"),n=e.querySelector("#renko-atr-period"),a=e.querySelector("#renko-box-size"),o=e.querySelector("#renko-percentage"),i=e.querySelector("#renko-show-wicks"),l={method:t.value,atrPeriod:parseInt(n.value)||14,boxSize:parseFloat(a.value)||100,percentage:parseFloat(o.value)||1,showWicks:i.checked};this.engine.setRenkoSettings(l),this.saveChartSettings({renkoSettings:l}),this.hideRenkoSettings()}},showCustomAlert:function(e,t){var n="customAlertModal",a=document.getElementById(n);if(!a){var o='\n        <div class="modal" id="'.concat(n,'" tabindex="-1" data-custom-modal="true" data-cm-compact="true" >\n          <div class="modal-dialog modal-sm modal-dialog-centered">\n            <div class="modal-content">\n              <div class="modal-body">\n                <div class="custom-dialog-message alert-modal-message"></div>\n              </div>\n              <div class="modal-footer">\n                <button class="btn-apply-changes alert-modal-ok">OK</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      ');document.body.insertAdjacentHTML("beforeend",o),a=document.getElementById(n)}a.querySelector(".alert-modal-message").innerHTML=e.replace(/\n/g,"<br>"),a._alertCallback=t;var i=window.CustomModal.getOrCreateInstance(a),l=a.querySelector(".alert-modal-ok"),r=l.cloneNode(!0);l.parentNode.replaceChild(r,l),r.addEventListener("click",function(){i.hide(),a._alertCallback&&a._alertCallback()}),i.show(),setTimeout(function(){return r.focus()},100)},showChartError:function(e){var t=this.engine.chartArea;if(t){this.hideChartError();var n=e.toLowerCase(),a=n.includes("timeframe")||n.includes("period")||n.includes("interval"),o=document.createElement("div");o.className="chart-error-overlay",o.id="chartErrorOverlay_".concat(this.chartId);var i=document.createElement("div");i.className="chart-error-content";var l=document.createElement("div");l.className="chart-error-icon",l.innerHTML='<svg width="200" height="200" fill="none" stroke="none"><use href="#magnifier-char"></use></svg>';var r=document.createElement("div");if(r.className="chart-error-message",r.innerHTML=a?'\n        <span class="chart-error-title">Invalid Timeframe</span>\n        <span class="chart-error-subtitle">This timeframe is not available for this symbol. Please select another one.</span>\n      ':'\n        <span class="chart-error-title">Invalid Symbol</span>\n        <span class="chart-error-subtitle">This symbol is not available. Please select another one.</span>\n      ',i.appendChild(l),i.appendChild(r),!a){var s=document.createElement("button");s.className="chart-error-btn",s.innerHTML='\n        <svg width="20" height="20" fill="none" stroke="currentColor"><use href="#search"></use></svg>\n        <span>Change Symbol</span>\n      ',s.addEventListener("click",function(){var e=document.getElementById("chartSearchModal");e&&window.CustomModal&&window.CustomModal.getOrCreateInstance(e).show()}),i.appendChild(s)}o.appendChild(i),t.appendChild(o)}},hideChartError:function(){var e=document.getElementById("chartErrorOverlay_".concat(this.chartId));e&&e.remove()},showCustomConfirm:function(e,t,n){var a="customConfirmModal",o=document.getElementById(a);if(!o){var i='\n        <div class="modal" id="'.concat(a,'" tabindex="-1" data-custom-modal="true" data-cm-compact="true">\n          <div class="modal-dialog modal-md modal-dialog-centered">\n            <div class="modal-content">\n              <div class="modal-header cm-modal-header">\n                <h5 class="modal-title">Confirmation</h5>\n                <span class="custom-modal-close" data-cm-dismiss="custom-modal">\n                  <svg width="20" height="20" fill="none" stroke="currentColor"><use href="#x"></use></svg>\n                </span>\n              </div>\n              <div class="modal-body">\n                <div class="custom-dialog-message confirm-modal-message"></div>\n              </div>\n              <div class="modal-footer">\n                <button class="btn-cancel" data-cm-dismiss="custom-modal">Cancel</button>\n                <button class="btn-apply-changes confirm-modal-confirm">Confirm</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      ');document.body.insertAdjacentHTML("beforeend",i),o=document.getElementById(a)}o.querySelector(".confirm-modal-message").innerHTML=e.replace(/\n/g,"<br>"),o._confirmCallback=t,o._cancelCallback=n;var l=window.CustomModal.getOrCreateInstance(o),r=o.querySelector(".confirm-modal-confirm"),s=r.cloneNode(!0);r.parentNode.replaceChild(s,r),s.addEventListener("click",function(){l.hide(),o._confirmCallback&&o._confirmCallback()});var c=function(){o._cancelCallback&&!o._confirmed&&o._cancelCallback(),o._confirmed=!1,o.removeEventListener("hidden.cm.modal",c)};o._confirmed=!1,s.addEventListener("click",function(){o._confirmed=!0}),o.addEventListener("hidden.cm.modal",c),l.show(),setTimeout(function(){return s.focus()},100)},showCustomPrompt:function(e,t,n,a){var o=this,i="customPromptModal",l=document.getElementById(i);if(!l){var r='\n        <div class="modal" id="'.concat(i,'" tabindex="-1" data-custom-modal="true">\n          <div class="modal-dialog modal-md modal-dialog-centered">\n            <div class="modal-content">\n              <div class="modal-header cm-modal-header">\n                <h5 class="modal-title prompt-modal-title"></h5>\n                <span class="custom-modal-close" data-cm-dismiss="custom-modal">\n                  <svg width="22" height="22" fill="none" stroke="currentColor"><use href="#x"></use></svg>\n                </span>\n              </div>\n              <div class="modal-body">\n                <div class="settings-field">\n                  <input type="text" class="prompt-modal-input" placeholder="Enter name..." />\n                </div>\n              </div>\n              <div class="modal-footer">\n                <button class="btn-cancel" data-cm-dismiss="custom-modal">Cancel</button>\n                <button class="btn-apply-changes prompt-modal-confirm">Save</button>\n              </div>\n            </div>\n          </div>\n        </div>\n      ');document.body.insertAdjacentHTML("beforeend",r),l=document.getElementById(i)}var s=l.querySelector(".prompt-modal-title"),c=l.querySelector(".prompt-modal-input"),d=l.querySelector(".prompt-modal-confirm");s.textContent=e,c.value=t||"",this._promptCallbacks={onConfirm:n,onCancel:a};var u=d.cloneNode(!0);d.parentNode.replaceChild(u,d);var g=c.cloneNode(!0);g.value=t||"",c.parentNode.replaceChild(g,c),u.addEventListener("click",function(){var e,t=g.value.trim();window.CustomModal&&window.CustomModal.getOrCreateInstance(l).hide(),null!==(e=o._promptCallbacks)&&void 0!==e&&e.onConfirm&&o._promptCallbacks.onConfirm(t)}),g.addEventListener("keydown",function(e){if("Enter"===e.key){var t;e.preventDefault();var n=g.value.trim();window.CustomModal&&window.CustomModal.getOrCreateInstance(l).hide(),null!==(t=o._promptCallbacks)&&void 0!==t&&t.onConfirm&&o._promptCallbacks.onConfirm(n)}});var p=function(){var e;l.removeEventListener("hidden.cm.modal",p),null!==(e=o._promptCallbacks)&&void 0!==e&&e.onCancel&&!o._promptConfirmed&&o._promptCallbacks.onCancel(),o._promptConfirmed=!1};l.addEventListener("hidden.cm.modal",p),l.addEventListener("shown.cm.modal",function(){g.focus(),g.select()},{once:!0}),window.CustomModal&&window.CustomModal.getOrCreateInstance(l).show(),setTimeout(function(){g.focus(),g.select()},150)},saveNewTemplate:function(e){var t=this;this.templates[e]=this.getCurrentSettings(),this.currentTemplate=e,this.hasUnsavedChanges=!1,this.saveTemplates();var n=this.engine.multiChartManager;n&&(n.saveLayoutToStorage&&n.saveLayoutToStorage(),n.saveAllChartStates&&n.saveAllChartStates()),this.updateTemplateButton(),this.updateTemplateDropdownMenu(this.templateDropdown),n&&n.chartInstances.length>1&&n.chartInstances.forEach(function(e){var n,a=null===(n=e.engine)||void 0===n?void 0:n.uiManager;a&&a!==t&&(a.templates=t.templates,a.templateDropdown&&a.updateTemplateDropdownMenu(a.templateDropdown))})},downloadCurrentTemplate:function(){var e=this.getCurrentSettings(),t={name:this.currentTemplate,version:"1.0",createdAt:(new Date).toISOString(),settings:e},n=JSON.stringify(t,null,2),a=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(a),i=document.createElement("a");i.href=o,i.download="".concat(this.currentTemplate.replace(/[^a-z0-9]/gi,"_").toLowerCase(),"_template.json"),this.engine.wrapperDiv.appendChild(i),i.click(),this.engine.wrapperDiv.removeChild(i),URL.revokeObjectURL(o)},uploadTemplate:function(){var e=this,t=document.createElement("input");t.type="file",t.accept=".json",t.style.display="none",t.addEventListener("change",function(){var n=q(E().m(function n(a){var o,i,l,r;return E().w(function(n){for(;;)switch(n.p=n.n){case 0:if(o=a.target.files[0]){n.n=1;break}return n.a(2);case 1:return n.p=1,n.n=2,o.text();case 2:if(i=n.v,(l=JSON.parse(i)).settings){n.n=3;break}return e.showCustomAlert("Invalid template file: missing settings data"),n.a(2);case 3:r=l.name||o.name.replace(".json","").replace(/_/g," "),e.showCustomPrompt("Enter template name:",r,function(){var t=q(E().m(function t(n){return E().w(function(t){for(;;)switch(t.n){case 0:if(!n){t.n=2;break}if(!e.templates[n]){t.n=1;break}e.showCustomConfirm('Template "'.concat(n,'" already exists. Overwrite?'),q(E().m(function t(){return E().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,e.importTemplate(n,l.settings);case 1:return t.a(2)}},t)}))),t.n=2;break;case 1:return t.n=2,e.importTemplate(n,l.settings);case 2:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()),n.n=5;break;case 4:n.p=4,n.v,e.showCustomAlert("Failed to load template file. Please ensure it is a valid JSON file.");case 5:document.body.removeChild(t);case 6:return n.a(2)}},n,null,[[1,4]])}));return function(e){return n.apply(this,arguments)}}()),this.engine.wrapperDiv.appendChild(t),t.click()},importTemplate:function(e,t){var n=this;return q(E().m(function a(){return E().w(function(a){for(;;)switch(a.n){case 0:return n.templates[e]=t,n.saveTemplates(),a.n=1,n.applyTemplateSettings(t);case 1:n.currentTemplate=e,n.hasUnsavedChanges=!1,n.updateTemplateButton(),n.updateTemplateDropdownMenu(n.templateDropdown);case 2:return a.a(2)}},a)}))()},deleteTemplate:function(e){var t=this;this.showCustomConfirm("Are you sure you want to delete layout: '".concat(e,"?'"),function(){delete t.templates[e],t.saveTemplates(),t.currentTemplate===e&&(t.currentTemplate="Default",t.updateTemplateButton()),t.updateTemplateDropdownMenu(t.templateDropdown)})},markTemplateUnsaved:function(){this.isLoadingTemplate||(this.templateAutoSave&&this.currentTemplate&&"Default"!==this.currentTemplate&&"Custom"!==this.currentTemplate?this.autoSaveTemplate():(this.hasUnsavedChanges=!0,this.updateTemplateButton()))},createComprehensiveSettingsDialog:function(){this.createChartSettingsModal()},showComprehensiveSettings:function(){var e;this.chartSettingsModalManager||this.createChartSettingsModal(),this.hideChartSettingsMenu(),null===(e=this.chartSettingsModalManager)||void 0===e||e.show()},populateColorField:function(){},populatePriceLabelColor:function(){},previewComprehensiveSettings:function(){var e;null===(e=this.chartSettingsModalManager)||void 0===e||e.previewSettings()},gatherComprehensiveSettings:function(){var e;return(null===(e=this.chartSettingsModalManager)||void 0===e?void 0:e.gatherSettings())||{}},resetToDefaultSettings:function(){var e;null===(e=this.chartSettingsModalManager)||void 0===e||e.resetToDefault()},applySettingsToEngine:function(e){var t=this.engine.themeManager.getCurrentTheme();"backgroundColor"in e&&(null!==e.backgroundColor?this.engine.themeManager.setUserBackgroundColor(e.backgroundColor):this.engine.themeManager.clearUserBackgroundColor(),t.background=e.backgroundColor),"gridColor"in e&&(t.gridColor=e.gridColor||this.engine.themeManager.getDefaultTheme().gridColor),"textColor"in e&&(t.textColor=e.textColor||this.engine.themeManager.getDefaultTheme().textColor),"crosshairColor"in e&&(t.crosshairColor=e.crosshairColor||this.engine.themeManager.getDefaultTheme().crosshairColor);if(e.backgroundColor){var n=function(e,t){if(!e)return null;var n,a,o;if(e.startsWith("rgba")||e.startsWith("rgb")){var i=e.match(/(\d+),\s*(\d+),\s*(\d+)/);i&&(n=parseInt(i[1]),a=parseInt(i[2]),o=parseInt(i[3]))}else e.startsWith("#")&&(n=parseInt(e.substr(1,2),16),a=parseInt(e.substr(3,2),16),o=parseInt(e.substr(5,2),16));return void 0!==n?"rgba(".concat(n,", ").concat(a,", ").concat(o,", ").concat(t,")"):e}(e.backgroundColor,.5),a=function(e){if(!e)return!1;var t,n,a;if(e.startsWith("rgba")||e.startsWith("rgb")){var o=e.match(/(\d+),\s*(\d+),\s*(\d+)/);o&&(t=parseInt(o[1]),n=parseInt(o[2]),a=parseInt(o[3]))}else e.startsWith("#")&&(t=parseInt(e.substr(1,2),16),n=parseInt(e.substr(3,2),16),a=parseInt(e.substr(5,2),16));return void 0!==t&&(299*t+587*n+114*a)/1e3>128}(e.backgroundColor)?"#0F172A":"#f1f1f1";this.overlayBgColor=n,this.overlayTextColor=a,this.engine.themeManager.setOverlayColors(n,a)}else"backgroundColor"in e&&null===e.backgroundColor&&(this.overlayBgColor=null,this.overlayTextColor=null,this.engine.themeManager.clearOverlayColors());if(e.chartColors){var o=this.engine.chartType,i=this.engine.themeManager.getChartTypeColors(o);"line"===o||"area"===o?e.chartColors.lineColor&&(i.upColor=e.chartColors.lineColor,i.downColor=e.chartColors.lineColor,t.upColor=e.chartColors.lineColor,t.downColor=e.chartColors.lineColor):"hollow-candles"===o?(e.chartColors.upColor&&(i.upColor=e.chartColors.upColor,t.upColor=e.chartColors.upColor),e.chartColors.downColor&&(i.downColor=e.chartColors.downColor,t.downColor=e.chartColors.downColor),e.chartColors.hollowFill&&(i.hollowFill=e.chartColors.hollowFill)):(e.chartColors.upColor&&(i.upColor=e.chartColors.upColor,t.upColor=e.chartColors.upColor),e.chartColors.downColor&&(i.downColor=e.chartColors.downColor,t.downColor=e.chartColors.downColor)),this.engine.themeManager.setChartTypeColors(o,i)}void 0!==e.candleWidth&&(this.engine.candleWidth=e.candleWidth),void 0!==e.candleSpacing&&(this.engine.candleSpacing=e.candleSpacing),void 0!==e.futureOffset&&(this.engine.scrollOffset=-e.futureOffset),this.engine.showGrid=void 0!==e.showGrid?e.showGrid:this.engine.constructor.DEFAULT_SETTINGS.showGrid,this.engine.showCrosshair=void 0!==e.showCrosshair?e.showCrosshair:this.engine.constructor.DEFAULT_SETTINGS.showCrosshair,this.engine.showCrosshairLabels=void 0!==e.showCrosshairLabels?e.showCrosshairLabels:this.engine.constructor.DEFAULT_SETTINGS.showCrosshairLabels,this.engine.showPriceLine=void 0!==e.showPriceLine?e.showPriceLine:this.engine.constructor.DEFAULT_SETTINGS.showPriceLine,this.engine.showHighLow=void 0!==e.showHighLow?e.showHighLow:this.engine.constructor.DEFAULT_SETTINGS.showHighLow,this.engine.showAskPriceLabel=void 0!==e.showAskPriceLabel?e.showAskPriceLabel:this.engine.constructor.DEFAULT_SETTINGS.showAskPriceLabel,this.engine.showBidPriceLabel=void 0!==e.showBidPriceLabel?e.showBidPriceLabel:this.engine.constructor.DEFAULT_SETTINGS.showBidPriceLabel,this.engine.showAskBidLines=void 0!==e.showAskBidLines?e.showAskBidLines:this.engine.constructor.DEFAULT_SETTINGS.showAskBidLines,this.engine.showIndicatorLabels=void 0!==e.showIndicatorLabels?e.showIndicatorLabels:this.engine.constructor.DEFAULT_SETTINGS.showIndicatorLabels,this.engine.showOHLCBar=void 0!==e.showOHLCBar?e.showOHLCBar:this.engine.constructor.DEFAULT_SETTINGS.showOHLCBar,this.engine.autoScale=void 0!==e.autoScale?e.autoScale:this.engine.constructor.DEFAULT_SETTINGS.autoScale,this.engine.logScale=void 0!==e.logScale?e.logScale:this.engine.constructor.DEFAULT_SETTINGS.logScale,this.engine.askLabelColor=e.askLabelColor||this.engine.constructor.DEFAULT_SETTINGS.askLabelColor,this.engine.bidLabelColor=e.bidLabelColor||this.engine.constructor.DEFAULT_SETTINGS.bidLabelColor,"indicatorPanelBgColor"in e&&(null!==e.indicatorPanelBgColor?this.engine.themeManager.setUserIndicatorPanelBgColor(e.indicatorPanelBgColor):this.engine.themeManager.clearUserIndicatorPanelBgColor()),this.engine.indicatorPanelBgColor=e.indicatorPanelBgColor||null,this.engine.autoScale&&this.engine.interactionManager&&(this.engine.interactionManager.priceScaleFactor=1,this.engine.interactionManager.priceOffset=0),this.engine.infoOverlay&&(this.engine.infoOverlay.resetColorCache(),this.engine.infoOverlay.update()),this.engine.calculateVisibleRange(),this.engine.calculatePriceRange(),this.engine.render(),this.markTemplateUnsaved()},cancelComprehensiveSettings:function(){var e;null===(e=this.chartSettingsModalManager)||void 0===e||e.cancel()},hideComprehensiveSettings:function(){var e;null===(e=this.chartSettingsModalManager)||void 0===e||e.hide()},applyComprehensiveSettings:function(){var e;null===(e=this.chartSettingsModalManager)||void 0===e||e.apply()},loadSavedComprehensiveSettings:function(){try{var e=localStorage.getItem("fcsapi_chart_settings");if(e)return JSON.parse(e).comprehensiveSettings||{}}catch(t){}return{}},updateCoordinatesTab:function(e){var t=this,n=this.floatingToolbar.querySelector("#coordinates-container");if(n)if(n._delegationSetup||(n._delegationSetup=!0,n.addEventListener("input",function(e){if(e.target.classList.contains("coord-input-compact")){e.stopPropagation();var n=t.floatingToolbarItem;if(n){var a=parseFloat(e.target.value);if(void 0!==n.index)"marker-index"===e.target.dataset.type?n.index=Math.max(0,Math.floor(a)):"marker-price"===e.target.dataset.type&&(n.price=a),t.engine.saveMarkersToStorage();else{var o=parseInt(e.target.dataset.point),i=e.target.dataset.type;if(!isNaN(o)&&n.points[o])if("index"===i){if(n.points[o].index=Math.max(0,Math.floor(a)),n.points[o].timestamp){var l=t.engine.data[n.points[o].index];l&&(n.points[o].timestamp=l.timestamp)}}else"price"===i&&(n.points[o].price=a);t.engine.drawingManager.saveToStorage()}t.engine.render()}}}),n.addEventListener("click",function(e){e.target.classList.contains("coord-input-compact")&&e.stopPropagation()}),n.addEventListener("mousedown",function(e){e.target.classList.contains("coord-input-compact")&&e.stopPropagation()})),n.innerHTML="",void 0!==e.index)n.innerHTML='\n        <div class="coordinate-section">\n          <div class="coordinate-compact">\n            <label class="coord-compact-label">#1 Index, Price</label>\n            <div class="coord-compact-inputs">\n              <input type="number" class="coord-input-compact" data-type="marker-index" value="'.concat(e.index||0,'" min="0" placeholder="Index">\n              <input type="number" class="coord-input-compact" data-type="marker-price" value="').concat(e.price||0,'" step="0.00001" placeholder="Price">\n            </div>\n          </div>\n        </div>\n      ');else if(e.points&&e.points.length>0){var a='<div class="coordinate-section">';e.points.forEach(function(e,n){a+='\n          <div class="coordinate-compact">\n            <label class="coord-compact-label">#'.concat(n+1,' Index, Price</label>\n            <div class="coord-compact-inputs">\n              <input type="number" class="coord-input-compact" data-point="').concat(n,'" data-type="index" value="').concat(e.index||0,'" min="0" placeholder="Index">\n              <input type="number" class="coord-input-compact" data-point="').concat(n,'" data-type="price" value="').concat(e.price?t.engine.roundPrice(e.price):0,'" step="').concat(1/t.engine.PRICESCALE,'" placeholder="Price">\n            </div>\n          </div>\n        ')}),a+="</div>",n.innerHTML=a}},updateFibLinesTab:function(e){var t=this,n=this.floatingToolbar.querySelector("#fib-lines-container");if(n)if(n._delegationSetup||(n._delegationSetup=!0,this._setupFibLinesEventDelegation(n)),n.innerHTML="","gannbox"!==e.type){var i="fibtimezones"===e.type,l=(e.type,i?"timezones":"levels"),r=i?"visibleZones":"visibleLevels",s=i?"customTimezones":"customLevels",c=i?"zoneColors":"levelColors";e[r]||(e[r]={},e[l].forEach(function(t){e[r][t]=!0})),e[s]||(e[s]=M(e[l]));var d='\n      <div class="fib-add-line-container">\n        <div class="dropdown-select no-auto-highlight" id="fib-add-line-select" data-dropdown-id="fibAddLineDropdown" data-modal-escape="true">\n          <div class="select-trigger">\n            <span class="select-trigger-text-nochange">'.concat(a.cI.plus," Add Level</span>\n          </div>\n        </div>\n      </div>\n    ");d+='<div class="fib-lines-section">',e[s].forEach(function(t,n){var a=!1!==e[r][t],o=e[c][t]||e.color||"#2962ff";d+='\n        <div class="fib-line-row" data-level-index="'.concat(n,'">\n          <input type="checkbox" class="fib-line-checkbox toggle-checkbox" data-level="').concat(t,'" ').concat(a?"checked":"",'>\n          <input type="number" class="fib-line-value" data-level-index="').concat(n,'" value="').concat(t,'" step="0.001" min="0" max="10">\n          <div class="dropdown-select color-trigger-select no-auto-highlight fib-line-color-btn" data-level="').concat(t,'" data-dropdown-id="colorPickerDropdown" data-modal-escape="true">\n            <div class="select-trigger">\n              <span class="color-preview" style="background: ').concat(o,';"></span>\n            </div>\n          </div>\n        </div>\n      ')}),d+="</div>",n.innerHTML=d,n.querySelectorAll(".fib-line-color-btn").forEach(function(e){e._colorPickerCallback=function(n,a){var i=t.floatingToolbarItem;if(i){var l=parseFloat(e.dataset.level),r=e.querySelector(".color-preview"),s="fibtimezones"===i.type?"zoneColors":"levelColors",c=o.s.hexToRgba(n,a);i[s][l]=c,r&&(r.style.background=c),t.engine.drawingManager.saveToStorage(),t.engine.render()}}});var u=document.getElementById("fibAddLineDropdown");u&&u.remove();var g='\n        <div id="fibAddLineDropdown" class="select-dropdown fib-add-line-dropdown">\n          <div class="fib-custom-input-section tf-custom-option">\n            <input type="number" class="fib-custom-level-input" placeholder="Custom level..." step="0.001" min="0" max="10">\n            <button class="fib-add-custom-btn">'.concat(a.cI.plus,'</button>\n          </div>\n          <ul class="select-options" data-max-height-offset="60">\n            <li class="tf-group-header">Retracement</li>\n            <li class="select-option fib-add-level-option" data-value="0.236">0.236 (23.6%)</li>\n            <li class="select-option fib-add-level-option" data-value="0.382">0.382 (38.2%)</li>\n            <li class="select-option fib-add-level-option" data-value="0.5">0.5 (50%)</li>\n            <li class="select-option fib-add-level-option" data-value="0.618">0.618 (61.8%)</li>\n            <li class="select-option fib-add-level-option" data-value="0.786">0.786 (78.6%)</li>\n            <li class="tf-group-header">Extension</li>\n            <li class="select-option fib-add-level-option" data-value="1.272">1.272 (127.2%)</li>\n            <li class="select-option fib-add-level-option" data-value="1.414">1.414 (141.4%)</li>\n            <li class="select-option fib-add-level-option" data-value="1.618">1.618 (161.8%)</li>\n            <li class="select-option fib-add-level-option" data-value="2">2 (200%)</li>\n            <li class="select-option fib-add-level-option" data-value="2.618">2.618 (261.8%)</li>\n            <li class="select-option fib-add-level-option" data-value="3.618">3.618 (361.8%)</li>\n            <li class="select-option fib-add-level-option" data-value="4.236">4.236 (423.6%)</li>\n          </ul>\n        </div>\n      ');document.body.insertAdjacentHTML("beforeend",g);var p=n.querySelector("#fib-add-line-select");p&&new S.A(p),window.initCustomSelects&&window.initCustomSelects(n)}else this._updateGannBoxLinesTab(e,n)},_updateGannBoxLinesTab:function(e,t){var n="",o=this._detectGannPreset(e.priceLevels);n+='\n      <div class="gann-preset-container">\n        <span class="gann-preset-label">Preset:</span>\n        <div class="dropdown-select no-auto-highlight" id="gann-preset-select" data-dropdown-id="gannPresetDropdown" data-modal-escape="true">\n          <div class="select-trigger">\n            <span class="select-trigger-text-nochange">'.concat(o,'</span>\n            <svg width="12" height="12" class="select-arrow" fill="none" stroke="currentColor">\n              <use href="#chevron-down"></use>\n            </svg>\n          </div>\n        </div>\n      </div>\n    '),n+='<div class="gann-section-header">Price Levels (Horizontal)</div>',n+='\n      <div class="fib-add-line-container">\n        <div class="dropdown-select no-auto-highlight" id="gann-add-price-select" data-dropdown-id="gannAddPriceDropdown" data-modal-escape="true">\n          <div class="select-trigger">\n            <span class="select-trigger-text-nochange">'.concat(a.cI.plus," Add Level</span>\n          </div>\n        </div>\n      </div>\n    "),n+='<div class="fib-lines-section">',e.priceLevels.forEach(function(t,a){var o=!1!==e.visiblePriceLevels[t],i=e.priceLevelColors[t]||e.color||"#2962ff";n+='\n        <div class="fib-line-row" data-level-index="'.concat(a,'" data-gann-type="price">\n          <input type="checkbox" class="fib-line-checkbox toggle-checkbox" data-level="').concat(t,'" data-gann-type="price" ').concat(o?"checked":"",'>\n          <input type="number" class="fib-line-value" data-level-index="').concat(a,'" data-gann-type="price" value="').concat(t,'" step="0.01" min="0" max="1">\n          <div class="dropdown-select color-trigger-select no-auto-highlight fib-line-color-btn" data-level="').concat(t,'" data-gann-type="price" data-dropdown-id="colorPickerDropdown" data-modal-escape="true">\n            <div class="select-trigger">\n              <span class="color-preview" style="background: ').concat(i,';"></span>\n            </div>\n          </div>\n        </div>\n      ')}),n+="</div>",n+='<div class="gann-section-header" style="margin-top: 12px;">Time Levels (Vertical)</div>',n+='\n      <div class="fib-add-line-container">\n        <div class="dropdown-select no-auto-highlight" id="gann-add-time-select" data-dropdown-id="gannAddTimeDropdown" data-modal-escape="true">\n          <div class="select-trigger">\n            <span class="select-trigger-text-nochange">'.concat(a.cI.plus," Add Level</span>\n          </div>\n        </div>\n      </div>\n    "),n+='<div class="fib-lines-section">',e.timeLevels.forEach(function(t,a){var o=!1!==e.visibleTimeLevels[t],i=e.timeLevelColors[t]||e.color||"#2962ff";n+='\n        <div class="fib-line-row" data-level-index="'.concat(a,'" data-gann-type="time">\n          <input type="checkbox" class="fib-line-checkbox toggle-checkbox" data-level="').concat(t,'" data-gann-type="time" ').concat(o?"checked":"",'>\n          <input type="number" class="fib-line-value" data-level-index="').concat(a,'" data-gann-type="time" value="').concat(t,'" step="0.01" min="0" max="1">\n          <div class="dropdown-select color-trigger-select no-auto-highlight fib-line-color-btn" data-level="').concat(t,'" data-gann-type="time" data-dropdown-id="colorPickerDropdown" data-modal-escape="true">\n            <div class="select-trigger">\n              <span class="color-preview" style="background: ').concat(i,';"></span>\n            </div>\n          </div>\n        </div>\n      ')}),n+="</div>",n+='<div class="gann-section-header" style="margin-top: 12px;">Diagonal Angles</div>',n+='<div class="fib-lines-section">',e.diagonals.forEach(function(e,t){n+='\n        <div class="fib-line-row" data-diagonal-index="'.concat(t,'">\n          <input type="checkbox" class="fib-line-checkbox toggle-checkbox" data-diagonal="').concat(e.name,'" ').concat(e.enabled?"checked":"",'>\n          <span class="gann-level-label">').concat(e.name,'</span>\n          <div class="dropdown-select color-trigger-select no-auto-highlight fib-line-color-btn" data-diagonal="').concat(e.name,'" data-dropdown-id="colorPickerDropdown" data-modal-escape="true">\n            <div class="select-trigger">\n              <span class="color-preview" style="background: ').concat(e.color,';"></span>\n            </div>\n          </div>\n        </div>\n      ')}),n+="</div>",n+='<div class="gann-section-header" style="margin-top: 12px;">Display Options</div>',n+='<div class="gann-options-section">',n+='\n      <label class="gann-option-row">\n        <input type="checkbox" class="toggle-checkbox gann-option" data-option="showPriceLevels" '.concat(!1!==e.showPriceLevels?"checked":"",'>\n        <span>Show Price Levels</span>\n      </label>\n      <label class="gann-option-row">\n        <input type="checkbox" class="toggle-checkbox gann-option" data-option="showTimeLevels" ').concat(!1!==e.showTimeLevels?"checked":"",'>\n        <span>Show Time Levels</span>\n      </label>\n      <label class="gann-option-row">\n        <input type="checkbox" class="toggle-checkbox gann-option" data-option="showDiagonals" ').concat(!1!==e.showDiagonals?"checked":"",'>\n        <span>Show Diagonals</span>\n      </label>\n      <label class="gann-option-row">\n        <input type="checkbox" class="toggle-checkbox gann-option" data-option="showZoneFill" ').concat(!1!==e.showZoneFill?"checked":"",'>\n        <span>Show Zone Fill</span>\n      </label>\n      <label class="gann-option-row">\n        <input type="checkbox" class="toggle-checkbox gann-option" data-option="showLabels" ').concat(!1!==e.showLabels?"checked":"",">\n        <span>Show Labels</span>\n      </label>\n    "),n+="</div>",t.innerHTML=n,this._setupGannBoxEventHandlers(e,t),this._createGannAddLevelDropdowns(t),window.initCustomSelects&&window.initCustomSelects(t)},_createGannAddLevelDropdowns:function(e){var t=this;["gannAddPriceDropdown","gannAddTimeDropdown","gannPresetDropdown"].forEach(function(e){var t=document.getElementById(e);t&&t.remove()});document.body.insertAdjacentHTML("beforeend",'\n      <div id="gannPresetDropdown" class="select-dropdown">\n        <ul class="select-options">\n          <li class="select-option gann-preset-option" data-value="Standard (1/4)">Standard (1/4)</li>\n          <li class="select-option gann-preset-option" data-value="Gann Eighths (1/8)">Gann Eighths (1/8)</li>\n          <li class="select-option gann-preset-option" data-value="Fibonacci">Fibonacci</li>\n          <li class="select-option gann-preset-option" data-value="Custom">Custom</li>\n        </ul>\n      </div>\n    ');var n=e.querySelector("#gann-preset-select");n&&new S.A(n),document.querySelectorAll(".gann-preset-option").forEach(function(n){n.addEventListener("click",function(n){var a=n.target.dataset.value;t._applyGannPreset(a,e)})});var o='\n      <li class="tf-group-header">Gann Levels</li>\n      <li class="select-option gann-add-level-option" data-value="0.125">0.125 (12.5%)</li>\n      <li class="select-option gann-add-level-option" data-value="0.25">0.25 (25%)</li>\n      <li class="select-option gann-add-level-option" data-value="0.375">0.375 (37.5%)</li>\n      <li class="select-option gann-add-level-option" data-value="0.5">0.5 (50%)</li>\n      <li class="select-option gann-add-level-option" data-value="0.625">0.625 (62.5%)</li>\n      <li class="select-option gann-add-level-option" data-value="0.75">0.75 (75%)</li>\n      <li class="select-option gann-add-level-option" data-value="0.875">0.875 (87.5%)</li>\n      <li class="tf-group-header">Fibonacci Levels</li>\n      <li class="select-option gann-add-level-option" data-value="0.236">0.236 (23.6%)</li>\n      <li class="select-option gann-add-level-option" data-value="0.382">0.382 (38.2%)</li>\n      <li class="select-option gann-add-level-option" data-value="0.618">0.618 (61.8%)</li>\n      <li class="select-option gann-add-level-option" data-value="0.786">0.786 (78.6%)</li>\n      <li class="tf-group-header">Other Common</li>\n      <li class="select-option gann-add-level-option" data-value="0.333">0.333 (33.3%)</li>\n      <li class="select-option gann-add-level-option" data-value="0.666">0.666 (66.6%)</li>\n    ',i='\n      <div id="gannAddPriceDropdown" class="select-dropdown fib-add-line-dropdown">\n        <div class="fib-custom-input-section tf-custom-option">\n          <input type="number" class="fib-custom-level-input gann-custom-input" data-gann-type="price" placeholder="Custom (0-1)..." step="0.01" min="0" max="1">\n          <button class="fib-add-custom-btn gann-add-custom-btn" data-gann-type="price">'.concat(a.cI.plus,'</button>\n        </div>\n        <ul class="select-options" data-max-height-offset="60" data-gann-type="price">\n          ').concat(o,"\n        </ul>\n      </div>\n    "),l='\n      <div id="gannAddTimeDropdown" class="select-dropdown fib-add-line-dropdown">\n        <div class="fib-custom-input-section tf-custom-option">\n          <input type="number" class="fib-custom-level-input gann-custom-input" data-gann-type="time" placeholder="Custom (0-1)..." step="0.01" min="0" max="1">\n          <button class="fib-add-custom-btn gann-add-custom-btn" data-gann-type="time">'.concat(a.cI.plus,'</button>\n        </div>\n        <ul class="select-options" data-max-height-offset="60" data-gann-type="time">\n          ').concat(o,"\n        </ul>\n      </div>\n    ");document.body.insertAdjacentHTML("beforeend",i),document.body.insertAdjacentHTML("beforeend",l);var r=e.querySelector("#gann-add-price-select"),s=e.querySelector("#gann-add-time-select");r&&new S.A(r),s&&new S.A(s),document.querySelectorAll(".gann-add-level-option").forEach(function(n){n.addEventListener("click",function(n){var a=parseFloat(n.target.dataset.value),o=n.target.closest(".select-options").dataset.gannType;t._addGannLevel(a,o,e)})}),document.querySelectorAll(".gann-add-custom-btn").forEach(function(n){n.addEventListener("click",function(n){var a=n.target.dataset.gannType,o=n.target.previousElementSibling,i=parseFloat(o.value);!isNaN(i)&&i>=0&&i<=1&&(t._addGannLevel(i,a,e),o.value="")})})},_getLevelColor:function(e){for(var t=[{pos:0,color:"#787b86"},{pos:.15,color:"#f44336"},{pos:.3,color:"#ff9800"},{pos:.45,color:"#ffeb3b"},{pos:.55,color:"#4caf50"},{pos:.7,color:"#00bcd4"},{pos:.85,color:"#2196f3"},{pos:1,color:"#2962ff"}],n=t[0],a=Math.abs(e-t[0].pos),o=0,i=t;o<i.length;o++){var l=i[o],r=Math.abs(e-l.pos);r<a&&(a=r,n=l)}return n.color},_addGannLevel:function(e,t,n){var a=this.floatingToolbarItem;if(a){var o=this._getLevelColor(e);if("price"===t){if(a.priceLevels.includes(e))return;a.priceLevels.push(e),a.priceLevels.sort(function(e,t){return e-t}),a.visiblePriceLevels[e]=!0,a.priceLevelColors[e]=o}else{if(a.timeLevels.includes(e))return;a.timeLevels.push(e),a.timeLevels.sort(function(e,t){return e-t}),a.visibleTimeLevels[e]=!0,a.timeLevelColors[e]=o}this.engine.drawingManager.saveToStorage(),this.engine.render(),this._updateGannBoxLinesTab(a,n)}},_gannPresets:{"Standard (1/4)":[0,.25,.5,.75,1],"Gann Eighths (1/8)":[0,.125,.25,.375,.5,.625,.75,.875,1],Fibonacci:[0,.236,.382,.5,.618,.786,1],Custom:null},_detectGannPreset:function(e){for(var t,n=this._gannPresets,a=function(){var t=x(i[o],2),n=t[0],a=t[1];return a?e.length!==a.length?0:M(e).sort(function(e,t){return e-t}).every(function(e,t){return Math.abs(e-a[t])<.001})?{v:n}:void 0:0},o=0,i=Object.entries(n);o<i.length;o++)if(0!==(t=a())&&t)return t.v;return"Custom"},_gannPresetColors:{"Standard (1/4)":{price:{0:"#787b86",.25:"#f23645",.5:"#ff9800",.75:"#4caf50",1:"#2962ff"},time:{0:"#787b86",.25:"#9c27b0",.5:"#ff9800",.75:"#00bcd4",1:"#2962ff"}},"Gann Eighths (1/8)":{price:{0:"#787b86",.125:"#f44336",.25:"#e91e63",.375:"#9c27b0",.5:"#ff9800",.625:"#8bc34a",.75:"#4caf50",.875:"#00bcd4",1:"#2962ff"},time:{0:"#787b86",.125:"#f44336",.25:"#e91e63",.375:"#9c27b0",.5:"#ff9800",.625:"#8bc34a",.75:"#4caf50",.875:"#00bcd4",1:"#2962ff"}},Fibonacci:{price:{0:"#787b86",.236:"#f44336",.382:"#ff9800",.5:"#ffeb3b",.618:"#4caf50",.786:"#00bcd4",1:"#2962ff"},time:{0:"#787b86",.236:"#f44336",.382:"#ff9800",.5:"#ffeb3b",.618:"#4caf50",.786:"#00bcd4",1:"#2962ff"}}},_applyGannPreset:function(e,t){var n=this.floatingToolbarItem;if(n){var a=this._gannPresets[e];if(a){var o=this._gannPresetColors[e];n.priceLevels=M(a),n.timeLevels=M(a),n.visiblePriceLevels={},n.visibleTimeLevels={},a.forEach(function(e){n.visiblePriceLevels[e]=!0,n.visibleTimeLevels[e]=!0}),n.priceLevelColors=o?B({},o.price):{},n.timeLevelColors=o?B({},o.time):{},this.engine.drawingManager.saveToStorage(),this.engine.render(),this._updateGannBoxLinesTab(n,t)}}},_setupGannBoxEventHandlers:function(e,t){var n=this;t.querySelectorAll(".fib-line-checkbox[data-level]").forEach(function(t){t.addEventListener("change",function(t){var a=parseFloat(t.target.dataset.level),o=t.target.dataset.gannType;"price"===o?e.visiblePriceLevels[a]=t.target.checked:"time"===o&&(e.visibleTimeLevels[a]=t.target.checked),n.engine.drawingManager.saveToStorage(),n.engine.render()})}),t.querySelectorAll(".fib-line-value").forEach(function(a){a.addEventListener("change",function(a){var o=a.target.dataset.gannType,i=parseInt(a.target.dataset.levelIndex),l=parseFloat(a.target.value);if(!(isNaN(l)||l<0||l>1)){if("price"===o){var r=e.priceLevels[i];e.priceLevels[i]=l,e.priceLevels.sort(function(e,t){return e-t}),e.visiblePriceLevels[l]=e.visiblePriceLevels[r],e.priceLevelColors[l]=e.priceLevelColors[r],delete e.visiblePriceLevels[r],delete e.priceLevelColors[r]}else if("time"===o){var s=e.timeLevels[i];e.timeLevels[i]=l,e.timeLevels.sort(function(e,t){return e-t}),e.visibleTimeLevels[l]=e.visibleTimeLevels[s],e.timeLevelColors[l]=e.timeLevelColors[s],delete e.visibleTimeLevels[s],delete e.timeLevelColors[s]}n.engine.drawingManager.saveToStorage(),n.engine.render(),n._updateGannBoxLinesTab(e,t)}})}),t.querySelectorAll(".fib-line-checkbox[data-diagonal]").forEach(function(t){t.addEventListener("change",function(t){var a=t.target.dataset.diagonal,o=e.diagonals.find(function(e){return e.name===a});o&&(o.enabled=t.target.checked,n.engine.drawingManager.saveToStorage(),n.engine.render())})}),t.querySelectorAll(".gann-option").forEach(function(t){t.addEventListener("change",function(t){var a=t.target.dataset.option;e[a]=t.target.checked,n.engine.drawingManager.saveToStorage(),n.engine.render()})}),t.querySelectorAll(".fib-line-color-btn[data-level]").forEach(function(e){e._colorPickerCallback=function(t,a){var i=n.floatingToolbarItem;if(i){var l=parseFloat(e.dataset.level),r=e.dataset.gannType,s=e.querySelector(".color-preview"),c=o.s.hexToRgba(t,a);"price"===r?i.priceLevelColors[l]=c:"time"===r&&(i.timeLevelColors[l]=c),s&&(s.style.background=c),n.engine.drawingManager.saveToStorage(),n.engine.render()}}}),t.querySelectorAll(".fib-line-color-btn[data-diagonal]").forEach(function(e){e._colorPickerCallback=function(t,a){var i=n.floatingToolbarItem;if(i){var l=e.dataset.diagonal,r=i.diagonals.find(function(e){return e.name===l});if(r){var s=e.querySelector(".color-preview"),c=o.s.hexToRgba(t,a);r.color=c,s&&(s.style.background=c),n.engine.drawingManager.saveToStorage(),n.engine.render()}}}})},updatePositionSettingsTab:function(e){var t=this.floatingToolbar.querySelector('.tab-content[data-tab="lines"]');if(t){e.type;var n="";n+='<div class="gann-section-header">Risk/Reward Ratio</div>',n+='\n      <div class="position-rr-container">\n        <span class="position-rr-label">R/R Ratio (1:</span>\n        <input type="number" class="position-rr-input" id="position-rr-value" value="'.concat(e.riskRewardRatio||2,'" step="0.1" min="0.1" max="20">\n        <span class="position-rr-label">)</span>\n      </div>\n    '),n+='<div class="gann-section-header" style="margin-top: 12px;">Colors</div>',n+='<div class="fib-lines-section">',n+='\n      <div class="fib-line-row">\n        <span class="gann-level-label">Entry Line</span>\n        <div class="dropdown-select color-trigger-select no-auto-highlight fib-line-color-btn" data-position-color="entry" data-dropdown-id="colorPickerDropdown" data-modal-escape="true">\n          <div class="select-trigger">\n            <span class="color-preview" style="background: '.concat(e.entryColor||"#2962ff",';"></span>\n          </div>\n        </div>\n      </div>\n    '),n+='\n      <div class="fib-line-row">\n        <span class="gann-level-label">Profit Zone</span>\n        <div class="dropdown-select color-trigger-select no-auto-highlight fib-line-color-btn" data-position-color="profit" data-dropdown-id="colorPickerDropdown" data-modal-escape="true">\n          <div class="select-trigger">\n            <span class="color-preview" style="background: '.concat(e.profitColor||"#26a69a",';"></span>\n          </div>\n        </div>\n      </div>\n    '),n+='\n      <div class="fib-line-row">\n        <span class="gann-level-label">Loss Zone</span>\n        <div class="dropdown-select color-trigger-select no-auto-highlight fib-line-color-btn" data-position-color="loss" data-dropdown-id="colorPickerDropdown" data-modal-escape="true">\n          <div class="select-trigger">\n            <span class="color-preview" style="background: '.concat(e.lossColor||"#ef5350",';"></span>\n          </div>\n        </div>\n      </div>\n    '),n+="</div>",n+='<div class="gann-section-header" style="margin-top: 12px;">Display Options</div>',n+='<div class="gann-options-section">',n+='\n      <label class="gann-option-row">\n        <input type="checkbox" class="toggle-checkbox position-option" data-option="showLabels" '.concat(!1!==e.showLabels?"checked":"",'>\n        <span>Show Labels</span>\n      </label>\n      <label class="gann-option-row">\n        <input type="checkbox" class="toggle-checkbox position-option" data-option="showPercentages" ').concat(!1!==e.showPercentages?"checked":"",'>\n        <span>Show Percentages</span>\n      </label>\n      <label class="gann-option-row">\n        <input type="checkbox" class="toggle-checkbox position-option" data-option="showRiskReward" ').concat(!1!==e.showRiskReward?"checked":"",'>\n        <span>Show R/R Box</span>\n      </label>\n      <label class="gann-option-row">\n        <input type="checkbox" class="toggle-checkbox position-option" data-option="extendLines" ').concat(e.extendLines?"checked":"",">\n        <span>Extend Lines</span>\n      </label>\n    "),n+="</div>",t.innerHTML=n,this._setupPositionEventHandlers(e,t),window.initCustomSelects&&window.initCustomSelects(t)}},_setupPositionEventHandlers:function(e,t){var n=this,a=t.querySelector("#position-rr-value");a&&a.addEventListener("change",function(t){var a=parseFloat(t.target.value);!isNaN(a)&&a>0&&(e.riskRewardRatio=a,n.engine.drawingManager.saveToStorage(),n.engine.render())}),t.querySelectorAll(".position-option").forEach(function(t){t.addEventListener("change",function(t){var a=t.target.dataset.option;e[a]=t.target.checked,n.engine.drawingManager.saveToStorage(),n.engine.render()})}),t.querySelectorAll(".fib-line-color-btn[data-position-color]").forEach(function(e){e._colorPickerCallback=function(t,a){var i=n.floatingToolbarItem;if(i){var l=e.dataset.positionColor,r=e.querySelector(".color-preview"),s=o.s.hexToRgba(t,a);"entry"===l?i.entryColor=s:"profit"===l?i.profitColor=s:"loss"===l&&(i.lossColor=s),r&&(r.style.background=s),n.engine.drawingManager.saveToStorage(),n.engine.render()}}})},applyIndicatorSettings:function(){this.currentIndicator?(this.updateAddedTab(),this.engine.panelManager&&"separate"===this.currentIndicator.panelType&&this.engine.panelManager.updatePanelIndicatorName(this.currentIndicator),this.engine.indicatorManager&&this.engine.indicatorManager.saveIndicators(),this.markTemplateUnsaved(),this.originalIndicatorValues=null,this.hideSettingsDialog()):this.hideSettingsDialog()},applySettingImmediately:function(e,t){this.currentIndicator&&(this.currentIndicator[e]=t,this.currentIndicator.calculate(),this.engine.render(),this.updateIndicatorLegend())},cancelIndicatorSettings:function(){var e=this;this.currentIndicator&&this.originalIndicatorValues?(Object.keys(this.originalIndicatorValues).forEach(function(t){e.currentIndicator[t]=e.originalIndicatorValues[t]}),this.currentIndicator.calculate(),this.engine.render(),this.updateIndicatorLegend(),this.originalIndicatorValues=null,this.hideSettingsDialog()):this.hideSettingsDialog()},showIndicatorSettings:function(e){var t=this;return q(E().m(function n(){var a,i,l,r,s,c,d,u;return E().w(function(n){for(;;)switch(n.n){case 0:return t.currentIndicator=e,t.settingsBody.innerHTML="",t.originalIndicatorValues={},t.settingsDialog.querySelector(".modal-title").textContent=e.config.name||e.config.type,n.n=1,t.engine.indicatorManager.loadIndicatorClass(e.config.type);case 1:a=n.v,i=null,a&&"function"==typeof a.getSettingsConfig&&(i=a.getSettingsConfig()),i?((l=document.createElement("div")).className="settings-tab-content active",l.dataset.tab="settings",(r=document.createElement("div")).className="settings-tab-content",r.dataset.tab="style",i.inputs&&i.inputs.length>0?(i.inputs.forEach(function(n){var a=void 0!==e[n.key]?e[n.key]:n.default;t.originalIndicatorValues[n.key]=a;var o=t.createDynamicField(B(B({},n),{},{default:a}));l.appendChild(o)}),t.setupDependentFields(l,i.inputs)):((s=document.createElement("p")).className="settings-empty-msg",s.textContent="No input settings available",l.appendChild(s)),i.style&&i.style.length>0?(c={},d=[],i.style.forEach(function(e){c[e.label]||(c[e.label]=[],d.push(e.label)),c[e.label].push(e)}),d.forEach(function(n){var a=c[n];if(1===a.length){var i=a[0],l=void 0!==e[i.key]?e[i.key]:i.default;t.originalIndicatorValues[i.key]=l;var s=t.createDynamicField(B(B({},i),{},{default:l}));r.appendChild(s)}else{var d=document.createElement("div");d.className="settings-field grouped-field";var u=document.createElement("div");u.className="grouped-left";var g=document.createElement("div");g.className="grouped-controls";var p=a.find(function(e){return"checkbox"===e.type});if(p){var h=void 0!==e[p.key]?e[p.key]:p.default;t.originalIndicatorValues[p.key]=h;var v=document.createElement("label");v.className="grouped-toggle";var m=document.createElement("input");m.type="checkbox",m.checked=h,m.dataset.setting=p.key,m.addEventListener("change",function(){t.applySettingImmediately(p.key,m.checked)}),v.appendChild(m),u.appendChild(v)}var f=document.createElement("span");f.className="grouped-label",f.textContent=n,u.appendChild(f),d.appendChild(u);var b=a.filter(function(e){return"checkbox"!==e.type});b.filter(function(e){return"number"===e.type}).forEach(function(n){var a=void 0!==e[n.key]?e[n.key]:n.default;t.originalIndicatorValues[n.key]=a;var o=document.createElement("input");o.type="number",o.className="grouped-number",o.value=a,o.dataset.setting=n.key,void 0!==n.min&&(o.min=n.min),void 0!==n.max&&(o.max=n.max),void 0!==n.step&&(o.step=n.step),o.addEventListener("input",function(){var e=parseFloat(o.value);isNaN(e)||t.applySettingImmediately(n.key,e)}),g.appendChild(o)}),b.filter(function(e){return"color"===e.type}).forEach(function(n){var a=void 0!==e[n.key]?e[n.key]:n.default;t.originalIndicatorValues[n.key]=a;var i=document.createElement("div");i.className="dropdown-select color-trigger-select no-auto-highlight grouped-color",i.dataset.setting=n.key,i.setAttribute("data-dropdown-id","colorPickerDropdown"),i.setAttribute("data-modal-escape","true");var l=document.createElement("div");l.className="select-trigger";var r=document.createElement("span");r.className="color-preview";var s=o.s.rgbaToHex(a),c=o.s.extractOpacity(a);r.style.backgroundColor=o.s.hexToRgba(s,c),r.dataset.color=a,l.appendChild(r),i.appendChild(l),i._colorPickerCallback=function(e,a){var i=o.s.hexToRgba(e,a);r.style.backgroundColor=i,r.dataset.color=i,t.applySettingImmediately(n.key,i)},g.appendChild(i)}),d.appendChild(g),r.appendChild(d)}})):((u=document.createElement("p")).className="settings-empty-msg",u.textContent="No style settings available",r.appendChild(u)),t.settingsBody.appendChild(l),t.settingsBody.appendChild(r),t.settingsTabHeader.classList.remove("hidden"),t.switchSettingsTab("settings")):(t.settingsTabHeader.classList.add("hidden"),t.addSettingsField("Color","color",e.color||e.config.color||"#2962ff"),void 0!==e.period&&t.addSettingsField("Period","number",e.period,{min:1,max:500}),void 0!==e.fastPeriod&&(t.addSettingsField("Fast Period","number",e.fastPeriod,{min:1,max:100}),t.addSettingsField("Slow Period","number",e.slowPeriod,{min:1,max:100}),t.addSettingsField("Signal Period","number",e.signalPeriod,{min:1,max:100})),void 0!==e.stdDev&&t.addSettingsField("Standard Deviation","number",e.stdDev,{min:.5,max:5,step:.1})),t.settingsDialog.querySelector(".btn-apply-changes").onclick=function(){t.applyIndicatorSettings()},t.settingsDialog.querySelector(".btn-cancel").onclick=function(){t.cancelIndicatorSettings()},t.showSettingsDialog(),setTimeout(function(){window.initCustomSelects&&window.initCustomSelects(t.settingsDialog)},50);case 2:return n.a(2)}},n)}))()},createIndicatorModal:function(){this.indicatorModalManager=new m(this.engine),this.indicatorModalManager.init(this.allIndicators,this.favoriteIndicators),this.indicatorModal=document.getElementById("chartIndicatorModal")},createChartSettingsModal:function(){this.chartSettingsModalManager=new C(this.engine),this.chartSettingsModalManager.init()},showIndicatorModal:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null===(e=this.indicatorModalManager)||void 0===e||e.updateIndicators(this.allIndicators,this.favoriteIndicators);var n=document.getElementById("chartIndicatorModal");n&&(n._focusInputOnShow=t),n&&window.CustomModal&&window.CustomModal.getOrCreateInstance(n).show()},hideIndicatorModal:function(){}};function Y(e){Object.keys(F).forEach(function(t){e.prototype[t]=F[t]})}const H=F}}]);