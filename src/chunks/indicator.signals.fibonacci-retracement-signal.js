"use strict";(self.webpackChunkfcsapi_chart=self.webpackChunkfcsapi_chart||[]).push([["indicator.signals.fibonacci-retracement-signal"],{1889:(e,t,o)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(e){if("string"==typeof e)return n(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,c=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return a=e.done,e},e:function(e){c=!0,l=e},f:function(){try{a||null==o.return||o.return()}finally{if(c)throw l}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=Array(t);o<t;o++)r[o]=e[o];return r}function l(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function a(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var i=o.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function c(e,t,o){return t=s(t),function(e,t){if(t&&("object"==r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,f()?Reflect.construct(t,o||[],s(e).constructor):t.apply(e,o))}function f(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(f=function(){return!!e})()}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function b(e,t){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},b(e,t)}o.r(t),o.d(t,{default:()=>u});const u=function(e){function t(e,o,r){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=c(this,t,[e,o,r])).title="Fibonacci Retracement",i.shorttitle="Fib Ret",i.precision=2,i.swingLookback=void 0!==o.swingLookback?o.swingLookback:20,i.touchTolerance=void 0!==o.touchTolerance?o.touchTolerance:.2,i.showLevels=void 0===o.showLevels||o.showLevels,i.showLabels=void 0===o.showLabels||o.showLabels,i.fibColor236=o.fibColor236||"#FF6B6B",i.fibColor382=o.fibColor382||"#4ECDC4",i.fibColor500=o.fibColor500||"#45B7D1",i.fibColor618=o.fibColor618||"#F7B731",i.fibColor786=o.fibColor786||"#5F27CD",i.panelType="main",i.plots=[{dataKey:"signals",colorKey:"fibColor618",title:"Fib Levels"}],i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}(t,e),o=t,n=[{key:"getSettingsConfig",value:function(){return{inputs:[{key:"swingLookback",label:"Swing Lookback",type:"number",default:20,min:10,max:100,step:5},{key:"touchTolerance",label:"Touch Tolerance %",type:"number",default:.2,min:.1,max:1,step:.1},{key:"showLevels",label:"Show Fib Levels",type:"checkbox",default:!0},{key:"showLabels",label:"Show Labels",type:"checkbox",default:!0}],style:[{key:"fibColor236",label:"23.6% Level",type:"color",default:"#FF6B6B"},{key:"fibColor382",label:"38.2% Level",type:"color",default:"#4ECDC4"},{key:"fibColor500",label:"50.0% Level",type:"color",default:"#45B7D1"},{key:"fibColor618",label:"61.8% Level",type:"color",default:"#F7B731"},{key:"fibColor786",label:"78.6% Level",type:"color",default:"#5F27CD"}]}}}],(r=[{key:"calculate",value:function(){for(var e=this.engine.data,t=[],o=e.map(function(){return null}),r=[],i=this.swingLookback;i<e.length-this.swingLookback;i++){for(var n=!0,l=1;l<=this.swingLookback;l++)if(e[i-l].high>=e[i].high||e[i+l].high>=e[i].high){n=!1;break}for(var a=!0,c=1;c<=this.swingLookback;c++)if(e[i-c].low<=e[i].low||e[i+c].low<=e[i].low){a=!1;break}(n||a)&&t.push({index:i,isHigh:n,isLow:a,price:n?e[i].high:e[i].low})}for(var f=1;f<t.length;f++){var s=t[f-1],b=t[f];if(s.isHigh!==b.isHigh){var u=Math.max(s.price,b.price),h=Math.min(s.price,b.price),d=u-h,p={startIndex:Math.min(s.index,b.index),endIndex:Math.max(s.index,b.index),high:u,low:h,fib236:h+.236*d,fib382:h+.382*d,fib500:h+.5*d,fib618:h+.618*d,fib786:h+.786*d};r.push(p);for(var v=p.endIndex+1;v<e.length;v++)for(var y=e[v],g=y.close*(this.touchTolerance/100),w=0,m=[{level:p.fib236,name:"23.6%",color:this.fibColor236},{level:p.fib382,name:"38.2%",color:this.fibColor382},{level:p.fib500,name:"50.0%",color:this.fibColor500},{level:p.fib618,name:"61.8%",color:this.fibColor618},{level:p.fib786,name:"78.6%",color:this.fibColor786}];w<m.length;w++){var k=m[w];(Math.abs(y.close-k.level)<=g||y.low<=k.level&&y.high>=k.level)&&(o[v]||(o[v]={type:"fib_touch",level:k.name,price:k.level,color:k.color}))}}}this.data={signals:o,fibLevels:r}}},{key:"render",value:function(e,t){if(this.visible&&this.data){var o=e.ctx,r=e.getDpr(),n=this.engine,l=n.data;if(this.data.signals&&this.data.signals.length===l.length||(this.calculate(),this.data&&this.data.signals)){o.save(),o.scale(r,r);var a=n.visibleRange;if(this.showLevels&&this.data.fibLevels){var c,f=i(this.data.fibLevels);try{for(f.s();!(c=f.n()).done;){var s=c.value;s.endIndex>=a.start-50&&s.startIndex<=a.end&&this.drawFibLevels(o,n,s,a)}}catch(p){f.e(p)}finally{f.f()}}for(var b=a.start;b<a.end;b++)if(!(b<0||b>=this.data.signals.length)){var u=this.data.signals[b];if(u){var h=n.indexToX(b)+n.candleWidth/2,d=n.priceToY(u.price);this.drawFibTouch(o,h,d,u.color),this.showLabels&&this.drawLabel(o,h,d,u.level,u.color)}}o.restore()}}}},{key:"drawFibLevels",value:function(e,t,o,r){for(var i=t.indexToX(Math.max(o.startIndex,r.start)),n=t.indexToX(Math.min(o.endIndex+50,r.end))+t.candleWidth,l=0,a=[{price:o.fib236,color:this.fibColor236,label:"23.6"},{price:o.fib382,color:this.fibColor382,label:"38.2"},{price:o.fib500,color:this.fibColor500,label:"50.0"},{price:o.fib618,color:this.fibColor618,label:"61.8"},{price:o.fib786,color:this.fibColor786,label:"78.6"}];l<a.length;l++){var c=a[l],f=t.priceToY(c.price);e.strokeStyle=c.color+"30",e.lineWidth=1,e.setLineDash([4,4]),e.beginPath(),e.moveTo(i,f),e.lineTo(n,f),e.stroke(),e.fillStyle=c.color,e.font="bold 9px sans-serif",e.textAlign="left",e.fillText(c.label,i+3,f-2)}e.setLineDash([])}},{key:"drawFibTouch",value:function(e,t,o,r){e.fillStyle=r,e.strokeStyle=r,e.lineWidth=2,e.beginPath(),e.moveTo(t,o-5),e.lineTo(t+5,o),e.lineTo(t,o+5),e.lineTo(t-5,o),e.closePath(),e.fill()}},{key:"drawLabel",value:function(e,t,o,r,i){e.font="bold 8px sans-serif",e.fillStyle=i,e.textAlign="center",e.fillText(r,t,o-10)}}])&&l(o.prototype,r),n&&l(o,n),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,r,n}(o(8018).A)}}]);