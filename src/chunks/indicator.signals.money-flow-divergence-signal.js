"use strict";(self.webpackChunkfcsapi_chart=self.webpackChunkfcsapi_chart||[]).push([["indicator.signals.money-flow-divergence-signal"],{9116:(e,t,i)=>{function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function r(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,n(o.key),o)}}function n(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}function l(e,t,i){return t=s(t),function(e,t){if(t&&("object"==o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,a()?Reflect.construct(t,i||[],s(e).constructor):t.apply(e,i))}function a(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(a=function(){return!!e})()}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function h(e,t){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},h(e,t)}i.r(t),i.d(t,{default:()=>c});const c=function(e){function t(e,i,o){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=l(this,t,[e,i,o])).title="Money Flow Divergence",r.shorttitle="MFI Div",r.precision=2,r.mfiPeriod=void 0!==i.mfiPeriod?i.mfiPeriod:14,r.pivotLookback=void 0!==i.pivotLookback?i.pivotLookback:3,r.minDivergenceStrength=void 0!==i.minDivergenceStrength?i.minDivergenceStrength:5,r.showLabels=void 0===i.showLabels||i.showLabels,r.bullishColor=i.bullishColor||"#00E676",r.bearishColor=i.bearishColor||"#FF1744",r.panelType="main",r.plots=[{dataKey:"signals",colorKey:"bullishColor",title:"MFI Divergence"}],r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(t,e),i=t,n=[{key:"getSettingsConfig",value:function(){return{inputs:[{key:"mfiPeriod",label:"MFI Period",type:"number",default:14,min:7,max:30,step:1},{key:"pivotLookback",label:"Pivot Lookback",type:"number",default:3,min:2,max:10,step:1},{key:"minDivergenceStrength",label:"Min Divergence",type:"number",default:5,min:2,max:20,step:1},{key:"showLabels",label:"Show Labels",type:"checkbox",default:!0}],style:[{key:"bullishColor",label:"Bullish Divergence",type:"color",default:"#00E676"},{key:"bearishColor",label:"Bearish Divergence",type:"color",default:"#FF1744"}]}}}],(o=[{key:"calculate",value:function(){for(var e=this.engine.data,t=this.calculateMFI(e),i=this.findPivots(e,"price"),o=this.findPivots(t,"mfi"),r=e.map(function(){return null}),n=1;n<i.lows.length;n++){var l=i.lows[n-1],a=i.lows[n],s=this.findClosestPivot(o.lows,l.index),h=this.findClosestPivot(o.lows,a.index);if(-1!==s&&-1!==h){var c=o.lows[s],u=o.lows[h];if(a.price<l.price&&u.value>c.value){var f=Math.abs(u.value-c.value);f>=this.minDivergenceStrength&&!r[a.index]&&(r[a.index]={type:"bullish",price:a.price,strength:f})}}}for(var v=1;v<i.highs.length;v++){var b=i.highs[v-1],p=i.highs[v],d=this.findClosestPivot(o.highs,b.index),g=this.findClosestPivot(o.highs,p.index);if(-1!==d&&-1!==g){var y=o.highs[d],m=o.highs[g];if(p.price>b.price&&m.value<y.value){var k=Math.abs(y.value-m.value);k>=this.minDivergenceStrength&&!r[p.index]&&(r[p.index]={type:"bearish",price:p.price,strength:k})}}}this.data={signals:r,mfi:t}}},{key:"calculateMFI",value:function(e){for(var t=[],i=[],o=[],r=0;r<e.length;r++){var n=e[r],l=(n.high+n.low+n.close)/3,a=l*(n.volume||1);i[r]=l,o[r]=a}for(var s=0;s<e.length;s++)if(s<this.mfiPeriod)t[s]=null;else{for(var h=0,c=0,u=s-this.mfiPeriod+1;u<=s;u++)0!==u&&(i[u]>i[u-1]?h+=o[u]:i[u]<i[u-1]&&(c+=o[u]));if(0===c)t[s]=100;else{var f=h/c;t[s]=100-100/(1+f)}}return t}},{key:"findPivots",value:function(e,t){for(var i=[],o=[],r=this.pivotLookback;r<e.length-this.pivotLookback;r++)if("price"===t){for(var n=e[r],l=!0,a=1;a<=this.pivotLookback;a++)if(e[r-a].high>=n.high||e[r+a].high>=n.high){l=!1;break}l&&i.push({index:r,price:n.high});for(var s=!0,h=1;h<=this.pivotLookback;h++)if(e[r-h].low<=n.low||e[r+h].low<=n.low){s=!1;break}s&&o.push({index:r,price:n.low})}else{if(null===e[r])continue;for(var c=!0,u=!0,f=1;f<=this.pivotLookback;f++){if(null===e[r-f]||null===e[r+f]){c=!1,u=!1;break}(e[r-f]>=e[r]||e[r+f]>=e[r])&&(c=!1),(e[r-f]<=e[r]||e[r+f]<=e[r])&&(u=!1)}c&&i.push({index:r,value:e[r]}),u&&o.push({index:r,value:e[r]})}return{highs:i,lows:o}}},{key:"findClosestPivot",value:function(e,t){for(var i=-1,o=1/0,r=0;r<e.length;r++){var n=Math.abs(e[r].index-t);n<o&&n<=10&&(o=n,i=r)}return i}},{key:"render",value:function(e,t){if(this.visible&&this.data){var i=e.ctx,o=e.getDpr(),r=this.engine,n=r.data;if(this.data.signals&&this.data.signals.length===n.length||(this.calculate(),this.data&&this.data.signals)){i.save(),i.scale(o,o);for(var l=r.visibleRange,a=l.start;a<l.end;a++)if(!(a<0||a>=this.data.signals.length)){var s=this.data.signals[a];if(s){var h=r.indexToX(a)+r.candleWidth/2,c=r.priceToY(s.price);"bullish"===s.type?(this.drawBullishDivergence(i,h,c),this.showLabels&&this.drawLabel(i,h,c,"MFI+",this.bullishColor)):"bearish"===s.type&&(this.drawBearishDivergence(i,h,c),this.showLabels&&this.drawLabel(i,h,c,"MFI-",this.bearishColor))}}i.restore()}}}},{key:"drawBullishDivergence",value:function(e,t,i){var o=20;e.strokeStyle=this.bullishColor,e.fillStyle=this.bullishColor,e.lineWidth=2,e.font="bold 12px sans-serif",e.fillText("$",t-3,i+o+4),e.beginPath(),e.moveTo(t-8,i+o+8),e.lineTo(t+8,i+o+2),e.stroke(),e.beginPath(),e.moveTo(t-8,i+o+2),e.lineTo(t+8,i+o-4),e.stroke(),e.beginPath(),e.moveTo(t+10,i+o-6),e.lineTo(t+7,i+o-3),e.lineTo(t+13,i+o-3),e.closePath(),e.fill()}},{key:"drawBearishDivergence",value:function(e,t,i){var o=20;e.strokeStyle=this.bearishColor,e.fillStyle=this.bearishColor,e.lineWidth=2,e.font="bold 12px sans-serif",e.fillText("$",t-3,i-o+4),e.beginPath(),e.moveTo(t-8,i-o-8),e.lineTo(t+8,i-o-2),e.stroke(),e.beginPath(),e.moveTo(t-8,i-o-2),e.lineTo(t+8,i-o+4),e.stroke(),e.beginPath(),e.moveTo(t+10,i-o+6),e.lineTo(t+7,i-o+3),e.lineTo(t+13,i-o+3),e.closePath(),e.fill()}},{key:"drawLabel",value:function(e,t,i,o,r){e.font="bold 9px sans-serif",e.fillStyle=r,e.textAlign="center";var n="MFI+"===o?40:-35;e.fillText(o,t,i+n)}}])&&r(i.prototype,o),n&&r(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}(i(8018).A)}}]);