"use strict";(self.webpackChunkfcsapi_chart=self.webpackChunkfcsapi_chart||[]).push([["src_core_TimeRangeSelector_js"],{8655:(e,t,a)=>{a.r(t),a.d(t,{default:()=>d});var n=a(6626),o=a(5367);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function l(){var e,t,a="function"==typeof Symbol?Symbol:{},n=a.iterator||"@@iterator",o=a.toStringTag||"@@toStringTag";function i(a,n,o,i){var l=n&&n.prototype instanceof c?n:c,f=Object.create(l.prototype);return r(f,"_invoke",function(a,n,o){var i,l,r,c=0,f=o||[],u=!1,d={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,a){return i=t,l=0,r=e,d.n=a,s}};function h(a,n){for(l=a,r=n,t=0;!u&&c&&!o&&t<f.length;t++){var o,i=f[t],h=d.p,m=i[2];a>3?(o=m===n)&&(r=i[(l=i[4])?5:(l=3,3)],i[4]=i[5]=e):i[0]<=h&&((o=a<2&&h<i[1])?(l=0,d.v=n,d.n=i[1]):h<m&&(o=a<3||i[0]>n||n>m)&&(i[4]=a,i[5]=n,d.n=m,l=0))}if(o||a>1)return s;throw u=!0,n}return function(o,f,m){if(c>1)throw TypeError("Generator is already running");for(u&&1===f&&h(f,m),l=f,r=m;(t=l<2?e:r)||!u;){i||(l?l<3?(l>1&&(d.n=-1),h(l,r)):d.n=r:d.v=r);try{if(c=2,i){if(l||(o="next"),t=i[o]){if(!(t=t.call(i,r)))throw TypeError("iterator result is not an object");if(!t.done)return t;r=t.value,l<2&&(l=0)}else 1===l&&(t=i.return)&&t.call(i),l<2&&(r=TypeError("The iterator does not provide a '"+o+"' method"),l=1);i=e}else if((t=(u=d.n<0)?r:a.call(n,d))!==s)break}catch(t){i=e,l=1,r=t}finally{c=1}}return{value:t,done:u}}}(a,o,i),!0),f}var s={};function c(){}function f(){}function u(){}t=Object.getPrototypeOf;var d=[][n]?t(t([][n]())):(r(t={},n,function(){return this}),t),h=u.prototype=c.prototype=Object.create(d);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,r(e,o,"GeneratorFunction")),e.prototype=Object.create(h),e}return f.prototype=u,r(h,"constructor",u),r(u,"constructor",f),f.displayName="GeneratorFunction",r(u,o,"GeneratorFunction"),r(h),r(h,o,"Generator"),r(h,n,function(){return this}),r(h,"toString",function(){return"[object Generator]"}),(l=function(){return{w:i,m}})()}function r(e,t,a,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}r=function(e,t,a,n){function i(t,a){r(e,t,function(e){return this._invoke(t,a,e)})}t?o?o(e,t,{value:a,enumerable:!n,configurable:!n,writable:!n}):e[t]=a:(i("next",0),i("throw",1),i("return",2))},r(e,t,a,n)}function s(e,t,a,n,o,i,l){try{var r=e[i](l),s=r.value}catch(e){return void a(e)}r.done?t(s):Promise.resolve(s).then(n,o)}function c(e){return function(){var t=this,a=arguments;return new Promise(function(n,o){var i=e.apply(t,a);function l(e){s(i,n,o,l,r,"next",e)}function r(e){s(i,n,o,l,r,"throw",e)}l(void 0)})}}function f(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,u(n.key),n)}}function u(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}const d=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.chart=t,this.timeframeAggregator=new o.A,this.container=null,this.activeRange=null,this.clockInterval=null,this.lastClockText="",this.lastGoToDate=null;var a=t.options.timezone;a&&"local"!==a?(this.timezoneOffset=this.parseTimezoneString(a),this.selectedTimezone=this.getTimezoneLabel(this.timezoneOffset)):(this.timezoneOffset=-(new Date).getTimezoneOffset(),this.selectedTimezone=this.getLocalTimezoneName()),this.ranges={"1D":{label:"1D",period:"5m",length:300,durationMs:864e5,tooltip:"1 day in 5 minute intervals"},"5D":{label:"5D",period:"15m",length:500,durationMs:432e6,tooltip:"5 days in 15 minute intervals"},"1M":{label:"1M",period:"2h",length:400,durationMs:2592e6,tooltip:"1 month in 2 hour intervals"},"3M":{label:"3M",period:"4h",length:550,durationMs:7776e6,tooltip:"3 months in 4 hour intervals"},"6M":{label:"6M",period:"8h",length:550,durationMs:15552e6,tooltip:"6 months in 8 hour intervals"},YTD:{label:"YTD",period:"1D",length:600,durationMs:"YTD",tooltip:"Year to date in 1 day intervals"},"1Y":{label:"1Y",period:"1D",length:600,durationMs:31536e6,tooltip:"1 year in 1 day intervals"},"5Y":{label:"5Y",period:"1W",length:600,durationMs:15768e7,tooltip:"5 years in 1 week intervals"}}},t=[{key:"initialize",value:function(){var e=this;this.createDatePickerModal(),this.container=document.createElement("div"),this.container.className="fcsapi-time-range-toolbar",this.container.setAttribute("data-chart-id",this.chart.container.id),this.container.setAttribute("data-chart-index",this.chart.container.dataset.chartIndex||"1");var t=document.createElement("div");t.className="fcsapi-time-range-buttons",Object.keys(this.ranges).forEach(function(a){var n=e.ranges[a],o=e.createButton(a,n);t.appendChild(o)});var a=document.createElement("div");a.className="toolbar-separator",t.appendChild(a);var n=this.createCustomDateButton();t.appendChild(n),this.container.appendChild(t),this.createMobileDropdown(),this.chart.parentContainer.appendChild(this.container),this.createClock(),this.startClock()}},{key:"createClock",value:function(){var e=this,t=this.chart.container.id,a="timezoneDropdown-".concat(t),n=document.createElement("div");n.className="dropdown-select fcsapi-time-range-clock",n.setAttribute("data-dropdown-id",a),n.setAttribute("data-search","true"),n.setAttribute("data-search-placeholder","Search timezone...");var o=document.createElement("div");o.className="select-trigger fcsapi-clock-btn",o.setAttribute("tabindex","0");var i=this.formatTimezoneOffset(this.timezoneOffset);o.innerHTML='<span class="select-trigger-text">[00:00:00 '.concat(i," UTC]</span>"),n.appendChild(o);var l=[{label:"UTC-12:00 (Baker Island)",offset:-720},{label:"UTC-11:00 (American Samoa)",offset:-660},{label:"UTC-10:00 (Hawaii)",offset:-600},{label:"UTC-9:30 (Marquesas Islands)",offset:-570},{label:"UTC-9:00 (Alaska)",offset:-540},{label:"UTC-8:00 (Pacific Time)",offset:-480},{label:"UTC-7:00 (Mountain Time)",offset:-420},{label:"UTC-6:00 (Central Time)",offset:-360},{label:"UTC-5:00 (Eastern Time)",offset:-300},{label:"UTC-4:00 (Atlantic Time)",offset:-240},{label:"UTC-3:30 (Newfoundland)",offset:-210},{label:"UTC-3:00 (Argentina, Brazil)",offset:-180},{label:"UTC-2:00 (South Georgia)",offset:-120},{label:"UTC-1:00 (Azores)",offset:-60},{label:"UTC+0:00 (London, Lisbon)",offset:0},{label:"UTC+1:00 (Paris, Berlin)",offset:60},{label:"UTC+2:00 (Cairo, Athens)",offset:120},{label:"UTC+3:00 (Moscow, Istanbul)",offset:180},{label:"UTC+3:30 (Tehran, Iran)",offset:210},{label:"UTC+4:00 (Dubai, Baku)",offset:240},{label:"UTC+4:30 (Kabul, Afghanistan)",offset:270},{label:"UTC+5:00 (Pakistan, Maldives)",offset:300},{label:"UTC+5:30 (India, Sri Lanka)",offset:330},{label:"UTC+5:45 (Nepal)",offset:345},{label:"UTC+6:00 (Bangladesh, Bhutan)",offset:360},{label:"UTC+6:30 (Myanmar, Cocos)",offset:390},{label:"UTC+7:00 (Bangkok, Jakarta)",offset:420},{label:"UTC+8:00 (China, Singapore)",offset:480},{label:"UTC+8:45 (Eucla, Australia)",offset:525},{label:"UTC+9:00 (Tokyo, Seoul)",offset:540},{label:"UTC+9:30 (Adelaide, Darwin)",offset:570},{label:"UTC+10:00 (Sydney, Melbourne)",offset:600},{label:"UTC+10:30 (Lord Howe Island)",offset:630},{label:"UTC+11:00 (Solomon Islands)",offset:660},{label:"UTC+12:00 (New Zealand, Fiji)",offset:720},{label:"UTC+12:45 (Chatham Islands)",offset:765},{label:"UTC+13:00 (Tonga, Samoa)",offset:780},{label:"UTC+14:00 (Kiribati)",offset:840}].map(function(t){var a=t.offset===e.timezoneOffset?" selected":"";return'<li class="select-option timezone-item'.concat(a,'" data-value="').concat(t.offset,'" data-html="').concat(t.label,'">').concat(t.label,"</li>")}).join(""),r=document.createElement("div");r.id=a,r.className="select-dropdown fcsapi-timezone-dropdown",r.innerHTML='<ul class="select-options">'.concat(l,"</ul>"),document.body.appendChild(r),this.container.appendChild(n),new CustomSelect(n),n.addEventListener("customSelectChange",function(t){var a=parseInt(t.detail.value);e.timezoneOffset=a,e.selectedTimezone=t.detail.html||t.detail.text,e.updateClock(),e.chart.render&&e.chart.render()}),this.clockButton=o,this.timezoneDropdown=r}},{key:"createMobileDropdown",value:function(){var e=this,t=this.chart.container.id,a="rangeDropdown-".concat(t),o=document.createElement("div");o.className="fcsapi-time-range-mobile dropdown-select",o.setAttribute("data-dropdown-id",a),o.setAttribute("data-default-text","Range"),o.setAttribute("data-placement","top");var i=document.createElement("div");i.className="select-trigger",i.setAttribute("tabindex","0"),i.innerHTML='\n      <span class="select-trigger-text-nochange">Range</span>\n      <svg class="select-arrow" width="16" height="16" fill="none" stroke="currentColor"><use href="#chevron-down"></use></svg>\n    ',o.appendChild(i),this.container.appendChild(o);var l="";Object.keys(this.ranges).forEach(function(t){var a=e.ranges[t];l+='<li class="select-option" data-value="'.concat(t,'">').concat(a.label,"</li>")});var r=document.createElement("div");r.id=a,r.className="select-dropdown fcsapi-range-dropdown",r.innerHTML='\n      <div class="select-option tf-custom-option" data-value="custom" data-cm-toggle="custom-modal" data-cm-target="#datePickerModal">\n        '.concat(n.cI.calendarArrow,'\n        <span>Go to Date</span>\n      </div>\n      <ul class="select-options">').concat(l,"</ul>\n    "),document.body.appendChild(r),new CustomSelect(o);var s=r.querySelector(".tf-custom-option");s&&s.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),o.customSelectAPI&&o.customSelectAPI.close();var t=document.getElementById("datePickerModal");t&&window.CustomModal&&window.CustomModal.getOrCreateInstance(t).show()}),o.addEventListener("customSelectChange",function(t){var a=t.detail.value;a&&e.selectRange(a)}),this.mobileSelect=o,this.mobileDropdown=r}},{key:"startClock",value:function(){var e=this;this.updateClock(),this.clockInterval=setInterval(function(){e.updateClock()},1e3)}},{key:"updateClock",value:function(){if(this.clockButton){var e=new Date,t=new Date(e.getTime()+6e4*this.timezoneOffset),a=String(t.getUTCHours()).padStart(2,"0"),n=String(t.getUTCMinutes()).padStart(2,"0"),o=String(t.getUTCSeconds()).padStart(2,"0"),i=this.formatTimezoneOffset(this.timezoneOffset),l="[".concat(a,":").concat(n,":").concat(o," ").concat(i," UTC]");if(l!==this.lastClockText){var r=this.clockButton.querySelector(".select-trigger-text");r?r.textContent=l:this.clockButton.textContent=l,this.lastClockText=l}}}},{key:"formatTimezoneOffset",value:function(e){var t=e>=0?"+":"-",a=Math.abs(e),n=Math.floor(a/60),o=a%60;return"".concat(t).concat(String(n).padStart(2,"0")).concat(String(o).padStart(2,"0"))}},{key:"getTimezoneOffset",value:function(){return this.timezoneOffset}},{key:"getSelectedTimezone",value:function(){return this.selectedTimezone}},{key:"getLocalTimezoneName",value:function(){var e=this,t=[{label:"UTC-12:00 (Baker Island)",offset:-720},{label:"UTC-11:00 (American Samoa)",offset:-660},{label:"UTC-10:00 (Hawaii)",offset:-600},{label:"UTC-9:30 (Marquesas Islands)",offset:-570},{label:"UTC-9:00 (Alaska)",offset:-540},{label:"UTC-8:00 (Pacific Time)",offset:-480},{label:"UTC-7:00 (Mountain Time)",offset:-420},{label:"UTC-6:00 (Central Time)",offset:-360},{label:"UTC-5:00 (Eastern Time)",offset:-300},{label:"UTC-4:00 (Atlantic Time)",offset:-240},{label:"UTC-3:30 (Newfoundland)",offset:-210},{label:"UTC-3:00 (Argentina, Brazil)",offset:-180},{label:"UTC-2:00 (South Georgia)",offset:-120},{label:"UTC-1:00 (Azores)",offset:-60},{label:"UTC+0:00 (London, Lisbon)",offset:0},{label:"UTC+1:00 (Paris, Berlin)",offset:60},{label:"UTC+2:00 (Cairo, Athens)",offset:120},{label:"UTC+3:00 (Moscow, Istanbul)",offset:180},{label:"UTC+3:30 (Tehran, Iran)",offset:210},{label:"UTC+4:00 (Dubai, Baku)",offset:240},{label:"UTC+4:30 (Kabul, Afghanistan)",offset:270},{label:"UTC+5:00 (Pakistan, Maldives)",offset:300},{label:"UTC+5:30 (India, Sri Lanka)",offset:330},{label:"UTC+5:45 (Nepal)",offset:345},{label:"UTC+6:00 (Bangladesh, Bhutan)",offset:360},{label:"UTC+6:30 (Myanmar, Cocos)",offset:390},{label:"UTC+7:00 (Bangkok, Jakarta)",offset:420},{label:"UTC+8:00 (China, Singapore)",offset:480},{label:"UTC+8:45 (Eucla, Australia)",offset:525},{label:"UTC+9:00 (Tokyo, Seoul)",offset:540},{label:"UTC+9:30 (Adelaide, Darwin)",offset:570},{label:"UTC+10:00 (Sydney, Melbourne)",offset:600},{label:"UTC+10:30 (Lord Howe Island)",offset:630},{label:"UTC+11:00 (Solomon Islands)",offset:660},{label:"UTC+12:00 (New Zealand, Fiji)",offset:720},{label:"UTC+12:45 (Chatham Islands)",offset:765},{label:"UTC+13:00 (Tonga, Samoa)",offset:780},{label:"UTC+14:00 (Kiribati)",offset:840}].find(function(t){return t.offset===e.timezoneOffset});return t?t.label:"UTC".concat(this.formatTimezoneOffset(this.timezoneOffset))}},{key:"parseTimezoneString",value:function(e){if(!e||"UTC"===e)return 0;var t=e.match(/^([+-]?)(\d{1,2}):(\d{2})$/);return t?("-"===t[1]?-1:1)*(60*parseInt(t[2],10)+parseInt(t[3],10)):-(new Date).getTimezoneOffset()}},{key:"getTimezoneLabel",value:function(e){var t=[{label:"UTC-12:00 (Baker Island)",offset:-720},{label:"UTC-11:00 (American Samoa)",offset:-660},{label:"UTC-10:00 (Hawaii)",offset:-600},{label:"UTC-9:30 (Marquesas Islands)",offset:-570},{label:"UTC-9:00 (Alaska)",offset:-540},{label:"UTC-8:00 (Pacific Time)",offset:-480},{label:"UTC-7:00 (Mountain Time)",offset:-420},{label:"UTC-6:00 (Central Time)",offset:-360},{label:"UTC-5:00 (Eastern Time)",offset:-300},{label:"UTC-4:00 (Atlantic Time)",offset:-240},{label:"UTC-3:30 (Newfoundland)",offset:-210},{label:"UTC-3:00 (Argentina, Brazil)",offset:-180},{label:"UTC-2:00 (South Georgia)",offset:-120},{label:"UTC-1:00 (Azores)",offset:-60},{label:"UTC+0:00 (London, Lisbon)",offset:0},{label:"UTC+1:00 (Paris, Berlin)",offset:60},{label:"UTC+2:00 (Cairo, Athens)",offset:120},{label:"UTC+3:00 (Moscow, Istanbul)",offset:180},{label:"UTC+3:30 (Tehran, Iran)",offset:210},{label:"UTC+4:00 (Dubai, Baku)",offset:240},{label:"UTC+4:30 (Kabul, Afghanistan)",offset:270},{label:"UTC+5:00 (Pakistan, Maldives)",offset:300},{label:"UTC+5:30 (India, Sri Lanka)",offset:330},{label:"UTC+5:45 (Nepal)",offset:345},{label:"UTC+6:00 (Bangladesh, Bhutan)",offset:360},{label:"UTC+6:30 (Myanmar, Cocos)",offset:390},{label:"UTC+7:00 (Bangkok, Jakarta)",offset:420},{label:"UTC+8:00 (China, Singapore)",offset:480},{label:"UTC+8:45 (Eucla, Australia)",offset:525},{label:"UTC+9:00 (Tokyo, Seoul)",offset:540},{label:"UTC+9:30 (Adelaide, Darwin)",offset:570},{label:"UTC+10:00 (Sydney, Melbourne)",offset:600},{label:"UTC+10:30 (Lord Howe Island)",offset:630},{label:"UTC+11:00 (Solomon Islands)",offset:660},{label:"UTC+12:00 (New Zealand, Fiji)",offset:720},{label:"UTC+12:45 (Chatham Islands)",offset:765},{label:"UTC+13:00 (Tonga, Samoa)",offset:780},{label:"UTC+14:00 (Kiribati)",offset:840}].find(function(t){return t.offset===e});return t?t.label:"UTC".concat(this.formatTimezoneOffset(e))}},{key:"createButton",value:function(e,t){var a=this,n=document.createElement("button");return n.className="fcsapi-time-range-btn",n.setAttribute("data-range",e),n.setAttribute("data-tooltip-title",t.tooltip),n.textContent=t.label,n.addEventListener("click",function(){a.selectRange(e)}),n}},{key:"createCustomDateButton",value:function(){var e=document.createElement("button");return e.className="fcsapi-time-range-btn fcsapi-custom-date-btn toolbar-icon-btn",e.setAttribute("data-tooltip-title","Go to Date (Alt + G)"),e.setAttribute("data-cm-toggle","custom-modal"),e.setAttribute("data-cm-target","#datePickerModal"),e.innerHTML=n.cI.calendarArrow,e}},{key:"selectRange",value:function(e){var t=this.ranges[e];this.container.querySelectorAll(".fcsapi-time-range-btn").forEach(function(e){e.classList.remove("active")}),this.container.querySelector('[data-range="'.concat(e,'"]')).classList.add("active"),this.mobileSelect&&this.mobileSelect.customSelectAPI&&this.mobileSelect.customSelectAPI.setValue(e),this.activeRange=e,this.chart.chartInstance&&(this.chart.chartInstance.currentPage=1),this.chart.uiManager&&this.chart.uiManager.updateTimeframeDropdown(t.period);var a=t.durationMs;"YTD"===a&&(a=Date.now()-new Date((new Date).getFullYear(),0,1).getTime()),this.loadRangeData(t.period,t.length,null,null,a)}},{key:"loadRangeData",value:(r=c(l().m(function e(t,a){var n,o,i,r,s,c,f,u,d,h,m,p,b,v,g,T=this,C=arguments;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=C.length>2&&void 0!==C[2]?C[2]:null,o=C.length>3&&void 0!==C[3]?C[3]:null,i=C.length>4&&void 0!==C[4]?C[4]:null,this.chart.showLoading&&this.chart.showLoading(),e.p=1,r=this.chart.chartInstance,s=(null==r?void 0:r.options)||{},r&&(r.currentPage=1),c=this.chart.currentSymbol||s.symbol,f=this.timeframeAggregator.calculateAggregation(t),u=t,d=a,h=s.max_length||1e4,d&&(d=Math.max(600,Math.min(d,h))),m=d,f.isValid&&f.needsAggregation&&(u=f.source,d&&(d=Math.min(d*f.ratio,h))),p="".concat(s.apiUrl,"symbol=").concat(encodeURIComponent(c),"&period=").concat(u,"&access_key=").concat(s.accessKey,"&is_chart=1"),n&&o?p+="&from=".concat(n,"&to=").concat(o):d&&(p+="&length=".concat(d)),e.n=2,fetch(p);case 2:return b=e.v,e.n=3,b.json();case 3:if(!((v=e.v).status&&v.response&&Array.isArray(v.response))){e.n=5;break}return g=v.response,f.isValid&&f.needsAggregation&&(g=this.timeframeAggregator.processData(v.response,t)),e.n=4,this.chart.setData(g,v.info);case 4:s.period=t,m&&(s.length=m),setTimeout(function(){if(i){var e=Date.now()-i;T.zoomToTimeRange(e)}else T.zoomToShowAll()},100),e.n=6;break;case 5:case 6:e.n=8;break;case 7:e.p=7,e.v;case 8:return e.p=8,this.chart.hideLoading&&this.chart.hideLoading(),e.f(8);case 9:return e.a(2)}},e,this,[[1,7,8,9]])})),function(e,t){return r.apply(this,arguments)})},{key:"zoomToTimeRange",value:function(e){var t=this.chart.data;if(t&&0!==t.length){for(var a=-1,n=0;n<t.length;n++)if((t[n].time>9999999999?t[n].time:1e3*t[n].time)>=e){a=n;break}-1===a&&(a=0);var o=t.length-a;o<=0||this.fitCandlesToView(o)}}},{key:"zoomToShowAll",value:function(){var e=this.chart.data;e&&0!==e.length&&this.fitCandlesToView(e.length)}},{key:"fitCandlesToView",value:function(e){var t,a,n,o;if(!(e<=0)){var i=(null===(t=(a=this.chart).calculatePriceAxisWidth)||void 0===t?void 0:t.call(a))||80,l=(this.chart.width-i)/e,r=(null===(n=this.chart.options)||void 0===n?void 0:n.candleWidth)||8,s=(null===(o=this.chart.options)||void 0===o?void 0:o.candleSpacing)||2,c=r+s,f=Math.min(1,l/c);this.chart.candleWidth=Math.max(.5,r*f),this.chart.candleSpacing=Math.max(.1,s*f),this.chart.zoomLevel=f,this.chart.scrollOffset=0,this.chart.calculateVisibleRange(),this.chart.calculatePriceRange(),this.chart.render()}}},{key:"createDatePickerModal",value:function(){var e="datePickerModal";if(!document.getElementById(e)){var t='\n      <div class="modal" id="'.concat(e,'" tabindex="-1" data-custom-modal="true">\n        <div class="modal-dialog modal-sm modal-dialog-centered">\n          <div class="modal-content">\n            <div class="modal-header cm-modal-header">\n              <h5 class="modal-title">Go to Date</h5>\n              <span class="custom-modal-close" data-cm-dismiss="custom-modal">\n                <svg width="22" height="22" fill="none" stroke="currentColor"><use href="#x"></use></svg>\n              </span>\n            </div>\n            <div class="modal-body">\n              <div class="settings-field">\n                <label>From Date</label>\n                <input type="date" class="fcsapi-date-from" />\n              </div>\n              <div class="settings-field">\n                <label>To Date</label>\n                <input type="date" class="fcsapi-date-to" />\n              </div>\n              <div class="settings-field">\n                <label>Time Period</label>\n                <select class="fcsapi-date-period-select">\n                  <option value="30m">30 Minutes</option>\n                  <option value="1h">1 Hour</option>\n                  <option value="4h">4 Hours</option>\n                  <option value="1D" selected>1 Day</option>\n                  <option value="1W">1 Week</option>\n                </select>\n              </div>\n              <div class="fcsapi-date-picker-error" style="display: none;"></div>\n            </div>\n            <div class="modal-footer">\n              <button class="btn-cancel" data-cm-dismiss="custom-modal">Cancel</button>\n              <button class="btn-apply-changes fcsapi-date-apply">Apply</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    ');document.body.insertAdjacentHTML("beforeend",t);var a=document.getElementById(e);this.setupDatePickerEvents(a)}}},{key:"openCustomDatePicker",value:function(){var e=document.getElementById("datePickerModal");e&&window.CustomModal&&window.CustomModal.getOrCreateInstance(e).show()}},{key:"setupDatePickerEvents",value:function(e){var t=this,a=e.querySelector(".fcsapi-date-from"),n=e.querySelector(".fcsapi-date-to"),o=e.querySelector(".fcsapi-date-period-select"),i=e.querySelector(".fcsapi-date-picker-error"),l=e.querySelector(".fcsapi-date-apply");e.addEventListener("show.cm.modal",function(){if(t.lastGoToDate)a.value=t.lastGoToDate.from,n.value=t.lastGoToDate.to,o.value=t.lastGoToDate.period;else{var l=new Date,r=new Date;r.setDate(l.getDate()-30),a.value=t.formatDateForInput(r),n.value=t.formatDateForInput(l),o.value="1D"}i.style.display="none",i.textContent="",t.updateDateConstraints(e)}),o.addEventListener("change",function(){return t.updateDateConstraints(e)}),n.addEventListener("change",function(){return t.updateDateConstraints(e)}),l.addEventListener("click",function(){t.applyJumpAndLive(e)})}},{key:"updateDateConstraints",value:function(e){var t=e.querySelector(".fcsapi-date-from"),a=e.querySelector(".fcsapi-date-to"),n=e.querySelector(".fcsapi-date-period-select"),o=e.querySelector(".fcsapi-date-picker-error"),i=n.value,l=a.value?new Date(a.value):new Date,r=this.getMaxDaysForPeriod(i),s=new Date(l);s.setDate(s.getDate()-r),t.setAttribute("min",this.formatDateForInput(s)),o.style.display="none",o.textContent=""}},{key:"calculateCandleCount",value:function(e,t,a){var n={"1m":1,"5m":5,"15m":15,"30m":30,"1h":60,"2h":120,"4h":240,"8h":480,"1D":1440,"1W":10080,"1M":43200}[a]||60,o=(t.getTime()-e.getTime())/6e4;return Math.ceil(o/n)}},{key:"applyJumpAndLive",value:function(e){var t,a=e.querySelector(".fcsapi-date-from"),n=e.querySelector(".fcsapi-date-to"),o=e.querySelector(".fcsapi-date-period-select"),i=e.querySelector(".fcsapi-date-picker-error"),l=new Date(a.value),r=new Date(n.value),s=o.value,c=new Date;if(i.style.display="none",i.textContent="",!a.value||!n.value)return i.textContent="Please select both From and To dates",void(i.style.display="block");if(l>=r)return i.textContent="From date must be before To date",void(i.style.display="block");if(l>=c)return i.textContent="From date must be in the past",void(i.style.display="block");var f=this.calculateCandleCount(l,c,s);if(f>((null===(t=this.chart)||void 0===t||null===(t=t.chartInstance)||void 0===t||null===(t=t.options)||void 0===t?void 0:t.replayDataLength)||5760)){var u=this.getPeriodLabel(s),d=this.getMaxDaysForPeriod(s),h=new Date(c);return h.setDate(h.getDate()-d),i.innerHTML="Date range too large for <strong>".concat(u,"</strong> period.<br>Earliest allowed: <strong>").concat(this.formatDateForDisplay(h),"</strong>"),void(i.style.display="block")}var m=f+200;this.lastGoToDate={from:a.value,to:n.value,period:s},this.chart.uiManager&&this.chart.uiManager.updateTimeframeDropdown(s),window.CustomModal&&window.CustomModal.getOrCreateInstance(e).hide();var p=l.getTime(),b=r.getTime();this.loadRangeDataWithLength(s,m,p,b),this.container.querySelectorAll(".fcsapi-time-range-btn").forEach(function(e){e.classList.remove("active")})}},{key:"loadRangeDataWithLength",value:(i=c(l().m(function e(t,a,n,o){var i,r,s,c,f,u,d,h,m,p,b,v,g=this;return l().w(function(e){for(;;)switch(e.p=e.n){case 0:return this.chart.showLoading&&this.chart.showLoading(),e.p=1,i=this.chart.chartInstance,r=(null==i?void 0:i.options)||{},i&&(i.currentPage=1),s=this.chart.currentSymbol||r.symbol,c=r.max_length||1e4,f=Math.max(600,Math.min(a,c)),u=f,d=this.timeframeAggregator.calculateAggregation(t),h=t,d.isValid&&d.needsAggregation&&(h=d.source,f=Math.min(f*d.ratio,c)),m="".concat(r.apiUrl,"symbol=").concat(encodeURIComponent(s),"&period=").concat(h,"&access_key=").concat(r.accessKey,"&is_chart=1&length=").concat(f),e.n=2,fetch(m);case 2:return p=e.v,e.n=3,p.json();case 3:if(!((b=e.v).status&&b.response&&Array.isArray(b.response))){e.n=5;break}return v=b.response,d.isValid&&d.needsAggregation&&(v=this.timeframeAggregator.processData(b.response,t)),e.n=4,this.chart.setData(v,b.info);case 4:r.period=t,r.length=u,setTimeout(function(){g.zoomToDisplayRange(n,o)},100),e.n=6;break;case 5:case 6:e.n=8;break;case 7:e.p=7,e.v;case 8:return e.p=8,this.chart.hideLoading&&this.chart.hideLoading(),e.f(8);case 9:return e.a(2)}},e,this,[[1,7,8,9]])})),function(e,t,a,n){return i.apply(this,arguments)})},{key:"zoomToDisplayRange",value:function(e,t){var a=this.chart.data;if(a&&0!==a.length){for(var n=a.length-1,o=0;o<a.length;o++)(a[o].time>9999999999?a[o].time:1e3*a[o].time)<=t&&(n=o);var i=a.length-n-1;this.chart.scrollOffset=Math.max(0,i),this.chart.calculateVisibleRange(),this.chart.calculatePriceRange(),this.chart.render()}}},{key:"getMaxDaysForPeriod",value:function(e){var t,a=(null===(t=this.chart)||void 0===t||null===(t=t.chartInstance)||void 0===t||null===(t=t.options)||void 0===t?void 0:t.replayDataLength)||5760,n={"1m":1,"5m":5,"15m":15,"30m":30,"1h":60,"4h":240,"1D":1440,"1W":10080,"1M":43200}[e]||60;return Math.floor(a*n/1440)||120}},{key:"getPeriodLabel",value:function(e){return{"30m":"30 Minutes","1h":"1 Hour","4h":"4 Hours","1D":"1 Day","1W":"1 Week"}[e]||e}},{key:"formatDateForInput",value:function(e){var t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(n)}},{key:"formatDateForDisplay",value:function(e){var t=String(e.getDate()).padStart(2,"0"),a=String(e.getMonth()+1).padStart(2,"0"),n=e.getFullYear();return"".concat(t,"/").concat(a,"/").concat(n)}},{key:"getActiveRange",value:function(){return this.activeRange}},{key:"destroy",value:function(){this.clockInterval&&(clearInterval(this.clockInterval),this.clockInterval=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container)}}],t&&f(e.prototype,t),a&&f(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,a,i,r}()}}]);