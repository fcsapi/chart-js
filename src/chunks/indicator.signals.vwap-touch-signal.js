"use strict";(self.webpackChunkfcsapi_chart=self.webpackChunkfcsapi_chart||[]).push([["indicator.signals.vwap-touch-signal"],{9636:(e,t,o)=>{function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function r(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,n(i.key),i)}}function n(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function l(e,t,o){return t=s(t),function(e,t){if(t&&("object"==i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,a()?Reflect.construct(t,o||[],s(e).constructor):t.apply(e,o))}function a(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(a=function(){return!!e})()}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}o.r(t),o.d(t,{default:()=>h});const h=function(e){function t(e,o,i){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=l(this,t,[e,o,i])).title="VWAP Touch",r.shorttitle="VWAP",r.precision=2,r.touchThreshold=void 0!==o.touchThreshold?o.touchThreshold:.3,r.resetPeriod=o.resetPeriod||"daily",r.minBounceStrength=void 0!==o.minBounceStrength?o.minBounceStrength:.2,r.showLabels=void 0===o.showLabels||o.showLabels,r.showVwapLine=void 0===o.showVwapLine||o.showVwapLine,r.bullishColor=o.bullishColor||"#00E676",r.bearishColor=o.bearishColor||"#FF1744",r.vwapLineColor=o.vwapLineColor||"#2196F3",r.panelType="main",r.plots=[{dataKey:"signals",colorKey:"bullishColor",title:"VWAP Touch"},{dataKey:"vwap",colorKey:"vwapLineColor",title:"VWAP Line"}],r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(t,e),o=t,n=[{key:"getSettingsConfig",value:function(){return{inputs:[{key:"touchThreshold",label:"Touch Threshold %",type:"number",default:.3,min:.1,max:1,step:.1},{key:"resetPeriod",label:"Reset Period",type:"select",options:["daily","session","none"],default:"daily"},{key:"minBounceStrength",label:"Min Bounce %",type:"number",default:.2,min:.1,max:1,step:.1},{key:"showLabels",label:"Show Labels",type:"checkbox",default:!0},{key:"showVwapLine",label:"Show VWAP Line",type:"checkbox",default:!0}],style:[{key:"bullishColor",label:"Bullish Touch",type:"color",default:"#00E676"},{key:"bearishColor",label:"Bearish Touch",type:"color",default:"#FF1744"},{key:"vwapLineColor",label:"VWAP Line",type:"color",default:"#2196F3"}]}}}],(i=[{key:"calculate",value:function(){for(var e=this,t=this.engine.data,o=[],i=0,r=0,n=0;n<t.length;n++){var l=t[n];this.shouldResetVwap(n,t)&&(i=0,r=0);var a=(l.high+l.low+l.close)/3,s=l.volume||1;i+=a*s,r+=s,o[n]=r>0?i/r:a}var u=t.map(function(i,r){if(0===r||!o[r]||!o[r-1])return null;var n=e.touchThreshold/100*o[r];if(Math.abs(i.close-o[r])>n)return null;if(i.close>o[r]&&t[r-1].close<=o[r-1]&&r<t.length-1){var l,a=(((null===(l=t[r+1])||void 0===l?void 0:l.close)||i.close)-i.low)/i.low*100;if(a>=e.minBounceStrength)return{type:"bullish",price:i.low,vwap:o[r],bounce:a}}if(i.close<o[r]&&t[r-1].close>=o[r-1]&&r<t.length-1){var s,u=(i.high-((null===(s=t[r+1])||void 0===s?void 0:s.close)||i.close))/i.high*100;if(u>=e.minBounceStrength)return{type:"bearish",price:i.high,vwap:o[r],bounce:u}}return null});this.data={signals:u,vwap:o}}},{key:"shouldResetVwap",value:function(e,t){if("none"===this.resetPeriod)return!1;if(0===e)return!0;var o=new Date(t[e].time),i=new Date(t[e-1].time);if("daily"===this.resetPeriod)return o.getDate()!==i.getDate();if("session"===this.resetPeriod){var r=o.getHours(),n=i.getHours();return r>=9&&n<9}return!1}},{key:"render",value:function(e,t){if(this.visible&&this.data){var o=e.ctx,i=e.getDpr(),r=this.engine,n=r.data;if(this.data.signals&&this.data.signals.length===n.length||(this.calculate(),this.data&&this.data.signals)){o.save(),o.scale(i,i);var l=r.visibleRange;this.showVwapLine&&this.data.vwap&&this.drawVwapLine(o,r,l);for(var a=l.start;a<l.end;a++)if(!(a<0||a>=this.data.signals.length)){var s=this.data.signals[a];if(s){var u=r.indexToX(a)+r.candleWidth/2,h=r.priceToY(s.price);"bullish"===s.type?(this.drawBullishTouch(o,u,h),this.showLabels&&this.drawLabel(o,u,h,"VWAP↑",this.bullishColor)):"bearish"===s.type&&(this.drawBearishTouch(o,u,h),this.showLabels&&this.drawLabel(o,u,h,"VWAP↓",this.bearishColor))}}o.restore()}}}},{key:"drawVwapLine",value:function(e,t,o){e.strokeStyle=this.vwapLineColor,e.lineWidth=1.5,e.setLineDash([5,3]),e.beginPath();for(var i=!0,r=o.start;r<o.end;r++)if(!(r<0||r>=this.data.vwap.length)&&this.data.vwap[r]){var n=t.indexToX(r)+t.candleWidth/2,l=t.priceToY(this.data.vwap[r]);i?(e.moveTo(n,l),i=!1):e.lineTo(n,l)}e.stroke(),e.setLineDash([])}},{key:"drawBullishTouch",value:function(e,t,o){e.strokeStyle=this.bullishColor,e.fillStyle=this.bullishColor,e.lineWidth=2,e.beginPath(),e.arc(t,o+20,6,0,2*Math.PI),e.stroke(),e.beginPath(),e.moveTo(t,o+20-10),e.lineTo(t-4,o+20-6),e.lineTo(t+4,o+20-6),e.closePath(),e.fill()}},{key:"drawBearishTouch",value:function(e,t,o){e.strokeStyle=this.bearishColor,e.fillStyle=this.bearishColor,e.lineWidth=2,e.beginPath(),e.arc(t,o-20,6,0,2*Math.PI),e.stroke(),e.beginPath(),e.moveTo(t,o-20+10),e.lineTo(t-4,o-20+6),e.lineTo(t+4,o-20+6),e.closePath(),e.fill()}},{key:"drawLabel",value:function(e,t,o,i,r){e.font="bold 9px sans-serif",e.fillStyle=r,e.textAlign="center";var n=i.includes("↑")?40:-35;e.fillText(i,t,o+n)}}])&&r(o.prototype,i),n&&r(o,n),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,i,n}(o(8018).A)}}]);