"use strict";(self.webpackChunkfcsapi_chart=self.webpackChunkfcsapi_chart||[]).push([["src_core_ShortcutManager_js"],{5221:(e,t,a)=>{function r(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return n(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,s=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){s=!0,l=e},f:function(){try{o||null==a.return||a.return()}finally{if(s)throw l}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach(function(t){o(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function o(e,t,a){return(t=u(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function c(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,u(r.key),r)}}function u(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}a.r(t),a.d(t,{default:()=>h});var d="shortcutHelpModal";const h=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.chart=t,this.shortcuts=new Map,this.enabled=!0,this.clipboard=null,this.handleKeyDown=this.handleKeyDown.bind(this),this.registerDefaults(),this.bindEvents()},t=[{key:"registerDefaults",value:function(){var e=this;this.register("alt+t","Trend Line",function(){return e.selectLineTool("trendline")},"Drawing"),this.register("alt+h","Horizontal Line",function(){return e.selectLineTool("horizontal")},"Drawing"),this.register("alt+v","Vertical Line",function(){return e.selectLineTool("vertical")},"Drawing"),this.register("alt+c","Cross Line",function(){return e.selectLineTool("cross")},"Drawing"),this.register("alt+j","Ray",function(){return e.selectLineTool("ray")},"Drawing"),this.register("alt+e","Extended Line",function(){return e.selectLineTool("extended")},"Drawing"),this.register("alt+m","Info Line",function(){return e.selectLineTool("infoline")},"Drawing"),this.register("alt+f","Fibonacci Retracement",function(){return e.selectFibTool("fibonacci")},"Drawing"),this.register("alt+shift+r","Rectangle",function(){return e.selectShapeTool("rectangle")},"Drawing"),this.register("alt+shift+a","Arrow",function(){return e.selectShapeTool("arrow")},"Drawing"),this.register("alt+n","Text Note",function(){return e.selectTextTool("note")},"Drawing"),this.register("alt+b","Brush (Freehand)",function(){return e.selectShapeTool("brush")},"Drawing"),this.register("alt+shift+p","Parallel Channel",function(){return e.selectLineTool("parallelchannel")},"Drawing"),this.register("alt+shift+e","Ellipse",function(){return e.selectShapeTool("ellipse")},"Drawing"),this.register("ctrl+z","Undo",function(){var t,a;return null===(t=(a=e.chart).undo)||void 0===t?void 0:t.call(a)},"Edit"),this.register("ctrl+y","Redo",function(){var t,a;return null===(t=(a=e.chart).redo)||void 0===t?void 0:t.call(a)},"Edit"),this.register("ctrl+shift+z","Redo",function(){var t,a;return null===(t=(a=e.chart).redo)||void 0===t?void 0:t.call(a)},"Edit"),this.register("ctrl+s","Save Template",function(){return e.saveTemplate()},"Edit"),this.register("ctrl+shift+s","Save Template As",function(){return e.saveTemplateAs()},"Edit"),this.register("Delete","Delete Selected",function(){return e.deleteSelected()},"Edit"),this.register("alt+shift+Delete","Delete All",function(){return e.deleteAll()},"Edit"),this.register("ctrl+c","Copy Drawing",function(){return e.copySelected()},"Edit"),this.register("ctrl+v","Paste Drawing",function(){return e.pasteDrawing()},"Edit"),this.register("alt+d","Duplicate Drawing",function(){return e.duplicateSelected()},"Edit"),this.register("ctrl+a","Select All Drawings",function(){return e.selectAllDrawings()},"Edit"),this.register("escape","Cancel / Deselect",function(){return e.cancelOrDeselect()},"Edit"),this.register("ArrowLeft","Move Chart Left",function(){return e.moveChart(1)},"Navigation"),this.register("ArrowRight","Move Chart Right",function(){return e.moveChart(-1)},"Navigation"),this.register("ctrl+ArrowLeft","Move Chart Left (Fast)",function(){return e.moveChart(10)},"Navigation"),this.register("ctrl+ArrowRight","Move Chart Right (Fast)",function(){return e.moveChart(-10)},"Navigation"),this.register("ctrl+ArrowUp|=","Zoom In (Candle Width)",function(){return e.zoom(1.2)},"Navigation"),this.register("ctrl+ArrowDown|-","Zoom Out (Candle Width)",function(){return e.zoom(.8)},"Navigation"),this.register("ctrl+ArrowUp",null,function(){return e.zoom(1.2)},"Navigation"),this.register("ctrl+ArrowDown",null,function(){return e.zoom(.8)},"Navigation"),this.register("=",null,function(){return e.zoom(1.2)},"Navigation"),this.register("-",null,function(){return e.zoom(.8)},"Navigation"),this.register("alt+r","Reset Chart",function(){return e.resetChart()},"Navigation"),this.register("ctrl+0","Reset Zoom",function(){return e.resetZoom()},"Navigation"),this.register("home","Go to Latest Candle",function(){return e.goToChartEnd()},"Navigation"),this.register("end","Go to First Previous Candle",function(){return e.goToChartStart()},"Navigation"),this.register("1","Change Interval",function(){return e.openTimeframeDialog("1")},"Timeframe"),this.register("2","Change Interval",function(){return e.openTimeframeDialog("2")},"Timeframe"),this.register("3","Change Interval",function(){return e.openTimeframeDialog("3")},"Timeframe"),this.register("4","Change Interval",function(){return e.openTimeframeDialog("4")},"Timeframe"),this.register("5","Change Interval",function(){return e.openTimeframeDialog("5")},"Timeframe"),this.register("6","Change Interval",function(){return e.openTimeframeDialog("6")},"Timeframe"),this.register("7","Change Interval",function(){return e.openTimeframeDialog("7")},"Timeframe"),this.register("8","Change Interval",function(){return e.openTimeframeDialog("8")},"Timeframe"),this.register("9","Change Interval",function(){return e.openTimeframeDialog("9")},"Timeframe"),this.register("alt+g|0","Go to Date",function(){return e.goToDate()},"Settings"),this.register("alt+g",null,function(){return e.goToDate()},"Settings"),this.register("0",null,function(){return e.goToDate()},"Settings"),this.register("alt+l","Toggle Log Scale",function(){return e.toggleLogScale()},"Settings"),this.register("alt+p","Toggle Percent Scale",function(){return e.togglePercentScale()},"Settings"),this.register("alt+i","Invert Scale",function(){return e.invertScale()},"Settings"),this.register("alt+ArrowLeft","Step Replay Forward",function(){return e.stepReplayBackward()},"Replay"),this.register("alt+ArrowRight","Step Replay Backward",function(){return e.stepReplayForward()},"Replay"),this.register("space","Play/Pause Replay",function(){return e.toggleReplayPlayPause()},"Replay"),this.register("/","Open Indicators",function(){return e.openIndicators()},"Indicators"),this.register("ctrl+alt+h","Hide All Drawings",function(){return e.toggleDrawingsVisibility()},"Indicators"),this.register("shift+?|f1","Show Shortcuts Help",function(){return e.showHelp()},"Help"),this.register("shift+?",null,function(){return e.showHelp()},"Help"),this.register("f1",null,function(){return e.showHelp()},"Help"),this.register("alt+s","Take Screenshot",function(){return e.takeScreenshot()},"Export")}},{key:"register",value:function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"General",n=this.normalizeShortcut(e);this.shortcuts.set(n,{shortcut:e,description:t,callback:a,category:r})}},{key:"unregister",value:function(e){var t=this.normalizeShortcut(e);this.shortcuts.delete(t)}},{key:"normalizeShortcut",value:function(e){return e.toLowerCase().replace("control","ctrl").replace("option","alt").replace("command","meta").replace("cmd","meta")}},{key:"bindEvents",value:function(){window.addEventListener("keydown",this.handleKeyDown,!0)}},{key:"handleKeyDown",value:function(e){if(this.enabled){var t=e.target;if("INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName&&!t.isContentEditable||"Escape"===e.key){if(this.isModalOpen()&&"Escape"!==e.key){var a=document.getElementById("drawingQuickToolbarModal");if(!(null==a?void 0:a.classList.contains("show"))||!["Delete","c","v"].includes(e.key)&&(!e.ctrlKey||"c"!==e.key&&"v"!==e.key))return}if("Escape"===e.key&&document.querySelector('.modal.show[data-custom-modal="true"]:not([data-cm-persistent="true"])'))return;if(this.chart.multiChartManager&&this.chart.multiChartManager.isActive()&&!this.chart.container.classList.contains("active-chart"))return;var r=[];(e.ctrlKey||e.metaKey)&&r.push("ctrl"),e.altKey&&r.push("alt"),e.shiftKey&&r.push("shift");var n=e.key;if(" "===n&&(n="space"),n=n.toLowerCase(),!["control","alt","shift","meta"].includes(n)){r.push(n);var i=r.join("+"),l=this.shortcuts.get(i);if(l){e.preventDefault(),e.stopPropagation();try{l.callback()}catch(o){}}else e.ctrlKey||e.altKey||e.metaKey||!this.isSearchableKey(e.key)||(this.openSearchWithChar(e.key),e.preventDefault(),e.stopPropagation())}}}}},{key:"isSearchableKey",value:function(e){return/^[a-zA-Z]$/.test(e)}},{key:"openSearchWithChar",value:function(e){var t=document.getElementById("chartSearchModal");if(t&&!t.classList.contains("show")){window._fcsapiSearchManager&&(window._fcsapiSearchManager.targetChartId=this.chart.container.id);var a=window.CustomModal;if(a){var r=a.getOrCreateInstance(t);null==r||r.show()}setTimeout(function(){var a=t.querySelector("#chartSearchModal-input");a&&(a.value=e,a.focus(),a.dispatchEvent(new Event("input",{bubbles:!0})))},150)}}},{key:"isModalOpen",value:function(){return document.querySelectorAll('.modal.show[data-custom-modal="true"]:not([data-cm-persistent="true"])').length>0||[".fcsapi-indicator-dialog",".settings-dialog-overlay"].some(function(e){var t=document.querySelector(e);if(!t)return!1;var a=window.getComputedStyle(t);return"none"!==a.display&&"hidden"!==a.visibility&&"0"!==a.opacity})}},{key:"selectLineTool",value:function(e){var t={id:e,label:e};this.chart.uiManager&&(this.chart.uiManager.selectTool("lines",t),this.activateSidebarTool("lines"))}},{key:"selectFibTool",value:function(e){var t={id:e,label:e};this.chart.uiManager&&(this.chart.uiManager.selectTool("fibonacci",t),this.activateSidebarTool("fibonacci"))}},{key:"selectShapeTool",value:function(e){var t={id:e,label:e};this.chart.uiManager&&(this.chart.uiManager.selectTool("tools",t),this.activateSidebarTool("tools"))}},{key:"selectTextTool",value:function(e){var t={id:e,label:e};this.chart.uiManager&&(this.chart.uiManager.selectTool("text",t),this.activateSidebarTool("text"))}},{key:"selectPatternTool",value:function(e){var t={id:e,label:e};this.chart.uiManager&&(this.chart.uiManager.selectTool("patterns",t),this.activateSidebarTool("patterns"))}},{key:"activateSidebarTool",value:function(e){var t;if(null!==(t=this.chart.uiManager)&&void 0!==t&&t.sidebar){var a=this.chart.uiManager.sidebar;a.querySelectorAll(".sidebar-tool-btn-wrapper, .sidebar-tool-btn").forEach(function(e){e.classList.contains("keep-drawing-toggle")||e.classList.contains("magnet-toggle")||e.classList.remove("active")});var r=a.querySelector('.sidebar-tool-btn-wrapper[data-type="'.concat(e,'"]'));r&&r.classList.add("active")}}},{key:"deleteSelected",value:function(){var e,t=document.getElementById("drawingQuickToolbarModal");if(null!=t&&t.classList.contains("show")){var a=t.querySelector('[data-action="delete"]');if(a)return void a.click()}null!==(e=this.chart.drawingManager)&&void 0!==e&&e.selectedItem&&this.chart.drawingManager.deleteSelected()}},{key:"deleteAll",value:function(){var e,t,a,r,n,i,l=(null===(e=this.chart.drawingManager)||void 0===e||null===(e=e.drawings)||void 0===e?void 0:e.length)>0,o=(null===(t=this.chart.markers)||void 0===t?void 0:t.length)>0;l&&this.chart.drawingManager.clearAll(),o&&this.chart.clearMarkers(),null===(a=this.chart.uiManager)||void 0===a||null===(r=a.hideDrawingQuickToolbar)||void 0===r||r.call(a),null===(n=this.chart.uiManager)||void 0===n||null===(i=n.hideFloatingToolbar)||void 0===i||i.call(n),l||o||this.chart.render()}},{key:"copySelected",value:function(){var e,t,a=null===(e=this.chart.uiManager)||void 0===e?void 0:e.floatingToolbarItem;if(a)void 0!==a.index?this.clipboard={type:"marker",source:JSON.parse(JSON.stringify(a))}:(a.type||void 0!==a.id)&&(this.clipboard={type:"drawing",source:a,drawingType:a.type});else if(null!==(t=this.chart.drawingManager)&&void 0!==t&&t.selectedItem){var r=this.chart.drawingManager.selectedItem;this.clipboard={type:"drawing",source:r,drawingType:r.type}}}},{key:"pasteDrawing",value:function(){if(this.clipboard)if(this.clipboard.source){var e,t,a=this.chart.interactionManager,r=this.chart.canvas.getBoundingClientRect();(null==a?void 0:a.lastMouseX)>0&&(null==a?void 0:a.lastMouseY)>0?(e=a.lastMouseX,t=a.lastMouseY):(e=r.width/2,t=r.height/2);var n=this.chart.xToIndex(e),i=this.chart.yToPrice(t);if("drawing"===this.clipboard.type){var o,s,c=this.clipboard.source,u=Object.assign(Object.create(Object.getPrototypeOf(c)),c);if(u.id=this.chart.drawingManager.nextId++,u.points&&u.points.length>0){var d=u.points.reduce(function(e,t){return e+t.index},0)/u.points.length,h=u.points.reduce(function(e,t){return e+t.price},0)/u.points.length,v=n-d,g=i-h;u.points=u.points.map(function(e){return l(l({},e),{},{index:e.index+v,price:e.price+g})})}this.chart.drawingManager.drawings.push(u),this.chart.drawingManager.saveToStorage(),this.chart.drawingManager.syncDrawingToOtherCharts("add",u),null===(o=(s=this.chart).trackAction)||void 0===o||o.call(s,"drawing",u),this.chart.render()}else if("marker"===this.clipboard.type){var f=JSON.parse(JSON.stringify(this.clipboard.source));delete f.index,f.candleIndex=Math.round(n),f.price=i;var m,p,y=this.chart.addMarker(f);y&&(null===(m=(p=this.chart).trackAction)||void 0===m||m.call(p,"marker",y))}}else this.clipboard=null}},{key:"duplicateSelected",value:function(){var e,t=this.chart.uiManager;if(t){var a,r;if(null!==(e=this.chart.drawingManager)&&void 0!==e&&e.selectedItem)return t.selectedItem=this.chart.drawingManager.selectedItem,void(null===(a=t.handleContextMenuAction)||void 0===a||a.call(t,"clone"));t.floatingToolbarItem&&(t.selectedItem=t.floatingToolbarItem,null===(r=t.handleContextMenuAction)||void 0===r||r.call(t,"clone"))}}},{key:"selectAllDrawings",value:function(){var e,t;this.chart.drawingManager&&(null===(e=(t=this.chart.drawingManager).selectAll)||void 0===e||e.call(t))}},{key:"cancelOrDeselect",value:function(){var e,t,a,r,n,i,l,o,s,c,u,h=this.chart.uiManager;if(!document.querySelector('.modal.show[data-custom-modal="true"]:not([data-cm-persistent="true"])'))if(null!=h&&null!==(e=h.settingsDialog)&&void 0!==e&&e.classList.contains("visible"))null===(s=h.hideSettingsDialog)||void 0===s||s.call(h);else if(null!=h&&null!==(t=h.chartSettingsMenu)&&void 0!==t&&t.classList.contains("visible"))null===(c=h.hideChartSettingsMenu)||void 0===c||c.call(h);else if(null!=h&&null!==(a=h.blankAreaContextMenu)&&void 0!==a&&a.classList.contains("visible"))null===(u=h.hideBlankAreaContextMenu)||void 0===u||u.call(h);else if(null!=h&&null!==(r=h.contextMenu)&&void 0!==r&&r.classList.contains("visible")){var v;null===(v=h.hideContextMenu)||void 0===v||v.call(h)}else{var g=document.getElementById(d);if(null!=g&&g.classList.contains("show"))this.hideHelp();else if(null!=h&&h.floatingToolbarVisible){var f;null===(f=h.hideFloatingToolbar)||void 0===f||f.call(h)}else{if(null!==(n=this.chart.drawingManager)&&void 0!==n&&n.activeDrawing){var m,p,y,w=this.chart.drawingManager.activeDrawing;return"pathcreator"===w.type||"polygon"===w.type?void(null===(y=this.chart.interactionManager)||void 0===y||y.handleKeyDown({key:"Escape"})):void(null===(m=(p=this.chart.drawingManager).cancelDrawing)||void 0===m||m.call(p))}var b,k,M,T,S,D,C,I,E;if(null!==(i=this.chart.drawingManager)&&void 0!==i&&i.selectedItem)return null===(b=(k=this.chart.drawingManager).clearSelection)||void 0===b||b.call(k),void(null===(M=(T=this.chart).render)||void 0===M||M.call(T));null!==(l=this.chart.drawingManager)&&void 0!==l&&l.currentTool?(this.chart.drawingManager.setTool(null),h&&(null===(C=h.switchToCursorSynced)||void 0===C||C.call(h)),null===(S=(D=this.chart).render)||void 0===S||S.call(D)):null!==(o=this.chart.replayManager)&&void 0!==o&&o.isActive&&(null===(I=(E=this.chart.replayManager).stop)||void 0===I||I.call(E))}}}},{key:"cancelAction",value:function(){var e,t,a,r,n,i,l,o,s,c,u,d,h,v;null!==(e=this.chart.drawingManager)&&void 0!==e&&e.activeDrawing&&(null===(l=(o=this.chart.drawingManager).cancelDrawing)||void 0===l||l.call(o)),null!==(t=this.chart.drawingManager)&&void 0!==t&&t.selectedItem&&(null===(s=(c=this.chart.drawingManager).clearSelection)||void 0===s||s.call(c)),null!==(a=this.chart.drawingManager)&&void 0!==a&&a.currentTool&&(this.chart.drawingManager.setTool(null),this.chart.uiManager&&(null===(u=(d=this.chart.uiManager).switchToCursorSynced)||void 0===u||u.call(d))),this.hideHelp(),null!==(r=this.chart.uiManager)&&void 0!==r&&r.floatingToolbar&&(null===(h=(v=this.chart.uiManager).hideFloatingToolbar)||void 0===h||h.call(v)),null===(n=(i=this.chart).render)||void 0===n||n.call(i)}},{key:"moveChart",value:function(e){var t,a,r,n;if(this.chart){var i=this.chart.candleWidth+this.chart.candleSpacing;this.chart.scrollOffset+=e*i,null===(t=(a=this.chart).calculateVisibleRange)||void 0===t||t.call(a),null===(r=(n=this.chart).render)||void 0===r||r.call(n)}}},{key:"zoom",value:function(e){var t,a,r,n,i,l;this.chart&&(this.chart.candleWidth*=e,this.chart.candleWidth=Math.max(1,Math.min(50,this.chart.candleWidth)),null===(t=(a=this.chart).calculateVisibleRange)||void 0===t||t.call(a),null===(r=(n=this.chart).calculatePriceRange)||void 0===r||r.call(n),null===(i=(l=this.chart).render)||void 0===i||i.call(l))}},{key:"resetChart",value:function(){var e,t;null===(e=(t=this.chart).jumpToLatest)||void 0===e||e.call(t)}},{key:"resetZoom",value:function(){var e,t;null===(e=this.chart.uiManager)||void 0===e||null===(t=e.resetChartZoom)||void 0===t||t.call(e)}},{key:"goToChartStart",value:function(){var e,t,a,r,n,i,l;if(this.chart&&null!==(e=this.chart.data)&&void 0!==e&&e.length){var o=this.chart.width-(this.chart.priceAxisWidth||60),s=this.chart.candleWidth+this.chart.candleSpacing,c=Math.floor(o/s);this.chart.scrollOffset=this.chart.data.length-c,null===(t=(a=this.chart).calculateVisibleRange)||void 0===t||t.call(a),null===(r=(n=this.chart).calculatePriceRange)||void 0===r||r.call(n),null===(i=(l=this.chart).render)||void 0===i||i.call(l)}}},{key:"goToChartEnd",value:function(){var e,t;null===(e=(t=this.chart).jumpToLatest)||void 0===e||e.call(t)}},{key:"goToDate",value:function(){var e,t;null===(e=this.chart.timeRangeSelector)||void 0===e||null===(t=e.openCustomDatePicker)||void 0===t||t.call(e)}},{key:"toggleLogScale",value:function(){var e,t,a,r;this.chart.options&&(this.chart.options.logScale=!this.chart.options.logScale,null===(e=(t=this.chart).calculatePriceRange)||void 0===e||e.call(t),null===(a=(r=this.chart).render)||void 0===a||a.call(r))}},{key:"togglePercentScale",value:function(){var e,t,a,r;this.chart.options&&(this.chart.options.percentScale=!this.chart.options.percentScale,null===(e=(t=this.chart).calculatePriceRange)||void 0===e||e.call(t),null===(a=(r=this.chart).render)||void 0===a||a.call(r))}},{key:"invertScale",value:function(){var e,t;this.chart.options&&(this.chart.options.invertScale=!this.chart.options.invertScale,null===(e=(t=this.chart).render)||void 0===e||e.call(t))}},{key:"openIndicators",value:function(){var e,t;null===(e=this.chart.uiManager)||void 0===e||null===(t=e.showIndicatorModal)||void 0===t||t.call(e,!0)}},{key:"toggleDrawingsVisibility",value:function(){var e,t;null===(e=this.chart.uiManager)||void 0===e||null===(t=e.toggleAllIndicatorsVisibility)||void 0===t||t.call(e)}},{key:"takeScreenshot",value:function(){var e,t,a=null===(e=(t=this.chart).exportImage)||void 0===e?void 0:e.call(t);if(a){var r=document.createElement("a");r.download="chart-".concat(Date.now(),".png"),r.href=a,r.click()}}},{key:"saveTemplate",value:function(){var e,t;null===(e=this.chart.uiManager)||void 0===e||null===(t=e.handleTemplateSave)||void 0===t||t.call(e)}},{key:"saveTemplateAs",value:function(){var e,t;null===(e=this.chart.uiManager)||void 0===e||null===(t=e.showSaveTemplateDialog)||void 0===t||t.call(e)}},{key:"saveLayout",value:function(){var e,t=new CustomEvent("fcsapi-save-layout",{detail:{chartId:null===(e=this.chart.container)||void 0===e?void 0:e.id}});document.dispatchEvent(t)}},{key:"toggleReplayPlayPause",value:function(){var e;null!==(e=this.chart.replayManager)&&void 0!==e&&e.isActive&&(this.chart.replayManager.isPlaying?this.chart.replayManager.pause():this.chart.replayManager.play())}},{key:"stepReplayBackward",value:function(){var e;null!==(e=this.chart.replayManager)&&void 0!==e&&e.isActive&&this.chart.replayManager.skipBackward(1)}},{key:"stepReplayForward",value:function(){var e;null!==(e=this.chart.replayManager)&&void 0!==e&&e.isActive&&this.chart.replayManager.skipForward(1)}},{key:"createAlert",value:function(){var e,t=new CustomEvent("fcsapi-create-alert",{detail:{chartId:null===(e=this.chart.container)||void 0===e?void 0:e.id,symbol:this.chart.currentSymbol}});document.dispatchEvent(t)}},{key:"addToWatchlist",value:function(){var e=new CustomEvent("fcsapi-add-watchlist",{detail:{symbol:this.chart.currentSymbol}});document.dispatchEvent(e)}},{key:"nextSymbol",value:function(){var e;if(null===(e=this.chart.drawingManager)||void 0===e||!e.currentTool){var t=new CustomEvent("fcsapi-next-symbol");document.dispatchEvent(t)}}},{key:"prevSymbol",value:function(){var e;if(null===(e=this.chart.drawingManager)||void 0===e||!e.currentTool){var t=new CustomEvent("fcsapi-prev-symbol");document.dispatchEvent(t)}}},{key:"setTimeframe",value:function(e){if(this.chart.uiManager){var t,a,n=this.chart.chartInstance;if(this.chart.multiChartManager&&this.chart.multiChartManager.isActive()){var i=document.querySelector(".multi-chart-instance.active-chart");if(i){var l,o=r(this.chart.multiChartManager.chartInstances);try{for(o.s();!(l=o.n()).done;){var s=l.value;if(s.engine.container.id===i.id){n=s;break}}}catch(c){o.e(c)}finally{o.f()}}}null===(t=(a=this.chart.uiManager).updateTimeframeDropdown)||void 0===t||t.call(a,e),n&&n.setPeriod(e)}}},{key:"createTimeframeModal",value:function(){var e="timeframeModal";if(!document.getElementById(e)){var t='\n      <div class="modal" id="'.concat(e,'" tabindex="-1" data-custom-modal="true">\n        <div class="modal-dialog modal-md modal-dialog-centered">\n          <div class="modal-content">\n            <div class="modal-header cm-modal-header">\n              <h5 class="modal-title">Add Custom Interval</h5>\n              <span class="custom-modal-close" data-cm-dismiss="custom-modal">\n                <svg width="22" height="22" fill="none" stroke="currentColor"><use href="#x"></use></svg>\n              </span>\n            </div>\n            <div class="modal-body">\n              <div class="settings-field timeframe-value-field">\n                <label>Interval</label>\n                <input type="text" class="timeframe-input" maxlength="10" placeholder="15, 2H, 4D" autocomplete="off" />\n              </div>\n              <div class="timeframe-hint">Examples: 15 or 15m, 2H or 120, 1D or 24H or 1440</div>\n              <div class="timeframe-warning" style="display: none;"></div>\n            </div>\n            <div class="modal-footer">\n              <button class="btn-cancel" data-cm-dismiss="custom-modal">Cancel</button>\n              <button class="btn-apply-changes timeframe-apply-btn">Add</button>\n            </div>\n          </div>\n        </div>\n      </div>\n    ');document.body.insertAdjacentHTML("beforeend",t),this.setupTimeframeModalEvents()}}},{key:"setupTimeframeModalEvents",value:function(){var e=this,t=document.getElementById("timeframeModal");if(t){var a=t.querySelector(".timeframe-input"),r=t.querySelector(".timeframe-hint"),n=t.querySelector(".timeframe-warning"),i=t.querySelector(".timeframe-apply-btn"),l=function(e){if(!e)return"";var t=e.match(/^(\d+)([mhHdDwWM]?)$/);if(!t)return e;var a=parseInt(t[1]),r=t[2]||"m";return"".concat(a," ").concat(function(e,t){var a=parseInt(t)||1;return{m:1===a?"Minute":"Minutes",H:1===a?"Hour":"Hours",D:1===a?"Day":"Days",W:1===a?"Week":"Weeks",M:1===a?"Month":"Months"}[{h:"H",d:"D",w:"W"}[e]||e]||"Minutes"}(r,a))},o=function(){var t=a.value.trim();if(!t||""===t)return r.textContent="Examples: 15 or 15m, 2H or 120, 1D or 24H or 1440",r.className="timeframe-hint",void(n.style.display="none");var i=e.parseTimeframe(t);if(i.isValid){var o=l(i.period),s="✓ ".concat(o);i.needsAggregation&&i.source&&(s+=" — created from ".concat(i.source," candles")),r.textContent=s,r.className="timeframe-hint valid",n.style.display="none"}else{var c=l(e.normalizeTimeframeInput(t)||t);r.textContent="✗ ".concat(c||t," is not available"),r.className="timeframe-hint invalid",i.suggestion?n.innerHTML='<span class="timeframe-suggestion" data-value="'.concat(i.suggestion,'">Use <strong>').concat(i.suggestion," instead!</strong></span>"):n.innerHTML="<strong>Try a different value</strong>",n.style.display="block"}};n.addEventListener("click",function(e){var t=e.target.closest(".timeframe-suggestion");t&&(a.value=t.dataset.value,a.focus(),o())}),t.addEventListener("show.cm.modal",function(){a.value=e.pendingTimeframeValue||"",o(),t._focusInputOnShow&&(setTimeout(function(){a.focus();var e=a.value.length;a.setSelectionRange(e,e)},50),t._focusInputOnShow=!1)}),a.addEventListener("input",o),a.addEventListener("keydown",function(t){"Enter"===t.key&&(t.preventDefault(),e.applyTimeframeFromModal())}),i.addEventListener("click",function(){return e.applyTimeframeFromModal()})}}},{key:"applyTimeframeFromModal",value:function(){var e=document.getElementById("timeframeModal");if(e){var t=e.querySelector(".timeframe-input").value.trim();if(!t){var a=e.querySelector(".modal-dialog");return a.classList.add("shake"),void setTimeout(function(){return a.classList.remove("shake")},500)}var r=this.parseTimeframe(t);if(r.isValid&&r.period)!["1m","2m","3m","5m","10m","15m","30m","1H","2H","4H","6H","8H","12H","1D","1W","1M"].includes(r.period)&&this.chart.uiManager&&this.chart.uiManager.addCustomTimeframe(r.period),this.setTimeframe(r.period),this.chart.uiManager&&(this.chart.uiManager.refreshTimeframeDropdown(),this.chart.uiManager.updateTimeframeDropdown(r.period)),window.CustomModal&&window.CustomModal.getOrCreateInstance(e).hide();else{var n=e.querySelector(".modal-dialog");n.classList.add("shake"),setTimeout(function(){return n.classList.remove("shake")},500)}}}},{key:"openTimeframeDialog",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.createTimeframeModal(),this.pendingTimeframeValue=e;var t=document.getElementById("timeframeModal");t&&window.CustomModal&&(t._focusInputOnShow=!0,window.CustomModal.getOrCreateInstance(t).show())}},{key:"getTimeframeAggregator",value:function(){var e;return(null===(e=this.chart)||void 0===e||null===(e=e.chartInstance)||void 0===e?void 0:e.timeframeAggregator)||null}},{key:"normalizeTimeframeInput",value:function(e){if(!e||""===e.trim())return null;var t=e.trim(),a=t.toLowerCase();if(/^\d+$/.test(a))return"".concat(parseInt(a,10),"m");var r=a.match(/^(\d+)\s*(months?|mon)$/);if(r)return"".concat(parseInt(r[1],10),"M");var n=a.match(/^(\d+)\s*(hours?|hr)$/);if(n)return"".concat(parseInt(n[1],10),"H");var i=a.match(/^(\d+)\s*(days?)$/);if(i)return"".concat(parseInt(i[1],10),"D");var l=a.match(/^(\d+)\s*(weeks?)$/);if(l)return"".concat(parseInt(l[1],10),"W");var o=a.match(/^(\d+)\s*(mins?|minutes?)$/);if(o)return"".concat(parseInt(o[1],10),"m");var s=a.match(/^(\d+)([mhdwM])$/i);if(s){var c=parseInt(s[1],10),u=s[2].toLowerCase(),d={m:"m",h:"H",d:"D",w:"W"};if(t.match(/^\d+M$/))return"".concat(c,"M");if(d[u])return"".concat(c).concat(d[u])}return null}},{key:"generateTimeframeLabel",value:function(e){if(!e)return"";var t=e.match(/^(\d+)([mhDWM])$/);if(!t)return e;var a=parseInt(t[1],10),r={m:{singular:"Minute",plural:"Minutes"},h:{singular:"Hour",plural:"Hours"},D:{singular:"Day",plural:"Days"},W:{singular:"Week",plural:"Weeks"},M:{singular:"Month",plural:"Months"}}[t[2]];return r?"".concat(a," ").concat(1===a?r.singular:r.plural):e}},{key:"parseTimeframe",value:function(e){if(!e||""===e.trim())return{period:null,label:null,isValid:!1};var t=this.normalizeTimeframeInput(e);if(!t)return{period:null,label:null,isValid:!1,error:"Invalid format"};var a=this.getTimeframeAggregator();if(a){var r=a.validateTimeframe(t);return r.isValid?{period:r.targetPeriod,label:this.generateTimeframeLabel(r.targetPeriod),isValid:!0,source:r.source,ratio:r.ratio,needsAggregation:r.needsAggregation}:{period:t,label:null,isValid:!1,error:r.error,suggestion:r.suggestion}}return(window.FCS_VALID_TIMEFRAMES||["1m","2m","3m","5m","10m","15m","30m","1h","2h","4h","8h","12h","1D","1W","1M"]).includes(t)?{period:t,label:this.generateTimeframeLabel(t),isValid:!0}:{period:t,label:null,isValid:!1}}},{key:"createHelpModal",value:function(){var e=this;if(!document.getElementById(d)){var t=new Map;this.shortcuts.forEach(function(e,a){e.description&&(t.has(e.category)||t.set(e.category,[]),t.get(e.category).push({key:e.shortcut,description:e.description}))}),t.set("Symbol Search",[{key:"A-Z",description:"Open Symbol Search"}]),t.set("Mouse",[{key:"Scroll",description:"Zoom In / Out"},{key:"Click+Drag",description:"Pan Chart"}]);var a="";t.forEach(function(t,r){var n=t.map(function(t){return'\n        <div class="shortcut-item">\n          <span class="shortcut-keys">'.concat(e.formatShortcutDisplay(t.key),'</span>\n          <span class="shortcut-desc">').concat(t.description,"</span>\n        </div>\n      ")}).join("");a+='\n        <div class="shortcut-category">\n          <h3>'.concat(r,'</h3>\n          <div class="shortcut-list">').concat(n,"</div>\n        </div>\n      ")});var r='\n      <div class="modal" id="'.concat(d,'" tabindex="-1" data-custom-modal="true">\n        <div class="modal-dialog modal-lg modal-dialog-centered">\n          <div class="modal-content">\n            <div class="modal-header cm-modal-header">\n              <h5 class="modal-title">Keyboard Shortcuts</h5>\n              <span class="custom-modal-close" data-cm-dismiss="custom-modal">\n                <svg width="22" height="22" fill="none" stroke="currentColor"><use href="#x"></use></svg>\n              </span>\n            </div>\n            <div class="modal-body">\n              <div class="shortcut-help-content">').concat(a,"</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    ");document.body.insertAdjacentHTML("beforeend",r)}}},{key:"showHelp",value:function(){this.createHelpModal();var e=document.getElementById(d);e&&window.CustomModal&&window.CustomModal.getOrCreateInstance(e).show()}},{key:"hideHelp",value:function(){var e=document.getElementById(d);e&&window.CustomModal&&window.CustomModal.getOrCreateInstance(e).hide()}},{key:"formatShortcutDisplay",value:function(e){var t=this,a=e.toLowerCase();return"a-z"===a?'<kbd>A</kbd><span class="shortcut-plus">-</span><kbd>Z</kbd>':"scroll"===a?"<kbd>Scroll</kbd>":"click+drag"===a?'<kbd>Click</kbd><span class="shortcut-plus">+</span><kbd>Drag</kbd>':e.includes("|")?e.split("|").map(function(e){return t.formatSingleShortcut(e)}).join('<span class="shortcut-or">or</span>'):this.formatSingleShortcut(e)}},{key:"formatSingleShortcut",value:function(e){var t=function(e){return'<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="transform: rotate('.concat(e,'deg)"><path d="M6 9l6 6 6-6" stroke-linecap="round" stroke-linejoin="round"/></svg>')};return e.split("+").map(function(e){var a=e.toLowerCase();return"ctrl"===a?"<kbd>Ctrl</kbd>":"alt"===a?"<kbd>Alt</kbd>":"shift"===a?"<kbd>Shift</kbd>":"meta"===a?"<kbd>Cmd</kbd>":"arrowleft"===a?"<kbd>".concat(t(90),"</kbd>"):"arrowright"===a?"<kbd>".concat(t(-90),"</kbd>"):"arrowup"===a?"<kbd>".concat(t(180),"</kbd>"):"arrowdown"===a?"<kbd>".concat(t(0),"</kbd>"):"escape"===a?"<kbd>Esc</kbd>":"delete"===a?"<kbd>Del</kbd>":"backspace"===a?"<kbd>⌫</kbd>":"space"===a?"<kbd>Space</kbd>":"="===a?"<kbd>+</kbd>":"-"===a?"<kbd>−</kbd>":"<kbd>".concat(e.toUpperCase(),"</kbd>")}).join('<span class="shortcut-plus">+</span>')}},{key:"setEnabled",value:function(e){this.enabled=e}},{key:"getShortcuts",value:function(){var e={};return this.shortcuts.forEach(function(t,a){e[a]={shortcut:t.shortcut,description:t.description,category:t.category}}),e}},{key:"destroy",value:function(){window.removeEventListener("keydown",this.handleKeyDown,!0),this.hideHelp(),this.shortcuts.clear()}}],t&&c(e.prototype,t),a&&c(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,a}()}}]);