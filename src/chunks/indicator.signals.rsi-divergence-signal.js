"use strict";(self.webpackChunkfcsapi_chart=self.webpackChunkfcsapi_chart||[]).push([["indicator.signals.rsi-divergence-signal"],{1077:(e,t,i)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return o(e,t);var i={}.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,s=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return l=e.done,e},e:function(e){s=!0,a=e},f:function(){try{l||null==i.return||i.return()}finally{if(s)throw a}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=Array(t);i<t;i++)n[i]=e[i];return n}function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,l(n.key),n)}}function l(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}function s(e,t,i){return t=u(t),function(e,t){if(t&&("object"==n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,h()?Reflect.construct(t,i||[],u(e).constructor):t.apply(e,i))}function h(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(h=function(){return!!e})()}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}i.r(t),i.d(t,{default:()=>f});const f=function(e){function t(e,i,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=s(this,t,[e,i,n])).title="RSI Divergence",r.shorttitle="RSI Div",r.precision=2,r.rsiLength=void 0!==i.rsiLength?i.rsiLength:7,r.pivotLookback=void 0!==i.pivotLookback?i.pivotLookback:3,r.minDivergenceStrength=void 0!==i.minDivergenceStrength?i.minDivergenceStrength:.5,r.showLabels=void 0===i.showLabels||i.showLabels,r.showLines=void 0===i.showLines||i.showLines,r.bullishColor=i.bullishColor||"#00E676",r.bearishColor=i.bearishColor||"#FF1744",r.panelType="main",r.plots=[{dataKey:"signals",colorKey:"bullishColor",title:"RSI Divergence"}],r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(t,e),i=t,o=[{key:"getSettingsConfig",value:function(){return{inputs:[{key:"rsiLength",label:"RSI Length",type:"number",default:7,min:5,max:50,step:1},{key:"pivotLookback",label:"Pivot Lookback",type:"number",default:3,min:3,max:20,step:1},{key:"minDivergenceStrength",label:"Min Divergence %",type:"number",default:.5,min:.5,max:5,step:.5},{key:"showLines",label:"Show Divergence Lines",type:"checkbox",default:!0},{key:"showLabels",label:"Show Labels",type:"checkbox",default:!0}],style:[{key:"bullishColor",label:"Bullish Divergence",type:"color",default:"#00E676"},{key:"bearishColor",label:"Bearish Divergence",type:"color",default:"#FF1744"}]}}}],(n=[{key:"calculate",value:function(){for(var e=this.engine.data,t=this.engine.dataManager.calculateRSI(e,this.rsiLength),i=this.findSwingPoints(e.map(function(e){return{high:e.high,low:e.low}})),n=this.findSwingPoints(t.map(function(e){return{high:e,low:e}})),r=e.map(function(){return null}),o=[],a=0;a<i.lows.length-1;a++){var l=i.lows[a],s=i.lows[a+1];if(l&&s){var h=this.findNearestRsiSwing(n.lows,l.index,5),u=this.findNearestRsiSwing(n.lows,s.index,5);if(h&&u){var c=(s.value-l.value)/l.value*100,f=(u.value-h.value)/h.value*100;c<-this.minDivergenceStrength&&f>0&&(r[s.index]={type:"bullish",price:e[s.index].low,strength:Math.abs(c)+f},o.push({type:"bullish",startIndex:l.index,endIndex:s.index,startPrice:e[l.index].low,endPrice:e[s.index].low}))}}}for(var d=0;d<i.highs.length-1;d++){var v=i.highs[d],b=i.highs[d+1];if(v&&b){var g=this.findNearestRsiSwing(n.highs,v.index,5),p=this.findNearestRsiSwing(n.highs,b.index,5);if(g&&p){var y=(b.value-v.value)/v.value*100,w=(p.value-g.value)/g.value*100;y>this.minDivergenceStrength&&w<0&&(r[b.index]={type:"bearish",price:e[b.index].high,strength:y+Math.abs(w)},o.push({type:"bearish",startIndex:v.index,endIndex:b.index,startPrice:e[v.index].high,endPrice:e[b.index].high}))}}}this.data={signals:r,divergenceLines:o,rsi:t}}},{key:"findSwingPoints",value:function(e){for(var t=[],i=[],n=this.pivotLookback;n<e.length-this.pivotLookback;n++){var r=!0,o=!0,a=e[n].high,l=e[n].low;if(null!==a&&null!==l){for(var s=1;s<=this.pivotLookback;s++)if(e[n-s].high>=a||e[n+s].high>=a){r=!1;break}for(var h=1;h<=this.pivotLookback;h++)if(e[n-h].low<=l||e[n+h].low<=l){o=!1;break}r&&t.push({index:n,value:a}),o&&i.push({index:n,value:l})}}return{highs:t,lows:i}}},{key:"findNearestRsiSwing",value:function(e,t,i){var n,o=null,a=1/0,l=r(e);try{for(l.s();!(n=l.n()).done;){var s=n.value,h=Math.abs(s.index-t);h<=i&&h<a&&(a=h,o=s)}}catch(u){l.e(u)}finally{l.f()}return o}},{key:"render",value:function(e,t){if(this.visible&&this.data){var i=e.ctx,n=e.getDpr(),o=this.engine,a=o.data;if(this.data.signals&&this.data.signals.length===a.length||(this.calculate(),this.data&&this.data.signals)){i.save(),i.scale(n,n);var l=o.visibleRange;if(this.showLines&&this.data.divergenceLines){var s,h=r(this.data.divergenceLines);try{for(h.s();!(s=h.n()).done;){var u=s.value;u.endIndex>=l.start&&u.startIndex<=l.end&&this.drawDivergenceLine(i,o,u)}}catch(b){h.e(b)}finally{h.f()}}for(var c=l.start;c<l.end;c++)if(!(c<0||c>=this.data.signals.length)){var f=this.data.signals[c];if(f){var d=o.indexToX(c)+o.candleWidth/2,v=o.priceToY(f.price);"bullish"===f.type?(this.drawBullishDivergence(i,d,v),this.showLabels&&this.drawLabel(i,d,v,"DIV+",this.bullishColor)):"bearish"===f.type&&(this.drawBearishDivergence(i,d,v),this.showLabels&&this.drawLabel(i,d,v,"DIV-",this.bearishColor))}}i.restore()}}}},{key:"drawDivergenceLine",value:function(e,t,i){var n=t.indexToX(i.startIndex)+t.candleWidth/2,r=t.indexToX(i.endIndex)+t.candleWidth/2,o=t.priceToY(i.startPrice),a=t.priceToY(i.endPrice);e.strokeStyle="bullish"===i.type?this.bullishColor:this.bearishColor,e.lineWidth=1.5,e.setLineDash([5,5]),e.globalAlpha=.6,e.beginPath(),e.moveTo(n,o),e.lineTo(r,a),e.stroke(),e.setLineDash([]),e.globalAlpha=1}},{key:"drawBullishDivergence",value:function(e,t,i){e.fillStyle=this.bullishColor,e.strokeStyle=this.bullishColor,e.lineWidth=2,e.beginPath(),e.arc(t,i+20,8,0,2*Math.PI),e.stroke(),e.beginPath(),e.moveTo(t,i+20-4),e.lineTo(t-3,i+20-1),e.lineTo(t+3,i+20-1),e.closePath(),e.fill()}},{key:"drawBearishDivergence",value:function(e,t,i){e.fillStyle=this.bearishColor,e.strokeStyle=this.bearishColor,e.lineWidth=2,e.beginPath(),e.arc(t,i-20,8,0,2*Math.PI),e.stroke(),e.beginPath(),e.moveTo(t,i-20+4),e.lineTo(t-3,i-20+1),e.lineTo(t+3,i-20+1),e.closePath(),e.fill()}},{key:"drawLabel",value:function(e,t,i,n,r){e.font="bold 9px sans-serif",e.fillStyle=r,e.textAlign="center";var o="DIV+"===n?40:-35;e.fillText(n,t,i+o)}}])&&a(i.prototype,n),o&&a(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,n,o}(i(8018).A)}}]);